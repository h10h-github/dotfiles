<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Builder::XmlMarkup - Builder -- Easy XML Building</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="XmlBase.html">Builder::XmlBase</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-_attr_value">#_attr_value</a>
    
    <li ><a href="#method-i-_end_tag">#_end_tag</a>
    
    <li ><a href="#method-i-_ensure_no_block">#_ensure_no_block</a>
    
    <li ><a href="#method-i-_insert_attributes">#_insert_attributes</a>
    
    <li ><a href="#method-i-_special">#_special</a>
    
    <li ><a href="#method-i-_start_tag">#_start_tag</a>
    
    <li ><a href="#method-i-_text">#_text</a>
    
    <li ><a href="#method-i-cdata-21">#cdata!</a>
    
    <li ><a href="#method-i-comment-21">#comment!</a>
    
    <li ><a href="#method-i-declare-21">#declare!</a>
    
    <li ><a href="#method-i-instruct-21">#instruct!</a>
    
    <li ><a href="#method-i-target-21">#target!</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Builder::XmlMarkup">
  <h1 id="class-Builder::XmlMarkup" class="class">
    class Builder::XmlMarkup
  </h1>

  <section class="description">
    
<p>Create XML markup easily.  All (well, almost all) methods sent to an <a
href="XmlMarkup.html">XmlMarkup</a> object will be translated to the
equivalent XML markup.  Any method with a block will be treated as an XML
markup tag with nested markup in the block.</p>

<p>Examples will demonstrate this easier than words.  In the following,
<code>xm</code> is an <code>XmlMarkup</code> object.</p>

<pre class="ruby"><span class="ruby-identifier">xm</span>.<span class="ruby-identifier">em</span>(<span class="ruby-string">&quot;emphasized&quot;</span>)            <span class="ruby-comment"># =&gt; &lt;em&gt;emphasized&lt;/em&gt;</span>
<span class="ruby-identifier">xm</span>.<span class="ruby-identifier">em</span> { <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">b</span>(<span class="ruby-string">&quot;emp &amp; bold&quot;</span>) }   <span class="ruby-comment"># =&gt; &lt;em&gt;&lt;b&gt;emph &amp;amp; bold&lt;/b&gt;&lt;/em&gt;</span>
<span class="ruby-identifier">xm</span>.<span class="ruby-identifier">a</span>(<span class="ruby-string">&quot;A Link&quot;</span>, <span class="ruby-string">&quot;href&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;http://onestepback.org&quot;</span>)
                               <span class="ruby-comment"># =&gt; &lt;a href=&quot;http://onestepback.org&quot;&gt;A Link&lt;/a&gt;</span>
<span class="ruby-identifier">xm</span>.<span class="ruby-identifier">div</span> { <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">br</span> }               <span class="ruby-comment"># =&gt; &lt;div&gt;&lt;br/&gt;&lt;/div&gt;</span>
<span class="ruby-identifier">xm</span>.<span class="ruby-identifier">target</span>(<span class="ruby-string">&quot;name&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;compile&quot;</span>, <span class="ruby-string">&quot;option&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;fast&quot;</span>)
                               <span class="ruby-comment"># =&gt; &lt;target option=&quot;fast&quot; name=&quot;compile&quot;\&gt;</span>
                               <span class="ruby-comment"># NOTE: order of attributes is not specified.</span>

<span class="ruby-identifier">xm</span>.<span class="ruby-identifier">instruct!</span>                   <span class="ruby-comment"># &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="ruby-identifier">xm</span>.<span class="ruby-identifier">html</span> {                      <span class="ruby-comment"># &lt;html&gt;</span>
  <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">head</span> {                    <span class="ruby-comment">#   &lt;head&gt;</span>
    <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">title</span>(<span class="ruby-string">&quot;History&quot;</span>)        <span class="ruby-comment">#     &lt;title&gt;History&lt;/title&gt;</span>
  }                            <span class="ruby-comment">#   &lt;/head&gt;</span>
  <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">body</span> {                    <span class="ruby-comment">#   &lt;body&gt;</span>
    <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">comment!</span> <span class="ruby-string">&quot;HI&quot;</span>           <span class="ruby-comment">#     &lt;!-- HI --&gt;</span>
    <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">h1</span>(<span class="ruby-string">&quot;Header&quot;</span>)            <span class="ruby-comment">#     &lt;h1&gt;Header&lt;/h1&gt;</span>
    <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">p</span>(<span class="ruby-string">&quot;paragraph&quot;</span>)          <span class="ruby-comment">#     &lt;p&gt;paragraph&lt;/p&gt;</span>
  }                            <span class="ruby-comment">#   &lt;/body&gt;</span>
}                              <span class="ruby-comment"># &lt;/html&gt;</span>
</pre>

<h2 id="class-Builder::XmlMarkup-label-Notes%3A">Notes:<span><a href="#class-Builder::XmlMarkup-label-Notes%3A">&para;</a> <a href="#documentation">&uarr;</a></span></h2>
<ul><li>
<p>The order that attributes are inserted in markup tags is undefined.</p>
</li><li>
<p>Sometimes you wish to insert text without enclosing tags.  Use the
<code>text!</code> method to accomplish this.</p>

<p>Example:</p>

<pre>xm.div {                          # &lt;div&gt;
  xm.text! &quot;line&quot;; xm.br          #   line&lt;br/&gt;
  xm.text! &quot;another line&quot;; xmbr   #    another line&lt;br/&gt;
}                                 # &lt;/div&gt;</pre>
</li><li>
<p>The special XML characters &lt;, &gt;, and &amp; are converted to &amp;lt;,
&amp;gt; and &amp;amp; automatically.  Use the <code>&lt;&lt;</code>
operation to insert text without modification.</p>
</li><li>
<p>Sometimes tags use special characters not allowed in ruby identifiers.  Use
the <code>tag!</code> method to handle these cases.</p>

<p>Example:</p>

<pre>xml.tag!(&quot;SOAP:Envelope&quot;) { ... }</pre>

<p>will produce …</p>

<pre>&lt;SOAP:Envelope&gt; ... &lt;/SOAP:Envelope&gt;&quot;</pre>

<p><code>tag!</code> will also take text and attribute arguments (after the
tag name) like normal markup methods.  (But see the next bullet item for a
better way to handle XML namespaces).</p>
</li><li>
<p>Direct support for XML namespaces is now available.  If the first argument
to a tag call is a symbol, it will be joined to the tag to produce a
namespace:tag combination.  It is easier to show this than describe it.</p>

<pre>xml.SOAP :Envelope do ... end</pre>

<p>Just put a space before the colon in a namespace to produce the right form
for builder (e.g. “<code>SOAP:Envelope</code>” =&gt; “<code>xml.SOAP
:Envelope</code>”)</p>
</li><li>
<p><a href="XmlMarkup.html">XmlMarkup</a> builds the markup in any object
(called a <em>target</em>) that accepts the <code>&lt;&lt;</code> method. 
If no target is given, then <a href="XmlMarkup.html">XmlMarkup</a> defaults
to a string target.</p>

<p>Examples:</p>

<pre class="ruby"><span class="ruby-identifier">xm</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">result</span> = <span class="ruby-identifier">xm</span>.<span class="ruby-identifier">title</span>(<span class="ruby-string">&quot;yada&quot;</span>)
<span class="ruby-comment"># result is a string containing the markup.</span>

<span class="ruby-identifier">buffer</span> = <span class="ruby-string">&quot;&quot;</span>
<span class="ruby-identifier">xm</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">buffer</span>)
<span class="ruby-comment"># The markup is appended to buffer (using &lt;&lt;)</span>

<span class="ruby-identifier">xm</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">STDOUT</span>)
<span class="ruby-comment"># The markup is written to STDOUT (using &lt;&lt;)</span>

<span class="ruby-identifier">xm</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">x2</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">target=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">xm</span>)
<span class="ruby-comment"># Markup written to +x2+ will be send to +xm+.</span>
</pre>
</li><li>
<p>Indentation is enabled by providing the number of spaces to indent for each
level as a second argument to XmlBuilder.new. Initial indentation may be
specified using a third parameter.</p>

<p>Example:</p>

<pre class="ruby"><span class="ruby-identifier">xm</span> = <span class="ruby-constant">Builder</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">indent=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
<span class="ruby-comment"># xm will produce nicely formatted and indented XML.</span>

<span class="ruby-identifier">xm</span> = <span class="ruby-constant">Builder</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">indent=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>, :<span class="ruby-identifier">margin=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">4</span>)
<span class="ruby-comment"># xm will produce nicely formatted and indented XML with 2</span>
<span class="ruby-comment"># spaces per indent and an over all indentation level of 4.</span>

<span class="ruby-identifier">builder</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">target=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">$stdout</span>, :<span class="ruby-identifier">indent=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
<span class="ruby-identifier">builder</span>.<span class="ruby-identifier">name</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">first</span>(<span class="ruby-string">&quot;Jim&quot;</span>); <span class="ruby-identifier">b</span>.<span class="ruby-identifier">last</span>(<span class="ruby-node">&quot;Weirich) }
# prints:
#     &lt;name&gt;
#       &lt;first&gt;Jim&lt;/first&gt;
#       &lt;last&gt;Weirich&lt;/last&gt;
#     &lt;/name&gt;
</span></pre>
</li><li>
<p>The instance_eval implementation which forces self to refer to the message
receiver as self is now obsolete.  We now use normal block calls to execute
the markup block.  This means that all markup methods must now be
explicitly send to the xml builder. For instance, instead of</p>

<pre>xml.div { strong(&quot;text&quot;) }</pre>

<p>you need to write:</p>

<pre>xml.div { xml.strong(&quot;text&quot;) }</pre>

<p>Although more verbose, the subtle change in semantics within the block was
found to be prone to error.  To make this change a little less cumbersome,
the markup block now gets the markup object sent as an argument, allowing
you to use a shorter alias within the block.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-identifier">xml_builder</span> = <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">xml_builder</span>.<span class="ruby-identifier">div</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">xml</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">xml</span>.<span class="ruby-identifier">stong</span>(<span class="ruby-string">&quot;text&quot;</span>)
}
</pre>
</li></ul>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(options={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create an XML markup builder.  Parameters are specified by an option hash.</p>
<dl class="rdoc-list note-list"><dt>:target =&gt; <em>target_object</em>
<dd>
<p><a href="../Object.html">Object</a> receiving the markup. 
<code>target_object</code> must respond to the
<code>&lt;&lt;(<em>a_string</em>)</code> operator and return itself.  The
default target is a plain string target.</p>
</dd><dt>:indent =&gt; <em>indentation</em>
<dd>
<p>Number of spaces used for indentation.  The default is no indentation and
no line breaks.</p>
</dd><dt>:margin =&gt; <em>initial_indentation_level</em>
<dd>
<p>Amount of initial indentation (specified in levels, not spaces).</p>
</dd><dt>:quote =&gt; <em>:single</em>
<dd>
<p>Use single quotes for attributes rather than double quotes.</p>
</dd><dt>:escape_attrs =&gt; <em>OBSOLETE</em>
<dd>
<p>The :escape_attrs option is no longer supported by builder (and will be
quietly ignored).  <a href="../String.html">String</a> attribute values are
now automatically escaped.  If you need unescaped attribute values (perhaps
you are using entities in the attribute values), then give the value as a
<a href="../Symbol.html">Symbol</a>.  This allows much finer control over
escaping attribute values.</p>
</dd></dl>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="XmlBase.html#method-c-new">Builder::XmlBase.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 189</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">options</span>={})
  <span class="ruby-identifier">indent</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:indent</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">margin</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:margin</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
  <span class="ruby-ivar">@quote</span> = (<span class="ruby-identifier">options</span>[<span class="ruby-value">:quote</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:single</span>) <span class="ruby-operator">?</span> <span class="ruby-string">&quot;&#39;&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&quot;&#39;</span>
  <span class="ruby-ivar">@explicit_nil_handling</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:explicit_nil_handling</span>]
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">indent</span>, <span class="ruby-identifier">margin</span>)
  <span class="ruby-ivar">@target</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:target</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&quot;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-cdata-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cdata!</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert a CDATA section into the XML markup.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-identifier">xml</span>.<span class="ruby-identifier">cdata!</span>(<span class="ruby-string">&quot;text to be included in cdata&quot;</span>)
    <span class="ruby-comment">#=&gt; &lt;![CDATA[text to be included in cdata]]&gt;</span>
</pre>
          
          

          
          <div class="method-source-code" id="cdata-21-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 269</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cdata!</span>(<span class="ruby-identifier">text</span>)
  <span class="ruby-identifier">_ensure_no_block</span> <span class="ruby-operator">::</span><span class="ruby-constant">Kernel</span><span class="ruby-operator">::</span><span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">_special</span>(<span class="ruby-string">&quot;&lt;![CDATA[&quot;</span>, <span class="ruby-string">&quot;]]&gt;&quot;</span>, <span class="ruby-identifier">text</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;]]&gt;&#39;</span>, <span class="ruby-string">&#39;]]]]&gt;&lt;![CDATA[&gt;&#39;</span>), <span class="ruby-keyword">nil</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-comment-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">comment!</span><span
            class="method-args">(comment_text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="comment-21-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">comment!</span>(<span class="ruby-identifier">comment_text</span>)
  <span class="ruby-identifier">_ensure_no_block</span> <span class="ruby-operator">::</span><span class="ruby-constant">Kernel</span><span class="ruby-operator">::</span><span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">_special</span>(<span class="ruby-string">&quot;&lt;!-- &quot;</span>, <span class="ruby-string">&quot; --&gt;&quot;</span>, <span class="ruby-identifier">comment_text</span>, <span class="ruby-keyword">nil</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-declare-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">declare!</span><span
            class="method-args">(inst, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert an XML declaration into the XML markup.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-identifier">xml</span>.<span class="ruby-identifier">declare!</span> :<span class="ruby-constant">ELEMENT</span>, :<span class="ruby-identifier">blah</span>, <span class="ruby-string">&quot;yada&quot;</span>
    <span class="ruby-comment"># =&gt; &lt;!ELEMENT blah &quot;yada&quot;&gt;</span>
</pre>
          
          

          
          <div class="method-source-code" id="declare-21-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 214</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">declare!</span>(<span class="ruby-identifier">inst</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">_indent</span>
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;!#{inst}&quot;</span>
  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">String</span>
      <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">%Q{ &quot;#{arg}&quot;}</span> <span class="ruby-comment"># &quot; WART</span>
    <span class="ruby-keyword">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">Symbol</span>
      <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot; #{arg}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-operator">::</span><span class="ruby-constant">Kernel</span><span class="ruby-operator">::</span><span class="ruby-identifier">block_given?</span>
    <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; [&quot;</span>
    <span class="ruby-identifier">_newline</span>
    <span class="ruby-identifier">_nested_structures</span>(<span class="ruby-identifier">block</span>)
    <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;]&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&gt;&quot;</span>
  <span class="ruby-identifier">_newline</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-instruct-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">instruct!</span><span
            class="method-args">(directive_tag=:xml, attrs={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert a processing instruction into the XML markup.  E.g.</p>

<p>For example:</p>

<pre class="ruby"><span class="ruby-identifier">xml</span>.<span class="ruby-identifier">instruct!</span>
    <span class="ruby-comment">#=&gt; &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="ruby-identifier">xml</span>.<span class="ruby-identifier">instruct!</span> :<span class="ruby-identifier">aaa</span>, :<span class="ruby-identifier">bbb=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;ccc&quot;</span>
    <span class="ruby-comment">#=&gt; &lt;?aaa bbb=&quot;ccc&quot;?&gt;</span>
</pre>

<p>Note: If the encoding is setup to “UTF-8” and the value of $KCODE is
“UTF8”, then builder will emit UTF-8 encoded strings rather than the entity
encoding normally used.</p>
          
          

          
          <div class="method-source-code" id="instruct-21-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 247</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">instruct!</span>(<span class="ruby-identifier">directive_tag</span>=<span class="ruby-value">:xml</span>, <span class="ruby-identifier">attrs</span>={})
  <span class="ruby-identifier">_ensure_no_block</span> <span class="ruby-operator">::</span><span class="ruby-constant">Kernel</span><span class="ruby-operator">::</span><span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">directive_tag</span> <span class="ruby-operator">==</span> <span class="ruby-value">:xml</span>
    <span class="ruby-identifier">a</span> = { <span class="ruby-value">:version=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;1.0&quot;</span>, <span class="ruby-value">:encoding=</span><span class="ruby-operator">&gt;</span><span class="ruby-string">&quot;UTF-8&quot;</span> }
    <span class="ruby-identifier">attrs</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">attrs</span>
    <span class="ruby-ivar">@encoding</span> = <span class="ruby-identifier">attrs</span>[<span class="ruby-value">:encoding</span>].<span class="ruby-identifier">downcase</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">_special</span>(
    <span class="ruby-node">&quot;&lt;?#{directive_tag}&quot;</span>,
    <span class="ruby-string">&quot;?&gt;&quot;</span>,
    <span class="ruby-keyword">nil</span>,
    <span class="ruby-identifier">attrs</span>,
    [<span class="ruby-value">:version</span>, <span class="ruby-value">:encoding</span>, <span class="ruby-value">:standalone</span>])
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-target-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">target!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the target of the builder.</p>
          
          

          
          <div class="method-source-code" id="target-21-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 199</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">target!</span>
  <span class="ruby-ivar">@target</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-_attr_value" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_attr_value</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="_attr_value-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 320</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_attr_value</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">Symbol</span>
    <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">_escape_attribute</span>(<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_end_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_end_tag</span><span
            class="method-args">(sym)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert an ending tag.</p>
          
          

          
          <div class="method-source-code" id="_end_tag-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 304</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_end_tag</span>(<span class="ruby-identifier">sym</span>)
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;/#{sym}&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_ensure_no_block" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_ensure_no_block</span><span
            class="method-args">(got_block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="_ensure_no_block-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 329</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_ensure_no_block</span>(<span class="ruby-identifier">got_block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">got_block</span>
    <span class="ruby-operator">::</span><span class="ruby-constant">Kernel</span><span class="ruby-operator">::</span><span class="ruby-identifier">raise</span> <span class="ruby-constant">IllegalBlockError</span>.<span class="ruby-identifier">new</span>(
      <span class="ruby-string">&quot;Blocks are not allowed on XML instructions&quot;</span>
    )
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_insert_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_insert_attributes</span><span
            class="method-args">(attrs, order=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert the attributes (given in the hash).</p>
          
          

          
          <div class="method-source-code" id="_insert_attributes-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_insert_attributes</span>(<span class="ruby-identifier">attrs</span>, <span class="ruby-identifier">order</span>=[])
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">order</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">attrs</span>[<span class="ruby-identifier">k</span>]
    <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">%Q{ #{k}=#{@quote}#{_attr_value(v)}#{@quote}}</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">attrs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">%Q{ #{k}=#{@quote}#{_attr_value(v)}#{@quote}}</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">member?</span>(<span class="ruby-identifier">k</span>) <span class="ruby-comment"># &quot; WART</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_special" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_special</span><span
            class="method-args">(open, close, data=nil, attrs=nil, order=[])</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert special instruction.</p>
          
          

          
          <div class="method-source-code" id="_special-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 285</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_special</span>(<span class="ruby-identifier">open</span>, <span class="ruby-identifier">close</span>, <span class="ruby-identifier">data</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">attrs</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">order</span>=[])
  <span class="ruby-identifier">_indent</span>
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">open</span>
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">data</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>
  <span class="ruby-identifier">_insert_attributes</span>(<span class="ruby-identifier">attrs</span>, <span class="ruby-identifier">order</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">attrs</span>
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">close</span>
  <span class="ruby-identifier">_newline</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_start_tag" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_start_tag</span><span
            class="method-args">(sym, attrs, end_too=false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Start an XML tag.  If <code>end_too</code> is true, then the start tag is
also the end tag (e.g.  &lt;br/&gt;</p>
          
          

          
          <div class="method-source-code" id="_start_tag-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 296</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_start_tag</span>(<span class="ruby-identifier">sym</span>, <span class="ruby-identifier">attrs</span>, <span class="ruby-identifier">end_too</span>=<span class="ruby-keyword">false</span>)
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;#{sym}&quot;</span>
  <span class="ruby-identifier">_insert_attributes</span>(<span class="ruby-identifier">attrs</span>)
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_too</span>
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-_text" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">_text</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Insert text directly in to the builder&#39;s target.</p>
          
          

          
          <div class="method-source-code" id="_text-source">
            <pre><span class="ruby-comment"># File lib/builder/xmlmarkup.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">_text</span>(<span class="ruby-identifier">text</span>)
  <span class="ruby-ivar">@target</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

