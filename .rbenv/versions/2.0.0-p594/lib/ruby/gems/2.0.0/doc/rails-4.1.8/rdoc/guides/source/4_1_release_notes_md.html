<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>4_1_release_notes - rails-4.1.8 Documentation</title>

<link href="../../fonts.css" rel="stylesheet">
<link href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/navigation.js"></script>
<script src="../../js/search_index.js"></script>
<script src="../../js/search.js"></script>
<script src="../../js/searcher.js"></script>
<script src="../../js/darkfish.js"></script>


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Ruby+on+Rails+4.1+Release+Notes">Ruby on Rails 4.1 Release Notes</a>
    <li><a href="#label-Upgrading+to+Rails+4.1">Upgrading to Rails 4.1</a>
    <li><a href="#label-Major+Features">Major Features</a>
    <li><a href="#label-Spring+Application+Preloader">Spring Application Preloader</a>
    <li><a href="#label-config%2Fsecrets.yml"><code>config/secrets.yml</code></a>
    <li><a href="#label-Action+Pack+Variants">Action Pack Variants</a>
    <li><a href="#label-Action+Mailer+Previews">Action Mailer Previews</a>
    <li><a href="#label-Active+Record+enums">Active Record enums</a>
    <li><a href="#label-Message+Verifiers">Message Verifiers</a>
    <li><a href="#label-Module%23concerning">Module#concerning</a>
    <li><a href="#label-CSRF+protection+from+remote+%3Cscript%3E+tags">CSRF protection from remote <code>&lt;script&gt;</code> tags</a>
    <li><a href="#label-Railties">Railties</a>
    <li><a href="#label-Removals">Removals</a>
    <li><a href="#label-Notable+changes">Notable changes</a>
    <li><a href="#label-Action+Pack">Action Pack</a>
    <li><a href="#label-Removals">Removals</a>
    <li><a href="#label-Notable+changes">Notable changes</a>
    <li><a href="#label-Action+Mailer">Action Mailer</a>
    <li><a href="#label-Notable+changes">Notable changes</a>
    <li><a href="#label-Active+Record">Active Record</a>
    <li><a href="#label-Removals">Removals</a>
    <li><a href="#label-Deprecations">Deprecations</a>
    <li><a href="#label-Notable+changes">Notable changes</a>
    <li><a href="#label-Active+Model">Active Model</a>
    <li><a href="#label-Deprecations">Deprecations</a>
    <li><a href="#label-Notable+changes">Notable changes</a>
    <li><a href="#label-Active+Support">Active Support</a>
    <li><a href="#label-Removals">Removals</a>
    <li><a href="#label-Deprecations">Deprecations</a>
    <li><a href="#label-Notable+changes">Notable changes</a>
    <li><a href="#label-Credits">Credits</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../guides/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../guides/Rakefile.html">Rakefile</a>
  
    <li><a href="../../guides/assets/images/icons/README.html">README</a>
  
    <li><a href="../../guides/assets/javascripts/guides_js.html">guides.js</a>
  
    <li><a href="../../guides/assets/javascripts/jquery_min_js.html">jquery.min.js</a>
  
    <li><a href="../../guides/assets/javascripts/responsive-tables_js.html">responsive-tables.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAS3_js.html">shBrushAS3.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAppleScript_js.html">shBrushAppleScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushBash_js.html">shBrushBash.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCSharp_js.html">shBrushCSharp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushColdFusion_js.html">shBrushColdFusion.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCpp_js.html">shBrushCpp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCss_js.html">shBrushCss.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDelphi_js.html">shBrushDelphi.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDiff_js.html">shBrushDiff.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushErlang_js.html">shBrushErlang.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushGroovy_js.html">shBrushGroovy.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJScript_js.html">shBrushJScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJava_js.html">shBrushJava.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJavaFX_js.html">shBrushJavaFX.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPerl_js.html">shBrushPerl.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPhp_js.html">shBrushPhp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPlain_js.html">shBrushPlain.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPowerShell_js.html">shBrushPowerShell.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPython_js.html">shBrushPython.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushRuby_js.html">shBrushRuby.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSass_js.html">shBrushSass.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushScala_js.html">shBrushScala.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSql_js.html">shBrushSql.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushVb_js.html">shBrushVb.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushXml_js.html">shBrushXml.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shCore_js.html">shCore.js</a>
  
    <li><a href="../../guides/assets/stylesheets/fixes_css.html">fixes.css</a>
  
    <li><a href="../../guides/assets/stylesheets/kindle_css.html">kindle.css</a>
  
    <li><a href="../../guides/assets/stylesheets/main_css.html">main.css</a>
  
    <li><a href="../../guides/assets/stylesheets/print_css.html">print.css</a>
  
    <li><a href="../../guides/assets/stylesheets/reset_css.html">reset.css</a>
  
    <li><a href="../../guides/assets/stylesheets/responsive-tables_css.html">responsive-tables.css</a>
  
    <li><a href="../../guides/assets/stylesheets/style_css.html">style.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCore_css.html">shCore.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDefault_css.html">shCoreDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDjango_css.html">shCoreDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEclipse_css.html">shCoreEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEmacs_css.html">shCoreEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreFadeToGrey_css.html">shCoreFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMDUltra_css.html">shCoreMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMidnight_css.html">shCoreMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreRDark_css.html">shCoreRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDefault_css.html">shThemeDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDjango_css.html">shThemeDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEclipse_css.html">shThemeEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEmacs_css.html">shThemeEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeFadeToGrey_css.html">shThemeFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMDUltra_css.html">shThemeMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMidnight_css.html">shThemeMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRDark_css.html">shThemeRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRailsGuides_css.html">shThemeRailsGuides.css</a>
  
    <li><a href="../../guides/code/getting_started/Gemfile.html">Gemfile</a>
  
    <li><a href="../../guides/code/getting_started/Gemfile_lock.html">Gemfile.lock</a>
  
    <li><a href="../../guides/code/getting_started/README_rdoc.html">README</a>
  
    <li><a href="../../guides/code/getting_started/Rakefile.html">Rakefile</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/javascripts/application_js.html">application.js</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/javascripts/comments_js_coffee.html">comments.js.coffee</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/javascripts/posts_js_coffee.html">posts.js.coffee</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/javascripts/welcome_js_coffee.html">welcome.js.coffee</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/stylesheets/application_css.html">application.css</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/stylesheets/comments_css_scss.html">comments.css.scss</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/stylesheets/posts_css_scss.html">posts.css.scss</a>
  
    <li><a href="../../guides/code/getting_started/app/assets/stylesheets/welcome_css_scss.html">welcome.css.scss</a>
  
    <li><a href="../../guides/code/getting_started/config_ru.html">config.ru</a>
  
    <li><a href="../../guides/code/getting_started/public/404_html.html">404.html</a>
  
    <li><a href="../../guides/code/getting_started/public/422_html.html">422.html</a>
  
    <li><a href="../../guides/code/getting_started/public/500_html.html">500.html</a>
  
    <li><a href="../../guides/code/getting_started/public/favicon_ico.html">favicon.ico</a>
  
    <li><a href="../../guides/code/getting_started/public/robots_txt.html">robots</a>
  
    <li><a href="../../guides/source/2_2_release_notes_md.html">2_2_release_notes</a>
  
    <li><a href="../../guides/source/2_3_release_notes_md.html">2_3_release_notes</a>
  
    <li><a href="../../guides/source/3_0_release_notes_md.html">3_0_release_notes</a>
  
    <li><a href="../../guides/source/3_1_release_notes_md.html">3_1_release_notes</a>
  
    <li><a href="../../guides/source/3_2_release_notes_md.html">3_2_release_notes</a>
  
    <li><a href="../../guides/source/4_0_release_notes_md.html">4_0_release_notes</a>
  
    <li><a href="../../guides/source/4_1_release_notes_md.html">4_1_release_notes</a>
  
    <li><a href="../../guides/source/action_controller_overview_md.html">action_controller_overview</a>
  
    <li><a href="../../guides/source/action_mailer_basics_md.html">action_mailer_basics</a>
  
    <li><a href="../../guides/source/action_view_overview_md.html">action_view_overview</a>
  
    <li><a href="../../guides/source/active_model_basics_md.html">active_model_basics</a>
  
    <li><a href="../../guides/source/active_record_basics_md.html">active_record_basics</a>
  
    <li><a href="../../guides/source/active_record_callbacks_md.html">active_record_callbacks</a>
  
    <li><a href="../../guides/source/active_record_querying_md.html">active_record_querying</a>
  
    <li><a href="../../guides/source/active_record_validations_md.html">active_record_validations</a>
  
    <li><a href="../../guides/source/active_support_core_extensions_md.html">active_support_core_extensions</a>
  
    <li><a href="../../guides/source/active_support_instrumentation_md.html">active_support_instrumentation</a>
  
    <li><a href="../../guides/source/api_documentation_guidelines_md.html">api_documentation_guidelines</a>
  
    <li><a href="../../guides/source/asset_pipeline_md.html">asset_pipeline</a>
  
    <li><a href="../../guides/source/association_basics_md.html">association_basics</a>
  
    <li><a href="../../guides/source/caching_with_rails_md.html">caching_with_rails</a>
  
    <li><a href="../../guides/source/command_line_md.html">command_line</a>
  
    <li><a href="../../guides/source/configuring_md.html">configuring</a>
  
    <li><a href="../../guides/source/contributing_to_ruby_on_rails_md.html">contributing_to_ruby_on_rails</a>
  
    <li><a href="../../guides/source/debugging_rails_applications_md.html">debugging_rails_applications</a>
  
    <li><a href="../../guides/source/development_dependencies_install_md.html">development_dependencies_install</a>
  
    <li><a href="../../guides/source/documents_yaml.html">documents.yaml</a>
  
    <li><a href="../../guides/source/engines_md.html">engines</a>
  
    <li><a href="../../guides/source/form_helpers_md.html">form_helpers</a>
  
    <li><a href="../../guides/source/generators_md.html">generators</a>
  
    <li><a href="../../guides/source/getting_started_md.html">getting_started</a>
  
    <li><a href="../../guides/source/i18n_md.html">i18n</a>
  
    <li><a href="../../guides/source/initialization_md.html">initialization</a>
  
    <li><a href="../../guides/source/layouts_and_rendering_md.html">layouts_and_rendering</a>
  
    <li><a href="../../guides/source/maintenance_policy_md.html">maintenance_policy</a>
  
    <li><a href="../../guides/source/migrations_md.html">migrations</a>
  
    <li><a href="../../guides/source/nested_model_forms_md.html">nested_model_forms</a>
  
    <li><a href="../../guides/source/plugins_md.html">plugins</a>
  
    <li><a href="../../guides/source/rails_application_templates_md.html">rails_application_templates</a>
  
    <li><a href="../../guides/source/rails_on_rack_md.html">rails_on_rack</a>
  
    <li><a href="../../guides/source/routing_md.html">routing</a>
  
    <li><a href="../../guides/source/ruby_on_rails_guides_guidelines_md.html">ruby_on_rails_guides_guidelines</a>
  
    <li><a href="../../guides/source/security_md.html">security</a>
  
    <li><a href="../../guides/source/testing_md.html">testing</a>
  
    <li><a href="../../guides/source/upgrading_ruby_on_rails_md.html">upgrading_ruby_on_rails</a>
  
    <li><a href="../../guides/source/working_with_javascript_in_rails_md.html">working_with_javascript_in_rails</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page guides/source/4_1_release_notes.md">

<h1 id="label-Ruby+on+Rails+4.1+Release+Notes">Ruby on Rails 4.1 Release Notes<span><a href="#label-Ruby+on+Rails+4.1+Release+Notes">&para;</a> <a href="#documentation">&uarr;</a></span></h1>

<p>Highlights in Rails 4.1:</p>
<ul><li>
<p>Spring application preloader</p>
</li><li>
<p><code>config/secrets.yml</code></p>
</li><li>
<p>Action Pack variants</p>
</li><li>
<p>Action Mailer previews</p>
</li></ul>

<p>These release notes cover only the major changes. To learn about various
bug fixes and changes, please refer to the change logs or check out the <a
href="https://github.com/rails/rails/commits/4-1-stable">list of
commits</a> in the main Rails repository on GitHub.</p>
<hr>

<h2 id="label-Upgrading+to+Rails+4.1">Upgrading to Rails 4.1<span><a href="#label-Upgrading+to+Rails+4.1">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>If you&#39;re upgrading an existing application, it&#39;s a great idea to
have good test coverage before going in. You should also first upgrade to
Rails 4.0 in case you haven&#39;t and make sure your application still runs
as expected before attempting an update to Rails 4.1. A list of things to
watch out for when upgrading is available in the <a
href="upgrading_ruby_on_rails.html#upgrading-from-rails-4-0-to-rails-4-1">Upgrading
Ruby on Rails</a> guide.</p>

<h2 id="label-Major+Features">Major Features<span><a href="#label-Major+Features">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<h3 id="label-Spring+Application+Preloader">Spring Application Preloader<span><a href="#label-Spring+Application+Preloader">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Spring is a Rails application preloader. It speeds up development by
keeping your application running in the background so you don&#39;t need to
boot it every time you run a test, rake task or migration.</p>

<p>New Rails 4.1 applications will ship with “springified” binstubs. This
means that <code>bin/rails</code> and <code>bin/rake</code> will
automatically take advantage of preloaded spring environments.</p>

<p><strong>Running rake tasks:</strong></p>

<pre>bin/rake test:models</pre>

<p><strong>Running a Rails command:</strong></p>

<pre>bin/rails console</pre>

<p><strong>Spring introspection:</strong></p>

<pre>$ bin/spring status
Spring is running:

 1182 spring server | my_app | started 29 mins ago
 3656 spring app    | my_app | started 23 secs ago | test mode
 3746 spring app    | my_app | started 10 secs ago | development mode</pre>

<p>Have a look at the <a
href="https://github.com/rails/spring/blob/master/README.md">Spring
README</a> to see all available features.</p>

<p>See the <a href="upgrading_ruby_on_rails.html#spring">Upgrading Ruby on
Rails</a> guide on how to migrate existing applications to use this
feature.</p>

<h3 id="label-config%2Fsecrets.yml"><code>config/secrets.yml</code><span><a href="#label-config%2Fsecrets.yml">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Rails 4.1 generates a new <code>secrets.yml</code> file in the
<code>config</code> folder. By default, this file contains the
application&#39;s <code>secret_key_base</code>, but it could also be used
to store other secrets such as access keys for external APIs.</p>

<p>The secrets added to this file are accessible via
<code>Rails.application.secrets</code>. For example, with the following
<code>config/secrets.yml</code>:</p>

<pre>development:
  secret_key_base: 3b7cd727ee24e8444053437c36cc66c3
  some_api_key: SOMEKEY</pre>

<p><code>Rails.application.secrets.some_api_key</code> returns
<code>SOMEKEY</code> in the development environment.</p>

<p>See the <a href="upgrading_ruby_on_rails.html#config-secrets-yml">Upgrading
Ruby on Rails</a> guide on how to migrate existing applications to use this
feature.</p>

<h3 id="label-Action+Pack+Variants">Action Pack Variants<span><a href="#label-Action+Pack+Variants">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>We often want to render different HTML/JSON/XML templates for phones,
tablets, and desktop browsers. Variants make it easy.</p>

<p>The request variant is a specialization of the request format, like
<code>:tablet</code>, <code>:phone</code>, or <code>:desktop</code>.</p>

<p>You can set the variant in a <code>before_action</code>:</p>

<pre class="ruby"><span class="ruby-identifier">request</span>.<span class="ruby-identifier">variant</span> = :<span class="ruby-identifier">tablet</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">user_agent</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/iPad/</span>
</pre>

<p>Respond to variants in the action just like you respond to formats:</p>

<pre class="ruby"><span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">html</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">html</span>.<span class="ruby-identifier">tablet</span> <span class="ruby-comment"># renders app/views/projects/show.html+tablet.erb</span>
    <span class="ruby-identifier">html</span>.<span class="ruby-identifier">phone</span> { <span class="ruby-identifier">extra_setup</span>; <span class="ruby-identifier">render</span> <span class="ruby-operator">...</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Provide separate templates for each format and variant:</p>

<pre>app/views/projects/show.html.erb
app/views/projects/show.html+tablet.erb
app/views/projects/show.html+phone.erb</pre>

<p>You can also simplify the variants definition using the inline syntax:</p>

<pre class="ruby"><span class="ruby-identifier">respond_to</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">format</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">format</span>.<span class="ruby-identifier">js</span>         { <span class="ruby-identifier">render</span> <span class="ruby-string">&quot;trash&quot;</span> }
  <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>.<span class="ruby-identifier">phone</span> { <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">progress_path</span> }
  <span class="ruby-identifier">format</span>.<span class="ruby-identifier">html</span>.<span class="ruby-identifier">none</span>  { <span class="ruby-identifier">render</span> <span class="ruby-string">&quot;trash&quot;</span> }
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Action+Mailer+Previews">Action Mailer Previews<span><a href="#label-Action+Mailer+Previews">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Action Mailer previews provide a way to visually see how emails look by
visiting a special URL that renders them.</p>

<p>You implement a preview class whose methods return the mail object
you&#39;d like to check:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">NotifierPreview</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Preview</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">welcome</span>
    <span class="ruby-constant">Notifier</span>.<span class="ruby-identifier">welcome</span>(<span class="ruby-constant">User</span>.<span class="ruby-identifier">first</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The preview is available in <a
href="http://localhost:3000/rails/mailers/notifier/welcome">localhost:3000/rails/mailers/notifier/welcome</a>,
and a list of them in <a
href="http://localhost:3000/rails/mailers">localhost:3000/rails/mailers</a>.</p>

<p>By default, these preview classes live in
<code>test/mailers/previews</code>. This can be configured using the
<code>preview_path</code> option.</p>

<p>See its <a
href="http://api.rubyonrails.org/v4.1.0/classes/ActionMailer/Base.html#class-ActionMailer::Base-label-Previewing+emails">documentation</a>
for a detailed write up.</p>

<h3 id="label-Active+Record+enums">Active Record enums<span><a href="#label-Active+Record+enums">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Declare an enum attribute where the values map to integers in the database,
but can be queried by name.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Conversation</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">enum</span> <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> [ :<span class="ruby-identifier">active</span>, :<span class="ruby-identifier">archived</span> ]
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">conversation</span>.<span class="ruby-identifier">archived!</span>
<span class="ruby-identifier">conversation</span>.<span class="ruby-identifier">active?</span> <span class="ruby-comment"># =&gt; false</span>
<span class="ruby-identifier">conversation</span>.<span class="ruby-identifier">status</span>  <span class="ruby-comment"># =&gt; &quot;archived&quot;</span>

<span class="ruby-constant">Conversation</span>.<span class="ruby-identifier">archived</span> <span class="ruby-comment"># =&gt; Relation for all archived Conversations</span>

<span class="ruby-constant">Conversation</span>.<span class="ruby-identifier">statuses</span> <span class="ruby-comment"># =&gt; { &quot;active&quot; =&gt; 0, &quot;archived&quot; =&gt; 1 }</span>
</pre>

<p>See its <a
href="http://api.rubyonrails.org/v4.1.0/classes/ActiveRecord/Enum.html">documentation</a>
for a detailed write up.</p>

<h3 id="label-Message+Verifiers">Message Verifiers<span><a href="#label-Message+Verifiers">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Message verifiers can be used to generate and verify signed messages. This
can be useful to safely transport sensitive data like remember-me tokens
and friends.</p>

<p>The method <code>Rails.application.message_verifier</code> returns a new
message verifier that signs messages with a key derived from
secret_key_base and the given message verifier name:</p>

<pre class="ruby"><span class="ruby-identifier">signed_token</span> = <span class="ruby-constant">Rails</span>.<span class="ruby-identifier">application</span>.<span class="ruby-identifier">message_verifier</span>(:<span class="ruby-identifier">remember_me</span>).<span class="ruby-identifier">generate</span>(<span class="ruby-identifier">token</span>)
<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">application</span>.<span class="ruby-identifier">message_verifier</span>(:<span class="ruby-identifier">remember_me</span>).<span class="ruby-identifier">verify</span>(<span class="ruby-identifier">signed_token</span>) <span class="ruby-comment"># =&gt; token</span>

<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">application</span>.<span class="ruby-identifier">message_verifier</span>(:<span class="ruby-identifier">remember_me</span>).<span class="ruby-identifier">verify</span>(<span class="ruby-identifier">tampered_token</span>)
<span class="ruby-comment"># raises ActiveSupport::MessageVerifier::InvalidSignature</span>
</pre>

<h3 id="label-Module%23concerning">Module#concerning<span><a href="#label-Module%23concerning">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>A natural, low-ceremony way to separate responsibilities within a class:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Todo</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">concerning</span> :<span class="ruby-constant">EventTracking</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">included</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">has_many</span> :<span class="ruby-identifier">events</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">def</span> <span class="ruby-identifier">latest_event</span>
      <span class="ruby-operator">...</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">private</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier">some_internal_method</span>
        <span class="ruby-operator">...</span>
      <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This example is equivalent to defining a <code>EventTracking</code> module
inline, extending it with <code>ActiveSupport::Concern</code>, then mixing
it in to the <code>Todo</code> class.</p>

<p>See its <a
href="http://api.rubyonrails.org/v4.1.0/classes/Module/Concerning.html">documentation</a>
for a detailed write up and the intended use cases.</p>

<h3 id="label-CSRF+protection+from+remote+%3Cscript%3E+tags">CSRF protection from remote <code>&lt;script&gt;</code> tags<span><a href="#label-CSRF+protection+from+remote+%3Cscript%3E+tags">&para;</a> <a href="#documentation">&uarr;</a></span></h3>

<p>Cross-site request forgery (CSRF) protection now covers GET requests with
JavaScript responses, too. That prevents a third-party site from
referencing your JavaScript URL and attempting to run it to extract
sensitive data.</p>

<p>This means any of your tests that hit <code>.js</code> URLs will now fail
CSRF protection unless they use <code>xhr</code>. Upgrade your tests to be
explicit about expecting XmlHttpRequests. Instead of <code>post :create,
format: :js</code>, switch to the explicit <code>xhr :post, :create,
format: :js</code>.</p>

<h2 id="label-Railties">Railties<span><a href="#label-Railties">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Please refer to the <a
href="https://github.com/rails/rails/blob/4-1-stable/railties/CHANGELOG.md">Changelog</a>
for detailed changes.</p>

<h3 id="label-Removals">Removals<span><a href="#label-Removals">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Removed <code>update:application_controller</code> rake task.</p>
</li><li>
<p>Removed deprecated <code>Rails.application.railties.engines</code>.</p>
</li><li>
<p>Removed deprecated <code>threadsafe!</code> from Rails Config.</p>
</li><li>
<p>Removed deprecated
<code>ActiveRecord::Generators::ActiveModel#update_attributes</code> in 
favor of <code>ActiveRecord::Generators::ActiveModel#update</code>.</p>
</li><li>
<p>Removed deprecated <code>config.whiny_nils</code> option.</p>
</li><li>
<p>Removed deprecated rake tasks for running tests: <code>rake
test:uncommitted</code> and  <code>rake test:recent</code>.</p>
</li></ul>

<h3 id="label-Notable+changes">Notable changes<span><a href="#label-Notable+changes">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>The <a href="https://github.com/rails/spring">Spring application
preloader</a> is now installed  by default for new applications. It uses
the development group of  the <a
href="../code/getting_started/Gemfile.html">Gemfile</a>, so will not be
installed in  production. (<a
href="https://github.com/rails/rails/pull/12958">Pull Request</a>)</p>
</li><li>
<p><code>BACKTRACE</code> environment variable to show unfiltered backtraces
for test  failures. (<a
href="https://github.com/rails/rails/commit/84eac5dab8b0fe9ee20b51250e52ad7bfea36553">Commit</a>)</p>
</li><li>
<p>Exposed <code>MiddlewareStack#unshift</code> to environment  configuration.
(<a href="https://github.com/rails/rails/pull/12479">Pull Request</a>)</p>
</li><li>
<p>Added <code>Application#message_verifier</code> method to return a message 
verifier. (<a href="https://github.com/rails/rails/pull/12995">Pull
Request</a>)</p>
</li><li>
<p>The <code>test_help.rb</code> file which is required by the default
generated test  helper will automatically keep your test database
up-to-date with  <code>db/schema.rb</code> (or
<code>db/structure.sql</code>). It raises an error if  reloading the schema
does not resolve all pending migrations. Opt out  with
<code>config.active_record.maintain_test_schema = false</code>. (<a
href="https://github.com/rails/rails/pull/13528">Pull Request</a>)</p>
</li><li>
<p>Introduce <code>Rails.gem_version</code> as a convenience method to return 
<code>Gem::Version.new(Rails.version)</code>, suggesting a more reliable
way to perform  version comparison. (<a
href="https://github.com/rails/rails/pull/14103">Pull Request</a>)</p>
</li></ul>

<h2 id="label-Action+Pack">Action Pack<span><a href="#label-Action+Pack">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Please refer to the <a
href="https://github.com/rails/rails/blob/4-1-stable/actionpack/CHANGELOG.md">Changelog</a>
for detailed changes.</p>

<h3 id="label-Removals">Removals<span><a href="#label-Removals">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Removed deprecated Rails application fallback for integration testing, set 
<code>ActionDispatch.test_app</code> instead.</p>
</li><li>
<p>Removed deprecated <code>page_cache_extension</code> config.</p>
</li><li>
<p>Removed deprecated <code>ActionController::RecordIdentifier</code>, use 
<code>ActionView::RecordIdentifier</code> instead.</p>
</li><li>
<p>Removed deprecated constants from Action Controller:</p>
</li></ul>

<p>| Removed | Successor |  |:———————————–|:——————————–|  |
ActionController::AbstractRequest | ActionDispatch::Request |  |
ActionController::Request | ActionDispatch::Request |  |
ActionController::AbstractResponse | ActionDispatch::Response |  |
ActionController::Response | ActionDispatch::Response |  |
ActionController::Routing | ActionDispatch::Routing |  |
ActionController::Integration | ActionDispatch::Integration |  |
ActionController::IntegrationTest | ActionDispatch::IntegrationTest |</p>

<h3 id="label-Notable+changes">Notable changes<span><a href="#label-Notable+changes">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p><code>protect_from_forgery</code> also prevents cross-origin
<code>&lt;script&gt;</code> tags.  Update your tests to use <code>xhr :get,
:foo, format: :js</code> instead of  <code>get :foo, format: :js</code>. 
(<a href="https://github.com/rails/rails/pull/13345">Pull Request</a>)</p>
</li><li>
<p><code>#url_for</code> takes a hash with options inside an  array. (<a
href="https://github.com/rails/rails/pull/9599">Pull Request</a>)</p>
</li><li>
<p>Added <code>session#fetch</code> method fetch behaves similarly to  <a
href="http://www.ruby-doc.org/core-1.9.3/Hash.html#method-i-fetch">Hash#fetch</a>,
with the exception that the returned value is always saved into the 
session. (<a href="https://github.com/rails/rails/pull/12692">Pull
Request</a>)</p>
</li><li>
<p>Separated Action View completely from Action  Pack. (<a
href="https://github.com/rails/rails/pull/11032">Pull Request</a>)</p>
</li><li>
<p>Log which keys were affected by deep  munge. (<a
href="https://github.com/rails/rails/pull/13813">Pull Request</a>)</p>
</li><li>
<p>New config option <code>config.action_dispatch.perform_deep_munge</code> to
opt out of  params “deep munging” that was used to address security
vulnerability  CVE-2013-0155. (<a
href="https://github.com/rails/rails/pull/13188">Pull Request</a>)</p>
</li><li>
<p>New config option <code>config.action_dispatch.cookies_serializer</code>
for specifying a  serializer for the signed and encrypted cookie jars.
(Pull Requests  <a href="https://github.com/rails/rails/pull/13692">1</a>, 
<a href="https://github.com/rails/rails/pull/13945">2</a> /  <a
href="upgrading_ruby_on_rails.html#cookies-serializer">More Details</a>)</p>
</li><li>
<p>Added <code>render :plain</code>, <code>render :html</code> and
<code>render   :body</code>. (<a
href="https://github.com/rails/rails/pull/14062">Pull Request</a> /  <a
href="upgrading_ruby_on_rails.html#rendering-content-from-string">More
Details</a>)</p>
</li></ul>

<h2 id="label-Action+Mailer">Action Mailer<span><a href="#label-Action+Mailer">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Please refer to the <a
href="https://github.com/rails/rails/blob/4-1-stable/actionmailer/CHANGELOG.md">Changelog</a>
for detailed changes.</p>

<h3 id="label-Notable+changes">Notable changes<span><a href="#label-Notable+changes">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Added mailer previews feature based on 37 Signals mail_view  gem. (<a
href="https://github.com/rails/rails/commit/d6dec7fcb6b8fddf8c170182d4fe64ecfc7b2261">Commit</a>)</p>
</li><li>
<p>Instrument the generation of Action Mailer messages. The time it takes to 
generate a message is written to the log. (<a
href="https://github.com/rails/rails/pull/12556">Pull Request</a>)</p>
</li></ul>

<h2 id="label-Active+Record">Active Record<span><a href="#label-Active+Record">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Please refer to the <a
href="https://github.com/rails/rails/blob/4-1-stable/activerecord/CHANGELOG.md">Changelog</a>
for detailed changes.</p>

<h3 id="label-Removals">Removals<span><a href="#label-Removals">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Removed deprecated nil-passing to the following <code>SchemaCache</code>
methods:  <code>primary_keys</code>, <code>tables</code>,
<code>columns</code> and <code>columns_hash</code>.</p>
</li><li>
<p>Removed deprecated block filter from
<code>ActiveRecord::Migrator#migrate</code>.</p>
</li><li>
<p>Removed deprecated String constructor from
<code>ActiveRecord::Migrator</code>.</p>
</li><li>
<p>Removed deprecated <code>scope</code> use without passing a callable
object.</p>
</li><li>
<p>Removed deprecated <code>transaction_joinable=</code> in favor of
<code>begin_transaction</code>  with <code>d:joinable</code> option.</p>
</li><li>
<p>Removed deprecated <code>decrement_open_transactions</code>.</p>
</li><li>
<p>Removed deprecated <code>increment_open_transactions</code>.</p>
</li><li>
<p>Removed deprecated <code>PostgreSQLAdapter#outside_transaction?</code> 
method. You can use <code>#transaction_open?</code> instead.</p>
</li><li>
<p>Removed deprecated <code>ActiveRecord::Fixtures.find_table_name</code> in
favor of  <code>ActiveRecord::Fixtures.default_fixture_model_name</code>.</p>
</li><li>
<p>Removed deprecated <code>columns_for_remove</code> from
<code>SchemaStatements</code>.</p>
</li><li>
<p>Removed deprecated <code>SchemaStatements#distinct</code>.</p>
</li><li>
<p>Moved deprecated <code>ActiveRecord::TestCase</code> into the Rails test 
suite. The class is no longer public and is only used for internal  Rails
tests.</p>
</li><li>
<p>Removed support for deprecated option <code>:restrict</code> for
<code>:dependent</code>  in associations.</p>
</li><li>
<p>Removed support for deprecated <code>:delete_sql</code>,
<code>:insert_sql</code>, <code>:finder_sql</code>  and
<code>:counter_sql</code> options in associations.</p>
</li><li>
<p>Removed deprecated method <code>type_cast_code</code> from Column.</p>
</li><li>
<p>Removed deprecated <code>ActiveRecord::Base#connection</code> method.  Make
sure to access it via the class.</p>
</li><li>
<p>Removed deprecation warning for
<code>auto_explain_threshold_in_seconds</code>.</p>
</li><li>
<p>Removed deprecated <code>:distinct</code> option from
<code>Relation#count</code>.</p>
</li><li>
<p>Removed deprecated methods <code>partial_updates</code>,
<code>partial_updates?</code> and  <code>partial_updates=</code>.</p>
</li><li>
<p>Removed deprecated method <code>scoped</code>.</p>
</li><li>
<p>Removed deprecated method <code>default_scopes?</code>.</p>
</li><li>
<p>Remove implicit join references that were deprecated in 4.0.</p>
</li><li>
<p>Removed <code>activerecord-deprecated_finders</code> as a dependency. 
Please see <a
href="https://github.com/rails/activerecord-deprecated_finders#active-record-deprecated-finders">the
gem README</a>  for more info.</p>
</li><li>
<p>Removed usage of <code>implicit_readonly</code>. Please use
<code>readonly</code> method  explicitly to mark records as 
<code>readonly</code>. (<a
href="https://github.com/rails/rails/pull/10769">Pull Request</a>)</p>
</li></ul>

<h3 id="label-Deprecations">Deprecations<span><a href="#label-Deprecations">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Deprecated <code>quoted_locking_column</code> method, which isn&#39;t used
anywhere.</p>
</li><li>
<p>Deprecated <code>ConnectionAdapters::SchemaStatements#distinct</code>,  as
it is no longer used by internals. (<a
href="https://github.com/rails/rails/pull/10556">Pull Request</a>)</p>
</li><li>
<p>Deprecated <code>rake db:test:*</code> tasks as the test database is now 
automatically maintained. See railties release notes. (<a
href="https://github.com/rails/rails/pull/13528">Pull Request</a>)</p>
</li><li>
<p>Deprecate unused <code>ActiveRecord::Base.symbolized_base_class</code>  and
<code>ActiveRecord::Base.symbolized_sti_name</code> without  replacement.
<a
href="https://github.com/rails/rails/commit/97e7ca48c139ea5cce2fa9b4be631946252a1ebd">Commit</a></p>
</li></ul>

<h3 id="label-Notable+changes">Notable changes<span><a href="#label-Notable+changes">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Default scopes are no longer overriden by chained conditions.</p>
</li></ul>

<p>Before this change when you defined a <code>default_scope</code> in a model
it was overriden by chained conditions in the same field. Now it  is merged
like any other scope. <a
href="upgrading_ruby_on_rails.html#changes-on-default-scopes">More
Details</a>.</p>
<ul><li>
<p>Added <code>ActiveRecord::Base.to_param</code> for convenient "pretty" URLs
derived from  a model&#39;s attribute or  method. (<a
href="https://github.com/rails/rails/pull/12891">Pull Request</a>)</p>
</li><li>
<p>Added <code>ActiveRecord::Base.no_touching</code>, which allows ignoring
touch on  models. (<a href="https://github.com/rails/rails/pull/12772">Pull
Request</a>)</p>
</li><li>
<p>Unify boolean type casting for <code>MysqlAdapter</code> and
<code>Mysql2Adapter</code>.  <code>type_cast</code> will return
<code>1</code> for <code>true</code> and <code>0</code> for
<code>false</code>. (<a
href="https://github.com/rails/rails/pull/12425">Pull Request</a>)</p>
</li><li>
<p><code>.unscope</code> now removes conditions specified in 
<code>default_scope</code>. (<a
href="https://github.com/rails/rails/commit/94924dc32baf78f13e289172534c2e71c9c8cade">Commit</a>)</p>
</li><li>
<p>Added <code>ActiveRecord::QueryMethods#rewhere</code> which will overwrite
an existing,  named where condition. (<a
href="https://github.com/rails/rails/commit/f950b2699f97749ef706c6939a84dfc85f0b05f2">Commit</a>)</p>
</li><li>
<p>Extended <code>ActiveRecord::Base#cache_key</code> to take an optional list
of timestamp  attributes of which the highest will be used. (<a
href="https://github.com/rails/rails/commit/e94e97ca796c0759d8fcb8f946a3bbc60252d329">Commit</a>)</p>
</li><li>
<p>Added <code>ActiveRecord::Base#enum</code> for declaring enum attributes
where the values  map to integers in the database, but can be queried by 
name. (<a
href="https://github.com/rails/rails/commit/db41eb8a6ea88b854bf5cd11070ea4245e1639c5">Commit</a>)</p>
</li><li>
<p>Type cast json values on write, so that the value is consistent with
reading  from the database. (<a
href="https://github.com/rails/rails/pull/12643">Pull Request</a>)</p>
</li><li>
<p>Type cast hstore values on write, so that the value is consistent  with
reading from the database. (<a
href="https://github.com/rails/rails/commit/5ac2341fab689344991b2a4817bd2bc8b3edac9d">Commit</a>)</p>
</li><li>
<p>Make <code>next_migration_number</code> accessible for third party 
generators. (<a href="https://github.com/rails/rails/pull/12407">Pull
Request</a>)</p>
</li><li>
<p>Calling <code>update_attributes</code> will now throw an
<code>ArgumentError</code> whenever it  gets a <code>nil</code> argument.
More specifically, it will throw an error if the  argument that it gets
passed does not respond to to  <code>stringify_keys</code>. (<a
href="https://github.com/rails/rails/pull/9860">Pull Request</a>)</p>
</li><li>
<p><code>CollectionAssociation#first</code>/<code>#last</code> (e.g.
<code>has_many</code>) use a <code>LIMIT</code>ed  query to fetch results
rather than loading the entire  collection. (<a
href="https://github.com/rails/rails/pull/12137">Pull Request</a>)</p>
</li><li>
<p><code>inspect</code> on Active Record model classes does not initiate a new
connection. This means that calling <code>inspect</code>, when the database
is missing,  will no longer raise an exception. (<a
href="https://github.com/rails/rails/pull/11014">Pull Request</a>)</p>
</li><li>
<p>Removed column restrictions for <code>count</code>, let the database raise
if the SQL is  invalid. (<a
href="https://github.com/rails/rails/pull/10710">Pull Request</a>)</p>
</li><li>
<p>Rails now automatically detects inverse associations. If you do not set the
<code>:inverse_of</code> option on the association, then Active Record will
guess the  inverse association based on heuristics. (<a
href="https://github.com/rails/rails/pull/10886">Pull Request</a>)</p>
</li><li>
<p>Handle aliased attributes in ActiveRecord::Relation. When using symbol
keys,  ActiveRecord will now translate aliased attribute names to the
actual column  name used in the database. (<a
href="https://github.com/rails/rails/pull/7839">Pull Request</a>)</p>
</li><li>
<p>The ERB in fixture files is no longer evaluated in the context of the main 
object. Helper methods used by multiple fixtures should be defined on
modules  included in <code>ActiveRecord::FixtureSet.context_class</code>.
(<a href="https://github.com/rails/rails/pull/13022">Pull Request</a>)</p>
</li><li>
<p>Don&#39;t create or drop the test database if RAILS_ENV is specified 
explicitly. (<a href="https://github.com/rails/rails/pull/13629">Pull
Request</a>)</p>
</li><li>
<p><code>Relation</code> no longer has mutator methods like <code>#map!</code>
and <code>#delete_if</code>. Convert  to an <code>Array</code> by calling
<code>#to_a</code> before using these methods. (<a
href="https://github.com/rails/rails/pull/13314">Pull Request</a>)</p>
</li><li>
<p><code>find_in_batches</code>, <code>find_each</code>,
<code>Result#each</code> and <code>Enumerable#index_by</code> now  return
an <code>Enumerator</code> that can calculate its  size. (<a
href="https://github.com/rails/rails/pull/13938">Pull Request</a>)</p>
</li><li>
<p><code>scope</code>, <code>enum</code> and Associations now raise on
“dangerous” name  conflicts. (<a
href="https://github.com/rails/rails/pull/13450">Pull Request</a>,  <a
href="https://github.com/rails/rails/pull/13896">Pull Request</a>)</p>
</li><li>
<p><code>second</code> through <code>fifth</code> methods act like the
<code>first</code>  finder. (<a
href="https://github.com/rails/rails/pull/13757">Pull Request</a>)</p>
</li><li>
<p>Make <code>touch</code> fire the <code>after_commit</code> and
<code>after_rollback</code>  callbacks. (<a
href="https://github.com/rails/rails/pull/12031">Pull Request</a>)</p>
</li><li>
<p>Enable partial indexes for <code>sqlite &gt;= 3.8.0</code>.  (<a
href="https://github.com/rails/rails/pull/13350">Pull Request</a>)</p>
</li><li>
<p>Make <code>change_column_null</code>  revertable. (<a
href="https://github.com/rails/rails/commit/724509a9d5322ff502aefa90dd282ba33a281a96">Commit</a>)</p>
</li><li>
<p>Added a flag to disable schema dump after migration. This is set to
<code>false</code>  by default in the production environment for new
applications.  (<a href="https://github.com/rails/rails/pull/13948">Pull
Request</a>)</p>
</li></ul>

<h2 id="label-Active+Model">Active Model<span><a href="#label-Active+Model">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Please refer to the <a
href="https://github.com/rails/rails/blob/4-1-stable/activemodel/CHANGELOG.md">Changelog</a>
for detailed changes.</p>

<h3 id="label-Deprecations">Deprecations<span><a href="#label-Deprecations">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Deprecate <code>Validator#setup</code>. This should be done manually now in
the  validator&#39;s constructor. (<a
href="https://github.com/rails/rails/commit/7d84c3a2f7ede0e8d04540e9c0640de7378e9b3a">Commit</a>)</p>
</li></ul>

<h3 id="label-Notable+changes">Notable changes<span><a href="#label-Notable+changes">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Added new API methods <code>reset_changes</code> and
<code>changes_applied</code> to  <code>ActiveModel::Dirty</code> that
control changes state.</p>
</li><li>
<p>Ability to specify multiple contexts when defining a  validation. (<a
href="https://github.com/rails/rails/pull/13754">Pull Request</a>)</p>
</li><li>
<p><code>attribute_changed?</code> now accepts a hash to check if the
attribute was changed  <code>:from</code> and/or <code>:to</code> a given 
value. (<a href="https://github.com/rails/rails/pull/13131">Pull
Request</a>)</p>
</li></ul>

<h2 id="label-Active+Support">Active Support<span><a href="#label-Active+Support">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>Please refer to the <a
href="https://github.com/rails/rails/blob/4-1-stable/activesupport/CHANGELOG.md">Changelog</a>
for detailed changes.</p>

<h3 id="label-Removals">Removals<span><a href="#label-Removals">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Removed <code>MultiJSON</code> dependency. As a result,
<code>ActiveSupport::JSON.decode</code>  no longer accepts an options hash
for <code>MultiJSON</code>. (<a
href="https://github.com/rails/rails/pull/10576">Pull Request</a> / <a
href="upgrading_ruby_on_rails.html#changes-in-json-handling">More
Details</a>)</p>
</li><li>
<p>Removed support for the <code>encode_json</code> hook used for encoding
custom objects into  JSON. This feature has been extracted into the <a
href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a>
gem.  (<a href="https://github.com/rails/rails/pull/12183">Related Pull
Request</a> /  <a
href="upgrading_ruby_on_rails.html#changes-in-json-handling">More
Details</a>)</p>
</li><li>
<p>Removed deprecated <code>ActiveSupport::JSON::Variable</code> with no
replacement.</p>
</li><li>
<p>Removed deprecated <code>String#encoding_aware?</code> core extensions
(<code>core_ext/string/encoding</code>).</p>
</li><li>
<p>Removed deprecated <code>Module#local_constant_names</code> in favor of
<code>Module#local_constants</code>.</p>
</li><li>
<p>Removed deprecated <code>DateTime.local_offset</code> in favor of
<code>DateTime.civil_from_format</code>.</p>
</li><li>
<p>Removed deprecated <code>Logger</code> core extensions
(<code>core_ext/logger.rb</code>).</p>
</li><li>
<p>Removed deprecated <code>Time#time_with_datetime_fallback</code>,
<code>Time#utc_time</code> and  <code>Time#local_time</code> in favor of
<code>Time#utc</code> and <code>Time#local</code>.</p>
</li><li>
<p>Removed deprecated <code>Hash#diff</code> with no replacement.</p>
</li><li>
<p>Removed deprecated <code>Date#to_time_in_current_zone</code> in favor of
<code>Date#in_time_zone</code>.</p>
</li><li>
<p>Removed deprecated <code>Proc#bind</code> with no replacement.</p>
</li><li>
<p>Removed deprecated <code>Array#uniq_by</code> and
<code>Array#uniq_by!</code>, use native  <code>Array#uniq</code> and
<code>Array#uniq!</code> instead.</p>
</li><li>
<p>Removed deprecated <code>ActiveSupport::BasicObject</code>, use 
<code>ActiveSupport::ProxyObject</code> instead.</p>
</li><li>
<p>Removed deprecated <code>BufferedLogger</code>, use
<code>ActiveSupport::Logger</code> instead.</p>
</li><li>
<p>Removed deprecated <code>assert_present</code> and
<code>assert_blank</code> methods, use <code>assert   object.blank?</code>
and <code>assert object.present?</code> instead.</p>
</li><li>
<p>Remove deprecated <code>#filter</code> method for filter objects, use the
corresponding  method instead (e.g. <code>#before</code> for a before
filter).</p>
</li><li>
<p>Removed &#39;cow&#39; =&gt; &#39;kine&#39; irregular inflection from
default  inflections. (<a
href="https://github.com/rails/rails/commit/c300dca9963bda78b8f358dbcb59cabcdc5e1dc9">Commit</a>)</p>
</li></ul>

<h3 id="label-Deprecations">Deprecations<span><a href="#label-Deprecations">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p>Deprecated <code>Numeric#{ago,until,since,from_now}, the user is expected
to  explicitly convert the value into an AS::Duration, i.e. 5.ago =>
5.seconds.ago  ({Pull
Request}[https://github.com/rails/rails/pull/12389]</code>)</p>
</li><li>
<p>Deprecated the require path
<code>active_support/core_ext/object/to_json</code>. Require 
<code>active_support/core_ext/object/json</code> instead. (<a
href="https://github.com/rails/rails/pull/12203">Pull Request</a>)</p>
</li><li>
<p>Deprecated
<code>ActiveSupport::JSON::Encoding::CircularReferenceError</code>. This
feature  has been extracted into the <a
href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a>
gem.  (<a href="https://github.com/rails/rails/pull/12785">Pull Request</a>
/  <a href="upgrading_ruby_on_rails.html#changes-in-json-handling">More
Details</a>)</p>
</li><li>
<p>Deprecated <code>ActiveSupport.encode_big_decimal_as_string</code> option.
This feature has  been extracted into the <a
href="https://github.com/rails/activesupport-json_encoder">activesupport-json_encoder</a>
gem.  (<a href="https://github.com/rails/rails/pull/13060">Pull Request</a>
/  <a href="upgrading_ruby_on_rails.html#changes-in-json-handling">More
Details</a>)</p>
</li><li>
<p>Deprecate custom <code>BigDecimal</code>  serialization. (<a
href="https://github.com/rails/rails/pull/13911">Pull Request</a>)</p>
</li></ul>

<h3 id="label-Notable+changes">Notable changes<span><a href="#label-Notable+changes">&para;</a> <a href="#documentation">&uarr;</a></span></h3>
<ul><li>
<p><code>ActiveSupport</code>&#39;s JSON encoder has been rewritten to take
advantage of the  JSON gem rather than doing custom encoding in pure-Ruby. 
(<a href="https://github.com/rails/rails/pull/12183">Pull Request</a> /  <a
href="upgrading_ruby_on_rails.html#changes-in-json-handling">More
Details</a>)</p>
</li><li>
<p>Improved compatibility with the JSON gem.  (<a
href="https://github.com/rails/rails/pull/12862">Pull Request</a> /  <a
href="upgrading_ruby_on_rails.html#changes-in-json-handling">More
Details</a>)</p>
</li><li>
<p>Added <code>ActiveSupport::Testing::TimeHelpers#travel</code> and
<code>#travel_to</code>. These  methods change current time to the given
time or duration by stubbing  <code>Time.now</code> and
<code>Date.today</code>.</p>
</li><li>
<p>Added <code>ActiveSupport::Testing::TimeHelpers#travel_back</code>. This
method returns  the current time to the original state, by removing the
stubs added by <code>travel</code>  and <code>travel_to</code>. (<a
href="https://github.com/rails/rails/pull/13884">Pull Request</a>)</p>
</li><li>
<p>Added <code>Numeric#in_milliseconds</code>, like
<code>1.hour.in_milliseconds</code>, so we can feed  them to JavaScript
functions like  <code>getTime()</code>. (<a
href="https://github.com/rails/rails/commit/423249504a2b468d7a273cbe6accf4f21cb0e643">Commit</a>)</p>
</li><li>
<p>Added <code>Date#middle_of_day</code>, <code>DateTime#middle_of_day</code>
and <code>Time#middle_of_day</code>  methods. Also added
<code>midday</code>, <code>noon</code>, <code>at_midday</code>,
<code>at_noon</code> and  <code>at_middle_of_day</code> as  aliases. (<a
href="https://github.com/rails/rails/pull/10879">Pull Request</a>)</p>
</li><li>
<p>Added <code>Date#all_week/month/quarter/year</code> for generating date 
ranges. (<a href="https://github.com/rails/rails/pull/9685">Pull
Request</a>)</p>
</li><li>
<p>Added <code>Time.zone.yesterday</code> and 
<code>Time.zone.tomorrow</code>. (<a
href="https://github.com/rails/rails/pull/12822">Pull Request</a>)</p>
</li><li>
<p>Added <code>String#remove(pattern)</code> as a short-hand for the common
pattern of  <code>String#gsub(pattern,&#39;&#39;)</code>. (<a
href="https://github.com/rails/rails/commit/5da23a3f921f0a4a3139495d2779ab0d3bd4cb5f">Commit</a>)</p>
</li><li>
<p>Added <code>Hash#compact</code> and <code>Hash#compact!</code> for removing
items with nil value  from hash. (<a
href="https://github.com/rails/rails/pull/13632">Pull Request</a>)</p>
</li><li>
<p><code>blank?</code> and <code>present?</code> commit to return  singletons.
(<a
href="https://github.com/rails/rails/commit/126dc47665c65cd129967cbd8a5926dddd0aa514">Commit</a>)</p>
</li><li>
<p>Default the new <code>I18n.enforce_available_locales</code> config to
<code>true</code>, meaning  <code>I18n</code> will make sure that all
locales passed to it must be declared in the 
<code>available_locales</code>  list. (<a
href="https://github.com/rails/rails/pull/13341">Pull Request</a>)</p>
</li><li>
<p>Introduce <code>Module#concerning</code>: a natural, low-ceremony way to
separate  responsibilities within a  class. (<a
href="https://github.com/rails/rails/commit/1eee0ca6de975b42524105a59e0521d18b38ab81">Commit</a>)</p>
</li><li>
<p>Added <code>Object#presence_in</code> to simplify value whitelisting.  (<a
href="https://github.com/rails/rails/commit/4edca106daacc5a159289eae255207d160f22396">Commit</a>)</p>
</li></ul>

<h2 id="label-Credits">Credits<span><a href="#label-Credits">&para;</a> <a href="#documentation">&uarr;</a></span></h2>

<p>See the <a href="http://contributors.rubyonrails.org/">full list of
contributors to Rails</a> for the many people who spent many hours making
Rails, the stable and robust framework it is. Kudos to all of them.</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

