<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class RSpec::CallerFilter - rspec-support-3.1.2 Documentation</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-first_non_rspec_line">::first_non_rspec_line</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-RSpec::CallerFilter">
  <h1 id="class-RSpec::CallerFilter" class="class">
    class RSpec::CallerFilter
  </h1>

  <section class="description">
    
<p>Consistent implementation for “cleaning” the caller method to strip out
non-rspec lines. This enables errors to be reported at the call site in the
code using the library, which is far more useful than the particular
internal method that raised an error.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="ADDITIONAL_TOP_LEVEL_FILES">ADDITIONAL_TOP_LEVEL_FILES
        
        <dd>
        
      
        <dt id="IGNORE_REGEX">IGNORE_REGEX
        
        <dd><p>rubygems/core_ext/kernel_require.rb isn&#39;t actually part of rspec
(obviously) but we want it ignored when we are looking for the first
meaningful line of the backtrace outside of RSpec. It can show up in the
backtrace as the immediate first caller when
`CallerFilter.first_non_rspec_line` is called from the top level of a
required file, but it depends on if rubygems is loaded or not. We don&#39;t
want to have to deal with this complexity in our `RSpec.deprecate` calls,
so we ignore it here.</p>
        
      
        <dt id="LIB_REGEX">LIB_REGEX
        
        <dd>
        
      
        <dt id="RSPEC_LIBS">RSPEC_LIBS
        
        <dd>
        
      
      </dl>
    </section>
    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-first_non_rspec_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">first_non_rspec_line</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="first_non_rspec_line-source">
            <pre><span class="ruby-comment"># File lib/rspec/support/caller_filter.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">first_non_rspec_line</span>
  <span class="ruby-comment"># `caller` is an expensive method that scales linearly with the size of</span>
  <span class="ruby-comment"># the stack. The performance hit for fetching it in chunks is small,</span>
  <span class="ruby-comment"># and since the target line is probably near the top of the stack, the</span>
  <span class="ruby-comment"># overall improvement of a chunked search like this is significant.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment"># See benchmarks/caller.rb for measurements.</span>

  <span class="ruby-comment"># Initial value here is mostly arbitrary, but is chosen to give good</span>
  <span class="ruby-comment"># performance on the common case of creating a double.</span>
  <span class="ruby-identifier">increment</span> = <span class="ruby-value">5</span>
  <span class="ruby-identifier">i</span>         = <span class="ruby-value">1</span>
  <span class="ruby-identifier">line</span>      = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">until</span> <span class="ruby-identifier">line</span>
    <span class="ruby-identifier">stack</span> = <span class="ruby-identifier">caller</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">increment</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;No non-lib lines in stack&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">stack</span>

    <span class="ruby-identifier">line</span> = <span class="ruby-identifier">stack</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">l</span><span class="ruby-operator">|</span> <span class="ruby-identifier">l</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">IGNORE_REGEX</span> }

    <span class="ruby-identifier">i</span>         <span class="ruby-operator">+=</span> <span class="ruby-identifier">increment</span>
    <span class="ruby-identifier">increment</span> <span class="ruby-operator">*=</span> <span class="ruby-value">2</span> <span class="ruby-comment"># The choice of two here is arbitrary.</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">line</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

