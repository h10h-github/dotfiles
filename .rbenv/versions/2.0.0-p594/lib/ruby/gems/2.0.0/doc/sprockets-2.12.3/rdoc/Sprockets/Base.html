<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Sprockets::Base - sprockets-2.12.3 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="Caching.html">Sprockets::Caching</a>
  
  
  
    <li><a class="include" href="Paths.html">Sprockets::Paths</a>
  
  
  
    <li><a class="include" href="Mime.html">Sprockets::Mime</a>
  
  
  
    <li><a class="include" href="Processing.html">Sprockets::Processing</a>
  
  
  
    <li><a class="include" href="Compressing.html">Sprockets::Compressing</a>
  
  
  
    <li><a class="include" href="Engines.html">Sprockets::Engines</a>
  
  
  
    <li><a class="include" href="Server.html">Sprockets::Server</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-5B-5D">#[]</a>
    
    <li class="calls-super" ><a href="#method-i-append_path">#append_path</a>
    
    <li ><a href="#method-i-attributes_for">#attributes_for</a>
    
    <li ><a href="#method-i-build_asset">#build_asset</a>
    
    <li ><a href="#method-i-cache-3D">#cache=</a>
    
    <li ><a href="#method-i-cache_key_for">#cache_key_for</a>
    
    <li ><a href="#method-i-circular_call_protection">#circular_call_protection</a>
    
    <li class="calls-super" ><a href="#method-i-clear_paths">#clear_paths</a>
    
    <li ><a href="#method-i-content_type_of">#content_type_of</a>
    
    <li ><a href="#method-i-digest">#digest</a>
    
    <li ><a href="#method-i-digest_class-3D">#digest_class=</a>
    
    <li ><a href="#method-i-each_entry">#each_entry</a>
    
    <li ><a href="#method-i-each_file">#each_file</a>
    
    <li ><a href="#method-i-each_logical_path">#each_logical_path</a>
    
    <li ><a href="#method-i-entries">#entries</a>
    
    <li ><a href="#method-i-expire_index-21">#expire_index!</a>
    
    <li ><a href="#method-i-file_digest">#file_digest</a>
    
    <li ><a href="#method-i-find_asset">#find_asset</a>
    
    <li ><a href="#method-i-index">#index</a>
    
    <li ><a href="#method-i-inspect">#inspect</a>
    
    <li ><a href="#method-i-json_decode">#json_decode</a>
    
    <li ><a href="#method-i-logical_path_for_filename">#logical_path_for_filename</a>
    
    <li ><a href="#method-i-matches_filter">#matches_filter</a>
    
    <li class="calls-super" ><a href="#method-i-prepend_path">#prepend_path</a>
    
    <li class="calls-super" ><a href="#method-i-register_bundle_processor">#register_bundle_processor</a>
    
    <li class="calls-super" ><a href="#method-i-register_engine">#register_engine</a>
    
    <li class="calls-super" ><a href="#method-i-register_mime_type">#register_mime_type</a>
    
    <li class="calls-super" ><a href="#method-i-register_postprocessor">#register_postprocessor</a>
    
    <li class="calls-super" ><a href="#method-i-register_preprocessor">#register_preprocessor</a>
    
    <li ><a href="#method-i-resolve">#resolve</a>
    
    <li ><a href="#method-i-stat">#stat</a>
    
    <li class="calls-super" ><a href="#method-i-unregister_bundle_processor">#unregister_bundle_processor</a>
    
    <li class="calls-super" ><a href="#method-i-unregister_postprocessor">#unregister_postprocessor</a>
    
    <li class="calls-super" ><a href="#method-i-unregister_preprocessor">#unregister_preprocessor</a>
    
    <li ><a href="#method-i-version-3D">#version=</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Sprockets::Base">
  <h1 id="class-Sprockets::Base" class="class">
    class Sprockets::Base
  </h1>

  <section class="description">
    
<p>`Base` class for `Environment` and `Index`.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-cache" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cache</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Get persistent cache store</p>
        
        </div>
      </div>
      
      <div id="attribute-i-context_class" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">context_class</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Get `Context` class.</p>

<p>This class maybe mutated and mixed in with custom helpers.</p>

<pre class="ruby"><span class="ruby-identifier">environment</span>.<span class="ruby-identifier">context_class</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">MyHelpers</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">asset_url</span>; <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
        
        </div>
      </div>
      
      <div id="attribute-i-digest_class" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">digest_class</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>Returns a `Digest` implementation class.</p>

<p>Defaults to `Digest::MD5`.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-logger" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">logger</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Get and set `Logger` instance.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-version" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">version</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>The `Environment#version` is a custom value used for manually expiring all
asset caches.</p>

<p><a href="../Sprockets.html">Sprockets</a> is able to track most file and
directory changes and will take care of expiring the cache for you.
However, its impossible to know when any custom helpers change that you mix
into the `Context`.</p>

<p>It would be wise to increment this value anytime you make a configuration
change to the `Environment` object.</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-5B-5D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">[]</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Preferred `find_asset` shorthand.</p>

<pre class="ruby"><span class="ruby-identifier">environment</span>[<span class="ruby-string">&#39;application.js&#39;</span>]
</pre>
          
          

          
          <div class="method-source-code" id="5B-5D-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 294</span>
<span class="ruby-keyword">def</span> <span class="ruby-operator">[]</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">find_asset</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-append_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">append_path</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Paths.html#method-i-append_path">Sprockets::Paths#append_path</a>
            </div>
          

          
          <div class="method-source-code" id="append_path-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 107</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">append_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-attributes_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">attributes_for</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal. Return a `AssetAttributes` for `path`.</p>
          
          

          
          <div class="method-source-code" id="attributes_for-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 252</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">attributes_for</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">AssetAttributes</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cache-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache=</span><span
            class="method-args">(cache)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set persistent cache store</p>

<p>The cache store must implement a pair of getters and setters. Either
`get(key)`/`set(key, value)`, `[<a href="key">key]`/`</a>=value`,
`read(key)`/`write(key, value)`.</p>
          
          

          
          <div class="method-source-code" id="cache-3D-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 96</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cache=</span>(<span class="ruby-identifier">cache</span>)
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-ivar">@cache</span> = <span class="ruby-identifier">cache</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-clear_paths" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">clear_paths</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Paths.html#method-i-clear_paths">Sprockets::Paths#clear_paths</a>
            </div>
          

          
          <div class="method-source-code" id="clear_paths-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">clear_paths</span>
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-content_type_of" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">content_type_of</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal. Return content type of `path`.</p>
          
          

          
          <div class="method-source-code" id="content_type_of-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">content_type_of</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">attributes_for</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">content_type</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-digest" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">digest</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a `Digest` instance for the `Environment`.</p>

<p>This value serves two purposes. If two `Environment`s have the same digest
value they can be treated as equal. This is more useful for comparing
environment states between processes rather than in the same. Two equal
`Environment`s can share the same cached assets.</p>

<p>The value also provides a seed digest for all `Asset` digests. Any change
in the environment digest will affect all of its assets.</p>
          
          

          
          <div class="method-source-code" id="digest-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">digest</span>
  <span class="ruby-comment"># Compute the initial digest using the implementation class. The</span>
  <span class="ruby-comment"># Sprockets release version and custom environment version are</span>
  <span class="ruby-comment"># mixed in. So any new releases will affect all your assets.</span>
  <span class="ruby-ivar">@digest</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">digest_class</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">update</span>(<span class="ruby-constant">VERSION</span>).<span class="ruby-identifier">update</span>(<span class="ruby-identifier">version</span>.<span class="ruby-identifier">to_s</span>)

  <span class="ruby-comment"># Returned a dupped copy so the caller can safely mutate it with `.update`</span>
  <span class="ruby-ivar">@digest</span>.<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-digest_class-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">digest_class=</span><span
            class="method-args">(klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Assign a `Digest` implementation class. This maybe any Ruby `Digest::`
implementation such as `Digest::MD5` or `Digest::SHA1`.</p>

<pre class="ruby"><span class="ruby-identifier">environment</span>.<span class="ruby-identifier">digest_class</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">SHA1</span>
</pre>
          
          

          
          <div class="method-source-code" id="digest_class-3D-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 27</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">digest_class=</span>(<span class="ruby-identifier">klass</span>)
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-ivar">@digest_class</span> = <span class="ruby-identifier">klass</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each_entry" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each_entry</span><span
            class="method-args">(root, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="each_entry-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 298</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">each_entry</span>(<span class="ruby-identifier">root</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">to_enum</span>(<span class="ruby-identifier">__method__</span>, <span class="ruby-identifier">root</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">root</span> = <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">root</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Pathname</span>)

  <span class="ruby-identifier">paths</span> = []
  <span class="ruby-identifier">entries</span>(<span class="ruby-identifier">root</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">filename</span>)
    <span class="ruby-identifier">paths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">path</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">stat</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">directory?</span>
      <span class="ruby-identifier">each_entry</span>(<span class="ruby-identifier">path</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">subpath</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">paths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">subpath</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">sort_by</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>).<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)

  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each_file</span><span
            class="method-args">() { |path| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="each_file-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 319</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">each_file</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">to_enum</span>(<span class="ruby-identifier">__method__</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">root</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">each_entry</span>(<span class="ruby-identifier">root</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">stat</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">directory?</span>
        <span class="ruby-keyword">yield</span> <span class="ruby-identifier">path</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-each_logical_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">each_logical_path</span><span
            class="method-args">(*args) { |logical_path, filename| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="each_logical_path-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 331</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">each_logical_path</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">to_enum</span>(<span class="ruby-identifier">__method__</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">filters</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>
  <span class="ruby-identifier">files</span> = {}
  <span class="ruby-identifier">each_file</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">logical_path</span> = <span class="ruby-identifier">logical_path_for_filename</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">filters</span>)
      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">files</span>[<span class="ruby-identifier">logical_path</span>]
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>.<span class="ruby-identifier">arity</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
          <span class="ruby-keyword">yield</span> <span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">to_s</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">yield</span> <span class="ruby-identifier">logical_path</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">files</span>[<span class="ruby-identifier">logical_path</span>] = <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-entries" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">entries</span><span
            class="method-args">(pathname)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Works like `Dir.entries`.</p>

<p>Subclasses may cache this method.</p>
          
          

          
          <div class="method-source-code" id="entries-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 223</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">entries</span>(<span class="ruby-identifier">pathname</span>)
  <span class="ruby-ivar">@trail</span>.<span class="ruby-identifier">entries</span>(<span class="ruby-identifier">pathname</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_digest" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_digest</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Read and compute digest of filename.</p>

<p>Subclasses may cache this method.</p>
          
          

          
          <div class="method-source-code" id="file_digest-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 237</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_digest</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">stat</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-comment"># If its a file, digest the contents</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">file?</span>
      <span class="ruby-identifier">digest</span>.<span class="ruby-identifier">file</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_s</span>)

    <span class="ruby-comment"># If its a directive, digest the list of filenames</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">stat</span>.<span class="ruby-identifier">directory?</span>
      <span class="ruby-identifier">contents</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">entries</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;,&#39;</span>)
      <span class="ruby-identifier">digest</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">contents</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-find_asset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_asset</span><span
            class="method-args">(path, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Find asset by logical path or expanded path.</p>
          
          

          
          <div class="method-source-code" id="find_asset-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 262</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_asset</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">logical_path</span> = <span class="ruby-identifier">path</span>
  <span class="ruby-identifier">pathname</span>     = <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">cleanpath</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">absolute?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">stat</span>(<span class="ruby-identifier">pathname</span>)
    <span class="ruby-identifier">logical_path</span> = <span class="ruby-identifier">attributes_for</span>(<span class="ruby-identifier">pathname</span>).<span class="ruby-identifier">logical_path</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">pathname</span> = <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">logical_path</span>)

      <span class="ruby-comment"># If logical path is missing a mime type extension, append</span>
      <span class="ruby-comment"># the absolute path extname so it has one.</span>
      <span class="ruby-comment">#</span>
      <span class="ruby-comment"># Ensures some consistency between finding &quot;foo/bar&quot; vs</span>
      <span class="ruby-comment"># &quot;foo/bar.js&quot;.</span>
      <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">logical_path</span>) <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span>
        <span class="ruby-identifier">expanded_logical_path</span> = <span class="ruby-identifier">attributes_for</span>(<span class="ruby-identifier">pathname</span>).<span class="ruby-identifier">logical_path</span>
        <span class="ruby-identifier">logical_path</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">expanded_logical_path</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">FileNotFound</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">build_asset</span>(<span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">pathname</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-index" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">index</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return an `Index`. Must be implemented by the subclass.</p>
          
          

          
          <div class="method-source-code" id="index-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">index</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-inspect" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inspect</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Pretty inspect</p>
          
          

          
          <div class="method-source-code" id="inspect-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 352</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inspect</span>
  <span class="ruby-node">&quot;#&lt;#{self.class}:0x#{object_id.to_s(16)} &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;root=#{root.to_s.inspect}, &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;paths=#{paths.inspect}, &quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-node">&quot;digest=#{digest.to_s.inspect}&quot;</span> <span class="ruby-operator">+</span>
    <span class="ruby-string">&quot;&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-prepend_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prepend_path</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Paths.html#method-i-prepend_path">Sprockets::Paths#prepend_path</a>
            </div>
          

          
          <div class="method-source-code" id="prepend_path-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prepend_path</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-register_bundle_processor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register_bundle_processor</span><span
            class="method-args">(mime_type, klass, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Processing.html#method-i-register_bundle_processor">Sprockets::Processing#register_bundle_processor</a>
            </div>
          

          
          <div class="method-source-code" id="register_bundle_processor-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">register_bundle_processor</span>(<span class="ruby-identifier">mime_type</span>, <span class="ruby-identifier">klass</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-register_engine" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register_engine</span><span
            class="method-args">(ext, klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Registers a new Engine `klass` for `ext`.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Engines.html#method-i-register_engine">Sprockets::Engines#register_engine</a>
            </div>
          

          
          <div class="method-source-code" id="register_engine-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">register_engine</span>(<span class="ruby-identifier">ext</span>, <span class="ruby-identifier">klass</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-identifier">add_engine_to_trail</span>(<span class="ruby-identifier">ext</span>, <span class="ruby-identifier">klass</span>)
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-register_mime_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register_mime_type</span><span
            class="method-args">(mime_type, ext)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Register a new mime type.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Mime.html#method-i-register_mime_type">Sprockets::Mime#register_mime_type</a>
            </div>
          

          
          <div class="method-source-code" id="register_mime_type-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 158</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">register_mime_type</span>(<span class="ruby-identifier">mime_type</span>, <span class="ruby-identifier">ext</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-ivar">@trail</span>.<span class="ruby-identifier">append_extension</span>(<span class="ruby-identifier">ext</span>)
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-register_postprocessor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register_postprocessor</span><span
            class="method-args">(mime_type, klass, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Processing.html#method-i-register_postprocessor">Sprockets::Processing#register_postprocessor</a>
            </div>
          

          
          <div class="method-source-code" id="register_postprocessor-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 185</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">register_postprocessor</span>(<span class="ruby-identifier">mime_type</span>, <span class="ruby-identifier">klass</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-register_preprocessor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register_preprocessor</span><span
            class="method-args">(mime_type, klass, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Processing.html#method-i-register_preprocessor">Sprockets::Processing#register_preprocessor</a>
            </div>
          

          
          <div class="method-source-code" id="register_preprocessor-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">register_preprocessor</span>(<span class="ruby-identifier">mime_type</span>, <span class="ruby-identifier">klass</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-resolve" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">resolve</span><span
            class="method-args">(logical_path, options = {}) { |dirname.join(bower)| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Finds the expanded real path for a given logical path by searching the
environment&#39;s paths.</p>

<pre class="ruby"><span class="ruby-identifier">resolve</span>(<span class="ruby-string">&quot;application.js&quot;</span>)
<span class="ruby-comment"># =&gt; &quot;/path/to/app/javascripts/application.js.coffee&quot;</span>
</pre>

<p>A `FileNotFound` exception is raised if the file does not exist.</p>
          
          

          
          <div class="method-source-code" id="resolve-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-comment"># If a block is given, preform an iterable search</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
    <span class="ruby-identifier">args</span> = <span class="ruby-identifier">attributes_for</span>(<span class="ruby-identifier">logical_path</span>).<span class="ruby-identifier">search_paths</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">options</span>]
    <span class="ruby-ivar">@trail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">pathname</span> = <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-node">%w( .bower.json bower.json component.json )</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">basename</span>.<span class="ruby-identifier">to_s</span>)
        <span class="ruby-identifier">bower</span> = <span class="ruby-identifier">json_decode</span>(<span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">read</span>)
        <span class="ruby-keyword">case</span> <span class="ruby-identifier">bower</span>[<span class="ruby-string">&#39;main&#39;</span>]
        <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span>
          <span class="ruby-keyword">yield</span> <span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">dirname</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">bower</span>[<span class="ruby-string">&#39;main&#39;</span>])
        <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
          <span class="ruby-identifier">extname</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">logical_path</span>)
          <span class="ruby-identifier">bower</span>[<span class="ruby-string">&#39;main&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fn</span><span class="ruby-operator">|</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">extname</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">extname</span> <span class="ruby-operator">==</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">extname</span>(<span class="ruby-identifier">fn</span>)
              <span class="ruby-keyword">yield</span> <span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">dirname</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">fn</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">yield</span> <span class="ruby-identifier">pathname</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">resolve</span>(<span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">options</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pathname</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">pathname</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">FileNotFound</span>, <span class="ruby-node">&quot;couldn&#39;t find file &#39;#{logical_path}&#39;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-stat" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">stat</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Works like `File.stat`.</p>

<p>Subclasses may cache this method.</p>
          
          

          
          <div class="method-source-code" id="stat-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 230</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stat</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-ivar">@trail</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unregister_bundle_processor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unregister_bundle_processor</span><span
            class="method-args">(mime_type, klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Processing.html#method-i-unregister_bundle_processor">Sprockets::Processing#unregister_bundle_processor</a>
            </div>
          

          
          <div class="method-source-code" id="unregister_bundle_processor-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unregister_bundle_processor</span>(<span class="ruby-identifier">mime_type</span>, <span class="ruby-identifier">klass</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unregister_postprocessor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unregister_postprocessor</span><span
            class="method-args">(mime_type, klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Processing.html#method-i-unregister_postprocessor">Sprockets::Processing#unregister_postprocessor</a>
            </div>
          

          
          <div class="method-source-code" id="unregister_postprocessor-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 191</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unregister_postprocessor</span>(<span class="ruby-identifier">mime_type</span>, <span class="ruby-identifier">klass</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unregister_preprocessor" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unregister_preprocessor</span><span
            class="method-args">(mime_type, klass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Processing.html#method-i-unregister_preprocessor">Sprockets::Processing#unregister_preprocessor</a>
            </div>
          

          
          <div class="method-source-code" id="unregister_preprocessor-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 179</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unregister_preprocessor</span>(<span class="ruby-identifier">mime_type</span>, <span class="ruby-identifier">klass</span>)
  <span class="ruby-comment"># Overrides the global behavior to expire the index</span>
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-version-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">version=</span><span
            class="method-args">(version)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Assign an environment version.</p>

<pre class="ruby"><span class="ruby-identifier">environment</span>.<span class="ruby-identifier">version</span> = <span class="ruby-string">&#39;2.0&#39;</span>
</pre>
          
          

          
          <div class="method-source-code" id="version-3D-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">version=</span>(<span class="ruby-identifier">version</span>)
  <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-ivar">@version</span> = <span class="ruby-identifier">version</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-build_asset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_asset</span><span
            class="method-args">(logical_path, pathname, options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="build_asset-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 366</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_asset</span>(<span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">pathname</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">pathname</span> = <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pathname</span>)

  <span class="ruby-comment"># If there are any processors to run on the pathname, use</span>
  <span class="ruby-comment"># `BundledAsset`. Otherwise use `StaticAsset` and treat is as binary.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">attributes_for</span>(<span class="ruby-identifier">pathname</span>).<span class="ruby-identifier">processors</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:bundle</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">circular_call_protection</span>(<span class="ruby-identifier">pathname</span>.<span class="ruby-identifier">to_s</span>) <span class="ruby-keyword">do</span>
        <span class="ruby-constant">ProcessedAsset</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">pathname</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">BundledAsset</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">pathname</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">StaticAsset</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">pathname</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cache_key_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache_key_for</span><span
            class="method-args">(path, options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cache_key_for-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 384</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cache_key_for</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-node">&quot;#{path}:#{options[:bundle] ? &#39;1&#39; : &#39;0&#39;}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-circular_call_protection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">circular_call_protection</span><span
            class="method-args">(path) { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="circular_call_protection-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 388</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">circular_call_protection</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">reset</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-value">:sprockets_circular_calls</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">calls</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-value">:sprockets_circular_calls</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">calls</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">path</span>)
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">CircularDependencyError</span>, <span class="ruby-node">&quot;#{path} has already been required&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">calls</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>[<span class="ruby-value">:sprockets_circular_calls</span>] = <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-expire_index-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">expire_index!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Clear index after mutating state. Must be implemented by the subclass.</p>
          
          

          
          <div class="method-source-code" id="expire_index-21-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 362</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">expire_index!</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-json_decode" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">json_decode</span><span
            class="method-args">(obj)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="json_decode-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 438</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">json_decode</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-constant">MultiJson</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">obj</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-logical_path_for_filename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">logical_path_for_filename</span><span
            class="method-args">(filename, filters)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="logical_path_for_filename-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 400</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">logical_path_for_filename</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">filters</span>)
  <span class="ruby-identifier">logical_path</span> = <span class="ruby-identifier">attributes_for</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">logical_path</span>.<span class="ruby-identifier">to_s</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">matches_filter</span>(<span class="ruby-identifier">filters</span>, <span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">filename</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">logical_path</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># If filename is an index file, retest with alias</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">logical_path</span>)[<span class="ruby-regexp">/[^\.]+/</span>, <span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;index&#39;</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-identifier">logical_path</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\/index\./</span>, <span class="ruby-string">&#39;.&#39;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">matches_filter</span>(<span class="ruby-identifier">filters</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">filename</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">path</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-matches_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">matches_filter</span><span
            class="method-args">(filters, logical_path, filename)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="matches_filter-source">
            <pre><span class="ruby-comment"># File lib/sprockets/base.rb, line 418</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">matches_filter</span>(<span class="ruby-identifier">filters</span>, <span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">filename</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">filters</span>.<span class="ruby-identifier">any?</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">filter</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>)
      <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">logical_path</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:call</span>)
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">arity</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
        <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">logical_path</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">filter</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">logical_path</span>, <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">to_s</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">filter</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">logical_path</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

