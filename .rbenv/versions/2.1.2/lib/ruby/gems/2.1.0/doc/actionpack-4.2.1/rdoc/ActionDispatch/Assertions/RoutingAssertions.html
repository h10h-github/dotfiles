<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module ActionDispatch::Assertions::RoutingAssertions - actionpack-4.2.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-assert_generates">#assert_generates</a>
    
    <li ><a href="#method-i-assert_recognizes">#assert_recognizes</a>
    
    <li ><a href="#method-i-assert_routing">#assert_routing</a>
    
    <li ><a href="#method-i-fail_on">#fail_on</a>
    
    <li class="calls-super" ><a href="#method-i-method_missing">#method_missing</a>
    
    <li ><a href="#method-i-recognized_request_for">#recognized_request_for</a>
    
    <li ><a href="#method-i-with_routing">#with_routing</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-ActionDispatch::Assertions::RoutingAssertions">
  <h1 id="module-ActionDispatch::Assertions::RoutingAssertions" class="module">
    module ActionDispatch::Assertions::RoutingAssertions
  </h1>

  <section class="description">
    
<p>Suite of assertions to test routes generated by Rails and the handling of
requests made to them.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-assert_generates" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assert_generates</span><span
            class="method-args">(expected_path, options, defaults={}, extras={}, message=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Asserts that the provided options can be used to generate the provided
path. This is the inverse of <code>assert_recognizes</code>. The
<code>extras</code> parameter is used to tell the request the names and
values of additional request parameters that would be in a query string.
The <code>message</code> parameter allows you to specify a custom error
message for assertion failures.</p>

<p>The <code>defaults</code> parameter is unused.</p>

<pre class="ruby"><span class="ruby-comment"># Asserts that the default action is generated for a route with no action</span>
<span class="ruby-identifier">assert_generates</span> <span class="ruby-string">&quot;/items&quot;</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;items&quot;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;index&quot;</span>

<span class="ruby-comment"># Tests that the list action is properly routed</span>
<span class="ruby-identifier">assert_generates</span> <span class="ruby-string">&quot;/items/list&quot;</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;items&quot;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;list&quot;</span>

<span class="ruby-comment"># Tests the generation of a route with a parameter</span>
<span class="ruby-identifier">assert_generates</span> <span class="ruby-string">&quot;/items/list/1&quot;</span>, { <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;items&quot;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;list&quot;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;1&quot;</span> }

<span class="ruby-comment"># Asserts that the generated route gives us our custom route</span>
<span class="ruby-identifier">assert_generates</span> <span class="ruby-string">&quot;changesets/12&quot;</span>, { <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;scm&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;show_diff&#39;</span>, <span class="ruby-identifier">revision</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;12&quot;</span> }
</pre>
          
          

          
          <div class="method-source-code" id="assert_generates-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/testing/assertions/routing.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assert_generates</span>(<span class="ruby-identifier">expected_path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>={}, <span class="ruby-identifier">extras</span>={}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">expected_path</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r{://}</span>
    <span class="ruby-identifier">fail_on</span>(<span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidURIError</span>, <span class="ruby-identifier">message</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">expected_path</span>)
      <span class="ruby-identifier">expected_path</span> = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">expected_path</span> = <span class="ruby-node">&quot;/#{expected_path}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">expected_path</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;/&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Load routes.rb if it hasn&#39;t been loaded.</span>

  <span class="ruby-identifier">generated_path</span>, <span class="ruby-identifier">extra_keys</span> = <span class="ruby-ivar">@routes</span>.<span class="ruby-identifier">generate_extras</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>)
  <span class="ruby-identifier">found_extras</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">extra_keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">k</span> }

  <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;found extras &lt;%s&gt;, not &lt;%s&gt;&quot;</span>, <span class="ruby-identifier">found_extras</span>, <span class="ruby-identifier">extras</span>)
  <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">extras</span>, <span class="ruby-identifier">found_extras</span>, <span class="ruby-identifier">msg</span>)

  <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;The generated path &lt;%s&gt; did not match &lt;%s&gt;&quot;</span>, <span class="ruby-identifier">generated_path</span>,
      <span class="ruby-identifier">expected_path</span>)
  <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">expected_path</span>, <span class="ruby-identifier">generated_path</span>, <span class="ruby-identifier">msg</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-assert_recognizes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assert_recognizes</span><span
            class="method-args">(expected_options, path, extras={}, msg=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Asserts that the routing of the given <code>path</code> was handled
correctly and that the parsed options (given in the
<code>expected_options</code> hash) match <code>path</code>. Basically, it
asserts that Rails recognizes the route given by
<code>expected_options</code>.</p>

<p>Pass a hash in the second argument (<code>path</code>) to specify the
request method. This is useful for routes requiring a specific HTTP method.
The hash should contain a :path with the incoming request path and a
:method containing the required HTTP verb.</p>

<pre class="ruby"><span class="ruby-comment"># assert that POSTing to /items will call the create action on ItemsController</span>
<span class="ruby-identifier">assert_recognizes</span>({<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;items&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;create&#39;</span>}, {<span class="ruby-identifier">path</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;items&#39;</span>, <span class="ruby-identifier">method</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">post</span>})
</pre>

<p>You can also pass in <code>extras</code> with a hash containing URL
parameters that would normally be in the query string. This can be used to
assert that values in the query string string will end up in the params
hash correctly. To test query strings you must use the extras argument,
appending the query string on the path directly will not work. For example:</p>

<pre class="ruby"><span class="ruby-comment"># assert that a path of &#39;/items/list/1?view=print&#39; returns the correct options</span>
<span class="ruby-identifier">assert_recognizes</span>({<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;items&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;list&#39;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;1&#39;</span>, <span class="ruby-identifier">view</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;print&#39;</span>}, <span class="ruby-string">&#39;items/list/1&#39;</span>, { <span class="ruby-identifier">view</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;print&quot;</span> })
</pre>

<p>The <code>message</code> parameter allows you to pass in an error message
that is displayed upon failure.</p>

<pre class="ruby"><span class="ruby-comment"># Check the default route (i.e., the index action)</span>
<span class="ruby-identifier">assert_recognizes</span>({<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;items&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;index&#39;</span>}, <span class="ruby-string">&#39;items&#39;</span>)

<span class="ruby-comment"># Test a specific action</span>
<span class="ruby-identifier">assert_recognizes</span>({<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;items&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;list&#39;</span>}, <span class="ruby-string">&#39;items/list&#39;</span>)

<span class="ruby-comment"># Test an action with a parameter</span>
<span class="ruby-identifier">assert_recognizes</span>({<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;items&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;destroy&#39;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;1&#39;</span>}, <span class="ruby-string">&#39;items/destroy/1&#39;</span>)

<span class="ruby-comment"># Test a custom route</span>
<span class="ruby-identifier">assert_recognizes</span>({<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;items&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;show&#39;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;1&#39;</span>}, <span class="ruby-string">&#39;view/item1&#39;</span>)
</pre>
          
          

          
          <div class="method-source-code" id="assert_recognizes-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/testing/assertions/routing.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assert_recognizes</span>(<span class="ruby-identifier">expected_options</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span>={}, <span class="ruby-identifier">msg</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">path</span>[<span class="ruby-value">:method</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;all&quot;</span>
    [<span class="ruby-value">:get</span>, <span class="ruby-value">:post</span>, <span class="ruby-value">:put</span>, <span class="ruby-value">:delete</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">method</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">assert_recognizes</span>(<span class="ruby-identifier">expected_options</span>, <span class="ruby-identifier">path</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">method</span><span class="ruby-operator">:</span> <span class="ruby-identifier">method</span>), <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">msg</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">request</span> = <span class="ruby-identifier">recognized_request_for</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">msg</span>)

    <span class="ruby-identifier">expected_options</span> = <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">clone</span>

    <span class="ruby-identifier">expected_options</span>.<span class="ruby-identifier">stringify_keys!</span>

    <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>, <span class="ruby-string">&quot;&quot;</span>) {
      <span class="ruby-identifier">sprintf</span>(<span class="ruby-string">&quot;The recognized options &lt;%s&gt; did not match &lt;%s&gt;, difference:&quot;</span>,
              <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span>, <span class="ruby-identifier">expected_options</span>)
    }

    <span class="ruby-identifier">assert_equal</span>(<span class="ruby-identifier">expected_options</span>, <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span>, <span class="ruby-identifier">msg</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-assert_routing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assert_routing</span><span
            class="method-args">(path, options, defaults={}, extras={}, message=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Asserts that path and options match both ways; in other words, it verifies
that <code>path</code> generates <code>options</code> and then that
<code>options</code> generates <code>path</code>. This essentially combines
<code>assert_recognizes</code> and <code>assert_generates</code> into one
step.</p>

<p>The <code>extras</code> hash allows you to specify options that would
normally be provided as a query string to the action. The
<code>message</code> parameter allows you to specify a custom error message
to display upon failure.</p>

<pre class="ruby"><span class="ruby-comment"># Assert a basic route: a controller with the default action (index)</span>
<span class="ruby-identifier">assert_routing</span> <span class="ruby-string">&#39;/home&#39;</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;home&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;index&#39;</span>

<span class="ruby-comment"># Test a route generated with a specific controller, action, and parameter (id)</span>
<span class="ruby-identifier">assert_routing</span> <span class="ruby-string">&#39;/entries/show/23&#39;</span>, <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;entries&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;show&#39;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-value">23</span>

<span class="ruby-comment"># Assert a basic route (controller + default action), with an error message if it fails</span>
<span class="ruby-identifier">assert_routing</span> <span class="ruby-string">&#39;/store&#39;</span>, { <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;store&#39;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;index&#39;</span> }, {}, {}, <span class="ruby-string">&#39;Route for store index not generated properly&#39;</span>

<span class="ruby-comment"># Tests a route, providing a defaults hash</span>
<span class="ruby-identifier">assert_routing</span> <span class="ruby-string">&#39;controller/action/9&#39;</span>, {<span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;9&quot;</span>, <span class="ruby-identifier">item</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;square&quot;</span>}, {<span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;controller&quot;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;action&quot;</span>}, {}, {<span class="ruby-identifier">item</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;square&quot;</span>}

<span class="ruby-comment"># Tests a route with a HTTP method</span>
<span class="ruby-identifier">assert_routing</span>({ <span class="ruby-identifier">method</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;put&#39;</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;/product/321&#39;</span> }, { <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;product&quot;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;update&quot;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;321&quot;</span> })
</pre>
          
          

          
          <div class="method-source-code" id="assert_routing-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/testing/assertions/routing.rb, line 121</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assert_routing</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-identifier">defaults</span>={}, <span class="ruby-identifier">extras</span>={}, <span class="ruby-identifier">message</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">assert_recognizes</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">message</span>)

  <span class="ruby-identifier">controller</span>, <span class="ruby-identifier">default_controller</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:controller</span>], <span class="ruby-identifier">defaults</span>[<span class="ruby-value">:controller</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">controller</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">controller</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">?/</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">default_controller</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">default_controller</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">?/</span>)
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:controller</span>] = <span class="ruby-node">&quot;/#{controller}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">generate_options</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">delete_if</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">defaults</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">k</span>) }
  <span class="ruby-identifier">assert_generates</span>(<span class="ruby-identifier">path</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">path</span>[<span class="ruby-value">:path</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">generate_options</span>, <span class="ruby-identifier">defaults</span>, <span class="ruby-identifier">extras</span>, <span class="ruby-identifier">message</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-method_missing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(selector, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>ROUTES TODO: These assertions should really work in an integration context</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="method_missing-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/testing/assertions/routing.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">selector</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@controller</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@controller</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@routes</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@routes</span>.<span class="ruby-identifier">named_routes</span>.<span class="ruby-identifier">route_defined?</span>(<span class="ruby-identifier">selector</span>)
    <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">selector</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">super</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-with_routing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">with_routing</span><span
            class="method-args">() { |routes| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A helper to make it easier to test different route configurations. This
method temporarily replaces @routes with a new RouteSet instance.</p>

<p>The new instance is yielded to the passed block. Typically the block will
create some routes using <code>set.draw { match ... }</code>:</p>

<pre class="ruby"><span class="ruby-identifier">with_routing</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">set</span>.<span class="ruby-identifier">draw</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">resources</span> :<span class="ruby-identifier">users</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;/users&quot;</span>, <span class="ruby-identifier">users_path</span>
<span class="ruby-keyword">end</span>
</pre>
          
          

          
          <div class="method-source-code" id="with_routing-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/testing/assertions/routing.rb, line 147</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">with_routing</span>
  <span class="ruby-identifier">old_routes</span>, <span class="ruby-ivar">@routes</span> = <span class="ruby-ivar">@routes</span>, <span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">Routing</span><span class="ruby-operator">::</span><span class="ruby-constant">RouteSet</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@controller</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@controller</span>
    <span class="ruby-identifier">old_controller</span>, <span class="ruby-ivar">@controller</span> = <span class="ruby-ivar">@controller</span>, <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">clone</span>
    <span class="ruby-identifier">_routes</span> = <span class="ruby-ivar">@routes</span>

    <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">singleton_class</span>.<span class="ruby-identifier">send</span>(<span class="ruby-value">:include</span>, <span class="ruby-identifier">_routes</span>.<span class="ruby-identifier">url_helpers</span>)
    <span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">view_context_class</span> = <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@controller</span>.<span class="ruby-identifier">view_context_class</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">include</span> <span class="ruby-identifier">_routes</span>.<span class="ruby-identifier">url_helpers</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-ivar">@routes</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@routes</span> = <span class="ruby-identifier">old_routes</span>
  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@controller</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@controller</span>
    <span class="ruby-ivar">@controller</span> = <span class="ruby-identifier">old_controller</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-fail_on" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">fail_on</span><span
            class="method-args">(exception_class, message) { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="fail_on-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/testing/assertions/routing.rb, line 211</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">fail_on</span>(<span class="ruby-identifier">exception_class</span>, <span class="ruby-identifier">message</span>)
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-identifier">exception_class</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">Minitest</span><span class="ruby-operator">::</span><span class="ruby-constant">Assertion</span>, <span class="ruby-identifier">message</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-recognized_request_for" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">recognized_request_for</span><span
            class="method-args">(path, extras = {}, msg)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Recognizes the route for a given path.</p>
          
          

          
          <div class="method-source-code" id="recognized_request_for-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/testing/assertions/routing.rb, line 177</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">recognized_request_for</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">extras</span> = {}, <span class="ruby-identifier">msg</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
    <span class="ruby-identifier">method</span> = <span class="ruby-identifier">path</span>[<span class="ruby-value">:method</span>]
    <span class="ruby-identifier">path</span>   = <span class="ruby-identifier">path</span>[<span class="ruby-value">:path</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">method</span> = <span class="ruby-value">:get</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Assume given controller</span>
  <span class="ruby-identifier">request</span> = <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestRequest</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r{://}</span>
    <span class="ruby-identifier">fail_on</span>(<span class="ruby-constant">URI</span><span class="ruby-operator">::</span><span class="ruby-constant">InvalidURIError</span>, <span class="ruby-identifier">msg</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">path</span>)
      <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;rack.url_scheme&quot;</span>] = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">scheme</span> <span class="ruby-operator">||</span> <span class="ruby-string">&quot;http&quot;</span>
      <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host</span> = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">host</span>
      <span class="ruby-identifier">request</span>.<span class="ruby-identifier">port</span> = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">port</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">port</span>
      <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span> = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">path</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;/#{path}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;/&quot;</span>
    <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span> = <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_method</span> = <span class="ruby-identifier">method</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">method</span>

  <span class="ruby-identifier">params</span> = <span class="ruby-identifier">fail_on</span>(<span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">RoutingError</span>, <span class="ruby-identifier">msg</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-ivar">@routes</span>.<span class="ruby-identifier">recognize_path</span>(<span class="ruby-identifier">path</span>, { <span class="ruby-value">:method</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">method</span>, <span class="ruby-value">:extras</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">extras</span> })
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_parameters</span> = <span class="ruby-identifier">params</span>.<span class="ruby-identifier">with_indifferent_access</span>

  <span class="ruby-identifier">request</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

