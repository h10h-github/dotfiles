<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ActionDispatch::Session::CookieStore - actionpack-4.2.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Rack::Session::Abstract::ID
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="Compatibility.html">ActionDispatch::Session::Compatibility</a>
  
  
  
    <li><a class="include" href="StaleSessionCheck.html">ActionDispatch::Session::StaleSessionCheck</a>
  
  
  
    <li><a class="include" href="SessionObject.html">ActionDispatch::Session::SessionObject</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-cookie_jar">#cookie_jar</a>
    
    <li ><a href="#method-i-destroy_session">#destroy_session</a>
    
    <li ><a href="#method-i-extract_session_id">#extract_session_id</a>
    
    <li ><a href="#method-i-get_cookie">#get_cookie</a>
    
    <li ><a href="#method-i-load_session">#load_session</a>
    
    <li ><a href="#method-i-persistent_session_id-21">#persistent_session_id!</a>
    
    <li ><a href="#method-i-set_cookie">#set_cookie</a>
    
    <li ><a href="#method-i-set_session">#set_session</a>
    
    <li ><a href="#method-i-unpacked_cookie_data">#unpacked_cookie_data</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ActionDispatch::Session::CookieStore">
  <h1 id="class-ActionDispatch::Session::CookieStore" class="class">
    class ActionDispatch::Session::CookieStore
  </h1>

  <section class="description">
    
<p>This cookie-based session store is the Rails default. It is dramatically
faster than the alternatives.</p>

<p>Sessions typically contain at most a user_id and flash message; both fit
within the 4K cookie size limit. A CookieOverflow exception is raised if
you attempt to store more than 4K of data.</p>

<p>The cookie jar used for storage is automatically configured to be the best
possible option given your application&#39;s configuration.</p>

<p>If you only have secret_token set, your cookies will be signed, but not
encrypted. This means a user cannot alter their <code>user_id</code>
without knowing your app&#39;s secret key, but can easily read their
<code>user_id</code>. This was the default for Rails 3 apps.</p>

<p>If you have secret_key_base set, your cookies will be encrypted. This goes
a step further than signed cookies in that encrypted cookies cannot be
altered or read by users. This is the default starting in Rails 4.</p>

<p>If you have both secret_token and secret_key base set, your cookies will be
encrypted, and signed cookies generated by Rails 3 will be transparently
read and encrypted to provide a smooth upgrade path.</p>

<p>Configure your session store in config/initializers/session_store.rb:</p>

<pre class="ruby"><span class="ruby-constant">Rails</span>.<span class="ruby-identifier">application</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">session_store</span> :<span class="ruby-identifier">cookie_store</span>, <span class="ruby-identifier">key</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;_your_app_session&#39;</span>
</pre>

<p>Configure your secret key in config/secrets.yml:</p>

<pre>development:
  secret_key_base: &#39;secret key&#39;</pre>

<p>To generate a secret key for an existing application, run `rake secret`.</p>

<p>If you are upgrading an existing Rails 3 app, you should leave your
existing secret_token in place and simply add the new secret_key_base. Note
that you should wait to set secret_key_base until you have 100% of your
userbase on Rails 4 and are reasonably sure you will not need to rollback
to Rails 3. This is because cookies signed based on the new secret_key_base
in Rails 4 are not backwards compatible with Rails 3. You are free to leave
your existing secret_token in place, not set the new secret_key_base, and
ignore the deprecation warnings until you are reasonably sure that your
upgrade is otherwise complete. Additionally, you should take care to make
sure you are not relying on the ability to decode signed cookies generated
by your app in external applications or JavaScript before upgrading.</p>

<p>Note that changing the secret key will invalidate all existing sessions!</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(app, options={})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Compatibility.html#method-c-new">ActionDispatch::Session::Compatibility.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">options</span>={})
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">app</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">:cookie_only</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-destroy_session" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">destroy_session</span><span
            class="method-args">(env, session_id, options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="destroy_session-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">destroy_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">new_sid</span> = <span class="ruby-identifier">generate_sid</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:drop</span>]
  <span class="ruby-comment"># Reset hash and Assign the new session id</span>
  <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;action_dispatch.request.unsigned_session_cookie&quot;</span>] = <span class="ruby-identifier">new_sid</span> <span class="ruby-operator">?</span> { <span class="ruby-string">&quot;session_id&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">new_sid</span> } <span class="ruby-operator">:</span> {}
  <span class="ruby-identifier">new_sid</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-load_session" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_session</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="load_session-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 71</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_session</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">stale_session_check!</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">unpacked_cookie_data</span>(<span class="ruby-identifier">env</span>)
    <span class="ruby-identifier">data</span> = <span class="ruby-identifier">persistent_session_id!</span>(<span class="ruby-identifier">data</span>)
    [<span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;session_id&quot;</span>], <span class="ruby-identifier">data</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-cookie_jar" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cookie_jar</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="cookie_jar-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cookie_jar</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">request</span> = <span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">Request</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">cookie_jar</span>.<span class="ruby-identifier">signed_or_encrypted</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-extract_session_id" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extract_session_id</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="extract_session_id-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">extract_session_id</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">stale_session_check!</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">unpacked_cookie_data</span>(<span class="ruby-identifier">env</span>)[<span class="ruby-string">&quot;session_id&quot;</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-get_cookie" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_cookie</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="get_cookie-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_cookie</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">cookie_jar</span>(<span class="ruby-identifier">env</span>)[<span class="ruby-ivar">@key</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-persistent_session_id-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">persistent_session_id!</span><span
            class="method-args">(data, sid=nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="persistent_session_id-21-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">persistent_session_id!</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">sid</span>=<span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">data</span> <span class="ruby-operator">||=</span> {}
  <span class="ruby-identifier">data</span>[<span class="ruby-string">&quot;session_id&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">sid</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">generate_sid</span>
  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_cookie" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_cookie</span><span
            class="method-args">(env, session_id, cookie)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_cookie-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 109</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_cookie</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">session_id</span>, <span class="ruby-identifier">cookie</span>)
  <span class="ruby-identifier">cookie_jar</span>(<span class="ruby-identifier">env</span>)[<span class="ruby-ivar">@key</span>] = <span class="ruby-identifier">cookie</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-set_session" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_session</span><span
            class="method-args">(env, sid, session_data, options)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="set_session-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 104</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_session</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">sid</span>, <span class="ruby-identifier">session_data</span>, <span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">session_data</span>[<span class="ruby-string">&quot;session_id&quot;</span>] = <span class="ruby-identifier">sid</span>
  <span class="ruby-identifier">session_data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unpacked_cookie_data" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unpacked_cookie_data</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="unpacked_cookie_data-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/session/cookie_store.rb, line 87</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unpacked_cookie_data</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">env</span>[<span class="ruby-string">&quot;action_dispatch.request.unsigned_session_cookie&quot;</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">stale_session_check!</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span> = <span class="ruby-identifier">get_cookie</span>(<span class="ruby-identifier">env</span>)
        <span class="ruby-identifier">data</span>.<span class="ruby-identifier">stringify_keys!</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">data</span> <span class="ruby-operator">||</span> {}
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

