<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>README - bcrypt-ruby</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-bcrypt-ruby">bcrypt-ruby</a>
    <li><a href="#label-Why+you+should+use+bcrypt-28-29">Why you should use bcrypt()</a>
    <li><a href="#label-How+to+install+bcrypt">How to install bcrypt</a>
    <li><a href="#label-How+to+use+bcrypt-28-29+in+your+Rails+application">How to use bcrypt() in your Rails application</a>
    <li><a href="#label-The+User+model">The User model</a>
    <li><a href="#label-Creating+an+account">Creating an account</a>
    <li><a href="#label-Authenticating+a+user">Authenticating a user</a>
    <li><a href="#label-If+a+user+forgets+their+password-3F">If a user forgets their password?</a>
    <li><a href="#label-How+to+use+bcrypt-ruby+in+general">How to use bcrypt-ruby in general</a>
    <li><a href="#label-How+bcrypt-28-29+works">How bcrypt() works</a>
    <li><a href="#label-Background">Background</a>
    <li><a href="#label-Rainbow+Tables">Rainbow Tables</a>
    <li><a href="#label-Salts">Salts</a>
    <li><a href="#label-Cost+Factors">Cost Factors</a>
    <li><a href="#label-More+Information">More Information</a>
    <li><a href="#label-Etc">Etc</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./CHANGELOG.html">CHANGELOG</a>
  
    <li><a href="./COPYING.html">COPYING</a>
  
    <li><a href="./README_md.html">README</a>
  
    <li><a href="./ext/jruby/bcrypt_jruby/BCrypt_java.html">BCrypt.java</a>
  
    <li><a href="./ext/mri/Makefile.html">Makefile</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page README.md">

<h1 id="label-bcrypt-ruby">bcrypt-ruby<span><a href="#label-bcrypt-ruby">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>An easy way to keep your users&#39; passwords secure.</p>
<ul><li>
<p><a
href="http://github.com/codahale/bcrypt-ruby/tree/master">github.com/codahale/bcrypt-ruby/tree/master</a></p>
</li></ul>

<p><a href="https://travis-ci.org/codahale/bcrypt-ruby"><img
src="https://travis-ci.org/codahale/bcrypt-ruby.png?branch=master"></a></p>

<h2 id="label-Why+you+should+use+bcrypt-28-29">Why you should use bcrypt()<span><a href="#label-Why+you+should+use+bcrypt-28-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>If you store user passwords in the clear, then an attacker who steals a
copy of your database has a giant list of emails and passwords. Some of
your users will only have one password – for their email account, for their
banking account, for your application. A simple hack could escalate into
massive identity theft.</p>

<p>It&#39;s your responsibility as a web developer to make your web
application secure – blaming your users for not being security experts is
not a professional response to risk.</p>

<p><code>bcrypt()</code> allows you to easily harden your application against
these kinds of attacks.</p>

<p><em>Note</em>: JRuby versions of the bcrypt gem <code>&lt;= 2.1.3</code>
had a <a href="http://www.mindrot.org/files/jBCrypt/internat.adv">security
vulnerability</a> that was fixed in <code>&gt;= 2.1.4</code>. If you used a
vulnerable version to hash passwords with international characters in them,
you will need to re-hash those passwords. This vulnerability only affected
the JRuby gem.</p>

<h2 id="label-How+to+install+bcrypt">How to install bcrypt<span><a href="#label-How+to+install+bcrypt">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">bcrypt</span>
</pre>

<p>The bcrypt gem is available on the following ruby platforms:</p>
<ul><li>
<p>JRuby</p>
</li><li>
<p>RubyInstaller 1.8, 1.9, 2.0, and 2.1 builds on win32</p>
</li><li>
<p>Any 1.8, 1.9, 2.0, 2.1, or 2.2 Ruby on a BSD/OS X/Linux system with a
compiler</p>
</li></ul>

<h2 id="label-How+to+use+bcrypt-28-29+in+your+Rails+application">How to use bcrypt() in your Rails application<span><a href="#label-How+to+use+bcrypt-28-29+in+your+Rails+application">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><em>Note</em>: Rails versions &gt;= 3 ship with
<code>ActiveModel::SecurePassword</code> which uses bcrypt-ruby.
<code>has_secure_password</code> <a
href="http://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html#method-i-has_secure_password">docs</a>
implements a similar authentication strategy to the code below.</p>

<h3 id="label-The+User+model">The User model<span><a href="#label-The+User+model">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;bcrypt&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># users.password_hash in the database is a :string</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">BCrypt</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">password</span>
    <span class="ruby-ivar">@password</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Password</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">password_hash</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">password=</span>(<span class="ruby-identifier">new_password</span>)
    <span class="ruby-ivar">@password</span> = <span class="ruby-constant">Password</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">new_password</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">password_hash</span> = <span class="ruby-ivar">@password</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Creating+an+account">Creating an account<span><a href="#label-Creating+an+account">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">user</span>])
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password</span> = <span class="ruby-identifier">params</span>[:<span class="ruby-identifier">password</span>]
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save!</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Authenticating+a+user">Authenticating a user<span><a href="#label-Authenticating+a+user">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">login</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">email</span>])
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[:<span class="ruby-identifier">password</span>]
    <span class="ruby-identifier">give_token</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">home_url</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-If+a+user+forgets+their+password-3F">If a user forgets their password?<span><a href="#label-If+a+user+forgets+their+password-3F">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-comment"># assign them a random one and mail it to them, asking them to change it</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">forgot_password</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_email</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">email</span>])
  <span class="ruby-identifier">random_password</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">10</span>).<span class="ruby-identifier">map</span> { (<span class="ruby-value">65</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rand</span>(<span class="ruby-value">58</span>)).<span class="ruby-identifier">chr</span> }.<span class="ruby-identifier">join</span>
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">password</span> = <span class="ruby-identifier">random_password</span>
  <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">save!</span>
  <span class="ruby-constant">Mailer</span>.<span class="ruby-identifier">create_and_deliver_password_change</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-identifier">random_password</span>)
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-How+to+use+bcrypt-ruby+in+general">How to use bcrypt-ruby in general<span><a href="#label-How+to+use+bcrypt-ruby+in+general">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;bcrypt&#39;</span>

<span class="ruby-identifier">my_password</span> = <span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Password</span>.<span class="ruby-identifier">create</span>(<span class="ruby-string">&quot;my password&quot;</span>)
  <span class="ruby-comment">#=&gt; &quot;$2a$10$vI8aWBnW3fID.ZQ4/zo1G.q1lRps.9cGLcZEiGDMVr5yUP1KUOYTa&quot;</span>

<span class="ruby-identifier">my_password</span>.<span class="ruby-identifier">version</span>              <span class="ruby-comment">#=&gt; &quot;2a&quot;</span>
<span class="ruby-identifier">my_password</span>.<span class="ruby-identifier">cost</span>                 <span class="ruby-comment">#=&gt; 10</span>
<span class="ruby-identifier">my_password</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;my password&quot;</span>     <span class="ruby-comment">#=&gt; true</span>
<span class="ruby-identifier">my_password</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;not my password&quot;</span> <span class="ruby-comment">#=&gt; false</span>

<span class="ruby-identifier">my_password</span> = <span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Password</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;$2a$10$vI8aWBnW3fID.ZQ4/zo1G.q1lRps.9cGLcZEiGDMVr5yUP1KUOYTa&quot;</span>)
<span class="ruby-identifier">my_password</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;my password&quot;</span>     <span class="ruby-comment">#=&gt; true</span>
<span class="ruby-identifier">my_password</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;not my password&quot;</span> <span class="ruby-comment">#=&gt; false</span>
</pre>

<p>Check the rdocs for more details – <a href="BCrypt.html">BCrypt</a>, <a
href="BCrypt/Password.html">BCrypt::Password</a>.</p>

<h2 id="label-How+bcrypt-28-29+works">How bcrypt() works<span><a href="#label-How+bcrypt-28-29+works">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><code>bcrypt()</code> is a hashing algorithm designed by Niels Provos and
David Mazières of the OpenBSD Project.</p>

<h3 id="label-Background">Background<span><a href="#label-Background">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Hash algorithms take a chunk of data (e.g., your user&#39;s password) and
create a “digital fingerprint,” or hash, of it. Because this process is not
reversible, there&#39;s no way to go from the hash back to the password.</p>

<p>In other words:</p>

<pre class="ruby"><span class="ruby-identifier">hash</span>(<span class="ruby-identifier">p</span>) <span class="ruby-comment">#=&gt; &lt;unique gibberish&gt;</span>
</pre>

<p>You can store the hash and check it against a hash made of a potentially
valid password:</p>

<pre>&lt;unique gibberish&gt; =? hash(just_entered_password)</pre>

<h3 id="label-Rainbow+Tables">Rainbow Tables<span><a href="#label-Rainbow+Tables">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>But even this has weaknesses – attackers can just run lists of possible
passwords through the same algorithm, store the results in a big database,
and then look up the passwords by their hash:</p>

<pre>PrecomputedPassword.find_by_hash(&lt;unique gibberish&gt;).password #=&gt; &quot;secret1&quot;</pre>

<h3 id="label-Salts">Salts<span><a href="#label-Salts">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The solution to this is to add a small chunk of random data – called a salt
– to the password before it&#39;s hashed:</p>

<pre class="ruby"><span class="ruby-identifier">hash</span>(<span class="ruby-identifier">salt</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>) <span class="ruby-comment">#=&gt; &lt;really unique gibberish&gt;</span>
</pre>

<p>The salt is then stored along with the hash in the database, and used to
check potentially valid passwords:</p>

<pre>&lt;really unique gibberish&gt; =? hash(salt + just_entered_password)</pre>

<p>bcrypt-ruby automatically handles the storage and generation of these salts
for you.</p>

<p>Adding a salt means that an attacker has to have a gigantic database for
each unique salt – for a salt made of 4 letters, that&#39;s 456,976
different databases. Pretty much no one has that much storage space, so
attackers try a different, slower method – throw a list of potential
passwords at each individual password:</p>

<pre>hash(salt + &quot;aadvark&quot;) =? &lt;really unique gibberish&gt;
hash(salt + &quot;abacus&quot;)  =? &lt;really unique gibberish&gt;
etc.</pre>

<p>This is much slower than the big database approach, but most hash
algorithms are pretty quick – and therein lies the problem. Hash algorithms
aren&#39;t usually designed to be slow, they&#39;re designed to turn
gigabytes of data into secure fingerprints as quickly as possible.
<code>bcrypt()</code>, though, is designed to be computationally expensive:</p>

<pre>Ten thousand iterations:
             user     system      total        real
md5      0.070000   0.000000   0.070000 (  0.070415)
bcrypt  22.230000   0.080000  22.310000 ( 22.493822)</pre>

<p>If an attacker was using Ruby to check each password, they could check
~140,000 passwords a second with MD5 but only ~450 passwords a second with
<code>bcrypt()</code>.</p>

<h3 id="label-Cost+Factors">Cost Factors<span><a href="#label-Cost+Factors">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In addition, <code>bcrypt()</code> allows you to increase the amount of
work required to hash a password as computers get faster. Old passwords
will still work fine, but new passwords can keep up with the times.</p>

<p>The default cost factor used by bcrypt-ruby is 10, which is fine for
session-based authentication. If you are using a stateless authentication
architecture (e.g., HTTP Basic Auth), you will want to lower the cost
factor to reduce your server load and keep your request times down. This
will lower the security provided you, but there are few alternatives.</p>

<p>To change the default cost factor used by bcrypt-ruby, use
<code>BCrypt::Engine.cost = new_value</code>:</p>

<pre class="ruby"><span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Password</span>.<span class="ruby-identifier">create</span>(<span class="ruby-string">&#39;secret&#39;</span>).<span class="ruby-identifier">cost</span>
  <span class="ruby-comment">#=&gt; 10, the default provided by bcrypt-ruby</span>

<span class="ruby-comment"># set a new default cost</span>
<span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Engine</span>.<span class="ruby-identifier">cost</span> = <span class="ruby-value">8</span>
<span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Password</span>.<span class="ruby-identifier">create</span>(<span class="ruby-string">&#39;secret&#39;</span>).<span class="ruby-identifier">cost</span>
  <span class="ruby-comment">#=&gt; 8</span>
</pre>

<p>The default cost can be overridden as needed by passing an options hash
with a different cost:</p>

<pre class="ruby"><span class="ruby-constant">BCrypt</span><span class="ruby-operator">::</span><span class="ruby-constant">Password</span>.<span class="ruby-identifier">create</span>(<span class="ruby-string">&#39;secret&#39;</span>, :<span class="ruby-identifier">cost</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">6</span>).<span class="ruby-identifier">cost</span>  <span class="ruby-comment">#=&gt; 6</span>
</pre>

<h2 id="label-More+Information">More Information<span><a href="#label-More+Information">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><code>bcrypt()</code> is currently used as the default password storage
hash in OpenBSD, widely regarded as the most secure operating system
available.</p>

<p>For a more technical explanation of the algorithm and its design criteria,
please read Niels Provos and David Mazières&#39; Usenix99 paper: <a
href="http://www.usenix.org/events/usenix99/provos.html">www.usenix.org/events/usenix99/provos.html</a></p>

<p>If you&#39;d like more down-to-earth advice regarding cryptography, I
suggest reading <em>Practical Cryptography</em> by Niels Ferguson and Bruce
Schneier: <a
href="http://www.schneier.com/book-practical.html">www.schneier.com/book-practical.html</a></p>

<h1 id="label-Etc">Etc<span><a href="#label-Etc">&para;</a> <a href="#top">&uarr;</a></span></h1>
<ul><li>
<p>Author :: Coda Hale <a
href="mailto:coda.hale@gmail.com">coda.hale@gmail.com</a></p>
</li><li>
<p>Website :: <a href="http://blog.codahale.com">blog.codahale.com</a></p>
</li></ul>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

