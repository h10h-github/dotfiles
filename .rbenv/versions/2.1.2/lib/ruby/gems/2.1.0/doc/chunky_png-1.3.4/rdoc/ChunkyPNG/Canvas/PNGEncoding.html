<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module ChunkyPNG::Canvas::PNGEncoding - chunky_png</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-i-determine_png_encoding">#determine_png_encoding</a>
    
    <li ><a href="#method-i-encode_png_image_pass_to_stream">#encode_png_image_pass_to_stream</a>
    
    <li ><a href="#method-i-encode_png_image_with_interlacing">#encode_png_image_with_interlacing</a>
    
    <li ><a href="#method-i-encode_png_image_without_interlacing">#encode_png_image_without_interlacing</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_grayscale_1bit">#encode_png_pixels_to_scanline_grayscale_1bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_grayscale_2bit">#encode_png_pixels_to_scanline_grayscale_2bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_grayscale_4bit">#encode_png_pixels_to_scanline_grayscale_4bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_grayscale_8bit">#encode_png_pixels_to_scanline_grayscale_8bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_grayscale_alpha_8bit">#encode_png_pixels_to_scanline_grayscale_alpha_8bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_indexed_1bit">#encode_png_pixels_to_scanline_indexed_1bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_indexed_2bit">#encode_png_pixels_to_scanline_indexed_2bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_indexed_4bit">#encode_png_pixels_to_scanline_indexed_4bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_indexed_8bit">#encode_png_pixels_to_scanline_indexed_8bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_method">#encode_png_pixels_to_scanline_method</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_truecolor_8bit">#encode_png_pixels_to_scanline_truecolor_8bit</a>
    
    <li ><a href="#method-i-encode_png_pixels_to_scanline_truecolor_alpha_8bit">#encode_png_pixels_to_scanline_truecolor_alpha_8bit</a>
    
    <li ><a href="#method-i-encode_png_pixelstream">#encode_png_pixelstream</a>
    
    <li ><a href="#method-i-encode_png_str_scanline_average">#encode_png_str_scanline_average</a>
    
    <li ><a href="#method-i-encode_png_str_scanline_none">#encode_png_str_scanline_none</a>
    
    <li ><a href="#method-i-encode_png_str_scanline_paeth">#encode_png_str_scanline_paeth</a>
    
    <li ><a href="#method-i-encode_png_str_scanline_sub">#encode_png_str_scanline_sub</a>
    
    <li ><a href="#method-i-encode_png_str_scanline_up">#encode_png_str_scanline_up</a>
    
    <li ><a href="#method-i-save">#save</a>
    
    <li ><a href="#method-i-to_blob">#to_blob</a>
    
    <li ><a href="#method-i-to_datastream">#to_datastream</a>
    
    <li ><a href="#method-i-to_s">#to_s</a>
    
    <li ><a href="#method-i-to_string">#to_string</a>
    
    <li ><a href="#method-i-write">#write</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-ChunkyPNG::Canvas::PNGEncoding">
  <h1 id="module-ChunkyPNG::Canvas::PNGEncoding" class="module">
    module ChunkyPNG::Canvas::PNGEncoding
  </h1>

  <section class="description">
    
<p>Methods for encoding a <a href="../Canvas.html">Canvas</a> instance into a
PNG datastream.</p>

<p>Overview of the encoding process:</p>
<ul><li>
<p>The image is split up in scanlines (i.e. rows of pixels);</p>
</li><li>
<p>All pixels are encoded as a pixelstream, based on the color mode.</p>
</li><li>
<p>All the pixel bytes in the pixelstream are adjusted using a filtering 
method if one is specified.</p>
</li><li>
<p>Compress the resulting string using deflate compression.</p>
</li><li>
<p>Split compressed data over one or more PNG chunks.</p>
</li><li>
<p>These chunks should be embedded in a datastream with at least a IHDR and 
IEND chunk and possibly a PLTE chunk.</p>
</li></ul>

<p>For interlaced images, the initial image is first split into 7 subimages.
These images get encoded exactly as above, and the result gets combined
before the compression step.</p>

<p>@see <a href="PNGDecoding.html">ChunkyPNG::Canvas::PNGDecoding</a> @see <a
href="http://www.w3.org/TR/PNG">www.w3.org/TR/PNG</a>/ The W3C PNG format
specification</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-encoding_palette" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">encoding_palette</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>The palette used for encoding the image.This is only in used for images
that get encoded using indexed colors. @return [ChunkyPNG::Palette]</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-save" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save</span><span
            class="method-args">(filename, constraints = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Writes the canvas to a file, encoded as a PNG image. @param [String]
filename The file to save the PNG image to. @param constraints (see <a
href="PNGEncoding.html#method-i-to_datastream">#to_datastream</a>) @return
[void]</p>
          
          

          
          <div class="method-source-code" id="save-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 42</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">constraints</span> = {})
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-string">&#39;wb&#39;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">constraints</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_blob" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_blob</span><span
            class="method-args">(constraints = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encoded the canvas to a PNG formatted string. @param constraints (see <a
href="PNGEncoding.html#method-i-to_datastream">#to_datastream</a>) @return
[String] The PNG encoded canvas as string.</p>
          
          

          
          <div class="method-source-code" id="to_blob-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 49</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_blob</span>(<span class="ruby-identifier">constraints</span> = {})
  <span class="ruby-identifier">to_datastream</span>(<span class="ruby-identifier">constraints</span>).<span class="ruby-identifier">to_blob</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="PNGEncoding.html#method-i-to_string">to_string</a>, <a href="PNGEncoding.html#method-i-to_s">to_s</a>
        </div>
        

        
      </div>

    
      <div id="method-i-to_datastream" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_datastream</span><span
            class="method-args">(constraints = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Converts this <a href="../Canvas.html">Canvas</a> to a datastream, so that
it can be saved as a PNG image. @param [Hash, Symbol] constraints The
constraints to use when encoding the canvas.</p>

<pre>This can either be a hash with different constraints, or a symbol which acts as a 
preset for some constraints. If no constraints are given, ChunkyPNG will decide  
for itself how to best create the PNG datastream. 
Supported presets are &lt;tt&gt;:fast_rgba&lt;/tt&gt; for quickly saving images with transparency,
&lt;tt&gt;:fast_rgb&lt;/tt&gt; for quickly saving opaque images, and &lt;tt&gt;:best_compression&lt;/tt&gt; to
obtain the smallest possible filesize.</pre>

<p>@option constraints [Fixnum] :color_mode The color mode to use. Use one of
the</p>

<pre>ChunkyPNG::COLOR_* constants.</pre>

<p>@option constraints [true, false] :interlace Whether to use interlacing.
@option constraints [Fixnum] :compression The compression level for Zlib.
This can be a</p>

<pre>value between 0 and 9, or a Zlib constant like Zlib::BEST_COMPRESSION.</pre>

<p>@option constraints [Fixnum] :bit_depth The bit depth to use. This option
is only used</p>

<pre>for indexed images, in which case it overrides the determined minimal bit depth. For
all the other color modes, a bit depth of 8 is used.</pre>

<p>@return [ChunkyPNG::Datastream] The PNG datastream containing the encoded
canvas. @see <a
href="PNGEncoding.html#method-i-determine_png_encoding">#determine_png_encoding</a></p>
          
          

          
          <div class="method-source-code" id="to_datastream-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 74</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_datastream</span>(<span class="ruby-identifier">constraints</span> = {})
  <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">determine_png_encoding</span>(<span class="ruby-identifier">constraints</span>)

  <span class="ruby-identifier">ds</span> = <span class="ruby-constant">Datastream</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">header_chunk</span> = <span class="ruby-constant">Chunk</span><span class="ruby-operator">::</span><span class="ruby-constant">Header</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:width</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">width</span>, <span class="ruby-value">:height</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">height</span>,
      <span class="ruby-value">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:color_mode</span>], <span class="ruby-value">:depth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:bit_depth</span>], <span class="ruby-value">:interlace</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:interlace</span>])

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:color_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_INDEXED</span>
    <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">palette_chunk</span>      = <span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">to_plte_chunk</span>
    <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">transparency_chunk</span> = <span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">to_trns_chunk</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">opaque?</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">data</span>           = <span class="ruby-identifier">encode_png_pixelstream</span>(<span class="ruby-identifier">encoding</span>[<span class="ruby-value">:color_mode</span>], <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:bit_depth</span>], <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:interlace</span>], <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:filtering</span>])
  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">data_chunks</span> = <span class="ruby-constant">Chunk</span><span class="ruby-operator">::</span><span class="ruby-constant">ImageData</span>.<span class="ruby-identifier">split_in_chunks</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:compression</span>])
  <span class="ruby-identifier">ds</span>.<span class="ruby-identifier">end_chunk</span>   = <span class="ruby-constant">Chunk</span><span class="ruby-operator">::</span><span class="ruby-constant">End</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ds</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_s" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">to_s</span><span
            class="method-args">(constraints = {})</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="PNGEncoding.html#method-i-to_blob">to_blob</a>
        </div>
        
      </div>

    
      <div id="method-i-to_string" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">to_string</span><span
            class="method-args">(constraints = {})</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="PNGEncoding.html#method-i-to_blob">to_blob</a>
        </div>
        
      </div>

    
      <div id="method-i-write" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write</span><span
            class="method-args">(io, constraints = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Writes the canvas to an IO stream, encoded as a PNG image. @param [IO] io
The output stream to write to. @param constraints (see <a
href="PNGEncoding.html#method-i-to_datastream">#to_datastream</a>) @return
[void]</p>
          
          

          
          <div class="method-source-code" id="write-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 34</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">io</span>, <span class="ruby-identifier">constraints</span> = {})
  <span class="ruby-identifier">to_datastream</span>(<span class="ruby-identifier">constraints</span>).<span class="ruby-identifier">write</span>(<span class="ruby-identifier">io</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-determine_png_encoding" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">determine_png_encoding</span><span
            class="method-args">(constraints = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Determines the best possible PNG encoding variables for this image, by
analyzing  the colors used for the image.</p>

<p>You can provide constraints for the encoding variables by passing a hash
with  encoding variables to this method.</p>

<p>@param [Hash, Symbol] constraints The constraints for the encoding. This
can be a</p>

<pre>Hash or a preset symbol.</pre>

<p>@return [Hash] A hash with encoding options for
{ChunkyPNG::Canvas::PNGEncoding#to_datastream}</p>
          
          

          
          <div class="method-source-code" id="determine_png_encoding-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 102</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">determine_png_encoding</span>(<span class="ruby-identifier">constraints</span> = {})

  <span class="ruby-identifier">encoding</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">constraints</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:fast_rgb</span>;         { <span class="ruby-value">:color_mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_TRUECOLOR</span>, <span class="ruby-value">:compression</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_SPEED</span> }
    <span class="ruby-keyword">when</span> <span class="ruby-value">:fast_rgba</span>;        { <span class="ruby-value">:color_mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_TRUECOLOR_ALPHA</span>, <span class="ruby-value">:compression</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_SPEED</span> }
    <span class="ruby-keyword">when</span> <span class="ruby-value">:best_compression</span>; { <span class="ruby-value">:compression</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_COMPRESSION</span>, <span class="ruby-value">:filtering</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_PAETH</span> }
    <span class="ruby-keyword">when</span> <span class="ruby-value">:good_compression</span>; { <span class="ruby-value">:compression</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_COMPRESSION</span>, <span class="ruby-value">:filtering</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_NONE</span> }
    <span class="ruby-keyword">when</span> <span class="ruby-value">:no_compression</span>;   { <span class="ruby-value">:compression</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_COMPRESSION</span> }
    <span class="ruby-keyword">when</span> <span class="ruby-value">:black_and_white</span>;  { <span class="ruby-value">:color_mode</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_GRAYSCALE</span>, <span class="ruby-value">:bit_depth</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> } 
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>; <span class="ruby-identifier">constraints</span>
    <span class="ruby-keyword">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>, <span class="ruby-node">&quot;Unknown encoding preset: #{constraints.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Do not create a palette when the encoding is given and does not require a palette.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:color_mode</span>]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:color_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_INDEXED</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">encoding_palette</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">palette</span>
      <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:bit_depth</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">determine_bit_depth</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:bit_depth</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">8</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">encoding_palette</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">palette</span>
    <span class="ruby-identifier">suggested_color_mode</span>, <span class="ruby-identifier">suggested_bit_depth</span> = <span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">best_color_settings</span>
    <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:color_mode</span>] <span class="ruby-operator">||=</span> <span class="ruby-identifier">suggested_color_mode</span>
    <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:bit_depth</span>]  <span class="ruby-operator">||=</span> <span class="ruby-identifier">suggested_bit_depth</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Use Zlib&#39;s default for compression unless otherwise provided.</span>
  <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:compression</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">DEFAULT_COMPRESSION</span>

  <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:interlace</span>] = <span class="ruby-keyword">case</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:interlace</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>, <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">INTERLACING_NONE</span>; <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">INTERLACING_NONE</span>
    <span class="ruby-keyword">when</span> <span class="ruby-keyword">true</span>, <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">INTERLACING_ADAM7</span>;      <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">INTERLACING_ADAM7</span>
    <span class="ruby-keyword">else</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:interlace</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:filtering</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">case</span> <span class="ruby-identifier">encoding</span>[<span class="ruby-value">:compression</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_COMPRESSION</span>; <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_PAETH</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">NO_COMPRESSION</span><span class="ruby-operator">..</span><span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">BEST_SPEED</span>; <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_NONE</span>
    <span class="ruby-keyword">else</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_UP</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">encoding</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_image_pass_to_stream" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_image_pass_to_stream</span><span
            class="method-args">(stream, color_mode, bit_depth, filtering)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes the canvas to a stream, in a given color mode. @param [String]
stream The stream to write to. @param [Integer] color_mode The color mode
to use for encoding. @param [Integer] bit_depth The bit depth of the image.
@param [Integer] filtering The filtering method to use.</p>
          
          

          
          <div class="method-source-code" id="encode_png_image_pass_to_stream-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 203</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_image_pass_to_stream</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span>, <span class="ruby-identifier">filtering</span>)

  <span class="ruby-identifier">start_pos</span>  = <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">bytesize</span>
  <span class="ruby-identifier">pixel_size</span> = <span class="ruby-constant">Color</span>.<span class="ruby-identifier">pixel_bytesize</span>(<span class="ruby-identifier">color_mode</span>)
  <span class="ruby-identifier">line_width</span> = <span class="ruby-constant">Color</span>.<span class="ruby-identifier">scanline_bytesize</span>(<span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span>, <span class="ruby-identifier">width</span>)
  
  <span class="ruby-comment"># Determine the filter method</span>
  <span class="ruby-identifier">encode_method</span> = <span class="ruby-identifier">encode_png_pixels_to_scanline_method</span>(<span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span>)
  <span class="ruby-identifier">filter_method</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">filtering</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_SUB</span>;     <span class="ruby-value">:encode_png_str_scanline_sub</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_UP</span>;      <span class="ruby-value">:encode_png_str_scanline_up</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_AVERAGE</span>; <span class="ruby-value">:encode_png_str_scanline_average</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_PAETH</span>;   <span class="ruby-value">:encode_png_str_scanline_paeth</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-identifier">height</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">stream</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">encode_method</span>, <span class="ruby-identifier">row</span>(<span class="ruby-identifier">y</span>))
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># Now, apply filtering if any</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">filter_method</span>
    (<span class="ruby-identifier">height</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">downto</span>(<span class="ruby-value">0</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">y</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">start_pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">y</span> <span class="ruby-operator">*</span> (<span class="ruby-identifier">line_width</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
      <span class="ruby-identifier">prev_pos</span> = (<span class="ruby-identifier">y</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) <span class="ruby-operator">?</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">line_width</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)
      <span class="ruby-identifier">send</span>(<span class="ruby-identifier">filter_method</span>, <span class="ruby-identifier">stream</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">prev_pos</span>, <span class="ruby-identifier">line_width</span>, <span class="ruby-identifier">pixel_size</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_image_with_interlacing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_image_with_interlacing</span><span
            class="method-args">(color_mode, bit_depth = 8, filtering = ChunkyPNG::FILTER_NONE)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes the canvas according to the PNG format specification with a given
color  mode and Adam7 interlacing.</p>

<p>This method will split the original canvas in 7 smaller canvases and encode
them one by one, concatenating the resulting strings.</p>

<p>@param [Integer] color_mode The color mode to use for encoding. @param
[Integer] bit_depth The bit depth of the image. @param [Integer] filtering
The filtering method to use. @return [String] The PNG encoded canvas as
string.</p>
          
          

          
          <div class="method-source-code" id="encode_png_image_with_interlacing-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 188</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_image_with_interlacing</span>(<span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span> = <span class="ruby-value">8</span>, <span class="ruby-identifier">filtering</span> = <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_NONE</span>)
  <span class="ruby-identifier">stream</span> = <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">Datastream</span>.<span class="ruby-identifier">empty_bytearray</span>
  <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">6</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pass</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">subcanvas</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">adam7_extract_pass</span>(<span class="ruby-identifier">pass</span>, <span class="ruby-keyword">self</span>)
    <span class="ruby-identifier">subcanvas</span>.<span class="ruby-identifier">encoding_palette</span> = <span class="ruby-identifier">encoding_palette</span>
    <span class="ruby-identifier">subcanvas</span>.<span class="ruby-identifier">encode_png_image_pass_to_stream</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span>, <span class="ruby-identifier">filtering</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">stream</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_image_without_interlacing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_image_without_interlacing</span><span
            class="method-args">(color_mode, bit_depth = 8, filtering = ChunkyPNG::FILTER_NONE)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes the canvas according to the PNG format specification with a given
color mode. @param [Integer] color_mode The color mode to use for encoding.
@param [Integer] bit_depth The bit depth of the image. @param [Integer]
filtering The filtering method to use. @return [String] The PNG encoded
canvas as string.</p>
          
          

          
          <div class="method-source-code" id="encode_png_image_without_interlacing-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 172</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_image_without_interlacing</span>(<span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span> = <span class="ruby-value">8</span>, <span class="ruby-identifier">filtering</span> = <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_NONE</span>)
  <span class="ruby-identifier">stream</span> = <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">Datastream</span>.<span class="ruby-identifier">empty_bytearray</span>
  <span class="ruby-identifier">encode_png_image_pass_to_stream</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span>, <span class="ruby-identifier">filtering</span>)
  <span class="ruby-identifier">stream</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_grayscale_1bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_grayscale_1bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 1-bit grayscale mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_grayscale_1bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 300</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_grayscale_1bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">chars</span> = []
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">each_slice</span>(<span class="ruby-value">8</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span>, <span class="ruby-identifier">p3</span>, <span class="ruby-identifier">p4</span>, <span class="ruby-identifier">p5</span>, <span class="ruby-identifier">p6</span>, <span class="ruby-identifier">p7</span>, <span class="ruby-identifier">p8</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">chars</span> <span class="ruby-operator">&lt;&lt;</span> ((<span class="ruby-identifier">p1</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p1</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">7</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p2</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p2</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">6</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p3</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p3</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">5</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p4</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p4</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">4</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p5</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p5</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">3</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p6</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p6</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">2</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p7</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p7</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p8</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p8</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">15</span>))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">chars</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&#39;xC*&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_grayscale_2bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_grayscale_2bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 2-bit grayscale mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_grayscale_2bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 318</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_grayscale_2bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">chars</span> = []
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">each_slice</span>(<span class="ruby-value">4</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span>, <span class="ruby-identifier">p3</span>, <span class="ruby-identifier">p4</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">chars</span> <span class="ruby-operator">&lt;&lt;</span> ((<span class="ruby-identifier">p1</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p1</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">14</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">6</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p2</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p2</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">14</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">4</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p3</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p3</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">14</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">2</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">p4</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">p4</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">14</span>))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">chars</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&#39;xC*&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_grayscale_4bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_grayscale_4bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 2-bit grayscale mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_grayscale_4bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 332</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_grayscale_4bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">chars</span> = []
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">each_slice</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">chars</span> <span class="ruby-operator">&lt;&lt;</span> ((<span class="ruby-identifier">p1</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> ((<span class="ruby-identifier">p1</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">12</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">4</span>) <span class="ruby-operator">|</span> (<span class="ruby-identifier">p2</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> ((<span class="ruby-identifier">p2</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x0000ffff</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">12</span>)))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">chars</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&#39;xC*&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_grayscale_8bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_grayscale_8bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 8-bit grayscale mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_grayscale_8bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 343</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_grayscale_8bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">8</span> }.<span class="ruby-identifier">pack</span>(<span class="ruby-node">&quot;xC#{width}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_grayscale_alpha_8bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_grayscale_alpha_8bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 8-bit grayscale alpha mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_grayscale_alpha_8bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 350</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_grayscale_alpha_8bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-node">&quot;xn#{width}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_indexed_1bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_indexed_1bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 1-bit indexed mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_indexed_1bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 250</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_indexed_1bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">chars</span> = []
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">each_slice</span>(<span class="ruby-value">8</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span>, <span class="ruby-identifier">p3</span>, <span class="ruby-identifier">p4</span>, <span class="ruby-identifier">p5</span>, <span class="ruby-identifier">p6</span>, <span class="ruby-identifier">p7</span>, <span class="ruby-identifier">p8</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">chars</span> <span class="ruby-operator">&lt;&lt;</span> ((<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p1</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">7</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p2</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">6</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p3</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">5</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p4</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">4</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p5</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">3</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p6</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">2</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p7</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p8</span>)))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">chars</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&#39;xC*&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_indexed_2bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_indexed_2bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 2-bit indexed mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_indexed_2bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_indexed_2bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">chars</span> = []
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">each_slice</span>(<span class="ruby-value">4</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span>, <span class="ruby-identifier">p3</span>, <span class="ruby-identifier">p4</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">chars</span> <span class="ruby-operator">&lt;&lt;</span> ((<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p1</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">6</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p2</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">4</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p3</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">2</span>) <span class="ruby-operator">|</span>
              (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p4</span>)))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">chars</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&#39;xC*&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_indexed_4bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_indexed_4bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 4-bit indexed mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_indexed_4bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 282</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_indexed_4bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">chars</span> = []
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">each_slice</span>(<span class="ruby-value">2</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p1</span>, <span class="ruby-identifier">p2</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">chars</span> <span class="ruby-operator">&lt;&lt;</span> ((<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p1</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">4</span>) <span class="ruby-operator">|</span> (<span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p2</span>)))
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">chars</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&#39;xC*&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_indexed_8bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_indexed_8bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 8-bit indexed mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_indexed_8bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 293</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_indexed_8bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">p</span>) }.<span class="ruby-identifier">pack</span>(<span class="ruby-node">&quot;xC#{width}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_method</span><span
            class="method-args">(color_mode, depth)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the method name to use to decode scanlines into pixels. @param
[Integer] color_mode The color mode of the image. @param [Integer] depth
The bit depth of the image. @return [Symbol] The method name to use for
decoding, to be called on the canvas class. @raise
[ChunkyPNG::NotSupported] when the color_mode and/or bit depth is not
supported.</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_method-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 360</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_method</span>(<span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">depth</span>)
  <span class="ruby-identifier">encoder_method</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">color_mode</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_TRUECOLOR</span>;       <span class="ruby-value">:&quot;encode_png_pixels_to_scanline_truecolor_#{depth}bit&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_TRUECOLOR_ALPHA</span>; <span class="ruby-value">:&quot;encode_png_pixels_to_scanline_truecolor_alpha_#{depth}bit&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_INDEXED</span>;         <span class="ruby-value">:&quot;encode_png_pixels_to_scanline_indexed_#{depth}bit&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_GRAYSCALE</span>;       <span class="ruby-value">:&quot;encode_png_pixels_to_scanline_grayscale_#{depth}bit&quot;</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_GRAYSCALE_ALPHA</span>; <span class="ruby-value">:&quot;encode_png_pixels_to_scanline_grayscale_alpha_#{depth}bit&quot;</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">NotSupported</span>, <span class="ruby-node">&quot;No encoder found for color mode #{color_mode} and #{depth}-bit depth!&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">encoder_method</span>, <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">encoder_method</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_truecolor_8bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_truecolor_8bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 8-bit truecolor mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_truecolor_8bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 236</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_truecolor_8bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-string">&#39;x&#39;</span> <span class="ruby-operator">+</span> (<span class="ruby-string">&#39;NX&#39;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">width</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixels_to_scanline_truecolor_alpha_8bit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixels_to_scanline_truecolor_alpha_8bit</span><span
            class="method-args">(pixels)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a line of pixels using 8-bit truecolor alpha mode. @param
[Array&lt;Integer&gt;] pixels A row of pixels of the original image.
@return [String] The encoded scanline as binary string</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixels_to_scanline_truecolor_alpha_8bit-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 243</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixels_to_scanline_truecolor_alpha_8bit</span>(<span class="ruby-identifier">pixels</span>)
  <span class="ruby-identifier">pixels</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-node">&quot;xN#{width}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_pixelstream" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_pixelstream</span><span
            class="method-args">(color_mode = ChunkyPNG::COLOR_TRUECOLOR, bit_depth = 8, interlace = ChunkyPNG::INTERLACING_NONE, filtering = ChunkyPNG::FILTER_NONE)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes the canvas according to the PNG format specification with a given
color  mode, possibly with interlacing. @param [Integer] color_mode The
color mode to use for encoding. @param [Integer] bit_depth The bit depth of
the image. @param [Integer] interlace The interlacing method to use.
@return [String] The PNG encoded canvas as string.</p>
          
          

          
          <div class="method-source-code" id="encode_png_pixelstream-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 153</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_pixelstream</span>(<span class="ruby-identifier">color_mode</span> = <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_TRUECOLOR</span>, <span class="ruby-identifier">bit_depth</span> = <span class="ruby-value">8</span>, <span class="ruby-identifier">interlace</span> = <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">INTERLACING_NONE</span>, <span class="ruby-identifier">filtering</span> = <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_NONE</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">color_mode</span> <span class="ruby-operator">==</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">COLOR_INDEXED</span> 
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">ExpectationFailed</span>, <span class="ruby-string">&quot;This palette is not suitable for encoding!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">can_encode?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">ExpectationFailed</span>, <span class="ruby-string">&quot;This palette has too many colors!&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">encoding_palette</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> (<span class="ruby-value">1</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">bit_depth</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">interlace</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">INTERLACING_NONE</span>;  <span class="ruby-identifier">encode_png_image_without_interlacing</span>(<span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span>, <span class="ruby-identifier">filtering</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">INTERLACING_ADAM7</span>; <span class="ruby-identifier">encode_png_image_with_interlacing</span>(<span class="ruby-identifier">color_mode</span>, <span class="ruby-identifier">bit_depth</span>, <span class="ruby-identifier">filtering</span>)
    <span class="ruby-keyword">else</span> <span class="ruby-identifier">raise</span> <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">NotSupported</span>, <span class="ruby-node">&quot;Unknown interlacing method: #{interlace}!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_str_scanline_average" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_str_scanline_average</span><span
            class="method-args">(stream, pos, prev_pos, line_width, pixel_size)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a scanline of a pixelstream using AVERAGE filtering. This will
modify the stream. @param (see <a
href="PNGEncoding.html#method-i-encode_png_str_scanline_none">encode_png_str_scanline_none</a>)
@return [void]</p>
          
          

          
          <div class="method-source-code" id="encode_png_str_scanline_average-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_str_scanline_average</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">prev_pos</span>, <span class="ruby-identifier">line_width</span>, <span class="ruby-identifier">pixel_size</span>)
  <span class="ruby-identifier">line_width</span>.<span class="ruby-identifier">downto</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">a</span> = (<span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">b</span> = <span class="ruby-identifier">prev_pos</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">prev_pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>, (<span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">-</span> ((<span class="ruby-identifier">a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">1</span>)) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span>, <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_AVERAGE</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_str_scanline_none" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_str_scanline_none</span><span
            class="method-args">(stream, pos, prev_pos, line_width, pixel_size)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a scanline of a pixelstream without filtering. This is a no-op.
@param [String] stream The pixelstream to work on. This string will be
modified. @param [Integer] pos The starting position of the scanline.
@param [Integer, nil] prev_pos The starting position of the previous
scanline. <code>nil</code> if</p>

<pre>this is the first line.</pre>

<p>@param [Integer] line_width The number of bytes in this scanline, without
counting the filtering</p>

<pre>method byte.</pre>

<p>@param [Integer] pixel_size The number of bytes used per pixel. @return
[void]</p>
          
          

          
          <div class="method-source-code" id="encode_png_str_scanline_none-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 385</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_str_scanline_none</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">prev_pos</span>, <span class="ruby-identifier">line_width</span>, <span class="ruby-identifier">pixel_size</span>)
  <span class="ruby-comment"># noop - this method shouldn&#39;t get called at all.</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_str_scanline_paeth" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_str_scanline_paeth</span><span
            class="method-args">(stream, pos, prev_pos, line_width, pixel_size)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a scanline of a pixelstream using PAETH filtering. This will modify
the stream. @param (see <a
href="PNGEncoding.html#method-i-encode_png_str_scanline_none">encode_png_str_scanline_none</a>)
@return [void]</p>
          
          

          
          <div class="method-source-code" id="encode_png_str_scanline_paeth-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 426</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_str_scanline_paeth</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">prev_pos</span>, <span class="ruby-identifier">line_width</span>, <span class="ruby-identifier">pixel_size</span>)
  <span class="ruby-identifier">line_width</span>.<span class="ruby-identifier">downto</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">a</span> = (<span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">b</span> = (<span class="ruby-identifier">prev_pos</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">prev_pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">c</span> = (<span class="ruby-identifier">prev_pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">prev_pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">p</span> = <span class="ruby-identifier">a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c</span>
    <span class="ruby-identifier">pa</span> = (<span class="ruby-identifier">p</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">a</span>).<span class="ruby-identifier">abs</span>
    <span class="ruby-identifier">pb</span> = (<span class="ruby-identifier">p</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>).<span class="ruby-identifier">abs</span>
    <span class="ruby-identifier">pc</span> = (<span class="ruby-identifier">p</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c</span>).<span class="ruby-identifier">abs</span>
    <span class="ruby-identifier">pr</span> = (<span class="ruby-identifier">pa</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">pb</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pa</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">pc</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">a</span> <span class="ruby-operator">:</span> (<span class="ruby-identifier">pb</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">pc</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">b</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">c</span>)
    <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>, (<span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">pr</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span>, <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_PAETH</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_str_scanline_sub" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_str_scanline_sub</span><span
            class="method-args">(stream, pos, prev_pos, line_width, pixel_size)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a scanline of a pixelstream using SUB filtering. This will modify
the stream. @param (see <a
href="PNGEncoding.html#method-i-encode_png_str_scanline_none">encode_png_str_scanline_none</a>)
@return [void]</p>
          
          

          
          <div class="method-source-code" id="encode_png_str_scanline_sub-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 392</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_str_scanline_sub</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">prev_pos</span>, <span class="ruby-identifier">line_width</span>, <span class="ruby-identifier">pixel_size</span>)
  <span class="ruby-identifier">line_width</span>.<span class="ruby-identifier">downto</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">a</span> = (<span class="ruby-identifier">i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">pixel_size</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>, (<span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">a</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span>, <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_SUB</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-encode_png_str_scanline_up" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encode_png_str_scanline_up</span><span
            class="method-args">(stream, pos, prev_pos, line_width, pixel_size)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Encodes a scanline of a pixelstream using UP filtering. This will modify
the stream. @param (see <a
href="PNGEncoding.html#method-i-encode_png_str_scanline_none">encode_png_str_scanline_none</a>)
@return [void]</p>
          
          

          
          <div class="method-source-code" id="encode_png_str_scanline_up-source">
            <pre><span class="ruby-comment"># File lib/chunky_png/canvas/png_encoding.rb, line 403</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encode_png_str_scanline_up</span>(<span class="ruby-identifier">stream</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">prev_pos</span>, <span class="ruby-identifier">line_width</span>, <span class="ruby-identifier">pixel_size</span>)
  <span class="ruby-identifier">line_width</span>.<span class="ruby-identifier">downto</span>(<span class="ruby-value">1</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">b</span> = <span class="ruby-identifier">prev_pos</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">prev_pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>, (<span class="ruby-identifier">stream</span>.<span class="ruby-identifier">getbyte</span>(<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>) <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">stream</span>.<span class="ruby-identifier">setbyte</span>(<span class="ruby-identifier">pos</span>, <span class="ruby-constant">ChunkyPNG</span><span class="ruby-operator">::</span><span class="ruby-constant">FILTER_UP</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

