<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Daemons::Application - daemons-1.2.2 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link"><a href="../Object.html">Object</a>
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-change_privilege">#change_privilege</a>
    
    <li ><a href="#method-i-default_show_status">#default_show_status</a>
    
    <li ><a href="#method-i-exception_log">#exception_log</a>
    
    <li ><a href="#method-i-logdir">#logdir</a>
    
    <li ><a href="#method-i-logfile">#logfile</a>
    
    <li ><a href="#method-i-logfilename">#logfilename</a>
    
    <li ><a href="#method-i-output_logfile">#output_logfile</a>
    
    <li ><a href="#method-i-output_logfilename">#output_logfilename</a>
    
    <li ><a href="#method-i-pidfile_dir">#pidfile_dir</a>
    
    <li ><a href="#method-i-reload">#reload</a>
    
    <li ><a href="#method-i-running-3F">#running?</a>
    
    <li ><a href="#method-i-script">#script</a>
    
    <li ><a href="#method-i-show_status">#show_status</a>
    
    <li ><a href="#method-i-show_status_callback-3D">#show_status_callback=</a>
    
    <li ><a href="#method-i-start">#start</a>
    
    <li ><a href="#method-i-start_exec">#start_exec</a>
    
    <li ><a href="#method-i-start_load">#start_load</a>
    
    <li ><a href="#method-i-start_none">#start_none</a>
    
    <li ><a href="#method-i-start_proc">#start_proc</a>
    
    <li ><a href="#method-i-started">#started</a>
    
    <li ><a href="#method-i-stop">#stop</a>
    
    <li ><a href="#method-i-zap">#zap</a>
    
    <li ><a href="#method-i-zap-21">#zap!</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Daemons::Application">
  <h1 id="class-Daemons::Application" class="class">
    class Daemons::Application
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="SIGNAL">SIGNAL
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-app_argv" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">app_argv</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-controller_argv" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">controller_argv</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-group" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">group</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>the <a href="ApplicationGroup.html">ApplicationGroup</a> the application
belongs to</p>
        
        </div>
      </div>
      
      <div id="attribute-i-options" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">options</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>my private options</p>
        
        </div>
      </div>
      
      <div id="attribute-i-pid" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">pid</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>the <a href="Pid.html">Pid</a> instance belonging to this application</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(group, add_options = {}, pid = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">group</span>, <span class="ruby-identifier">add_options</span> = {}, <span class="ruby-identifier">pid</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@group</span> = <span class="ruby-identifier">group</span>
  <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">group</span>.<span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-ivar">@options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">add_options</span>)

  <span class="ruby-ivar">@dir_mode</span> = <span class="ruby-ivar">@dir</span> = <span class="ruby-ivar">@script</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@force_kill_waittime</span> = <span class="ruby-ivar">@options</span>[<span class="ruby-value">:force_kill_waittime</span>] <span class="ruby-operator">||</span> <span class="ruby-value">20</span>

  <span class="ruby-ivar">@show_status_callback</span> = <span class="ruby-identifier">method</span>(<span class="ruby-value">:default_show_status</span>)

  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@pid</span> = <span class="ruby-identifier">pid</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@options</span>[<span class="ruby-value">:no_pidfiles</span>]
      <span class="ruby-ivar">@pid</span> = <span class="ruby-constant">PidMem</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">pidfile_dir</span>
      <span class="ruby-ivar">@pid</span> = <span class="ruby-constant">PidFile</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">app_name</span>, <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">multiple</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@pid</span> = <span class="ruby-constant">PidMem</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-change_privilege" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">change_privilege</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="change_privilege-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 51</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">change_privilege</span>
  <span class="ruby-identifier">user</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:user</span>]
  <span class="ruby-identifier">group</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:group</span>]
  <span class="ruby-constant">CurrentProcess</span>.<span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">group</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-default_show_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">default_show_status</span><span
            class="method-args">(daemon = self)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="default_show_status-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 438</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">default_show_status</span>(<span class="ruby-identifier">daemon</span> = <span class="ruby-keyword">self</span>)
  <span class="ruby-identifier">running</span> = <span class="ruby-identifier">daemon</span>.<span class="ruby-identifier">running?</span>

  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{group.app_name}: #{running ? &#39;&#39; : &#39;not &#39;}running#{(running and daemon.pid.exist?) ? &#39; [pid &#39; + daemon.pid.pid.to_s + &#39;]&#39; : &#39;&#39;}#{(daemon.pid.exist? and not running) ? &#39; (but pid-file exists: &#39; + daemon.pid.pid.to_s + &#39;)&#39; : &#39;&#39;}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-exception_log" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">exception_log</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This is a nice little function for debugging purposes: In case a
multi-threaded ruby script exits due to an uncaught exception it may be
difficult to find out where the exception came from because one cannot
catch exceptions that are thrown in threads other than the main thread.</p>

<p>This function searches for all exceptions in memory and outputs them to
STDERR (if it is connected) and to a log file in the pid-file directory.</p>
          
          

          
          <div class="method-source-code" id="exception_log-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 330</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">exception_log</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">logfile</span>

  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;logger&#39;</span>

  <span class="ruby-identifier">l_file</span> = <span class="ruby-constant">Logger</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">logfile</span>)

  <span class="ruby-comment"># the code below finds the last exception</span>
  <span class="ruby-identifier">e</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">each_object</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">o</span>
      <span class="ruby-identifier">e</span> = <span class="ruby-identifier">o</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">l_file</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&#39;*** below you find the most recent exception thrown, this will be likely (but not certainly) the exception that made the application exit abnormally ***&#39;</span>
  <span class="ruby-identifier">l_file</span>.<span class="ruby-identifier">error</span> <span class="ruby-identifier">e</span>

  <span class="ruby-identifier">l_file</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&#39;*** below you find all exception objects found in memory, some of them may have been thrown in your application, others may just be in memory because they are standard exceptions ***&#39;</span>

  <span class="ruby-comment"># this code logs every exception found in memory</span>
  <span class="ruby-constant">ObjectSpace</span>.<span class="ruby-identifier">each_object</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">o</span>
      <span class="ruby-identifier">l_file</span>.<span class="ruby-identifier">error</span> <span class="ruby-identifier">o</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">l_file</span>.<span class="ruby-identifier">close</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-logdir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">logdir</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="logdir-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">logdir</span>
  <span class="ruby-identifier">logdir</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:log_dir</span>]
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">logdir</span>
    <span class="ruby-identifier">logdir</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:dir_mode</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:system</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;/var/log&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">pidfile_dir</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">logdir</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-logfile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">logfile</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="logfile-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">logfile</span>
  <span class="ruby-identifier">logdir</span> <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">logdir</span>, <span class="ruby-identifier">logfilename</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-logfilename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">logfilename</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="logfilename-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">logfilename</span>
  <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:logfilename</span>]
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">filename</span> = <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">app_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.log&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">filename</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-output_logfile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output_logfile</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="output_logfile-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 81</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output_logfile</span>
  (<span class="ruby-identifier">options</span>[<span class="ruby-value">:log_output</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">logdir</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">logdir</span>, <span class="ruby-identifier">output_logfilename</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-output_logfilename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">output_logfilename</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="output_logfilename-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">output_logfilename</span>
  <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:output_logfilename</span>]
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">filename</span>
    <span class="ruby-identifier">filename</span> = <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">app_name</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;.output&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">filename</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-pidfile_dir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pidfile_dir</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="pidfile_dir-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pidfile_dir</span>
  <span class="ruby-constant">Pid</span>.<span class="ruby-identifier">dir</span>(<span class="ruby-ivar">@dir_mode</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">dir_mode</span>, <span class="ruby-ivar">@dir</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">dir</span>, <span class="ruby-ivar">@script</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">script</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reload" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reload</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="reload-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 308</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reload</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">zap</span>
    <span class="ruby-identifier">start</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-string">&#39;HUP&#39;</span>, <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span>)
    <span class="ruby-keyword">rescue</span>
      <span class="ruby-comment"># ignore</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-running-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">running?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This function implements a (probably too simle) method to detect whether
the program with the pid found in the pid-file is still running. It just
searches for the pid in the output of <code>ps ax</code>, which is probably
not a good idea in some cases. Alternatives would be to use a direct access
method the unix process control system.</p>
          
          

          
          <div class="method-source-code" id="running-3F-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 451</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">running?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">exist?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-constant">Pid</span>.<span class="ruby-identifier">running?</span>(<span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-script" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">script</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="script-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 57</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">script</span>
  <span class="ruby-ivar">@script</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">script</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show_status" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show_status</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="show_status-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 434</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show_status</span>
  <span class="ruby-ivar">@show_status_callback</span>.<span class="ruby-identifier">call</span>(<span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-show_status_callback-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">show_status_callback=</span><span
            class="method-args">(function)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="show_status_callback-3D-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">show_status_callback=</span>(<span class="ruby-identifier">function</span>)
  <span class="ruby-ivar">@show_status_callback</span> = <span class="ruby-identifier">method</span>(<span class="ruby-identifier">function</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-start" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start</span><span
            class="method-args">(restart = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="start-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 279</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start</span>(<span class="ruby-identifier">restart</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">change_privilege</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">restart</span>
    <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">create_monitor</span>(<span class="ruby-keyword">self</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>]  <span class="ruby-comment"># we don&#39;t monitor applications in the foreground</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:mode</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-value">:none</span>
      <span class="ruby-comment"># this is only used to daemonize the currently running process</span>
      <span class="ruby-identifier">start_none</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:exec</span>
      <span class="ruby-identifier">start_exec</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:load</span>
      <span class="ruby-identifier">start_load</span>
    <span class="ruby-keyword">when</span> <span class="ruby-value">:proc</span>
      <span class="ruby-identifier">start_proc</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">start_load</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-start_exec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start_exec</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="start_exec-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 140</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_exec</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:backtrace</span>]
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;option :backtrace is not supported with :mode =&gt; :exec, ignoring&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>]
    <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">daemonize</span>(<span class="ruby-identifier">output_logfile</span>, <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">app_name</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">simulate</span>(<span class="ruby-identifier">output_logfile</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># note that we cannot remove the pid file if we run in :ontop mode (i.e. &#39;ruby ctrl_exec.rb run&#39;)</span>
  <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;DAEMONS_ARGV&#39;</span>] = <span class="ruby-ivar">@controller_argv</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
  
  <span class="ruby-identifier">started</span>
  <span class="ruby-constant">Kernel</span>.<span class="ruby-identifier">exec</span>(<span class="ruby-identifier">script</span>, <span class="ruby-operator">*</span>(<span class="ruby-ivar">@app_argv</span> <span class="ruby-operator">||</span> []))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-start_load" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start_load</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="start_load-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 160</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_load</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>]
    <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">daemonize</span>(<span class="ruby-identifier">output_logfile</span>, <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">app_name</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">simulate</span>(<span class="ruby-identifier">output_logfile</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>

  <span class="ruby-comment"># We need this to remove the pid-file if the applications exits by itself.</span>
  <span class="ruby-comment"># Note that &lt;tt&gt;at_exit&lt;/tt&gt; will only be run if the applications exits by calling</span>
  <span class="ruby-comment"># &lt;tt&gt;exit&lt;/tt&gt;, and not if it calls &lt;tt&gt;exit!&lt;/tt&gt; (so please don&#39;t call &lt;tt&gt;exit!&lt;/tt&gt;</span>
  <span class="ruby-comment"># in your application!</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">at_exit</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">cleanup</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If the option &lt;tt&gt;:backtrace&lt;/tt&gt; is used and the application did exit by itself</span>
    <span class="ruby-comment"># create a exception log.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:backtrace</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$daemons_sigterm</span>
      <span class="ruby-keyword">begin</span>; <span class="ruby-identifier">exception_log</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># This part is needed to remove the pid-file if the application is killed by</span>
  <span class="ruby-comment"># daemons or manually by the user.</span>
  <span class="ruby-comment"># Note that the applications is not supposed to overwrite the signal handler for</span>
  <span class="ruby-comment"># &#39;TERM&#39;.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">$daemons_stop_proc</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:stop_proc</span>]
  <span class="ruby-identifier">trap</span>(<span class="ruby-constant">SIGNAL</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">$daemons_stop_proc</span>
        <span class="ruby-identifier">$daemons_stop_proc</span>.<span class="ruby-identifier">call</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">cleanup</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">$daemons_sigterm</span> = <span class="ruby-keyword">true</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:hard_exit</span>]
      <span class="ruby-identifier">exit!</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">exit</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Now we really start the script...</span>
  <span class="ruby-identifier">$DAEMONS_ARGV</span> = <span class="ruby-ivar">@controller_argv</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;DAEMONS_ARGV&#39;</span>] = <span class="ruby-ivar">@controller_argv</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)

  <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">concat</span> <span class="ruby-ivar">@app_argv</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@app_argv</span>

  <span class="ruby-identifier">started</span>
  <span class="ruby-comment"># TODO: exception logging</span>
  <span class="ruby-identifier">load</span> <span class="ruby-identifier">script</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-start_none" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start_none</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>this function is only used to daemonize the currently running process
(Daemons.daemonize)</p>
          
          

          
          <div class="method-source-code" id="start_none-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 98</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_none</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>]
    <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">daemonize</span>(<span class="ruby-identifier">output_logfile</span>, <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">app_name</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">simulate</span>(<span class="ruby-identifier">output_logfile</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>

  <span class="ruby-comment"># We need this to remove the pid-file if the applications exits by itself.</span>
  <span class="ruby-comment"># Note that &lt;tt&gt;at_text&lt;/tt&gt; will only be run if the applications exits by calling</span>
  <span class="ruby-comment"># &lt;tt&gt;exit&lt;/tt&gt;, and not if it calls &lt;tt&gt;exit!&lt;/tt&gt; (so please don&#39;t call &lt;tt&gt;exit!&lt;/tt&gt;</span>
  <span class="ruby-comment"># in your application!</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">at_exit</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">cleanup</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># If the option &lt;tt&gt;:backtrace&lt;/tt&gt; is used and the application did exit by itself</span>
    <span class="ruby-comment"># create a exception log.</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:backtrace</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$daemons_sigterm</span>
      <span class="ruby-keyword">begin</span>; <span class="ruby-identifier">exception_log</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># This part is needed to remove the pid-file if the application is killed by</span>
  <span class="ruby-comment"># daemons or manually by the user.</span>
  <span class="ruby-comment"># Note that the applications is not supposed to overwrite the signal handler for</span>
  <span class="ruby-comment"># &#39;TERM&#39;.</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-identifier">trap</span>(<span class="ruby-constant">SIGNAL</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">cleanup</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">$daemons_sigterm</span> = <span class="ruby-keyword">true</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:hard_exit</span>]
      <span class="ruby-identifier">exit!</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">exit</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-start_proc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start_proc</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="start_proc-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_proc</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">p</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:proc</span>]

  <span class="ruby-identifier">myproc</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span>

    <span class="ruby-comment"># We need this to remove the pid-file if the applications exits by itself.</span>
    <span class="ruby-comment"># Note that &lt;tt&gt;at_text&lt;/tt&gt; will only be run if the applications exits by calling</span>
    <span class="ruby-comment"># &lt;tt&gt;exit&lt;/tt&gt;, and not if it calls &lt;tt&gt;exit!&lt;/tt&gt; (so please don&#39;t call &lt;tt&gt;exit!&lt;/tt&gt;</span>
    <span class="ruby-comment"># in your application!</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">at_exit</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">cleanup</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># If the option &lt;tt&gt;:backtrace&lt;/tt&gt; is used and the application did exit by itself</span>
      <span class="ruby-comment"># create a exception log.</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:backtrace</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">$daemons_sigterm</span>
        <span class="ruby-keyword">begin</span>; <span class="ruby-identifier">exception_log</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># This part is needed to remove the pid-file if the application is killed by</span>
    <span class="ruby-comment"># daemons or manually by the user.</span>
    <span class="ruby-comment"># Note that the applications is not supposed to overwrite the signal handler for</span>
    <span class="ruby-comment"># &#39;TERM&#39;.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">$daemons_stop_proc</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:stop_proc</span>]
    <span class="ruby-identifier">trap</span>(<span class="ruby-constant">SIGNAL</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">begin</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">$daemons_stop_proc</span>
          <span class="ruby-identifier">$daemons_stop_proc</span>.<span class="ruby-identifier">call</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">cleanup</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">$daemons_sigterm</span> = <span class="ruby-keyword">true</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:hard_exit</span>]
        <span class="ruby-identifier">exit!</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">exit</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">p</span>.<span class="ruby-identifier">call</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:ontop</span>]
    <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span> = <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">call_as_daemon</span>(<span class="ruby-identifier">myproc</span>, <span class="ruby-identifier">output_logfile</span>, <span class="ruby-ivar">@group</span>.<span class="ruby-identifier">app_name</span>)

  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">simulate</span>(<span class="ruby-identifier">output_logfile</span>)

    <span class="ruby-identifier">myproc</span>.<span class="ruby-identifier">call</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">started</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-started" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">started</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="started-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 301</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">started</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">pid</span> = <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{group.app_name}: process with pid #{pid} started.&quot;</span>
    <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-stop" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">stop</span><span
            class="method-args">(no_wait = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="stop-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 361</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">stop</span>(<span class="ruby-identifier">no_wait</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">running?</span>
    <span class="ruby-identifier">zap</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">pid</span> = <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">pid</span>

  <span class="ruby-comment"># Catch errors when trying to kill a process that doesn&#39;t</span>
  <span class="ruby-comment"># exist. This happens when the process quits and hasn&#39;t been</span>
  <span class="ruby-comment"># restarted by the monitor yet. By catching the error, we allow the</span>
  <span class="ruby-comment"># pid file clean-up to occur.</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-constant">SIGNAL</span>, <span class="ruby-identifier">pid</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ESRCH</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{e} #{pid}&quot;</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;deleting pid-file.&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">no_wait</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@force_kill_waittime</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{group.app_name}: trying to stop process with pid #{pid}...&quot;</span>
      <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>

      <span class="ruby-keyword">begin</span>
        <span class="ruby-constant">Timeout</span>.<span class="ruby-identifier">timeout</span>(<span class="ruby-ivar">@force_kill_waittime</span>, <span class="ruby-constant">TimeoutError</span>) <span class="ruby-keyword">do</span>
          <span class="ruby-keyword">while</span> <span class="ruby-constant">Pid</span>.<span class="ruby-identifier">running?</span>(<span class="ruby-identifier">pid</span>)
            <span class="ruby-identifier">sleep</span>(<span class="ruby-value">0.2</span>)
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">TimeoutError</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{group.app_name}: process with pid #{pid} won&#39;t stop, we forcefully kill it...&quot;</span>
        <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>

        <span class="ruby-keyword">begin</span>
          <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-string">&#39;KILL&#39;</span>, <span class="ruby-identifier">pid</span>)
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ESRCH</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">begin</span>
          <span class="ruby-constant">Timeout</span>.<span class="ruby-identifier">timeout</span>(<span class="ruby-value">20</span>, <span class="ruby-constant">TimeoutError</span>) <span class="ruby-keyword">do</span>
            <span class="ruby-keyword">while</span> <span class="ruby-constant">Pid</span>.<span class="ruby-identifier">running?</span>(<span class="ruby-identifier">pid</span>)
              <span class="ruby-identifier">sleep</span>(<span class="ruby-value">1</span>)
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">TimeoutError</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{group.app_name}: unable to forcefully kill process with pid #{pid}.&quot;</span>
          <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">sleep</span>(<span class="ruby-value">0.1</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-constant">Pid</span>.<span class="ruby-identifier">running?</span>(<span class="ruby-identifier">pid</span>)
    <span class="ruby-comment"># We try to remove the pid-files by ourselves, in case the application</span>
    <span class="ruby-comment"># didn&#39;t clean it up.</span>
    <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">cleanup</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{group.app_name}: process with pid #{pid} successfully stopped.&quot;</span>
    <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-zap" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">zap</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="zap-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 426</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">zap</span>
  <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">zap</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-zap-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">zap!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="zap-21-source">
            <pre><span class="ruby-comment"># File lib/daemons/application.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">zap!</span>
  <span class="ruby-keyword">begin</span>; <span class="ruby-ivar">@pid</span>.<span class="ruby-identifier">zap</span>; <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span>; <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

