<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>active_record_basics - rails-4.2.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Active+Record+Basics">Active Record Basics</a>
    <li><a href="#label-What+is+Active+Record-3F">What is Active Record?</a>
    <li><a href="#label-The+Active+Record+Pattern">The Active Record Pattern</a>
    <li><a href="#label-Object+Relational+Mapping">Object Relational Mapping</a>
    <li><a href="#label-Active+Record+as+an+ORM+Framework">Active Record as an ORM Framework</a>
    <li><a href="#label-Convention+over+Configuration+in+Active+Record">Convention over Configuration in Active Record</a>
    <li><a href="#label-Naming+Conventions">Naming Conventions</a>
    <li><a href="#label-Schema+Conventions">Schema Conventions</a>
    <li><a href="#label-Creating+Active+Record+Models">Creating Active Record Models</a>
    <li><a href="#label-Overriding+the+Naming+Conventions">Overriding the Naming Conventions</a>
    <li><a href="#label-CRUD-3A+Reading+and+Writing+Data">CRUD: Reading and Writing Data</a>
    <li><a href="#label-Create">Create</a>
    <li><a href="#label-Read">Read</a>
    <li><a href="#label-Update">Update</a>
    <li><a href="#label-Delete">Delete</a>
    <li><a href="#label-Validations">Validations</a>
    <li><a href="#label-Callbacks">Callbacks</a>
    <li><a href="#label-Migrations">Migrations</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../guides/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../guides/Rakefile.html">Rakefile</a>
  
    <li><a href="../../guides/assets/images/icons/README.html">README</a>
  
    <li><a href="../../guides/assets/javascripts/guides_js.html">guides.js</a>
  
    <li><a href="../../guides/assets/javascripts/jquery_min_js.html">jquery.min.js</a>
  
    <li><a href="../../guides/assets/javascripts/responsive-tables_js.html">responsive-tables.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAS3_js.html">shBrushAS3.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAppleScript_js.html">shBrushAppleScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushBash_js.html">shBrushBash.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCSharp_js.html">shBrushCSharp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushColdFusion_js.html">shBrushColdFusion.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCpp_js.html">shBrushCpp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCss_js.html">shBrushCss.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDelphi_js.html">shBrushDelphi.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDiff_js.html">shBrushDiff.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushErlang_js.html">shBrushErlang.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushGroovy_js.html">shBrushGroovy.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJScript_js.html">shBrushJScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJava_js.html">shBrushJava.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJavaFX_js.html">shBrushJavaFX.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPerl_js.html">shBrushPerl.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPhp_js.html">shBrushPhp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPlain_js.html">shBrushPlain.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPowerShell_js.html">shBrushPowerShell.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPython_js.html">shBrushPython.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushRuby_js.html">shBrushRuby.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSass_js.html">shBrushSass.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushScala_js.html">shBrushScala.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSql_js.html">shBrushSql.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushVb_js.html">shBrushVb.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushXml_js.html">shBrushXml.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shCore_js.html">shCore.js</a>
  
    <li><a href="../../guides/assets/stylesheets/fixes_css.html">fixes.css</a>
  
    <li><a href="../../guides/assets/stylesheets/kindle_css.html">kindle.css</a>
  
    <li><a href="../../guides/assets/stylesheets/main_css.html">main.css</a>
  
    <li><a href="../../guides/assets/stylesheets/print_css.html">print.css</a>
  
    <li><a href="../../guides/assets/stylesheets/reset_css.html">reset.css</a>
  
    <li><a href="../../guides/assets/stylesheets/responsive-tables_css.html">responsive-tables.css</a>
  
    <li><a href="../../guides/assets/stylesheets/style_css.html">style.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCore_css.html">shCore.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDefault_css.html">shCoreDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDjango_css.html">shCoreDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEclipse_css.html">shCoreEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEmacs_css.html">shCoreEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreFadeToGrey_css.html">shCoreFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMDUltra_css.html">shCoreMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMidnight_css.html">shCoreMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreRDark_css.html">shCoreRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDefault_css.html">shThemeDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDjango_css.html">shThemeDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEclipse_css.html">shThemeEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEmacs_css.html">shThemeEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeFadeToGrey_css.html">shThemeFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMDUltra_css.html">shThemeMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMidnight_css.html">shThemeMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRDark_css.html">shThemeRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRailsGuides_css.html">shThemeRailsGuides.css</a>
  
    <li><a href="../../guides/source/2_2_release_notes_md.html">2_2_release_notes</a>
  
    <li><a href="../../guides/source/2_3_release_notes_md.html">2_3_release_notes</a>
  
    <li><a href="../../guides/source/3_0_release_notes_md.html">3_0_release_notes</a>
  
    <li><a href="../../guides/source/3_1_release_notes_md.html">3_1_release_notes</a>
  
    <li><a href="../../guides/source/3_2_release_notes_md.html">3_2_release_notes</a>
  
    <li><a href="../../guides/source/4_0_release_notes_md.html">4_0_release_notes</a>
  
    <li><a href="../../guides/source/4_1_release_notes_md.html">4_1_release_notes</a>
  
    <li><a href="../../guides/source/4_2_release_notes_md.html">4_2_release_notes</a>
  
    <li><a href="../../guides/source/action_controller_overview_md.html">action_controller_overview</a>
  
    <li><a href="../../guides/source/action_mailer_basics_md.html">action_mailer_basics</a>
  
    <li><a href="../../guides/source/action_view_overview_md.html">action_view_overview</a>
  
    <li><a href="../../guides/source/active_job_basics_md.html">active_job_basics</a>
  
    <li><a href="../../guides/source/active_model_basics_md.html">active_model_basics</a>
  
    <li><a href="../../guides/source/active_record_basics_md.html">active_record_basics</a>
  
    <li><a href="../../guides/source/active_record_callbacks_md.html">active_record_callbacks</a>
  
    <li><a href="../../guides/source/active_record_migrations_md.html">active_record_migrations</a>
  
    <li><a href="../../guides/source/active_record_postgresql_md.html">active_record_postgresql</a>
  
    <li><a href="../../guides/source/active_record_querying_md.html">active_record_querying</a>
  
    <li><a href="../../guides/source/active_record_validations_md.html">active_record_validations</a>
  
    <li><a href="../../guides/source/active_support_core_extensions_md.html">active_support_core_extensions</a>
  
    <li><a href="../../guides/source/active_support_instrumentation_md.html">active_support_instrumentation</a>
  
    <li><a href="../../guides/source/api_documentation_guidelines_md.html">api_documentation_guidelines</a>
  
    <li><a href="../../guides/source/asset_pipeline_md.html">asset_pipeline</a>
  
    <li><a href="../../guides/source/association_basics_md.html">association_basics</a>
  
    <li><a href="../../guides/source/autoloading_and_reloading_constants_md.html">autoloading_and_reloading_constants</a>
  
    <li><a href="../../guides/source/caching_with_rails_md.html">caching_with_rails</a>
  
    <li><a href="../../guides/source/command_line_md.html">command_line</a>
  
    <li><a href="../../guides/source/configuring_md.html">configuring</a>
  
    <li><a href="../../guides/source/contributing_to_ruby_on_rails_md.html">contributing_to_ruby_on_rails</a>
  
    <li><a href="../../guides/source/debugging_rails_applications_md.html">debugging_rails_applications</a>
  
    <li><a href="../../guides/source/development_dependencies_install_md.html">development_dependencies_install</a>
  
    <li><a href="../../guides/source/documents_yaml.html">documents.yaml</a>
  
    <li><a href="../../guides/source/engines_md.html">engines</a>
  
    <li><a href="../../guides/source/form_helpers_md.html">form_helpers</a>
  
    <li><a href="../../guides/source/generators_md.html">generators</a>
  
    <li><a href="../../guides/source/getting_started_md.html">getting_started</a>
  
    <li><a href="../../guides/source/i18n_md.html">i18n</a>
  
    <li><a href="../../guides/source/initialization_md.html">initialization</a>
  
    <li><a href="../../guides/source/layouts_and_rendering_md.html">layouts_and_rendering</a>
  
    <li><a href="../../guides/source/maintenance_policy_md.html">maintenance_policy</a>
  
    <li><a href="../../guides/source/nested_model_forms_md.html">nested_model_forms</a>
  
    <li><a href="../../guides/source/plugins_md.html">plugins</a>
  
    <li><a href="../../guides/source/rails_application_templates_md.html">rails_application_templates</a>
  
    <li><a href="../../guides/source/rails_on_rack_md.html">rails_on_rack</a>
  
    <li><a href="../../guides/source/routing_md.html">routing</a>
  
    <li><a href="../../guides/source/ruby_on_rails_guides_guidelines_md.html">ruby_on_rails_guides_guidelines</a>
  
    <li><a href="../../guides/source/security_md.html">security</a>
  
    <li><a href="../../guides/source/testing_md.html">testing</a>
  
    <li><a href="../../guides/source/upgrading_ruby_on_rails_md.html">upgrading_ruby_on_rails</a>
  
    <li><a href="../../guides/source/working_with_javascript_in_rails_md.html">working_with_javascript_in_rails</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page guides/source/active_record_basics.md">

<h1 id="label-Active+Record+Basics">Active Record Basics<span><a href="#label-Active+Record+Basics">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>This guide is an introduction to Active Record.</p>

<p>After reading this guide, you will know:</p>
<ul><li>
<p>What <a href="../../Object.html">Object</a> Relational Mapping and Active
Record are and how they are used in  Rails.</p>
</li><li>
<p>How Active Record fits into the Model-View-Controller paradigm.</p>
</li><li>
<p>How to use Active Record models to manipulate data stored in a relational 
database.</p>
</li><li>
<p>Active Record schema naming conventions.</p>
</li><li>
<p>The concepts of database migrations, validations and callbacks.</p>
</li></ul>
<hr>

<h2 id="label-What+is+Active+Record-3F">What is Active Record?<span><a href="#label-What+is+Active+Record-3F">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Active Record is the M in <a
href="getting_started.html#the-mvc-architecture">MVC</a> - the model -
which is the layer of the system responsible for representing business data
and logic. Active Record facilitates the creation and use of business
objects whose data requires persistent storage to a database. It is an
implementation of the Active Record pattern which itself is a description
of an <a href="../../Object.html">Object</a> Relational Mapping system.</p>

<h3 id="label-The+Active+Record+Pattern">The Active Record Pattern<span><a href="#label-The+Active+Record+Pattern">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="http://www.martinfowler.com/eaaCatalog/activeRecord.html">Active
Record was described by Martin Fowler</a> in his book <em>Patterns of
Enterprise Application Architecture</em>. In Active Record, objects carry
both persistent data and behavior which operates on that data. Active
Record takes the opinion that ensuring data access logic as part of the
object will educate users of that object on how to write to and read from
the database.</p>

<h3 id="label-Object+Relational+Mapping"><a href="../../Object.html">Object</a> Relational Mapping<span><a href="#label-Object+Relational+Mapping">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Object-Relational Mapping, commonly referred to as its abbreviation ORM, is
a technique that connects the rich objects of an application to tables in a
relational database management system. Using ORM, the properties and
relationships of the objects in an application can be easily stored and
retrieved from a database without writing SQL statements directly and with
less overall database access code.</p>

<h3 id="label-Active+Record+as+an+ORM+Framework">Active Record as an ORM Framework<span><a href="#label-Active+Record+as+an+ORM+Framework">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Active Record gives us several mechanisms, the most important being the
ability to:</p>
<ul><li>
<p>Represent models and their data.</p>
</li><li>
<p>Represent associations between these models.</p>
</li><li>
<p>Represent inheritance hierarchies through related models.</p>
</li><li>
<p>Validate models before they get persisted to the database.</p>
</li><li>
<p>Perform database operations in an object-oriented fashion.</p>
</li></ul>

<h2 id="label-Convention+over+Configuration+in+Active+Record">Convention over Configuration in Active Record<span><a href="#label-Convention+over+Configuration+in+Active+Record">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>When writing applications using other programming languages or frameworks,
it may be necessary to write a lot of configuration code. This is
particularly true for ORM frameworks in general. However, if you follow the
conventions adopted by Rails, you&#39;ll need to write very little
configuration (in some case no configuration at all) when creating Active
Record models. The idea is that if you configure your applications in the
very same way most of the time then this should be the default way. Thus,
explicit configuration would be needed only in those cases where you
can&#39;t follow the standard convention.</p>

<h3 id="label-Naming+Conventions">Naming Conventions<span><a href="#label-Naming+Conventions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>By default, Active Record uses some naming conventions to find out how the
mapping between models and database tables should be created. Rails will
pluralize your class names to find the respective database table. So, for a
class <code>Book</code>, you should have a database table called
<strong>books</strong>. The Rails pluralization mechanisms are very
powerful, being capable to pluralize (and singularize) both regular and
irregular words. When using class names composed of two or more words, the
model class name should follow the Ruby conventions, using the CamelCase
form, while the table name must contain the words separated by underscores.
Examples:</p>
<ul><li>
<p>Database Table - Plural with underscores separating words (e.g.,
<code>book_clubs</code>).</p>
</li><li>
<p>Model Class - Singular with the first letter of each word capitalized
(e.g., <code>BookClub</code>).</p>
</li></ul>

<p>| Model / Class | Table / Schema | | —————- | ————– | |
<code>Article</code> | <code>articles</code> | | <code>LineItem</code> |
<code>line_items</code> | | <code>Deer</code> | <code>deers</code> | |
<code>Mouse</code> | <code>mice</code> | | <code>Person</code> |
<code>people</code> |</p>

<h3 id="label-Schema+Conventions">Schema Conventions<span><a href="#label-Schema+Conventions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Active Record uses naming conventions for the columns in database tables,
depending on the purpose of these columns.</p>
<ul><li>
<p><strong>Foreign keys</strong> - These fields should be named following the
pattern  <code>singularized_table_name_id</code> (e.g.,
<code>item_id</code>, <code>order_id</code>). These are the  fields that
Active Record will look for when you create associations between  your
models.</p>
</li><li>
<p><strong>Primary keys</strong> - By default, Active Record will use an
integer column named  <code>id</code> as the table&#39;s primary key. When
using <a href="migrations.html">Active Record Migrations</a> to create your
tables, this column will be  automatically created.</p>
</li></ul>

<p>There are also some optional column names that will add additional features
to Active Record instances:</p>
<ul><li>
<p><code>created_at</code> - Automatically gets set to the current date and
time when the  record is first created.</p>
</li><li>
<p><code>updated_at</code> - Automatically gets set to the current date and
time whenever  the record is updated.</p>
</li><li>
<p><code>lock_version</code> - Adds <a
href="http://api.rubyonrails.org/classes/ActiveRecord/Locking.html">optimistic
locking</a> to  a model.</p>
</li><li>
<p><code>type</code> - Specifies that the model uses <a
href="http://api.rubyonrails.org/classes/ActiveRecord/Base.html#class-ActiveRecord::Base-label-Single+table+inheritance">Single
Table Inheritance</a>.</p>
</li><li>
<p><code>(association_name)_type</code> - Stores the type for  <a
href="association_basics.html#polymorphic-associations">polymorphic
associations</a>.</p>
</li><li>
<p><code>(table_name)_count</code> - Used to cache the number of belonging
objects on  associations. For example, a <code>comments_count</code> column
in a <code>Articles</code> class that  has many instances of
<code>Comment</code> will cache the number of existent comments  for each
article.</p>
</li></ul>

<p>NOTE: While these column names are optional, they are in fact reserved by
Active Record. Steer clear of reserved keywords unless you want the extra
functionality. For example, <code>type</code> is a reserved keyword used to
designate a table using Single Table Inheritance (STI). If you are not
using STI, try an analogous keyword like “context”, that may still
accurately describe the data you are modeling.</p>

<h2 id="label-Creating+Active+Record+Models">Creating Active Record Models<span><a href="#label-Creating+Active+Record+Models">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>It is very easy to create Active Record models. All you have to do is to
subclass the <code>ActiveRecord::Base</code> class and you&#39;re good to
go:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Product</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This will create a <code>Product</code> model, mapped to a
<code>products</code> table at the database. By doing this you&#39;ll also
have the ability to map the columns of each row in that table with the
attributes of the instances of your model. Suppose that the
<code>products</code> table was created using an SQL sentence like:</p>

<pre>CREATE TABLE products (
   id int(11) NOT NULL auto_increment,
   name varchar(255),
   PRIMARY KEY  (id)
);</pre>

<p>Following the table schema above, you would be able to write code like the
following:</p>

<pre class="ruby"><span class="ruby-identifier">p</span> = <span class="ruby-constant">Product</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">p</span>.<span class="ruby-identifier">name</span> = <span class="ruby-string">&quot;Some Book&quot;</span>
<span class="ruby-identifier">puts</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">name</span> <span class="ruby-comment"># &quot;Some Book&quot;</span>
</pre>

<h2 id="label-Overriding+the+Naming+Conventions">Overriding the Naming Conventions<span><a href="#label-Overriding+the+Naming+Conventions">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>What if you need to follow a different naming convention or need to use
your Rails application with a legacy database? No problem, you can easily
override the default conventions.</p>

<p>You can use the <code>ActiveRecord::Base.table_name=</code> method to
specify the table name that should be used:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Product</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">table_name</span> = <span class="ruby-string">&quot;PRODUCT&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If you do so, you will have to define manually the class name that is
hosting the fixtures (class_name.yml) using the
<code>set_fixture_class</code> method in your test definition:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">FunnyJoke</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">set_fixture_class</span> <span class="ruby-identifier">funny_jokes</span><span class="ruby-operator">:</span> <span class="ruby-constant">Joke</span>
  <span class="ruby-identifier">fixtures</span> :<span class="ruby-identifier">funny_jokes</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>It&#39;s also possible to override the column that should be used as the
table&#39;s primary key using the
<code>ActiveRecord::Base.primary_key=</code> method:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Product</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">primary_key</span> = <span class="ruby-string">&quot;product_id&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-CRUD-3A+Reading+and+Writing+Data">CRUD: Reading and Writing Data<span><a href="#label-CRUD-3A+Reading+and+Writing+Data">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>CRUD is an acronym for the four verbs we use to operate on data: *C*reate,
*R*ead, *U*pdate and *D*elete. Active Record automatically creates methods
to allow an application to read and manipulate data stored within its
tables.</p>

<h3 id="label-Create">Create<span><a href="#label-Create">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Active Record objects can be created from a hash, a block or have their
attributes manually set after creation. The <code>new</code> method will
return a new object while <code>create</code> will return the object and
save it to the database.</p>

<p>For example, given a model <code>User</code> with attributes of
<code>name</code> and <code>occupation</code>, the <code>create</code>
method call will create and save a new record into the database:</p>

<pre class="ruby"><span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;David&quot;</span>, <span class="ruby-identifier">occupation</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Code Artist&quot;</span>)
</pre>

<p>Using the <code>new</code> method, an object can be instantiated without
being saved:</p>

<pre class="ruby"><span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span> = <span class="ruby-string">&quot;David&quot;</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">occupation</span> = <span class="ruby-string">&quot;Code Artist&quot;</span>
</pre>

<p>A call to <code>user.save</code> will commit the record to the database.</p>

<p>Finally, if a block is provided, both <code>create</code> and
<code>new</code> will yield the new object to that block for
initialization:</p>

<pre class="ruby"><span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">u</span>.<span class="ruby-identifier">name</span> = <span class="ruby-string">&quot;David&quot;</span>
  <span class="ruby-identifier">u</span>.<span class="ruby-identifier">occupation</span> = <span class="ruby-string">&quot;Code Artist&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Read">Read<span><a href="#label-Read">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Active Record provides a rich API for accessing data within a database.
Below are a few examples of different data access methods provided by
Active Record.</p>

<pre class="ruby"><span class="ruby-comment"># return a collection with all users</span>
<span class="ruby-identifier">users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">all</span>
</pre>

<pre class="ruby"><span class="ruby-comment"># return the first user</span>
<span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">first</span>
</pre>

<pre class="ruby"><span class="ruby-comment"># return the first user named David</span>
<span class="ruby-identifier">david</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;David&#39;</span>)
</pre>

<pre class="ruby"><span class="ruby-comment"># find all users named David who are Code Artists and sort by created_at in reverse chronological order</span>
<span class="ruby-identifier">users</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">where</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;David&#39;</span>, <span class="ruby-identifier">occupation</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Code Artist&#39;</span>).<span class="ruby-identifier">order</span>(<span class="ruby-string">&#39;created_at DESC&#39;</span>)
</pre>

<p>You can learn more about querying an Active Record model in the <a
href="active_record_querying.html">Active Record Query Interface</a> guide.</p>

<h3 id="label-Update">Update<span><a href="#label-Update">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Once an Active Record object has been retrieved, its attributes can be
modified and it can be saved to the database.</p>

<pre class="ruby"><span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;David&#39;</span>)
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span> = <span class="ruby-string">&#39;Dave&#39;</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">save</span>
</pre>

<p>A shorthand for this is to use a hash mapping attribute names to the
desired value, like so:</p>

<pre class="ruby"><span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;David&#39;</span>)
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Dave&#39;</span>)
</pre>

<p>This is most useful when updating several attributes at once. If, on the
other hand, you&#39;d like to update several records in bulk, you may find
the <code>update_all</code> class method useful:</p>

<pre class="ruby"><span class="ruby-constant">User</span>.<span class="ruby-identifier">update_all</span> <span class="ruby-string">&quot;max_login_attempts = 3, must_change_password = &#39;true&#39;&quot;</span>
</pre>

<h3 id="label-Delete">Delete<span><a href="#label-Delete">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Likewise, once retrieved an Active Record object can be destroyed which
removes it from the database.</p>

<pre class="ruby"><span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;David&#39;</span>)
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">destroy</span>
</pre>

<h2 id="label-Validations">Validations<span><a href="#label-Validations">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Active Record allows you to validate the state of a model before it gets
written into the database. There are several methods that you can use to
check your models and validate that an attribute value is not empty, is
unique and not already in the database, follows a specific format and many
more.</p>

<p>Validation is a very important issue to consider when persisting to the
database, so the methods <code>save</code> and <code>update</code> take it
into account when running: they return <code>false</code> when validation
fails and they didn&#39;t actually perform any operation on the database.
All of these have a bang counterpart (that is, <code>save!</code> and
<code>update!</code>), which are stricter in that they raise the exception
<code>ActiveRecord::RecordInvalid</code> if validation fails. A quick
example to illustrate:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">validates</span> :<span class="ruby-identifier">name</span>, <span class="ruby-identifier">presence</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">save</span>  <span class="ruby-comment"># =&gt; false</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">save!</span> <span class="ruby-comment"># =&gt; ActiveRecord::RecordInvalid: Validation failed: Name can&#39;t be blank</span>
</pre>

<p>You can learn more about validations in the <a
href="active_record_validations.html">Active Record Validations guide</a>.</p>

<h2 id="label-Callbacks">Callbacks<span><a href="#label-Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Active Record callbacks allow you to attach code to certain events in the
life-cycle of your models. This enables you to add behavior to your models
by transparently executing code when those events occur, like when you
create a new record, update it, destroy it and so on. You can learn more
about callbacks in the <a href="active_record_callbacks.html">Active Record
Callbacks guide</a>.</p>

<h2 id="label-Migrations">Migrations<span><a href="#label-Migrations">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Rails provides a domain-specific language for managing a database schema
called migrations. Migrations are stored in files which are executed
against any database that Active Record supports using <code>rake</code>.
Here&#39;s a migration that creates a table:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">CreatePublications</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Migration</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">change</span>
    <span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">publications</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> :<span class="ruby-identifier">title</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">text</span> :<span class="ruby-identifier">description</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">references</span> :<span class="ruby-identifier">publication_type</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">integer</span> :<span class="ruby-identifier">publisher_id</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> :<span class="ruby-identifier">publisher_type</span>
      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">boolean</span> :<span class="ruby-identifier">single_issue</span>

      <span class="ruby-identifier">t</span>.<span class="ruby-identifier">timestamps</span> <span class="ruby-identifier">null</span><span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">add_index</span> :<span class="ruby-identifier">publications</span>, :<span class="ruby-identifier">publication_type_id</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Rails keeps track of which files have been committed to the database and
provides rollback features. To actually create the table, you&#39;d run
<code>rake db:migrate</code> and to roll it back, <code>rake
db:rollback</code>.</p>

<p>Note that the above code is database-agnostic: it will run in MySQL,
PostgreSQL, Oracle and others. You can learn more about migrations in the
<a href="migrations.html">Active Record Migrations guide</a>.</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

