<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>active_record_callbacks - rails-4.2.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Active+Record+Callbacks">Active Record Callbacks</a>
    <li><a href="#label-The+Object+Life+Cycle">The Object Life Cycle</a>
    <li><a href="#label-Callbacks+Overview">Callbacks Overview</a>
    <li><a href="#label-Callback+Registration">Callback Registration</a>
    <li><a href="#label-Available+Callbacks">Available Callbacks</a>
    <li><a href="#label-Creating+an+Object">Creating an Object</a>
    <li><a href="#label-Updating+an+Object">Updating an Object</a>
    <li><a href="#label-Destroying+an+Object">Destroying an Object</a>
    <li><a href="#label-after_initialize+and+after_find"><code>after_initialize</code> and <code>after_find</code></a>
    <li><a href="#label-after_touch"><code>after_touch</code></a>
    <li><a href="#label-Running+Callbacks">Running Callbacks</a>
    <li><a href="#label-Skipping+Callbacks">Skipping Callbacks</a>
    <li><a href="#label-Halting+Execution">Halting Execution</a>
    <li><a href="#label-Relational+Callbacks">Relational Callbacks</a>
    <li><a href="#label-Conditional+Callbacks">Conditional Callbacks</a>
    <li><a href="#label-Using+-3Aif+and+-3Aunless+with+a+Symbol">Using <code>:if</code> and <code>:unless</code> with a <code>Symbol</code></a>
    <li><a href="#label-Using+-3Aif+and+-3Aunless+with+a+String">Using <code>:if</code> and <code>:unless</code> with a String</a>
    <li><a href="#label-Using+-3Aif+and+-3Aunless+with+a+Proc">Using <code>:if</code> and <code>:unless</code> with a <code>Proc</code></a>
    <li><a href="#label-Multiple+Conditions+for+Callbacks">Multiple Conditions for Callbacks</a>
    <li><a href="#label-Callback+Classes">Callback Classes</a>
    <li><a href="#label-Transaction+Callbacks">Transaction Callbacks</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../guides/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../guides/Rakefile.html">Rakefile</a>
  
    <li><a href="../../guides/assets/images/icons/README.html">README</a>
  
    <li><a href="../../guides/assets/javascripts/guides_js.html">guides.js</a>
  
    <li><a href="../../guides/assets/javascripts/jquery_min_js.html">jquery.min.js</a>
  
    <li><a href="../../guides/assets/javascripts/responsive-tables_js.html">responsive-tables.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAS3_js.html">shBrushAS3.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAppleScript_js.html">shBrushAppleScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushBash_js.html">shBrushBash.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCSharp_js.html">shBrushCSharp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushColdFusion_js.html">shBrushColdFusion.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCpp_js.html">shBrushCpp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCss_js.html">shBrushCss.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDelphi_js.html">shBrushDelphi.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDiff_js.html">shBrushDiff.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushErlang_js.html">shBrushErlang.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushGroovy_js.html">shBrushGroovy.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJScript_js.html">shBrushJScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJava_js.html">shBrushJava.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJavaFX_js.html">shBrushJavaFX.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPerl_js.html">shBrushPerl.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPhp_js.html">shBrushPhp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPlain_js.html">shBrushPlain.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPowerShell_js.html">shBrushPowerShell.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPython_js.html">shBrushPython.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushRuby_js.html">shBrushRuby.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSass_js.html">shBrushSass.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushScala_js.html">shBrushScala.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSql_js.html">shBrushSql.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushVb_js.html">shBrushVb.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushXml_js.html">shBrushXml.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shCore_js.html">shCore.js</a>
  
    <li><a href="../../guides/assets/stylesheets/fixes_css.html">fixes.css</a>
  
    <li><a href="../../guides/assets/stylesheets/kindle_css.html">kindle.css</a>
  
    <li><a href="../../guides/assets/stylesheets/main_css.html">main.css</a>
  
    <li><a href="../../guides/assets/stylesheets/print_css.html">print.css</a>
  
    <li><a href="../../guides/assets/stylesheets/reset_css.html">reset.css</a>
  
    <li><a href="../../guides/assets/stylesheets/responsive-tables_css.html">responsive-tables.css</a>
  
    <li><a href="../../guides/assets/stylesheets/style_css.html">style.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCore_css.html">shCore.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDefault_css.html">shCoreDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDjango_css.html">shCoreDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEclipse_css.html">shCoreEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEmacs_css.html">shCoreEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreFadeToGrey_css.html">shCoreFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMDUltra_css.html">shCoreMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMidnight_css.html">shCoreMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreRDark_css.html">shCoreRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDefault_css.html">shThemeDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDjango_css.html">shThemeDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEclipse_css.html">shThemeEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEmacs_css.html">shThemeEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeFadeToGrey_css.html">shThemeFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMDUltra_css.html">shThemeMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMidnight_css.html">shThemeMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRDark_css.html">shThemeRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRailsGuides_css.html">shThemeRailsGuides.css</a>
  
    <li><a href="../../guides/source/2_2_release_notes_md.html">2_2_release_notes</a>
  
    <li><a href="../../guides/source/2_3_release_notes_md.html">2_3_release_notes</a>
  
    <li><a href="../../guides/source/3_0_release_notes_md.html">3_0_release_notes</a>
  
    <li><a href="../../guides/source/3_1_release_notes_md.html">3_1_release_notes</a>
  
    <li><a href="../../guides/source/3_2_release_notes_md.html">3_2_release_notes</a>
  
    <li><a href="../../guides/source/4_0_release_notes_md.html">4_0_release_notes</a>
  
    <li><a href="../../guides/source/4_1_release_notes_md.html">4_1_release_notes</a>
  
    <li><a href="../../guides/source/4_2_release_notes_md.html">4_2_release_notes</a>
  
    <li><a href="../../guides/source/action_controller_overview_md.html">action_controller_overview</a>
  
    <li><a href="../../guides/source/action_mailer_basics_md.html">action_mailer_basics</a>
  
    <li><a href="../../guides/source/action_view_overview_md.html">action_view_overview</a>
  
    <li><a href="../../guides/source/active_job_basics_md.html">active_job_basics</a>
  
    <li><a href="../../guides/source/active_model_basics_md.html">active_model_basics</a>
  
    <li><a href="../../guides/source/active_record_basics_md.html">active_record_basics</a>
  
    <li><a href="../../guides/source/active_record_callbacks_md.html">active_record_callbacks</a>
  
    <li><a href="../../guides/source/active_record_migrations_md.html">active_record_migrations</a>
  
    <li><a href="../../guides/source/active_record_postgresql_md.html">active_record_postgresql</a>
  
    <li><a href="../../guides/source/active_record_querying_md.html">active_record_querying</a>
  
    <li><a href="../../guides/source/active_record_validations_md.html">active_record_validations</a>
  
    <li><a href="../../guides/source/active_support_core_extensions_md.html">active_support_core_extensions</a>
  
    <li><a href="../../guides/source/active_support_instrumentation_md.html">active_support_instrumentation</a>
  
    <li><a href="../../guides/source/api_documentation_guidelines_md.html">api_documentation_guidelines</a>
  
    <li><a href="../../guides/source/asset_pipeline_md.html">asset_pipeline</a>
  
    <li><a href="../../guides/source/association_basics_md.html">association_basics</a>
  
    <li><a href="../../guides/source/autoloading_and_reloading_constants_md.html">autoloading_and_reloading_constants</a>
  
    <li><a href="../../guides/source/caching_with_rails_md.html">caching_with_rails</a>
  
    <li><a href="../../guides/source/command_line_md.html">command_line</a>
  
    <li><a href="../../guides/source/configuring_md.html">configuring</a>
  
    <li><a href="../../guides/source/contributing_to_ruby_on_rails_md.html">contributing_to_ruby_on_rails</a>
  
    <li><a href="../../guides/source/debugging_rails_applications_md.html">debugging_rails_applications</a>
  
    <li><a href="../../guides/source/development_dependencies_install_md.html">development_dependencies_install</a>
  
    <li><a href="../../guides/source/documents_yaml.html">documents.yaml</a>
  
    <li><a href="../../guides/source/engines_md.html">engines</a>
  
    <li><a href="../../guides/source/form_helpers_md.html">form_helpers</a>
  
    <li><a href="../../guides/source/generators_md.html">generators</a>
  
    <li><a href="../../guides/source/getting_started_md.html">getting_started</a>
  
    <li><a href="../../guides/source/i18n_md.html">i18n</a>
  
    <li><a href="../../guides/source/initialization_md.html">initialization</a>
  
    <li><a href="../../guides/source/layouts_and_rendering_md.html">layouts_and_rendering</a>
  
    <li><a href="../../guides/source/maintenance_policy_md.html">maintenance_policy</a>
  
    <li><a href="../../guides/source/nested_model_forms_md.html">nested_model_forms</a>
  
    <li><a href="../../guides/source/plugins_md.html">plugins</a>
  
    <li><a href="../../guides/source/rails_application_templates_md.html">rails_application_templates</a>
  
    <li><a href="../../guides/source/rails_on_rack_md.html">rails_on_rack</a>
  
    <li><a href="../../guides/source/routing_md.html">routing</a>
  
    <li><a href="../../guides/source/ruby_on_rails_guides_guidelines_md.html">ruby_on_rails_guides_guidelines</a>
  
    <li><a href="../../guides/source/security_md.html">security</a>
  
    <li><a href="../../guides/source/testing_md.html">testing</a>
  
    <li><a href="../../guides/source/upgrading_ruby_on_rails_md.html">upgrading_ruby_on_rails</a>
  
    <li><a href="../../guides/source/working_with_javascript_in_rails_md.html">working_with_javascript_in_rails</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page guides/source/active_record_callbacks.md">

<h1 id="label-Active+Record+Callbacks">Active Record Callbacks<span><a href="#label-Active+Record+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>This guide teaches you how to hook into the life cycle of your Active
Record objects.</p>

<p>After reading this guide, you will know:</p>
<ul><li>
<p>The life cycle of Active Record objects.</p>
</li><li>
<p>How to create callback methods that respond to events in the object life
cycle.</p>
</li><li>
<p>How to create special classes that encapsulate common behavior for your
callbacks.</p>
</li></ul>
<hr>

<h2 id="label-The+Object+Life+Cycle">The <a href="../../Object.html">Object</a> Life Cycle<span><a href="#label-The+Object+Life+Cycle">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>During the normal operation of a Rails application, objects may be created,
updated, and destroyed. Active Record provides hooks into this <em>object
life cycle</em> so that you can control your application and its data.</p>

<p>Callbacks allow you to trigger logic before or after an alteration of an
object&#39;s state.</p>

<h2 id="label-Callbacks+Overview">Callbacks Overview<span><a href="#label-Callbacks+Overview">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Callbacks are methods that get called at certain moments of an object&#39;s
life cycle. With callbacks it is possible to write code that will run
whenever an Active Record object is created, saved, updated, deleted,
validated, or loaded from the database.</p>

<h3 id="label-Callback+Registration">Callback Registration<span><a href="#label-Callback+Registration">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In order to use the available callbacks, you need to register them. You can
implement the callbacks as ordinary methods and use a macro-style class
method to register them as callbacks:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">validates</span> :<span class="ruby-identifier">login</span>, :<span class="ruby-identifier">email</span>, <span class="ruby-identifier">presence</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">before_validation</span> :<span class="ruby-identifier">ensure_login_has_a_value</span>

  <span class="ruby-identifier">protected</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">ensure_login_has_a_value</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">login</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">login</span> = <span class="ruby-identifier">email</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">email</span>.<span class="ruby-identifier">blank?</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The macro-style class methods can also receive a block. Consider using this
style if the code inside your block is so short that it fits in a single
line:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">validates</span> :<span class="ruby-identifier">login</span>, :<span class="ruby-identifier">email</span>, <span class="ruby-identifier">presence</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>

  <span class="ruby-identifier">before_create</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">login</span>.<span class="ruby-identifier">capitalize</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Callbacks can also be registered to only fire on certain life cycle events:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">before_validation</span> :<span class="ruby-identifier">normalize_name</span>, <span class="ruby-identifier">on</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">create</span>

  <span class="ruby-comment"># :on takes an array as well</span>
  <span class="ruby-identifier">after_validation</span> :<span class="ruby-identifier">set_location</span>, <span class="ruby-identifier">on</span><span class="ruby-operator">:</span> [ :<span class="ruby-identifier">create</span>, :<span class="ruby-identifier">update</span> ]

  <span class="ruby-identifier">protected</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">normalize_name</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">titleize</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">def</span> <span class="ruby-identifier">set_location</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">location</span> = <span class="ruby-constant">LocationService</span>.<span class="ruby-identifier">query</span>(<span class="ruby-keyword">self</span>)
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>It is considered good practice to declare callback methods as protected or
private. If left public, they can be called from outside of the model and
violate the principle of object encapsulation.</p>

<h2 id="label-Available+Callbacks">Available Callbacks<span><a href="#label-Available+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Here is a list with all the available Active Record callbacks, listed in
the same order in which they will get called during the respective
operations:</p>

<h3 id="label-Creating+an+Object">Creating an <a href="../../Object.html">Object</a><span><a href="#label-Creating+an+Object">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><code>before_validation</code></p>
</li><li>
<p><code>after_validation</code></p>
</li><li>
<p><code>before_save</code></p>
</li><li>
<p><code>around_save</code></p>
</li><li>
<p><code>before_create</code></p>
</li><li>
<p><code>around_create</code></p>
</li><li>
<p><code>after_create</code></p>
</li><li>
<p><code>after_save</code></p>
</li><li>
<p><code>after_commit/after_rollback</code></p>
</li></ul>

<h3 id="label-Updating+an+Object">Updating an <a href="../../Object.html">Object</a><span><a href="#label-Updating+an+Object">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><code>before_validation</code></p>
</li><li>
<p><code>after_validation</code></p>
</li><li>
<p><code>before_save</code></p>
</li><li>
<p><code>around_save</code></p>
</li><li>
<p><code>before_update</code></p>
</li><li>
<p><code>around_update</code></p>
</li><li>
<p><code>after_update</code></p>
</li><li>
<p><code>after_save</code></p>
</li><li>
<p><code>after_commit/after_rollback</code></p>
</li></ul>

<h3 id="label-Destroying+an+Object">Destroying an <a href="../../Object.html">Object</a><span><a href="#label-Destroying+an+Object">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><code>before_destroy</code></p>
</li><li>
<p><code>around_destroy</code></p>
</li><li>
<p><code>after_destroy</code></p>
</li><li>
<p><code>after_commit/after_rollback</code></p>
</li></ul>

<p>WARNING. <code>after_save</code> runs both on create and update, but always
<em>after</em> the more specific callbacks <code>after_create</code> and
<code>after_update</code>, no matter the order in which the macro calls
were executed.</p>

<h3 id="label-after_initialize+and+after_find"><code>after_initialize</code> and <code>after_find</code><span><a href="#label-after_initialize+and+after_find">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The <code>after_initialize</code> callback will be called whenever an
Active Record object is instantiated, either by directly using
<code>new</code> or when a record is loaded from the database. It can be
useful to avoid the need to directly override your Active Record
<code>initialize</code> method.</p>

<p>The <code>after_find</code> callback will be called whenever Active Record
loads a record from the database. <code>after_find</code> is called before
<code>after_initialize</code> if both are defined.</p>

<p>The <code>after_initialize</code> and <code>after_find</code> callbacks
have no <code>before_*</code> counterparts, but they can be registered just
like the other Active Record callbacks.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">after_initialize</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;You have initialized an object!&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">after_find</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;You have found an object!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">new</span>
<span class="ruby-constant">You</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">initialized</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">object!</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;User id: nil&gt;</span>

<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-constant">User</span>.<span class="ruby-identifier">first</span>
<span class="ruby-constant">You</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">found</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">object!</span>
<span class="ruby-constant">You</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">initialized</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">object!</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;User id: 1&gt;</span>
</pre>

<h3 id="label-after_touch"><code>after_touch</code><span><a href="#label-after_touch">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>The <code>after_touch</code> callback will be called whenever an Active
Record object is touched.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">after_touch</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">user</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;You have touched an object&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">u</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">name</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Kuldeep&#39;</span>)
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;User id: 1, name: &quot;Kuldeep&quot;, created_at: &quot;2013-11-25 12:17:49&quot;, updated_at: &quot;2013-11-25 12:17:49&quot;&gt;</span>

<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">touch</span>
<span class="ruby-constant">You</span> <span class="ruby-identifier">have</span> <span class="ruby-identifier">touched</span> <span class="ruby-identifier">an</span> <span class="ruby-identifier">object</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
</pre>

<p>It can be used along with <code>belongs_to</code>:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Employee</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">belongs_to</span> :<span class="ruby-identifier">company</span>, <span class="ruby-identifier">touch</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">after_touch</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;An Employee was touched&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">Company</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">has_many</span> :<span class="ruby-identifier">employees</span>
  <span class="ruby-identifier">after_touch</span> :<span class="ruby-identifier">log_when_employees_or_company_touched</span>

  <span class="ruby-identifier">private</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">log_when_employees_or_company_touched</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;Employee/Company was touched&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-ivar">@employee</span> = <span class="ruby-constant">Employee</span>.<span class="ruby-identifier">last</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;Employee id: 1, company_id: 1, created_at: &quot;2013-11-25 17:04:22&quot;, updated_at: &quot;2013-11-25 17:05:05&quot;&gt;</span>

<span class="ruby-comment"># triggers @employee.company.touch</span>
<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-ivar">@employee</span>.<span class="ruby-identifier">touch</span>
<span class="ruby-constant">Employee</span><span class="ruby-operator">/</span><span class="ruby-constant">Company</span> <span class="ruby-identifier">was</span> <span class="ruby-identifier">touched</span>
<span class="ruby-constant">An</span> <span class="ruby-constant">Employee</span> <span class="ruby-identifier">was</span> <span class="ruby-identifier">touched</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
</pre>

<h2 id="label-Running+Callbacks">Running Callbacks<span><a href="#label-Running+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The following methods trigger callbacks:</p>
<ul><li>
<p><code>create</code></p>
</li><li>
<p><code>create!</code></p>
</li><li>
<p><code>decrement!</code></p>
</li><li>
<p><code>destroy</code></p>
</li><li>
<p><code>destroy!</code></p>
</li><li>
<p><code>destroy_all</code></p>
</li><li>
<p><code>increment!</code></p>
</li><li>
<p><code>save</code></p>
</li><li>
<p><code>save!</code></p>
</li><li>
<p><code>save(validate: false)</code></p>
</li><li>
<p><code>toggle!</code></p>
</li><li>
<p><code>update_attribute</code></p>
</li><li>
<p><code>update</code></p>
</li><li>
<p><code>update!</code></p>
</li><li>
<p><code>valid?</code></p>
</li></ul>

<p>Additionally, the <code>after_find</code> callback is triggered by the
following finder methods:</p>
<ul><li>
<p><code>all</code></p>
</li><li>
<p><code>first</code></p>
</li><li>
<p><code>find</code></p>
</li><li>
<p><code>find_by</code></p>
</li><li>
<p><code>find_by_*</code></p>
</li><li>
<p><code>find_by_*!</code></p>
</li><li>
<p><code>find_by_sql</code></p>
</li><li>
<p><code>last</code></p>
</li></ul>

<p>The <code>after_initialize</code> callback is triggered every time a new
object of the class is initialized.</p>

<p>NOTE: The <code>find_by_*</code> and <code>find_by_*!</code> methods are
dynamic finders generated automatically for every attribute. Learn more
about them at the <a
href="active_record_querying.html#dynamic-finders">Dynamic finders
section</a></p>

<h2 id="label-Skipping+Callbacks">Skipping Callbacks<span><a href="#label-Skipping+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Just as with validations, it is also possible to skip callbacks by using
the following methods:</p>
<ul><li>
<p><code>decrement</code></p>
</li><li>
<p><code>decrement_counter</code></p>
</li><li>
<p><code>delete</code></p>
</li><li>
<p><code>delete_all</code></p>
</li><li>
<p><code>increment</code></p>
</li><li>
<p><code>increment_counter</code></p>
</li><li>
<p><code>toggle</code></p>
</li><li>
<p><code>touch</code></p>
</li><li>
<p><code>update_column</code></p>
</li><li>
<p><code>update_columns</code></p>
</li><li>
<p><code>update_all</code></p>
</li><li>
<p><code>update_counters</code></p>
</li></ul>

<p>These methods should be used with caution, however, because important
business rules and application logic may be kept in callbacks. Bypassing
them without understanding the potential implications may lead to invalid
data.</p>

<h2 id="label-Halting+Execution">Halting Execution<span><a href="#label-Halting+Execution">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>As you start registering new callbacks for your models, they will be queued
for execution. This queue will include all your model&#39;s validations,
the registered callbacks, and the database operation to be executed.</p>

<p>The whole callback chain is wrapped in a transaction. If any
<em>before</em> callback method returns exactly <code>false</code> or
raises an exception, the execution chain gets halted and a ROLLBACK is
issued; <em>after</em> callbacks can only accomplish that by raising an
exception.</p>

<p>WARNING. Any exception that is not <code>ActiveRecord::Rollback</code> will
be re-raised by Rails after the callback chain is halted. Raising an
exception other than <code>ActiveRecord::Rollback</code> may break code
that does not expect methods like <code>save</code> and
<code>update_attributes</code> (which normally try to return
<code>true</code> or <code>false</code>) to raise an exception.</p>

<h2 id="label-Relational+Callbacks">Relational Callbacks<span><a href="#label-Relational+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Callbacks work through model relationships, and can even be defined by
them. Suppose an example where a user has many articles. A user&#39;s
articles should be destroyed if the user is destroyed. Let&#39;s add an
<code>after_destroy</code> callback to the <code>User</code> model by way
of its relationship to the <code>Article</code> model:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">has_many</span> :<span class="ruby-identifier">articles</span>, <span class="ruby-identifier">dependent</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">destroy</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">Article</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">after_destroy</span> :<span class="ruby-identifier">log_destroy_action</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">log_destroy_action</span>
    <span class="ruby-identifier">puts</span> <span class="ruby-string">&#39;Article destroyed&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">first</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;User id: 1&gt;</span>
<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">articles</span>.<span class="ruby-identifier">create!</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;Article id: 1, user_id: 1&gt;</span>
<span class="ruby-operator">&gt;&gt;</span> <span class="ruby-identifier">user</span>.<span class="ruby-identifier">destroy</span>
<span class="ruby-constant">Article</span> <span class="ruby-identifier">destroyed</span>
=<span class="ruby-operator">&gt;</span> <span class="ruby-comment">#&lt;User id: 1&gt;</span>
</pre>

<h2 id="label-Conditional+Callbacks">Conditional Callbacks<span><a href="#label-Conditional+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>As with validations, we can also make the calling of a callback method
conditional on the satisfaction of a given predicate. We can do this using
the <code>:if</code> and <code>:unless</code> options, which can take a
symbol, a string, a <code>Proc</code> or an <code>Array</code>. You may use
the <code>:if</code> option when you want to specify under which conditions
the callback <strong>should</strong> be called. If you want to specify the
conditions under which the callback <strong>should not</strong> be called,
then you may use the <code>:unless</code> option.</p>

<h3 id="label-Using+-3Aif+and+-3Aunless+with+a+Symbol">Using <code>:if</code> and <code>:unless</code> with a <code>Symbol</code><span><a href="#label-Using+-3Aif+and+-3Aunless+with+a+Symbol">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You can associate the <code>:if</code> and <code>:unless</code> options
with a symbol corresponding to the name of a predicate method that will get
called right before the callback. When using the <code>:if</code> option,
the callback won&#39;t be executed if the predicate method returns false;
when using the <code>:unless</code> option, the callback won&#39;t be
executed if the predicate method returns true. This is the most common
option. Using this form of registration it is also possible to register
several different predicates that should be called to check if the callback
should be executed.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Order</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">before_save</span> :<span class="ruby-identifier">normalize_card_number</span>, <span class="ruby-identifier">if</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">paid_with_card?</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Using+-3Aif+and+-3Aunless+with+a+String">Using <code>:if</code> and <code>:unless</code> with a String<span><a href="#label-Using+-3Aif+and+-3Aunless+with+a+String">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You can also use a string that will be evaluated using <code>eval</code>
and hence needs to contain valid Ruby code. You should use this option only
when the string represents a really short condition:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Order</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">before_save</span> :<span class="ruby-identifier">normalize_card_number</span>, <span class="ruby-identifier">if</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;paid_with_card?&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Using+-3Aif+and+-3Aunless+with+a+Proc">Using <code>:if</code> and <code>:unless</code> with a <code>Proc</code><span><a href="#label-Using+-3Aif+and+-3Aunless+with+a+Proc">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Finally, it is possible to associate <code>:if</code> and
<code>:unless</code> with a <code>Proc</code> object. This option is best
suited when writing short validation methods, usually one-liners:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Order</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">before_save</span> :<span class="ruby-identifier">normalize_card_number</span>,
    <span class="ruby-identifier">if</span><span class="ruby-operator">:</span> <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">order</span><span class="ruby-operator">|</span> <span class="ruby-identifier">order</span>.<span class="ruby-identifier">paid_with_card?</span> }
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Multiple+Conditions+for+Callbacks">Multiple Conditions for Callbacks<span><a href="#label-Multiple+Conditions+for+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>When writing conditional callbacks, it is possible to mix both
<code>:if</code> and <code>:unless</code> in the same callback declaration:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Comment</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">after_create</span> :<span class="ruby-identifier">send_email_to_author</span>, <span class="ruby-identifier">if</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">author_wants_emails?</span>,
    <span class="ruby-identifier">unless</span><span class="ruby-operator">:</span> <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">comment</span><span class="ruby-operator">|</span> <span class="ruby-identifier">comment</span>.<span class="ruby-identifier">article</span>.<span class="ruby-identifier">ignore_comments?</span> }
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Callback+Classes">Callback Classes<span><a href="#label-Callback+Classes">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Sometimes the callback methods that you&#39;ll write will be useful enough
to be reused by other models. Active Record makes it possible to create
classes that encapsulate the callback methods, so it becomes very easy to
reuse them.</p>

<p>Here&#39;s an example where we create a class with an
<code>after_destroy</code> callback for a <code>PictureFile</code> model:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">PictureFileCallbacks</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">after_destroy</span>(<span class="ruby-identifier">picture_file</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">picture_file</span>.<span class="ruby-identifier">filepath</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">picture_file</span>.<span class="ruby-identifier">filepath</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>When declared inside a class, as above, the callback methods will receive
the model object as a parameter. We can now use the callback class in the
model:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">PictureFile</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">after_destroy</span> <span class="ruby-constant">PictureFileCallbacks</span>.<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note that we needed to instantiate a new <code>PictureFileCallbacks</code>
object, since we declared our callback as an instance method. This is
particularly useful if the callbacks make use of the state of the
instantiated object. Often, however, it will make more sense to declare the
callbacks as class methods:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">PictureFileCallbacks</span>
  <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">after_destroy</span>(<span class="ruby-identifier">picture_file</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">picture_file</span>.<span class="ruby-identifier">filepath</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">picture_file</span>.<span class="ruby-identifier">filepath</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If the callback method is declared this way, it won&#39;t be necessary to
instantiate a <code>PictureFileCallbacks</code> object.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">PictureFile</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">after_destroy</span> <span class="ruby-constant">PictureFileCallbacks</span>
<span class="ruby-keyword">end</span>
</pre>

<p>You can declare as many callbacks as you want inside your callback classes.</p>

<h2 id="label-Transaction+Callbacks">Transaction Callbacks<span><a href="#label-Transaction+Callbacks">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>There are two additional callbacks that are triggered by the completion of
a database transaction: <code>after_commit</code> and
<code>after_rollback</code>. These callbacks are very similar to the
<code>after_save</code> callback except that they don&#39;t execute until
after database changes have either been committed or rolled back. They are
most useful when your active record models need to interact with external
systems which are not part of the database transaction.</p>

<p>Consider, for example, the previous example where the
<code>PictureFile</code> model needs to delete a file after the
corresponding record is destroyed. If anything raises an exception after
the <code>after_destroy</code> callback is called and the transaction rolls
back, the file will have been deleted and the model will be left in an
inconsistent state. For example, suppose that <code>picture_file_2</code>
in the code below is not valid and the <code>save!</code> method raises an
error.</p>

<pre class="ruby"><span class="ruby-constant">PictureFile</span>.<span class="ruby-identifier">transaction</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">picture_file_1</span>.<span class="ruby-identifier">destroy</span>
  <span class="ruby-identifier">picture_file_2</span>.<span class="ruby-identifier">save!</span>
<span class="ruby-keyword">end</span>
</pre>

<p>By using the <code>after_commit</code> callback we can account for this
case.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">PictureFile</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">after_commit</span> :<span class="ruby-identifier">delete_picture_file_from_disk</span>, <span class="ruby-identifier">on</span><span class="ruby-operator">:</span> [:<span class="ruby-identifier">destroy</span>]

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">delete_picture_file_from_disk</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">filepath</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">filepath</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>NOTE: the <code>:on</code> option specifies when a callback will be fired.
If you don&#39;t supply the <code>:on</code> option the callback will fire
for every action.</p>

<p>WARNING. The <code>after_commit</code> and <code>after_rollback</code>
callbacks are guaranteed to be called for all models created, updated, or
destroyed within a transaction block. If any exceptions are raised within
one of these callbacks, they will be ignored so that they don&#39;t
interfere with the other callbacks. As such, if your callback code could
raise an exception, you&#39;ll need to rescue it and handle it
appropriately within the callback.</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

