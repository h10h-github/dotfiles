<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>active_record_postgresql - rails-4.2.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Active+Record+and+PostgreSQL">Active Record and PostgreSQL</a>
    <li><a href="#label-Datatypes">Datatypes</a>
    <li><a href="#label-Bytea">Bytea</a>
    <li><a href="#label-Array">Array</a>
    <li><a href="#label-Hstore">Hstore</a>
    <li><a href="#label-JSON">JSON</a>
    <li><a href="#label-Range+Types">Range Types</a>
    <li><a href="#label-Composite+Types">Composite Types</a>
    <li><a href="#label-Enumerated+Types">Enumerated Types</a>
    <li><a href="#label-UUID">UUID</a>
    <li><a href="#label-Bit+String+Types">Bit String Types</a>
    <li><a href="#label-Network+Address+Types">Network Address Types</a>
    <li><a href="#label-Geometric+Types">Geometric Types</a>
    <li><a href="#label-UUID+Primary+Keys">UUID Primary Keys</a>
    <li><a href="#label-Full+Text+Search">Full Text Search</a>
    <li><a href="#label-Database+Views">Database Views</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../guides/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../guides/Rakefile.html">Rakefile</a>
  
    <li><a href="../../guides/assets/images/icons/README.html">README</a>
  
    <li><a href="../../guides/assets/javascripts/guides_js.html">guides.js</a>
  
    <li><a href="../../guides/assets/javascripts/jquery_min_js.html">jquery.min.js</a>
  
    <li><a href="../../guides/assets/javascripts/responsive-tables_js.html">responsive-tables.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAS3_js.html">shBrushAS3.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAppleScript_js.html">shBrushAppleScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushBash_js.html">shBrushBash.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCSharp_js.html">shBrushCSharp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushColdFusion_js.html">shBrushColdFusion.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCpp_js.html">shBrushCpp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCss_js.html">shBrushCss.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDelphi_js.html">shBrushDelphi.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDiff_js.html">shBrushDiff.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushErlang_js.html">shBrushErlang.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushGroovy_js.html">shBrushGroovy.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJScript_js.html">shBrushJScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJava_js.html">shBrushJava.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJavaFX_js.html">shBrushJavaFX.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPerl_js.html">shBrushPerl.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPhp_js.html">shBrushPhp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPlain_js.html">shBrushPlain.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPowerShell_js.html">shBrushPowerShell.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPython_js.html">shBrushPython.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushRuby_js.html">shBrushRuby.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSass_js.html">shBrushSass.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushScala_js.html">shBrushScala.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSql_js.html">shBrushSql.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushVb_js.html">shBrushVb.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushXml_js.html">shBrushXml.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shCore_js.html">shCore.js</a>
  
    <li><a href="../../guides/assets/stylesheets/fixes_css.html">fixes.css</a>
  
    <li><a href="../../guides/assets/stylesheets/kindle_css.html">kindle.css</a>
  
    <li><a href="../../guides/assets/stylesheets/main_css.html">main.css</a>
  
    <li><a href="../../guides/assets/stylesheets/print_css.html">print.css</a>
  
    <li><a href="../../guides/assets/stylesheets/reset_css.html">reset.css</a>
  
    <li><a href="../../guides/assets/stylesheets/responsive-tables_css.html">responsive-tables.css</a>
  
    <li><a href="../../guides/assets/stylesheets/style_css.html">style.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCore_css.html">shCore.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDefault_css.html">shCoreDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDjango_css.html">shCoreDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEclipse_css.html">shCoreEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEmacs_css.html">shCoreEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreFadeToGrey_css.html">shCoreFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMDUltra_css.html">shCoreMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMidnight_css.html">shCoreMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreRDark_css.html">shCoreRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDefault_css.html">shThemeDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDjango_css.html">shThemeDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEclipse_css.html">shThemeEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEmacs_css.html">shThemeEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeFadeToGrey_css.html">shThemeFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMDUltra_css.html">shThemeMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMidnight_css.html">shThemeMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRDark_css.html">shThemeRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRailsGuides_css.html">shThemeRailsGuides.css</a>
  
    <li><a href="../../guides/source/2_2_release_notes_md.html">2_2_release_notes</a>
  
    <li><a href="../../guides/source/2_3_release_notes_md.html">2_3_release_notes</a>
  
    <li><a href="../../guides/source/3_0_release_notes_md.html">3_0_release_notes</a>
  
    <li><a href="../../guides/source/3_1_release_notes_md.html">3_1_release_notes</a>
  
    <li><a href="../../guides/source/3_2_release_notes_md.html">3_2_release_notes</a>
  
    <li><a href="../../guides/source/4_0_release_notes_md.html">4_0_release_notes</a>
  
    <li><a href="../../guides/source/4_1_release_notes_md.html">4_1_release_notes</a>
  
    <li><a href="../../guides/source/4_2_release_notes_md.html">4_2_release_notes</a>
  
    <li><a href="../../guides/source/action_controller_overview_md.html">action_controller_overview</a>
  
    <li><a href="../../guides/source/action_mailer_basics_md.html">action_mailer_basics</a>
  
    <li><a href="../../guides/source/action_view_overview_md.html">action_view_overview</a>
  
    <li><a href="../../guides/source/active_job_basics_md.html">active_job_basics</a>
  
    <li><a href="../../guides/source/active_model_basics_md.html">active_model_basics</a>
  
    <li><a href="../../guides/source/active_record_basics_md.html">active_record_basics</a>
  
    <li><a href="../../guides/source/active_record_callbacks_md.html">active_record_callbacks</a>
  
    <li><a href="../../guides/source/active_record_migrations_md.html">active_record_migrations</a>
  
    <li><a href="../../guides/source/active_record_postgresql_md.html">active_record_postgresql</a>
  
    <li><a href="../../guides/source/active_record_querying_md.html">active_record_querying</a>
  
    <li><a href="../../guides/source/active_record_validations_md.html">active_record_validations</a>
  
    <li><a href="../../guides/source/active_support_core_extensions_md.html">active_support_core_extensions</a>
  
    <li><a href="../../guides/source/active_support_instrumentation_md.html">active_support_instrumentation</a>
  
    <li><a href="../../guides/source/api_documentation_guidelines_md.html">api_documentation_guidelines</a>
  
    <li><a href="../../guides/source/asset_pipeline_md.html">asset_pipeline</a>
  
    <li><a href="../../guides/source/association_basics_md.html">association_basics</a>
  
    <li><a href="../../guides/source/autoloading_and_reloading_constants_md.html">autoloading_and_reloading_constants</a>
  
    <li><a href="../../guides/source/caching_with_rails_md.html">caching_with_rails</a>
  
    <li><a href="../../guides/source/command_line_md.html">command_line</a>
  
    <li><a href="../../guides/source/configuring_md.html">configuring</a>
  
    <li><a href="../../guides/source/contributing_to_ruby_on_rails_md.html">contributing_to_ruby_on_rails</a>
  
    <li><a href="../../guides/source/debugging_rails_applications_md.html">debugging_rails_applications</a>
  
    <li><a href="../../guides/source/development_dependencies_install_md.html">development_dependencies_install</a>
  
    <li><a href="../../guides/source/documents_yaml.html">documents.yaml</a>
  
    <li><a href="../../guides/source/engines_md.html">engines</a>
  
    <li><a href="../../guides/source/form_helpers_md.html">form_helpers</a>
  
    <li><a href="../../guides/source/generators_md.html">generators</a>
  
    <li><a href="../../guides/source/getting_started_md.html">getting_started</a>
  
    <li><a href="../../guides/source/i18n_md.html">i18n</a>
  
    <li><a href="../../guides/source/initialization_md.html">initialization</a>
  
    <li><a href="../../guides/source/layouts_and_rendering_md.html">layouts_and_rendering</a>
  
    <li><a href="../../guides/source/maintenance_policy_md.html">maintenance_policy</a>
  
    <li><a href="../../guides/source/nested_model_forms_md.html">nested_model_forms</a>
  
    <li><a href="../../guides/source/plugins_md.html">plugins</a>
  
    <li><a href="../../guides/source/rails_application_templates_md.html">rails_application_templates</a>
  
    <li><a href="../../guides/source/rails_on_rack_md.html">rails_on_rack</a>
  
    <li><a href="../../guides/source/routing_md.html">routing</a>
  
    <li><a href="../../guides/source/ruby_on_rails_guides_guidelines_md.html">ruby_on_rails_guides_guidelines</a>
  
    <li><a href="../../guides/source/security_md.html">security</a>
  
    <li><a href="../../guides/source/testing_md.html">testing</a>
  
    <li><a href="../../guides/source/upgrading_ruby_on_rails_md.html">upgrading_ruby_on_rails</a>
  
    <li><a href="../../guides/source/working_with_javascript_in_rails_md.html">working_with_javascript_in_rails</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page guides/source/active_record_postgresql.md">

<h1 id="label-Active+Record+and+PostgreSQL">Active Record and PostgreSQL<span><a href="#label-Active+Record+and+PostgreSQL">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>This guide covers PostgreSQL specific usage of Active Record.</p>

<p>After reading this guide, you will know:</p>
<ul><li>
<p>How to use PostgreSQL&#39;s datatypes.</p>
</li><li>
<p>How to use UUID primary keys.</p>
</li><li>
<p>How to implement full text search with PostgreSQL.</p>
</li><li>
<p>How to back your Active Record models with database views.</p>
</li></ul>
<hr>

<p>In order to use the PostgreSQL adapter you need to have at least version
8.2 installed. Older versions are not supported.</p>

<p>To get started with PostgreSQL have a look at the <a
href="configuring.html#configuring-a-postgresql-database">configuring Rails
guide</a>. It describes how to properly setup Active Record for PostgreSQL.</p>

<h2 id="label-Datatypes">Datatypes<span><a href="#label-Datatypes">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>PostgreSQL offers a number of specific datatypes. Following is a list of
types, that are supported by the PostgreSQL adapter.</p>

<h3 id="label-Bytea">Bytea<span><a href="#label-Bytea">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/datatype-binary.html">type
definition</a></p>
</li><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/functions-binarystring.html">functions
and operators</a></p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20140207133952_create_documents.rb</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">documents</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">binary</span> <span class="ruby-string">&#39;payload&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/document.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Document</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-identifier">data</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">Rails</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-string">&quot;tmp/output.pdf&quot;</span>)
<span class="ruby-constant">Document</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">payload</span><span class="ruby-operator">:</span> <span class="ruby-identifier">data</span>
</pre>

<h3 id="label-Array">Array<span><a href="#label-Array">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/arrays.html">type
definition</a></p>
</li><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/functions-array.html">functions
and operators</a></p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20140207133952_create_books.rb</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">books</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> <span class="ruby-string">&#39;title&#39;</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> <span class="ruby-string">&#39;tags&#39;</span>, <span class="ruby-identifier">array</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">integer</span> <span class="ruby-string">&#39;ratings&#39;</span>, <span class="ruby-identifier">array</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
<span class="ruby-identifier">add_index</span> :<span class="ruby-identifier">books</span>, :<span class="ruby-identifier">tags</span>, <span class="ruby-identifier">using</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;gin&#39;</span>
<span class="ruby-identifier">add_index</span> :<span class="ruby-identifier">books</span>, :<span class="ruby-identifier">ratings</span>, <span class="ruby-identifier">using</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;gin&#39;</span>

<span class="ruby-comment"># app/models/book.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Book</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Book</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Brave New World&quot;</span>,
            <span class="ruby-identifier">tags</span><span class="ruby-operator">:</span> [<span class="ruby-string">&quot;fantasy&quot;</span>, <span class="ruby-string">&quot;fiction&quot;</span>],
            <span class="ruby-identifier">ratings</span><span class="ruby-operator">:</span> [<span class="ruby-value">4</span>, <span class="ruby-value">5</span>]

<span class="ruby-comment">## Books for a single tag</span>
<span class="ruby-constant">Book</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;&#39;fantasy&#39; = ANY (tags)&quot;</span>)

<span class="ruby-comment">## Books for multiple tags</span>
<span class="ruby-constant">Book</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;tags @&gt; ARRAY[?]::varchar[]&quot;</span>, [<span class="ruby-string">&quot;fantasy&quot;</span>, <span class="ruby-string">&quot;fiction&quot;</span>])

<span class="ruby-comment">## Books with 3 or more ratings</span>
<span class="ruby-constant">Book</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;array_length(ratings, 1) &gt;= 3&quot;</span>)
</pre>

<h3 id="label-Hstore">Hstore<span><a href="#label-Hstore">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/hstore.html">type
definition</a></p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131009135255_create_profiles.rb</span>
<span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Schema</span>.<span class="ruby-identifier">define</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">profiles</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">t</span>.<span class="ruby-identifier">hstore</span> <span class="ruby-string">&#39;settings&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/profile.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Profile</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Profile</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">settings</span><span class="ruby-operator">:</span> { <span class="ruby-string">&quot;color&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;blue&quot;</span>, <span class="ruby-string">&quot;resolution&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;800x600&quot;</span> })

<span class="ruby-identifier">profile</span> = <span class="ruby-constant">Profile</span>.<span class="ruby-identifier">first</span>
<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">settings</span> <span class="ruby-comment"># =&gt; {&quot;color&quot;=&gt;&quot;blue&quot;, &quot;resolution&quot;=&gt;&quot;800x600&quot;}</span>

<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">settings</span> = {<span class="ruby-string">&quot;color&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;yellow&quot;</span>, <span class="ruby-string">&quot;resolution&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;1280x1024&quot;</span>}
<span class="ruby-identifier">profile</span>.<span class="ruby-identifier">save!</span>
</pre>

<h3 id="label-JSON">JSON<span><a href="#label-JSON">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/datatype-json.html">type
definition</a></p>
</li><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/functions-json.html">functions
and operators</a></p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131220144913_create_events.rb</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">events</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">json</span> <span class="ruby-string">&#39;payload&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/event.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Event</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Event</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">payload</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">kind</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;user_renamed&quot;</span>, <span class="ruby-identifier">change</span><span class="ruby-operator">:</span> [<span class="ruby-string">&quot;jack&quot;</span>, <span class="ruby-string">&quot;john&quot;</span>]})

<span class="ruby-identifier">event</span> = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">first</span>
<span class="ruby-identifier">event</span>.<span class="ruby-identifier">payload</span> <span class="ruby-comment"># =&gt; {&quot;kind&quot;=&gt;&quot;user_renamed&quot;, &quot;change&quot;=&gt;[&quot;jack&quot;, &quot;john&quot;]}</span>

<span class="ruby-comment">## Query based on JSON document</span>
<span class="ruby-comment"># The -&gt; operator returns the original JSON type (which might be an object), whereas -&gt;&gt; returns text</span>
<span class="ruby-constant">Event</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;payload-&gt;&gt;&#39;kind&#39; = ?&quot;</span>, <span class="ruby-string">&quot;user_renamed&quot;</span>)
</pre>

<h3 id="label-Range+Types">Range Types<span><a href="#label-Range+Types">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/rangetypes.html">type
definition</a></p>
</li><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/functions-range.html">functions
and operators</a></p>
</li></ul>

<p>This type is mapped to Ruby <a
href="http://www.ruby-doc.org/core-2.1.1/Range.html">Range</a> objects.</p>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20130923065404_create_events.rb</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">events</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">daterange</span> <span class="ruby-string">&#39;duration&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/event.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Event</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Event</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">duration</span><span class="ruby-operator">:</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">2014</span>, <span class="ruby-value">2</span>, <span class="ruby-value">11</span>)<span class="ruby-operator">..</span><span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">2014</span>, <span class="ruby-value">2</span>, <span class="ruby-value">12</span>))

<span class="ruby-identifier">event</span> = <span class="ruby-constant">Event</span>.<span class="ruby-identifier">first</span>
<span class="ruby-identifier">event</span>.<span class="ruby-identifier">duration</span> <span class="ruby-comment"># =&gt; Tue, 11 Feb 2014...Thu, 13 Feb 2014</span>

<span class="ruby-comment">## All Events on a given date</span>
<span class="ruby-constant">Event</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;duration @&gt; ?::date&quot;</span>, <span class="ruby-constant">Date</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">2014</span>, <span class="ruby-value">2</span>, <span class="ruby-value">12</span>))

<span class="ruby-comment">## Working with range bounds</span>
<span class="ruby-identifier">event</span> = <span class="ruby-constant">Event</span>.
  <span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;lower(duration) AS starts_at&quot;</span>).
  <span class="ruby-identifier">select</span>(<span class="ruby-string">&quot;upper(duration) AS ends_at&quot;</span>).<span class="ruby-identifier">first</span>

<span class="ruby-identifier">event</span>.<span class="ruby-identifier">starts_at</span> <span class="ruby-comment"># =&gt; Tue, 11 Feb 2014</span>
<span class="ruby-identifier">event</span>.<span class="ruby-identifier">ends_at</span> <span class="ruby-comment"># =&gt; Thu, 13 Feb 2014</span>
</pre>

<h3 id="label-Composite+Types">Composite Types<span><a href="#label-Composite+Types">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/rowtypes.html">type
definition</a></p>
</li></ul>

<p>Currently there is no special support for composite types. They are mapped
to normal text columns:</p>

<pre>CREATE TYPE full_address AS
(
  city VARCHAR(90),
  street VARCHAR(90)
);</pre>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20140207133952_create_contacts.rb</span>
<span class="ruby-identifier">execute</span> <span class="ruby-value">&lt;&lt;-SQL
 CREATE TYPE full_address AS
 (
   city VARCHAR(90),
   street VARCHAR(90)
 );
SQL</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">contacts</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> :<span class="ruby-identifier">address</span>, :<span class="ruby-identifier">full_address</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/contact.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Contact</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Contact</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">address</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;(Paris,Champs-Élysées)&quot;</span>
<span class="ruby-identifier">contact</span> = <span class="ruby-constant">Contact</span>.<span class="ruby-identifier">first</span>
<span class="ruby-identifier">contact</span>.<span class="ruby-identifier">address</span> <span class="ruby-comment"># =&gt; &quot;(Paris,Champs-Élysées)&quot;</span>
<span class="ruby-identifier">contact</span>.<span class="ruby-identifier">address</span> = <span class="ruby-string">&quot;(Paris,Rue Basse)&quot;</span>
<span class="ruby-identifier">contact</span>.<span class="ruby-identifier">save!</span>
</pre>

<h3 id="label-Enumerated+Types">Enumerated Types<span><a href="#label-Enumerated+Types">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/datatype-enum.html">type
definition</a></p>
</li></ul>

<p>Currently there is no special support for enumerated types. They are mapped
as normal text columns:</p>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131220144913_create_articles.rb</span>
<span class="ruby-identifier">execute</span> <span class="ruby-value">&lt;&lt;-SQL
  CREATE TYPE article_status AS ENUM (&#39;draft&#39;, &#39;published&#39;);
SQL</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">articles</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> :<span class="ruby-identifier">status</span>, :<span class="ruby-identifier">article_status</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/article.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Article</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Article</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;draft&quot;</span>
<span class="ruby-identifier">article</span> = <span class="ruby-constant">Article</span>.<span class="ruby-identifier">first</span>
<span class="ruby-identifier">article</span>.<span class="ruby-identifier">status</span> <span class="ruby-comment"># =&gt; &quot;draft&quot;</span>

<span class="ruby-identifier">article</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&quot;published&quot;</span>
<span class="ruby-identifier">article</span>.<span class="ruby-identifier">save!</span>
</pre>

<h3 id="label-UUID">UUID<span><a href="#label-UUID">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/datatype-uuid.html">type
definition</a></p>
</li><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/uuid-ossp.html">generator
functions</a></p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131220144913_create_revisions.rb</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">revisions</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> :<span class="ruby-identifier">identifier</span>, :<span class="ruby-identifier">uuid</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/revision.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Revision</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Revision</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">identifier</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;A0EEBC99-9C0B-4EF8-BB6D-6BB9BD380A11&quot;</span>

<span class="ruby-identifier">revision</span> = <span class="ruby-constant">Revision</span>.<span class="ruby-identifier">first</span>
<span class="ruby-identifier">revision</span>.<span class="ruby-identifier">identifier</span> <span class="ruby-comment"># =&gt; &quot;a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11&quot;</span>
</pre>

<h3 id="label-Bit+String+Types">Bit String Types<span><a href="#label-Bit+String+Types">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a href="http://www.postgresql.org/docs/9.3/static/datatype-bit.html">type
definition</a></p>
</li><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/functions-bitstring.html">functions
and operators</a></p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131220144913_create_users.rb</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">users</span>, <span class="ruby-identifier">force</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">column</span> :<span class="ruby-identifier">settings</span>, <span class="ruby-string">&quot;bit(8)&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/device.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">User</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">User</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">settings</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;01010011&quot;</span>
<span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">first</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">settings</span> <span class="ruby-comment"># =&gt; &quot;01010011&quot;</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">settings</span> = <span class="ruby-string">&quot;0xAF&quot;</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">settings</span> <span class="ruby-comment"># =&gt; 10101111</span>
<span class="ruby-identifier">user</span>.<span class="ruby-identifier">save!</span>
</pre>

<h3 id="label-Network+Address+Types">Network Address Types<span><a href="#label-Network+Address+Types">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/datatype-net-types.html">type
definition</a></p>
</li></ul>

<p>The types <code>inet</code> and <code>cidr</code> are mapped to Ruby <a
href="http://www.ruby-doc.org/stdlib-2.1.1/libdoc/ipaddr/rdoc/IPAddr.html">IPAddr</a>
objects. The <code>macaddr</code> type is mapped to normal text.</p>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20140508144913_create_devices.rb</span>
<span class="ruby-identifier">create_table</span>(:<span class="ruby-identifier">devices</span>, <span class="ruby-identifier">force</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">inet</span> <span class="ruby-string">&#39;ip&#39;</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">cidr</span> <span class="ruby-string">&#39;network&#39;</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">macaddr</span> <span class="ruby-string">&#39;address&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/device.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Device</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-identifier">macbook</span> = <span class="ruby-constant">Device</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">ip</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;192.168.1.12&quot;</span>,
                        <span class="ruby-identifier">network</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;192.168.2.0/24&quot;</span>,
                        <span class="ruby-identifier">address</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;32:01:16:6d:05:ef&quot;</span>)

<span class="ruby-identifier">macbook</span>.<span class="ruby-identifier">ip</span>
<span class="ruby-comment"># =&gt; #&lt;IPAddr: IPv4:192.168.1.12/255.255.255.255&gt;</span>

<span class="ruby-identifier">macbook</span>.<span class="ruby-identifier">network</span>
<span class="ruby-comment"># =&gt; #&lt;IPAddr: IPv4:192.168.2.0/255.255.255.0&gt;</span>

<span class="ruby-identifier">macbook</span>.<span class="ruby-identifier">address</span>
<span class="ruby-comment"># =&gt; &quot;32:01:16:6d:05:ef&quot;</span>
</pre>

<h3 id="label-Geometric+Types">Geometric Types<span><a href="#label-Geometric+Types">&para;</a> <a href="#top">&uarr;</a></span></h3>
<ul><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/datatype-geometric.html">type
definition</a></p>
</li></ul>

<p>All geometric types, with the exception of <code>points</code> are mapped
to normal text. A point is casted to an array containing <code>x</code> and
<code>y</code> coordinates.</p>

<h2 id="label-UUID+Primary+Keys">UUID Primary Keys<span><a href="#label-UUID+Primary+Keys">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>NOTE: you need to enable the <code>uuid-ossp</code> extension to generate
UUIDs.</p>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131220144913_create_devices.rb</span>
<span class="ruby-identifier">enable_extension</span> <span class="ruby-string">&#39;uuid-ossp&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">extension_enabled?</span>(<span class="ruby-string">&#39;uuid-ossp&#39;</span>)
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">devices</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> :<span class="ruby-identifier">uuid</span>, <span class="ruby-identifier">default</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;uuid_generate_v4()&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> :<span class="ruby-identifier">kind</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># app/models/device.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Device</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-identifier">device</span> = <span class="ruby-constant">Device</span>.<span class="ruby-identifier">create</span>
<span class="ruby-identifier">device</span>.<span class="ruby-identifier">id</span> <span class="ruby-comment"># =&gt; &quot;814865cd-5a1d-4771-9306-4268f188fe9e&quot;</span>
</pre>

<h2 id="label-Full+Text+Search">Full Text Search<span><a href="#label-Full+Text+Search">&para;</a> <a href="#top">&uarr;</a></span></h2>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131220144913_create_documents.rb</span>
<span class="ruby-identifier">create_table</span> :<span class="ruby-identifier">documents</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> <span class="ruby-string">&#39;title&#39;</span>
  <span class="ruby-identifier">t</span>.<span class="ruby-identifier">string</span> <span class="ruby-string">&#39;body&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">execute</span> <span class="ruby-string">&quot;CREATE INDEX documents_idx ON documents USING gin(to_tsvector(&#39;english&#39;, title || &#39; &#39; || body));&quot;</span>

<span class="ruby-comment"># app/models/document.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Document</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-constant">Document</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Cats and Dogs&quot;</span>, <span class="ruby-identifier">body</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;are nice!&quot;</span>)

<span class="ruby-comment">## all documents matching &#39;cat &amp; dog&#39;</span>
<span class="ruby-constant">Document</span>.<span class="ruby-identifier">where</span>(<span class="ruby-string">&quot;to_tsvector(&#39;english&#39;, title || &#39; &#39; || body) @@ to_tsquery(?)&quot;</span>,
                 <span class="ruby-string">&quot;cat &amp; dog&quot;</span>)
</pre>

<h2 id="label-Database+Views">Database Views<span><a href="#label-Database+Views">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p><a
href="http://www.postgresql.org/docs/9.3/static/sql-createview.html">view
creation</a></p>
</li></ul>

<p>Imagine you need to work with a legacy database containing the following
table:</p>

<pre>rails_pg_guide=# \d &quot;TBL_ART&quot;
                                        Table &quot;public.TBL_ART&quot;
   Column   |            Type             |                         Modifiers
------------+-----------------------------+------------------------------------------------------------
 INT_ID     | integer                     | not null default nextval(&#39;&quot;TBL_ART_INT_ID_seq&quot;&#39;::regclass)
 STR_TITLE  | character varying           |
 STR_STAT   | character varying           | default &#39;draft&#39;::character varying
 DT_PUBL_AT | timestamp without time zone |
 BL_ARCH    | boolean                     | default false
Indexes:
    &quot;TBL_ART_pkey&quot; PRIMARY KEY, btree (&quot;INT_ID&quot;)</pre>

<p>This table does not follow the Rails conventions at all. Because simple
PostgreSQL views are updateable by default, we can wrap it as follows:</p>

<pre class="ruby"><span class="ruby-comment"># db/migrate/20131220144913_create_articles_view.rb</span>
<span class="ruby-identifier">execute</span> <span class="ruby-value">&lt;&lt;-SQL
CREATE VIEW articles AS
  SELECT &quot;INT_ID&quot; AS id,
         &quot;STR_TITLE&quot; AS title,
         &quot;STR_STAT&quot; AS status,
         &quot;DT_PUBL_AT&quot; AS published_at,
         &quot;BL_ARCH&quot; AS archived
  FROM &quot;TBL_ART&quot;
  WHERE &quot;BL_ARCH&quot; = &#39;f&#39;
  SQL</span>

<span class="ruby-comment"># app/models/article.rb</span>
<span class="ruby-keyword">class</span> <span class="ruby-constant">Article</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">primary_key</span> = <span class="ruby-string">&quot;id&quot;</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">archive!</span>
    <span class="ruby-identifier">update_attribute</span> :<span class="ruby-identifier">archived</span>, <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># Usage</span>
<span class="ruby-identifier">first</span> = <span class="ruby-constant">Article</span>.<span class="ruby-identifier">create!</span> <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Winter is coming&quot;</span>,
                        <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;published&quot;</span>,
                        <span class="ruby-identifier">published_at</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">year</span>.<span class="ruby-identifier">ago</span>
<span class="ruby-identifier">second</span> = <span class="ruby-constant">Article</span>.<span class="ruby-identifier">create!</span> <span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;Brace yourself&quot;</span>,
                         <span class="ruby-identifier">status</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;draft&quot;</span>,
                         <span class="ruby-identifier">published_at</span><span class="ruby-operator">:</span> <span class="ruby-value">1</span>.<span class="ruby-identifier">month</span>.<span class="ruby-identifier">ago</span>

<span class="ruby-constant">Article</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 1</span>
<span class="ruby-identifier">first</span>.<span class="ruby-identifier">archive!</span>
<span class="ruby-constant">Article</span>.<span class="ruby-identifier">count</span> <span class="ruby-comment"># =&gt; 2</span>
</pre>

<p>NOTE: This application only cares about non-archived <code>Articles</code>.
A view also allows for conditions so we can exclude the archived
<code>Articles</code> directly.</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

