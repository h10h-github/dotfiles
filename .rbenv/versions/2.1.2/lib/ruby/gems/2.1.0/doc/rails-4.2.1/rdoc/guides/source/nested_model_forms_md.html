<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>nested_model_forms - rails-4.2.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Rails+Nested+Model+Forms">Rails Nested Model Forms</a>
    <li><a href="#label-Model+setup">Model setup</a>
    <li><a href="#label-ActiveRecord-3A-3ABase+model">ActiveRecord::Base model</a>
    <li><a href="#label-has_one">has_one</a>
    <li><a href="#label-belongs_to">belongs_to</a>
    <li><a href="#label-has_many+-2F+has_and_belongs_to_many">has_many / has_and_belongs_to_many</a>
    <li><a href="#label-Custom+model">Custom model</a>
    <li><a href="#label-Single+associated+object">Single associated object</a>
    <li><a href="#label-Association+collection">Association collection</a>
    <li><a href="#label-Views">Views</a>
    <li><a href="#label-Controller+code">Controller code</a>
    <li><a href="#label-Form+code">Form code</a>
    <li><a href="#label-Standard+form">Standard form</a>
    <li><a href="#label-Nested+form+for+a+single+associated+object">Nested form for a single associated object</a>
    <li><a href="#label-Nested+form+for+a+collection+of+associated+objects">Nested form for a collection of associated objects</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../guides/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../guides/Rakefile.html">Rakefile</a>
  
    <li><a href="../../guides/assets/images/icons/README.html">README</a>
  
    <li><a href="../../guides/assets/javascripts/guides_js.html">guides.js</a>
  
    <li><a href="../../guides/assets/javascripts/jquery_min_js.html">jquery.min.js</a>
  
    <li><a href="../../guides/assets/javascripts/responsive-tables_js.html">responsive-tables.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAS3_js.html">shBrushAS3.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAppleScript_js.html">shBrushAppleScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushBash_js.html">shBrushBash.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCSharp_js.html">shBrushCSharp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushColdFusion_js.html">shBrushColdFusion.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCpp_js.html">shBrushCpp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCss_js.html">shBrushCss.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDelphi_js.html">shBrushDelphi.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDiff_js.html">shBrushDiff.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushErlang_js.html">shBrushErlang.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushGroovy_js.html">shBrushGroovy.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJScript_js.html">shBrushJScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJava_js.html">shBrushJava.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJavaFX_js.html">shBrushJavaFX.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPerl_js.html">shBrushPerl.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPhp_js.html">shBrushPhp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPlain_js.html">shBrushPlain.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPowerShell_js.html">shBrushPowerShell.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPython_js.html">shBrushPython.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushRuby_js.html">shBrushRuby.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSass_js.html">shBrushSass.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushScala_js.html">shBrushScala.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSql_js.html">shBrushSql.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushVb_js.html">shBrushVb.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushXml_js.html">shBrushXml.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shCore_js.html">shCore.js</a>
  
    <li><a href="../../guides/assets/stylesheets/fixes_css.html">fixes.css</a>
  
    <li><a href="../../guides/assets/stylesheets/kindle_css.html">kindle.css</a>
  
    <li><a href="../../guides/assets/stylesheets/main_css.html">main.css</a>
  
    <li><a href="../../guides/assets/stylesheets/print_css.html">print.css</a>
  
    <li><a href="../../guides/assets/stylesheets/reset_css.html">reset.css</a>
  
    <li><a href="../../guides/assets/stylesheets/responsive-tables_css.html">responsive-tables.css</a>
  
    <li><a href="../../guides/assets/stylesheets/style_css.html">style.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCore_css.html">shCore.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDefault_css.html">shCoreDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDjango_css.html">shCoreDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEclipse_css.html">shCoreEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEmacs_css.html">shCoreEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreFadeToGrey_css.html">shCoreFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMDUltra_css.html">shCoreMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMidnight_css.html">shCoreMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreRDark_css.html">shCoreRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDefault_css.html">shThemeDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDjango_css.html">shThemeDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEclipse_css.html">shThemeEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEmacs_css.html">shThemeEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeFadeToGrey_css.html">shThemeFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMDUltra_css.html">shThemeMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMidnight_css.html">shThemeMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRDark_css.html">shThemeRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRailsGuides_css.html">shThemeRailsGuides.css</a>
  
    <li><a href="../../guides/source/2_2_release_notes_md.html">2_2_release_notes</a>
  
    <li><a href="../../guides/source/2_3_release_notes_md.html">2_3_release_notes</a>
  
    <li><a href="../../guides/source/3_0_release_notes_md.html">3_0_release_notes</a>
  
    <li><a href="../../guides/source/3_1_release_notes_md.html">3_1_release_notes</a>
  
    <li><a href="../../guides/source/3_2_release_notes_md.html">3_2_release_notes</a>
  
    <li><a href="../../guides/source/4_0_release_notes_md.html">4_0_release_notes</a>
  
    <li><a href="../../guides/source/4_1_release_notes_md.html">4_1_release_notes</a>
  
    <li><a href="../../guides/source/4_2_release_notes_md.html">4_2_release_notes</a>
  
    <li><a href="../../guides/source/action_controller_overview_md.html">action_controller_overview</a>
  
    <li><a href="../../guides/source/action_mailer_basics_md.html">action_mailer_basics</a>
  
    <li><a href="../../guides/source/action_view_overview_md.html">action_view_overview</a>
  
    <li><a href="../../guides/source/active_job_basics_md.html">active_job_basics</a>
  
    <li><a href="../../guides/source/active_model_basics_md.html">active_model_basics</a>
  
    <li><a href="../../guides/source/active_record_basics_md.html">active_record_basics</a>
  
    <li><a href="../../guides/source/active_record_callbacks_md.html">active_record_callbacks</a>
  
    <li><a href="../../guides/source/active_record_migrations_md.html">active_record_migrations</a>
  
    <li><a href="../../guides/source/active_record_postgresql_md.html">active_record_postgresql</a>
  
    <li><a href="../../guides/source/active_record_querying_md.html">active_record_querying</a>
  
    <li><a href="../../guides/source/active_record_validations_md.html">active_record_validations</a>
  
    <li><a href="../../guides/source/active_support_core_extensions_md.html">active_support_core_extensions</a>
  
    <li><a href="../../guides/source/active_support_instrumentation_md.html">active_support_instrumentation</a>
  
    <li><a href="../../guides/source/api_documentation_guidelines_md.html">api_documentation_guidelines</a>
  
    <li><a href="../../guides/source/asset_pipeline_md.html">asset_pipeline</a>
  
    <li><a href="../../guides/source/association_basics_md.html">association_basics</a>
  
    <li><a href="../../guides/source/autoloading_and_reloading_constants_md.html">autoloading_and_reloading_constants</a>
  
    <li><a href="../../guides/source/caching_with_rails_md.html">caching_with_rails</a>
  
    <li><a href="../../guides/source/command_line_md.html">command_line</a>
  
    <li><a href="../../guides/source/configuring_md.html">configuring</a>
  
    <li><a href="../../guides/source/contributing_to_ruby_on_rails_md.html">contributing_to_ruby_on_rails</a>
  
    <li><a href="../../guides/source/debugging_rails_applications_md.html">debugging_rails_applications</a>
  
    <li><a href="../../guides/source/development_dependencies_install_md.html">development_dependencies_install</a>
  
    <li><a href="../../guides/source/documents_yaml.html">documents.yaml</a>
  
    <li><a href="../../guides/source/engines_md.html">engines</a>
  
    <li><a href="../../guides/source/form_helpers_md.html">form_helpers</a>
  
    <li><a href="../../guides/source/generators_md.html">generators</a>
  
    <li><a href="../../guides/source/getting_started_md.html">getting_started</a>
  
    <li><a href="../../guides/source/i18n_md.html">i18n</a>
  
    <li><a href="../../guides/source/initialization_md.html">initialization</a>
  
    <li><a href="../../guides/source/layouts_and_rendering_md.html">layouts_and_rendering</a>
  
    <li><a href="../../guides/source/maintenance_policy_md.html">maintenance_policy</a>
  
    <li><a href="../../guides/source/nested_model_forms_md.html">nested_model_forms</a>
  
    <li><a href="../../guides/source/plugins_md.html">plugins</a>
  
    <li><a href="../../guides/source/rails_application_templates_md.html">rails_application_templates</a>
  
    <li><a href="../../guides/source/rails_on_rack_md.html">rails_on_rack</a>
  
    <li><a href="../../guides/source/routing_md.html">routing</a>
  
    <li><a href="../../guides/source/ruby_on_rails_guides_guidelines_md.html">ruby_on_rails_guides_guidelines</a>
  
    <li><a href="../../guides/source/security_md.html">security</a>
  
    <li><a href="../../guides/source/testing_md.html">testing</a>
  
    <li><a href="../../guides/source/upgrading_ruby_on_rails_md.html">upgrading_ruby_on_rails</a>
  
    <li><a href="../../guides/source/working_with_javascript_in_rails_md.html">working_with_javascript_in_rails</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page guides/source/nested_model_forms.md">

<h1 id="label-Rails+Nested+Model+Forms">Rails Nested Model Forms<span><a href="#label-Rails+Nested+Model+Forms">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>Creating a form for a model <em>and</em> its associations can become quite
tedious. Therefore Rails provides helpers to assist in dealing with the
complexities of generating these forms <em>and</em> the required CRUD
operations to create, update, and destroy associations.</p>

<p>After reading this guide, you will know:</p>
<ul><li>
<p>do stuff.</p>
</li></ul>
<hr>

<p>NOTE: This guide assumes the user knows how to use the <a
href="form_helpers.html">Rails form helpers</a> in general. Also, it&#39;s
<strong>not</strong> an API reference. For a complete reference please
visit <a href="http://api.rubyonrails.org/">the Rails API
documentation</a>.</p>

<h2 id="label-Model+setup">Model setup<span><a href="#label-Model+setup">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>To be able to use the nested model functionality in your forms, the model
will need to support some basic operations.</p>

<p>First of all, it needs to define a writer method for the attribute that
corresponds to the association you are building a nested model form for.
The <code>fields_for</code> form helper will look for this method to decide
whether or not a nested model form should be built.</p>

<p>If the associated object is an array, a form builder will be yielded for
each object, else only a single form builder will be yielded.</p>

<p>Consider a Person model with an associated Address. When asked to yield a
nested FormBuilder for the <code>:address</code> attribute, the
<code>fields_for</code> form helper will look for a method on the Person
instance named <code>address_attributes=</code>.</p>

<h3 id="label-ActiveRecord-3A-3ABase+model">ActiveRecord::Base model<span><a href="#label-ActiveRecord-3A-3ABase+model">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For an ActiveRecord::Base model and association this writer method is
commonly defined with the <code>accepts_nested_attributes_for</code> class
method:</p>

<h4 id="label-has_one">has_one<span><a href="#label-has_one">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Person</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">has_one</span> :<span class="ruby-identifier">address</span>
  <span class="ruby-identifier">accepts_nested_attributes_for</span> :<span class="ruby-identifier">address</span>
<span class="ruby-keyword">end</span>
</pre>

<h4 id="label-belongs_to">belongs_to<span><a href="#label-belongs_to">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Person</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">belongs_to</span> :<span class="ruby-identifier">firm</span>
  <span class="ruby-identifier">accepts_nested_attributes_for</span> :<span class="ruby-identifier">firm</span>
<span class="ruby-keyword">end</span>
</pre>

<h4 id="label-has_many+-2F+has_and_belongs_to_many">has_many / has_and_belongs_to_many<span><a href="#label-has_many+-2F+has_and_belongs_to_many">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Person</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">has_many</span> :<span class="ruby-identifier">projects</span>
  <span class="ruby-identifier">accepts_nested_attributes_for</span> :<span class="ruby-identifier">projects</span>
<span class="ruby-keyword">end</span>
</pre>

<p>NOTE: For greater detail on associations see <a
href="association_basics.html">Active Record Associations</a>. For a
complete reference on associations please visit the API documentation for
<a
href="http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html">ActiveRecord::Associations::ClassMethods</a>.</p>

<h3 id="label-Custom+model">Custom model<span><a href="#label-Custom+model">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>As you might have inflected from this explanation, you <em>don&#39;t</em>
necessarily need an ActiveRecord::Base model to use this functionality. The
following examples are sufficient to enable the nested model form behavior:</p>

<h4 id="label-Single+associated+object">Single associated object<span><a href="#label-Single+associated+object">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Person</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">address</span>
    <span class="ruby-constant">Address</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">address_attributes=</span>(<span class="ruby-identifier">attributes</span>)
    <span class="ruby-comment"># ...</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h4 id="label-Association+collection">Association collection<span><a href="#label-Association+collection">&para;</a> <a href="#top">&uarr;</a></span></h4>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Person</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">projects</span>
    [<span class="ruby-constant">Project</span>.<span class="ruby-identifier">new</span>, <span class="ruby-constant">Project</span>.<span class="ruby-identifier">new</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">projects_attributes=</span>(<span class="ruby-identifier">attributes</span>)
    <span class="ruby-comment"># ...</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>NOTE: See (TODO) in the advanced section for more information on how to
deal with the CRUD operations in your custom model.</p>

<h2 id="label-Views">Views<span><a href="#label-Views">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="label-Controller+code">Controller code<span><a href="#label-Controller+code">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>A nested model form will <em>only</em> be built if the associated object(s)
exist. This means that for a new model instance you would probably want to
build the associated object(s) first.</p>

<p>Consider the following typical RESTful controller which will prepare a new
Person instance and its <code>address</code> and <code>projects</code>
associations before rendering the <code>new</code> template:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">PeopleController</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ApplicationController</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>
    <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">built_address</span>
    <span class="ruby-value">2</span>.<span class="ruby-identifier">times</span> { <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">projects</span>.<span class="ruby-identifier">build</span> }
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">create</span>
    <span class="ruby-ivar">@person</span> = <span class="ruby-constant">Person</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[:<span class="ruby-identifier">person</span>])
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@person</span>.<span class="ruby-identifier">save</span>
      <span class="ruby-comment"># ...</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>NOTE: Obviously the instantiation of the associated object(s) can become
tedious and not DRY, so you might want to move that into the model itself.
ActiveRecord::Base provides an <code>after_initialize</code> callback which
is a good way to refactor this.</p>

<h3 id="label-Form+code">Form code<span><a href="#label-Form+code">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Now that you have a model instance, with the appropriate methods and
associated object(s), you can start building the nested model form.</p>

<h4 id="label-Standard+form">Standard form<span><a href="#label-Standard+form">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Start out with a regular RESTful form:</p>

<pre>&lt;%= form_for @person do |f| %&gt;
  &lt;%= f.text_field :name %&gt;
&lt;% end %&gt;</pre>

<p>This will generate the following html:</p>

<pre>&lt;form action=&quot;/people&quot; class=&quot;new_person&quot; id=&quot;new_person&quot; method=&quot;post&quot;&gt;
  &lt;input id=&quot;person_name&quot; name=&quot;person[name]&quot; type=&quot;text&quot; /&gt;
&lt;/form&gt;</pre>

<h4 id="label-Nested+form+for+a+single+associated+object">Nested form for a single associated object<span><a href="#label-Nested+form+for+a+single+associated+object">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Now add a nested form for the <code>address</code> association:</p>

<pre>&lt;%= form_for @person do |f| %&gt;
  &lt;%= f.text_field :name %&gt;

  &lt;%= f.fields_for :address do |af| %&gt;
    &lt;%= af.text_field :street %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;</pre>

<p>This generates:</p>

<pre>&lt;form action=&quot;/people&quot; class=&quot;new_person&quot; id=&quot;new_person&quot; method=&quot;post&quot;&gt;
  &lt;input id=&quot;person_name&quot; name=&quot;person[name]&quot; type=&quot;text&quot; /&gt;

  &lt;input id=&quot;person_address_attributes_street&quot; name=&quot;person[address_attributes][street]&quot; type=&quot;text&quot; /&gt;
&lt;/form&gt;</pre>

<p>Notice that <code>fields_for</code> recognized the <code>address</code> as
an association for which a nested model form should be built by the way it
has namespaced the <code>name</code> attribute.</p>

<p>When this form is posted the Rails parameter parser will construct a hash
like the following:</p>

<pre class="ruby">{
  <span class="ruby-string">&quot;person&quot;</span> =<span class="ruby-operator">&gt;</span> {
    <span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Eloy Duran&quot;</span>,
    <span class="ruby-string">&quot;address_attributes&quot;</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;street&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Nieuwe Prinsengracht&quot;</span>
    }
  }
}
</pre>

<p>That&#39;s it. The controller will simply pass this hash on to the model
from the <code>create</code> action. The model will then handle building
the <code>address</code> association for you and automatically save it when
the parent (<code>person</code>) is saved.</p>

<h4 id="label-Nested+form+for+a+collection+of+associated+objects">Nested form for a collection of associated objects<span><a href="#label-Nested+form+for+a+collection+of+associated+objects">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>The form code for an association collection is pretty similar to that of a
single associated object:</p>

<pre>&lt;%= form_for @person do |f| %&gt;
  &lt;%= f.text_field :name %&gt;

  &lt;%= f.fields_for :projects do |pf| %&gt;
    &lt;%= pf.text_field :name %&gt;
  &lt;% end %&gt;
&lt;% end %&gt;</pre>

<p>Which generates:</p>

<pre>&lt;form action=&quot;/people&quot; class=&quot;new_person&quot; id=&quot;new_person&quot; method=&quot;post&quot;&gt;
  &lt;input id=&quot;person_name&quot; name=&quot;person[name]&quot; type=&quot;text&quot; /&gt;

  &lt;input id=&quot;person_projects_attributes_0_name&quot; name=&quot;person[projects_attributes][0][name]&quot; type=&quot;text&quot; /&gt;
  &lt;input id=&quot;person_projects_attributes_1_name&quot; name=&quot;person[projects_attributes][1][name]&quot; type=&quot;text&quot; /&gt;
&lt;/form&gt;</pre>

<p>As you can see it has generated 2 <code>project name</code> inputs, one for
each new <code>project</code> that was built in the controller&#39;s
<code>new</code> action. Only this time the <code>name</code> attribute of
the input contains a digit as an extra namespace. This will be parsed by
the Rails parameter parser as:</p>

<pre class="ruby">{
  <span class="ruby-string">&quot;person&quot;</span> =<span class="ruby-operator">&gt;</span> {
    <span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Eloy Duran&quot;</span>,
    <span class="ruby-string">&quot;projects_attributes&quot;</span> =<span class="ruby-operator">&gt;</span> {
      <span class="ruby-string">&quot;0&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Project 1&quot;</span> },
      <span class="ruby-string">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-string">&quot;name&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Project 2&quot;</span> }
    }
  }
}
</pre>

<p>You can basically see the <code>projects_attributes</code> hash as an array
of attribute hashes, one for each model instance.</p>

<p>NOTE: The reason that <code>fields_for</code> constructed a hash instead of
an array is that it won&#39;t work for any form nested deeper than one
level deep.</p>

<p>TIP: You <em>can</em> however pass an array to the writer method generated
by <code>accepts_nested_attributes_for</code> if you&#39;re using plain
Ruby or some other API access. See (TODO) for more info and example.</p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

