<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>testing - rails-4.2.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-A+Guide+to+Testing+Rails+Applications">A Guide to Testing Rails Applications</a>
    <li><a href="#label-Why+Write+Tests+for+your+Rails+Applications-3F">Why Write Tests for your Rails Applications?</a>
    <li><a href="#label-Introduction+to+Testing">Introduction to Testing</a>
    <li><a href="#label-The+Test+Environment">The Test Environment</a>
    <li><a href="#label-Rails+Sets+up+for+Testing+from+the+Word+Go">Rails Sets up for Testing from the Word Go</a>
    <li><a href="#label-The+Low-Down+on+Fixtures">The Low-Down on Fixtures</a>
    <li><a href="#label-What+Are+Fixtures-3F">What Are Fixtures?</a>
    <li><a href="#label-YAML">YAML</a>
    <li><a href="#label-ERB-27in+It+Up">ERB&#39;in It Up</a>
    <li><a href="#label-Fixtures+in+Action">Fixtures in Action</a>
    <li><a href="#label-Fixtures+are+Active+Record+objects">Fixtures are Active Record objects</a>
    <li><a href="#label-Unit+Testing+your+Models">Unit Testing your Models</a>
    <li><a href="#label-Maintaining+the+test+database+schema">Maintaining the test database schema</a>
    <li><a href="#label-Running+Tests">Running Tests</a>
    <li><a href="#label-What+to+Include+in+Your+Unit+Tests">What to Include in Your Unit Tests</a>
    <li><a href="#label-Available+Assertions">Available Assertions</a>
    <li><a href="#label-Rails+Specific+Assertions">Rails Specific Assertions</a>
    <li><a href="#label-Functional+Tests+for+Your+Controllers">Functional Tests for Your Controllers</a>
    <li><a href="#label-What+to+Include+in+your+Functional+Tests">What to Include in your Functional Tests</a>
    <li><a href="#label-Available+Request+Types+for+Functional+Tests">Available Request Types for Functional Tests</a>
    <li><a href="#label-The+Four+Hashes+of+the+Apocalypse">The Four Hashes of the Apocalypse</a>
    <li><a href="#label-Instance+Variables+Available">Instance Variables Available</a>
    <li><a href="#label-Setting+Headers+and+CGI+variables">Setting Headers and CGI variables</a>
    <li><a href="#label-Testing+Templates+and+Layouts">Testing Templates and Layouts</a>
    <li><a href="#label-A+Fuller+Functional+Test+Example">A Fuller Functional Test Example</a>
    <li><a href="#label-Testing+Views">Testing Views</a>
    <li><a href="#label-Additional+View-Based+Assertions">Additional View-Based Assertions</a>
    <li><a href="#label-Integration+Testing">Integration Testing</a>
    <li><a href="#label-Helpers+Available+for+Integration+Tests">Helpers Available for Integration Tests</a>
    <li><a href="#label-Integration+Testing+Examples">Integration Testing Examples</a>
    <li><a href="#label-Rake+Tasks+for+Running+your+Tests">Rake Tasks for Running your Tests</a>
    <li><a href="#label-A+Brief+Note+About+Minitest">A Brief Note About Minitest</a>
    <li><a href="#label-Setup+and+Teardown">Setup and Teardown</a>
    <li><a href="#label-Testing+Routes">Testing Routes</a>
    <li><a href="#label-Testing+Your+Mailers">Testing Your Mailers</a>
    <li><a href="#label-Keeping+the+Postman+in+Check">Keeping the Postman in Check</a>
    <li><a href="#label-From+All+Sides">From All Sides</a>
    <li><a href="#label-Unit+Testing">Unit Testing</a>
    <li><a href="#label-Revenge+of+the+Fixtures">Revenge of the Fixtures</a>
    <li><a href="#label-The+Basic+Test+Case">The Basic Test Case</a>
    <li><a href="#label-Functional+Testing">Functional Testing</a>
    <li><a href="#label-Testing+helpers">Testing helpers</a>
    <li><a href="#label-Testing+Jobs">Testing Jobs</a>
    <li><a href="#label-A+Basic+Test+Case">A Basic Test Case</a>
    <li><a href="#label-Custom+Assertions+And+Testing+Jobs+Inside+Other+Components">Custom Assertions And Testing Jobs Inside Other Components</a>
    <li><a href="#label-Other+Testing+Approaches">Other Testing Approaches</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="../../README_md.html">README</a>
  
    <li><a href="../../guides/CHANGELOG_md.html">CHANGELOG</a>
  
    <li><a href="../../guides/Rakefile.html">Rakefile</a>
  
    <li><a href="../../guides/assets/images/icons/README.html">README</a>
  
    <li><a href="../../guides/assets/javascripts/guides_js.html">guides.js</a>
  
    <li><a href="../../guides/assets/javascripts/jquery_min_js.html">jquery.min.js</a>
  
    <li><a href="../../guides/assets/javascripts/responsive-tables_js.html">responsive-tables.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAS3_js.html">shBrushAS3.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushAppleScript_js.html">shBrushAppleScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushBash_js.html">shBrushBash.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCSharp_js.html">shBrushCSharp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushColdFusion_js.html">shBrushColdFusion.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCpp_js.html">shBrushCpp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushCss_js.html">shBrushCss.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDelphi_js.html">shBrushDelphi.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushDiff_js.html">shBrushDiff.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushErlang_js.html">shBrushErlang.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushGroovy_js.html">shBrushGroovy.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJScript_js.html">shBrushJScript.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJava_js.html">shBrushJava.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushJavaFX_js.html">shBrushJavaFX.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPerl_js.html">shBrushPerl.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPhp_js.html">shBrushPhp.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPlain_js.html">shBrushPlain.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPowerShell_js.html">shBrushPowerShell.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushPython_js.html">shBrushPython.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushRuby_js.html">shBrushRuby.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSass_js.html">shBrushSass.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushScala_js.html">shBrushScala.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushSql_js.html">shBrushSql.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushVb_js.html">shBrushVb.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shBrushXml_js.html">shBrushXml.js</a>
  
    <li><a href="../../guides/assets/javascripts/syntaxhighlighter/shCore_js.html">shCore.js</a>
  
    <li><a href="../../guides/assets/stylesheets/fixes_css.html">fixes.css</a>
  
    <li><a href="../../guides/assets/stylesheets/kindle_css.html">kindle.css</a>
  
    <li><a href="../../guides/assets/stylesheets/main_css.html">main.css</a>
  
    <li><a href="../../guides/assets/stylesheets/print_css.html">print.css</a>
  
    <li><a href="../../guides/assets/stylesheets/reset_css.html">reset.css</a>
  
    <li><a href="../../guides/assets/stylesheets/responsive-tables_css.html">responsive-tables.css</a>
  
    <li><a href="../../guides/assets/stylesheets/style_css.html">style.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCore_css.html">shCore.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDefault_css.html">shCoreDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreDjango_css.html">shCoreDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEclipse_css.html">shCoreEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreEmacs_css.html">shCoreEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreFadeToGrey_css.html">shCoreFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMDUltra_css.html">shCoreMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreMidnight_css.html">shCoreMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shCoreRDark_css.html">shCoreRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDefault_css.html">shThemeDefault.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeDjango_css.html">shThemeDjango.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEclipse_css.html">shThemeEclipse.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeEmacs_css.html">shThemeEmacs.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeFadeToGrey_css.html">shThemeFadeToGrey.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMDUltra_css.html">shThemeMDUltra.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeMidnight_css.html">shThemeMidnight.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRDark_css.html">shThemeRDark.css</a>
  
    <li><a href="../../guides/assets/stylesheets/syntaxhighlighter/shThemeRailsGuides_css.html">shThemeRailsGuides.css</a>
  
    <li><a href="../../guides/source/2_2_release_notes_md.html">2_2_release_notes</a>
  
    <li><a href="../../guides/source/2_3_release_notes_md.html">2_3_release_notes</a>
  
    <li><a href="../../guides/source/3_0_release_notes_md.html">3_0_release_notes</a>
  
    <li><a href="../../guides/source/3_1_release_notes_md.html">3_1_release_notes</a>
  
    <li><a href="../../guides/source/3_2_release_notes_md.html">3_2_release_notes</a>
  
    <li><a href="../../guides/source/4_0_release_notes_md.html">4_0_release_notes</a>
  
    <li><a href="../../guides/source/4_1_release_notes_md.html">4_1_release_notes</a>
  
    <li><a href="../../guides/source/4_2_release_notes_md.html">4_2_release_notes</a>
  
    <li><a href="../../guides/source/action_controller_overview_md.html">action_controller_overview</a>
  
    <li><a href="../../guides/source/action_mailer_basics_md.html">action_mailer_basics</a>
  
    <li><a href="../../guides/source/action_view_overview_md.html">action_view_overview</a>
  
    <li><a href="../../guides/source/active_job_basics_md.html">active_job_basics</a>
  
    <li><a href="../../guides/source/active_model_basics_md.html">active_model_basics</a>
  
    <li><a href="../../guides/source/active_record_basics_md.html">active_record_basics</a>
  
    <li><a href="../../guides/source/active_record_callbacks_md.html">active_record_callbacks</a>
  
    <li><a href="../../guides/source/active_record_migrations_md.html">active_record_migrations</a>
  
    <li><a href="../../guides/source/active_record_postgresql_md.html">active_record_postgresql</a>
  
    <li><a href="../../guides/source/active_record_querying_md.html">active_record_querying</a>
  
    <li><a href="../../guides/source/active_record_validations_md.html">active_record_validations</a>
  
    <li><a href="../../guides/source/active_support_core_extensions_md.html">active_support_core_extensions</a>
  
    <li><a href="../../guides/source/active_support_instrumentation_md.html">active_support_instrumentation</a>
  
    <li><a href="../../guides/source/api_documentation_guidelines_md.html">api_documentation_guidelines</a>
  
    <li><a href="../../guides/source/asset_pipeline_md.html">asset_pipeline</a>
  
    <li><a href="../../guides/source/association_basics_md.html">association_basics</a>
  
    <li><a href="../../guides/source/autoloading_and_reloading_constants_md.html">autoloading_and_reloading_constants</a>
  
    <li><a href="../../guides/source/caching_with_rails_md.html">caching_with_rails</a>
  
    <li><a href="../../guides/source/command_line_md.html">command_line</a>
  
    <li><a href="../../guides/source/configuring_md.html">configuring</a>
  
    <li><a href="../../guides/source/contributing_to_ruby_on_rails_md.html">contributing_to_ruby_on_rails</a>
  
    <li><a href="../../guides/source/debugging_rails_applications_md.html">debugging_rails_applications</a>
  
    <li><a href="../../guides/source/development_dependencies_install_md.html">development_dependencies_install</a>
  
    <li><a href="../../guides/source/documents_yaml.html">documents.yaml</a>
  
    <li><a href="../../guides/source/engines_md.html">engines</a>
  
    <li><a href="../../guides/source/form_helpers_md.html">form_helpers</a>
  
    <li><a href="../../guides/source/generators_md.html">generators</a>
  
    <li><a href="../../guides/source/getting_started_md.html">getting_started</a>
  
    <li><a href="../../guides/source/i18n_md.html">i18n</a>
  
    <li><a href="../../guides/source/initialization_md.html">initialization</a>
  
    <li><a href="../../guides/source/layouts_and_rendering_md.html">layouts_and_rendering</a>
  
    <li><a href="../../guides/source/maintenance_policy_md.html">maintenance_policy</a>
  
    <li><a href="../../guides/source/nested_model_forms_md.html">nested_model_forms</a>
  
    <li><a href="../../guides/source/plugins_md.html">plugins</a>
  
    <li><a href="../../guides/source/rails_application_templates_md.html">rails_application_templates</a>
  
    <li><a href="../../guides/source/rails_on_rack_md.html">rails_on_rack</a>
  
    <li><a href="../../guides/source/routing_md.html">routing</a>
  
    <li><a href="../../guides/source/ruby_on_rails_guides_guidelines_md.html">ruby_on_rails_guides_guidelines</a>
  
    <li><a href="../../guides/source/security_md.html">security</a>
  
    <li><a href="../../guides/source/testing_md.html">testing</a>
  
    <li><a href="../../guides/source/upgrading_ruby_on_rails_md.html">upgrading_ruby_on_rails</a>
  
    <li><a href="../../guides/source/working_with_javascript_in_rails_md.html">working_with_javascript_in_rails</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page guides/source/testing.md">

<h1 id="label-A+Guide+to+Testing+Rails+Applications">A Guide to Testing Rails Applications<span><a href="#label-A+Guide+to+Testing+Rails+Applications">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>This guide covers built-in mechanisms in Rails for testing your
application.</p>

<p>After reading this guide, you will know:</p>
<ul><li>
<p>Rails testing terminology.</p>
</li><li>
<p>How to write unit, functional, and integration tests for your application.</p>
</li><li>
<p>Other popular testing approaches and plugins.</p>
</li></ul>
<hr>

<h2 id="label-Why+Write+Tests+for+your+Rails+Applications-3F">Why Write Tests for your Rails Applications?<span><a href="#label-Why+Write+Tests+for+your+Rails+Applications-3F">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Rails makes it super easy to write your tests. It starts by producing
skeleton test code while you are creating your models and controllers.</p>

<p>By simply running your Rails tests you can ensure your code adheres to the
desired functionality even after some major code refactoring.</p>

<p>Rails tests can also simulate browser requests and thus you can test your
application&#39;s response without having to test it through your browser.</p>

<h2 id="label-Introduction+to+Testing">Introduction to Testing<span><a href="#label-Introduction+to+Testing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Testing support was woven into the Rails fabric from the beginning. It
wasn&#39;t an “oh! let&#39;s bolt on support for running tests because
they&#39;re new and cool” epiphany. Just about every Rails application
interacts heavily with a database and, as a result, your tests will need a
database to interact with as well. To write efficient tests, you&#39;ll
need to understand how to set up this database and populate it with sample
data.</p>

<h3 id="label-The+Test+Environment">The Test Environment<span><a href="#label-The+Test+Environment">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>By default, every Rails application has three environments: development,
test, and production. The database for each one of them is configured in
<code>config/database.yml</code>.</p>

<p>A dedicated test database allows you to set up and interact with test data
in isolation. Tests can mangle test data with confidence, that won&#39;t
touch the data in the development or production databases.</p>

<h3 id="label-Rails+Sets+up+for+Testing+from+the+Word+Go">Rails Sets up for Testing from the Word Go<span><a href="#label-Rails+Sets+up+for+Testing+from+the+Word+Go">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Rails creates a <code>test</code> folder for you as soon as you create a
Rails project using <code>rails new</code> <em>application_name</em>. If
you list the contents of this folder then you shall see:</p>

<pre>$ ls -F test
controllers/    helpers/        mailers/        test_helper.rb
fixtures/       integration/    models/</pre>

<p>The <code>models</code> directory is meant to hold tests for your models,
the <code>controllers</code> directory is meant to hold tests for your
controllers and the <code>integration</code> directory is meant to hold
tests that involve any number of controllers interacting.</p>

<p>Fixtures are a way of organizing test data; they reside in the
<code>fixtures</code> folder.</p>

<p>The <code>test_helper.rb</code> file holds the default configuration for
your tests.</p>

<h3 id="label-The+Low-Down+on+Fixtures">The Low-Down on Fixtures<span><a href="#label-The+Low-Down+on+Fixtures">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>For good tests, you&#39;ll need to give some thought to setting up test
data. In Rails, you can handle this by defining and customizing fixtures.
You can find comprehensive documentation in the <a
href="http://api.rubyonrails.org/classes/ActiveRecord/FixtureSet.html">fixture
api documentation</a>.</p>

<h4 id="label-What+Are+Fixtures-3F">What Are Fixtures?<span><a href="#label-What+Are+Fixtures-3F">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p><em>Fixtures</em> is a fancy word for sample data. Fixtures allow you to
populate your testing database with predefined data before your tests run.
Fixtures are database independent written in YAML. There is one file per
model.</p>

<p>You&#39;ll find fixtures under your <code>test/fixtures</code> directory.
When you run <code>rails generate model</code> to create a new model
fixture stubs will be automatically created and placed in this directory.</p>

<h4 id="label-YAML">YAML<span><a href="#label-YAML">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>YAML-formatted fixtures are a very human-friendly way to describe your
sample data. These types of fixtures have the <strong>.yml</strong> file
extension (as in <code>users.yml</code>).</p>

<p>Here&#39;s a sample YAML fixture file:</p>

<pre># lo &amp; behold! I am a YAML comment!
david:
  name: David Heinemeier Hansson
  birthday: 1979-10-15
  profession: Systems development

steve:
  name: Steve Ross Kellock
  birthday: 1974-09-27
  profession: guy with keyboard</pre>

<p>Each fixture is given a name followed by an indented list of
colon-separated key/value pairs. Records are typically separated by a blank
space. You can place comments in a fixture file by using the # character in
the first column. Keys which resemble YAML keywords such as &#39;yes&#39;
and &#39;no&#39; are quoted so that the YAML Parser correctly interprets
them.</p>

<p>If you are working with <a
href="/association_basics.html">associations</a>, you can simply define a
reference node between two different fixtures. Here&#39;s an example with a
<code>belongs_to</code>/<code>has_many</code> association:</p>

<pre># In fixtures/categories.yml
about:
  name: About

# In fixtures/articles.yml
one:
  title: Welcome to Rails!
  body: Hello world!
  category: about</pre>

<p>Note: For associations to reference one another by name, you cannot specify
the <code>id:</code>  attribute on the fixtures. Rails will auto assign a
primary key to be consistent between  runs. If you manually specify an
<code>id:</code> attribute, this behavior will not work. For more 
information on this association behavior please read the  <a
href="http://api.rubyonrails.org/classes/ActiveRecord/FixtureSet.html">fixture
api documentation</a>.</p>

<h4 id="label-ERB-27in+It+Up">ERB&#39;in It Up<span><a href="#label-ERB-27in+It+Up">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>ERB allows you to embed Ruby code within templates. The YAML fixture format
is pre-processed with ERB when Rails loads fixtures. This allows you to use
Ruby to help you generate some sample data. For example, the following code
generates a thousand users:</p>

<pre>&lt;% 1000.times do |n| %&gt;
user_&lt;%= n %&gt;:
  username: &lt;%= &quot;user#{n}&quot; %&gt;
  email: &lt;%= &quot;user#{n}@example.com&quot; %&gt;
&lt;% end %&gt;</pre>

<h4 id="label-Fixtures+in+Action">Fixtures in Action<span><a href="#label-Fixtures+in+Action">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Rails by default automatically loads all fixtures from the
<code>test/fixtures</code> folder for your models and controllers test.
Loading involves three steps:</p>
<ul><li>
<p>Remove any existing data from the table corresponding to the fixture</p>
</li><li>
<p>Load the fixture data into the table</p>
</li><li>
<p>Dump the fixture data into a variable in case you want to access it
directly</p>
</li></ul>

<h4 id="label-Fixtures+are+Active+Record+objects">Fixtures are Active Record objects<span><a href="#label-Fixtures+are+Active+Record+objects">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Fixtures are instances of Active Record. As mentioned in point #3 above,
you can access the object directly because it is automatically setup as a
local variable of the test case. For example:</p>

<pre class="ruby"><span class="ruby-comment"># this will return the User object for the fixture named david</span>
<span class="ruby-identifier">users</span>(:<span class="ruby-identifier">david</span>)

<span class="ruby-comment"># this will return the property for david called id</span>
<span class="ruby-identifier">users</span>(:<span class="ruby-identifier">david</span>).<span class="ruby-identifier">id</span>

<span class="ruby-comment"># one can also access methods available on the User class</span>
<span class="ruby-identifier">email</span>(<span class="ruby-identifier">david</span>.<span class="ruby-identifier">girlfriend</span>.<span class="ruby-identifier">email</span>, <span class="ruby-identifier">david</span>.<span class="ruby-identifier">location_tonight</span>)
</pre>

<h2 id="label-Unit+Testing+your+Models">Unit Testing your Models<span><a href="#label-Unit+Testing+your+Models">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>In Rails, models tests are what you write to test your models.</p>

<p>For this guide we will be using Rails <em>scaffolding</em>. It will create
the model, a migration, controller and views for the new resource in a
single operation. It will also create a full test suite following Rails
best practices. We will be using examples from this generated code and will
be supplementing it with additional examples where necessary.</p>

<p>NOTE: For more information on Rails <em>scaffolding</em>, refer to <a
href="getting_started.html">Getting Started with Rails</a></p>

<p>When you use <code>rails generate scaffold</code>, for a resource among
other things it creates a test stub in the <code>test/models</code> folder:</p>

<pre>$ bin/rails generate scaffold article title:string body:text
...
create  app/models/article.rb
create  test/models/article_test.rb
create  test/fixtures/articles.yml
...</pre>

<p>The default test stub in <code>test/models/article_test.rb</code> looks
like this:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">ArticleTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-comment"># test &quot;the truth&quot; do</span>
  <span class="ruby-comment">#   assert true</span>
  <span class="ruby-comment"># end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>A line by line examination of this file will help get you oriented to Rails
testing code and terminology.</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>
</pre>

<p>As you know by now, <code>test_helper.rb</code> specifies the default
configuration to run our tests. This is included with all the tests, so any
methods added to this file are available to all your tests.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ArticleTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
</pre>

<p>The <code>ArticleTest</code> class defines a <em>test case</em> because it
inherits from <code>ActiveSupport::TestCase</code>.
<code>ArticleTest</code> thus has all the methods available from
<code>ActiveSupport::TestCase</code>. You&#39;ll see those methods a little
later in this guide.</p>

<p>Any method defined within a class inherited from
<code>Minitest::Test</code> (which is the superclass of
<code>ActiveSupport::TestCase</code>) that begins with <code>test_</code>
(case sensitive) is simply called a test. So, <code>test_password</code>
and <code>test_valid_password</code> are legal test names and are run
automatically when the test case is run.</p>

<p>Rails adds a <code>test</code> method that takes a test name and a block.
It generates a normal <code>Minitest::Unit</code> test with method names
prefixed with <code>test_</code>. So,</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;the truth&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
</pre>

<p>acts as if you had written</p>

<pre class="ruby"><span class="ruby-keyword">def</span> <span class="ruby-identifier">test_the_truth</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
</pre>

<p>only the <code>test</code> macro allows a more readable test name. You can
still use regular method definitions though.</p>

<p>NOTE: The method name is generated by replacing spaces with underscores.
The result does not need to be a valid Ruby identifier though, the name may
contain punctuation characters etc. That&#39;s because in Ruby technically
any string may be a method name. Odd ones need <code>define_method</code>
and <code>send</code> calls, but formally there&#39;s no restriction.</p>

<pre class="ruby"><span class="ruby-identifier">assert</span> <span class="ruby-keyword">true</span>
</pre>

<p>This line of code is called an <em>assertion</em>. An assertion is a line
of code that evaluates an object (or expression) for expected results. For
example, an assertion can check:</p>
<ul><li>
<p>does this value = that value?</p>
</li><li>
<p>is this object nil?</p>
</li><li>
<p>does this line of code throw an exception?</p>
</li><li>
<p>is the user&#39;s password greater than 5 characters?</p>
</li></ul>

<p>Every test contains one or more assertions. Only when all the assertions
are successful will the test pass.</p>

<h3 id="label-Maintaining+the+test+database+schema">Maintaining the test database schema<span><a href="#label-Maintaining+the+test+database+schema">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In order to run your tests, your test database will need to have the
current structure. The test helper checks whether your test database has
any pending migrations. If so, it will try to load your
<code>db/schema.rb</code> or <code>db/structure.sql</code> into the test
database. If migrations are still pending, an error will be raised. Usually
this indicates that your schema is not fully migrated. Running the
migrations against the development database (<code>bin/rake
db:migrate</code>) will bring the schema up to date.</p>

<p>NOTE: If existing migrations required modifications, the test database
needs to be rebuilt. This can be done by executing <code>bin/rake
db:test:prepare</code>.</p>

<h3 id="label-Running+Tests">Running Tests<span><a href="#label-Running+Tests">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Running a test is as simple as invoking the file containing the test cases
through <code>rake test</code> command.</p>

<pre>$ bin/rake test test/models/article_test.rb
.

Finished tests in 0.009262s, 107.9680 tests/s, 107.9680 assertions/s.

1 tests, 1 assertions, 0 failures, 0 errors, 0 skips</pre>

<p>You can also run a particular test method from the test case by running the
test and providing the <code>test method name</code>.</p>

<pre>$ bin/rake test test/models/article_test.rb test_the_truth
.

Finished tests in 0.009064s, 110.3266 tests/s, 110.3266 assertions/s.

1 tests, 1 assertions, 0 failures, 0 errors, 0 skips</pre>

<p>This will run all test methods from the test case. Note that
<code>test_helper.rb</code> is in the <code>test</code> directory, hence
this directory needs to be added to the load path using the <code>-I</code>
switch.</p>

<p>The <code>.</code> (dot) above indicates a passing test. When a test fails
you see an <code>F</code>; when a test throws an error you see an
<code>E</code> in its place. The last line of the output is the summary.</p>

<p>To see how a test failure is reported, you can add a failing test to the
<code>article_test.rb</code> test case.</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should not save article without title&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">article</span> = <span class="ruby-constant">Article</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">article</span>.<span class="ruby-identifier">save</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Let us run this newly added test.</p>

<pre>$ bin/rake test test/models/article_test.rb test_should_not_save_article_without_title
F

Finished tests in 0.044632s, 22.4054 tests/s, 22.4054 assertions/s.

  1) Failure:
test_should_not_save_article_without_title(ArticleTest) [test/models/article_test.rb:6]:
Failed assertion, no message given.

1 tests, 1 assertions, 1 failures, 0 errors, 0 skips</pre>

<p>In the output, <code>F</code> denotes a failure. You can see the
corresponding trace shown under <code>1)</code> along with the name of the
failing test. The next few lines contain the stack trace followed by a
message which mentions the actual value and the expected value by the
assertion. The default assertion messages provide just enough information
to help pinpoint the error. To make the assertion failure message more
readable, every assertion provides an optional message parameter, as shown
here:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should not save article without title&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">article</span> = <span class="ruby-constant">Article</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">assert_not</span> <span class="ruby-identifier">article</span>.<span class="ruby-identifier">save</span>, <span class="ruby-string">&quot;Saved the article without a title&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Running this test shows the friendlier assertion message:</p>

<pre>1) Failure:
test_should_not_save_article_without_title(ArticleTest) [test/models/article_test.rb:6]:
Saved the article without a title</pre>

<p>Now to get this test to pass we can add a model level validation for the
<em>title</em> field.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Article</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">validates</span> :<span class="ruby-identifier">title</span>, <span class="ruby-identifier">presence</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Now the test should pass. Let us verify by running the test again:</p>

<pre>$ bin/rake test test/models/article_test.rb test_should_not_save_article_without_title
.

Finished tests in 0.047721s, 20.9551 tests/s, 20.9551 assertions/s.

1 tests, 1 assertions, 0 failures, 0 errors, 0 skips</pre>

<p>Now, if you noticed, we first wrote a test which fails for a desired
functionality, then we wrote some code which adds the functionality and
finally we ensured that our test passes. This approach to software
development is referred to as <em>Test-Driven Development</em> (TDD).</p>

<p>TIP: Many Rails developers practice <em>Test-Driven Development</em> (TDD).
This is an excellent way to build up a test suite that exercises every part
of your application. TDD is beyond the scope of this guide, but one place
to start is with <a
href="http://andrzejonsoftware.blogspot.com/2007/05/15-tdd-steps-to-create-rails.html">15
TDD steps to create a Rails application</a>.</p>

<p>To see how an error gets reported, here&#39;s a test containing an error:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should report error&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># some_undefined_variable is not defined elsewhere in the test case</span>
  <span class="ruby-identifier">some_undefined_variable</span>
  <span class="ruby-identifier">assert</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Now you can see even more output in the console from running the tests:</p>

<pre>$ bin/rake test test/models/article_test.rb test_should_report_error
E

Finished tests in 0.030974s, 32.2851 tests/s, 0.0000 assertions/s.

  1) Error:
test_should_report_error(ArticleTest):
NameError: undefined local variable or method `some_undefined_variable&#39; for #&lt;ArticleTest:0x007fe32e24afe0&gt;
    test/models/article_test.rb:10:in `block in &lt;class:ArticleTest&gt;&#39;

1 tests, 0 assertions, 0 failures, 1 errors, 0 skips</pre>

<p>Notice the &#39;E&#39; in the output. It denotes a test with error.</p>

<p>NOTE: The execution of each test method stops as soon as any error or an
assertion failure is encountered, and the test suite continues with the
next method. All test methods are executed in alphabetical order.</p>

<p>When a test fails you are presented with the corresponding backtrace. By
default Rails filters that backtrace and will only print lines relevant to
your application. This eliminates the framework noise and helps to focus on
your code. However there are situations when you want to see the full
backtrace. simply set the <code>BACKTRACE</code> environment variable to
enable this behavior:</p>

<pre>$ BACKTRACE=1 bin/rake test test/models/article_test.rb</pre>

<h3 id="label-What+to+Include+in+Your+Unit+Tests">What to Include in Your Unit Tests<span><a href="#label-What+to+Include+in+Your+Unit+Tests">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Ideally, you would like to include a test for everything which could
possibly break. It&#39;s a good practice to have at least one test for each
of your validations and at least one test for every method in your model.</p>

<h3 id="label-Available+Assertions">Available Assertions<span><a href="#label-Available+Assertions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>By now you&#39;ve caught a glimpse of some of the assertions that are
available. Assertions are the worker bees of testing. They are the ones
that actually perform the checks to ensure that things are going as
planned.</p>

<p>There are a bunch of different types of assertions you can use. Here&#39;s
an extract of the assertions you can use with <a
href="https://github.com/seattlerb/minitest">Minitest</a>, the default
testing library used by Rails. The <code>[msg]</code> parameter is an
optional string message you can specify to make your test failure messages
clearer. It&#39;s not required.</p>

<p>| Assertion | Purpose | | —————————————————————- | ——- | | <code>assert(
test, [msg] )</code> | Ensures that <code>test</code> is true.| |
<code>assert_not( test, [msg] )</code> | Ensures that <code>test</code> is
false.| | <code>assert_equal( expected, actual, [msg] )</code> | Ensures
that <code>expected == actual</code> is true.| | <code>assert_not_equal(
expected, actual, [msg] )</code> | Ensures that <code>expected !=
actual</code> is true.| | <code>assert_same( expected, actual, [msg]
)</code> | Ensures that <code>expected.equal?(actual)</code> is true.| |
<code>assert_not_same( expected, actual, [msg] )</code> | Ensures that
<code>expected.equal?(actual)</code> is false.| | <code>assert_nil( obj,
[msg] )</code> | Ensures that <code>obj.nil?</code> is true.| |
<code>assert_not_nil( obj, [msg] )</code> | Ensures that
<code>obj.nil?</code> is false.| | <code>assert_empty( obj, [msg] )</code>
| Ensures that <code>obj</code> is <code>empty?</code>.| |
<code>assert_not_empty( obj, [msg] )</code> | Ensures that <code>obj</code>
is not <code>empty?</code>.| | <code>assert_match( regexp, string, [msg]
)</code> | Ensures that a string matches the regular expression.| |
<code>assert_no_match( regexp, string, [msg] )</code> | Ensures that a
string doesn&#39;t match the regular expression.| | <code>assert_includes(
collection, obj, [msg] )</code> | Ensures that <code>obj</code> is in
<code>collection</code>.| | <code>assert_not_includes( collection, obj,
[msg] )</code> | Ensures that <code>obj</code> is not in
<code>collection</code>.| | <code>assert_in_delta( expecting, actual,
[delta], [msg] )</code> | Ensures that the numbers <code>expected</code>
and <code>actual</code> are within <code>delta</code> of each other.| |
<code>assert_not_in_delta( expecting, actual, [delta], [msg] )</code> |
Ensures that the numbers <code>expected</code> and <code>actual</code> are
not within <code>delta</code> of each other.| | <code>assert_throws(
symbol, [msg] ) { block }</code> | Ensures that the given block throws the
symbol.| | <code>assert_raises( exception1, exception2, ... ) { block
}</code> | Ensures that the given block raises one of the given
exceptions.| | <code>assert_nothing_raised( exception1, exception2, ... ) {
block }</code> | Ensures that the given block doesn&#39;t raise one of the
given exceptions.| | <code>assert_instance_of( class, obj, [msg] )</code> |
Ensures that <code>obj</code> is an instance of <code>class</code>.| |
<code>assert_not_instance_of( class, obj, [msg] )</code> | Ensures that
<code>obj</code> is not an instance of <code>class</code>.| |
<code>assert_kind_of( class, obj, [msg] )</code> | Ensures that
<code>obj</code> is or descends from <code>class</code>.| |
<code>assert_not_kind_of( class, obj, [msg] )</code> | Ensures that
<code>obj</code> is not an instance of <code>class</code> and is not
descending from it.| | <code>assert_respond_to( obj, symbol, [msg] )</code>
| Ensures that <code>obj</code> responds to <code>symbol</code>.| |
<code>assert_not_respond_to( obj, symbol, [msg] )</code> | Ensures that
<code>obj</code> does not respond to <code>symbol</code>.| |
<code>assert_operator( obj1, operator, [obj2], [msg] )</code> | Ensures
that <code>obj1.operator(obj2)</code> is true.| |
<code>assert_not_operator( obj1, operator, [obj2], [msg] )</code> | Ensures
that <code>obj1.operator(obj2)</code> is false.| | <code>assert_predicate (
obj, predicate, [msg] )</code> | Ensures that <code>obj.predicate</code> is
true, e.g. <code>assert_predicate str, :empty?</code>| |
<code>assert_not_predicate ( obj, predicate, [msg] )</code> | Ensures that
<code>obj.predicate</code> is false, e.g. <code>assert_not_predicate str,
:empty?</code>| | <code>assert_send( array, [msg] )</code> | Ensures that
executing the method listed in <code>array[1]</code> on the object in
<code>array[0]</code> with the parameters of <code>array[2 and up]</code>
is true. This one is weird eh?| | <code>flunk( [msg] )</code> | Ensures
failure. This is useful to explicitly mark a test that isn&#39;t finished
yet.|</p>

<p>The above are subset of assertions that minitest supports. For an
exhaustive &amp; more up-to-date list, please check <a
href="http://docs.seattlerb.org/minitest/">Minitest API documentation</a>,
specifically <a
href="http://docs.seattlerb.org/minitest/Minitest/Assertions.html">Minitest::Assertions</a></p>

<p>Because of the modular nature of the testing framework, it is possible to
create your own assertions. In fact, that&#39;s exactly what Rails does. It
includes some specialized assertions to make your life easier.</p>

<p>NOTE: Creating your own assertions is an advanced topic that we won&#39;t
cover in this tutorial.</p>

<h3 id="label-Rails+Specific+Assertions">Rails Specific Assertions<span><a href="#label-Rails+Specific+Assertions">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Rails adds some custom assertions of its own to the <code>minitest</code>
framework:</p>

<p>| Assertion | Purpose | | ——————————————————————————— | ——- | |
<code>assert_difference(expressions, difference = 1, message = nil) {...} |
Test numeric difference between the return value of an expression as a
result of what is evaluated in the yielded block.| |
assert_no_difference(expressions, message = nil, &amp;block) | Asserts that
the numeric result of evaluating an expression is not changed before and
after invoking the passed in block.| | assert_recognizes(expected_options,
path, extras={}, message=nil) | Asserts that the routing of the given path
was handled correctly and that the parsed options (given in the
expected_options hash) match path. Basically, it asserts that Rails
recognizes the route given by expected_options.| |
assert_generates(expected_path, options, defaults={}, extras = {},
message=nil) | Asserts that the provided options can be used to generate
the provided path. This is the inverse of assert_recognizes. The extras
parameter is used to tell the request the names and values of additional
request parameters that would be in a query string. The message parameter
allows you to specify a custom error message for assertion failures.| |
assert_response(type, message = nil) | Asserts that the response comes with
a specific status code. You can specify :success to indicate 200-299,
:redirect to indicate 300-399, :missing to indicate 404, or :error to match
the 500-599 range. You can also pass an explicit status number or its
symbolic equivalent. For more information, see {full list of status
codes}[http://rubydoc.info/github/rack/rack/master/Rack/Utils#HTTP_STATUS_CODES-constant]</code>
and how their <a
href="http://rubydoc.info/github/rack/rack/master/Rack/Utils#SYMBOL_TO_STATUS_CODE-constant">mapping</a>
works.| | <code>assert_redirected_to(options = {}, message=nil)</code> |
Assert that the redirection options passed in match those of the redirect
called in the latest action. This match can be partial, such that
<code>assert_redirected_to(controller: &quot;weblog&quot;)</code> will also
match the redirection of <code>redirect_to(controller: &quot;weblog&quot;,
action: &quot;show&quot;)</code> and so on. You can also pass named routes
such as <code>assert_redirected_to root_path</code> and Active Record
objects such as <code>assert_redirected_to @article</code>.| |
<code>assert_template(expected = nil, message=nil)</code> | Asserts that
the request was rendered with the appropriate template file.|</p>

<p>You&#39;ll see the usage of some of these assertions in the next chapter.</p>

<h2 id="label-Functional+Tests+for+Your+Controllers">Functional Tests for Your Controllers<span><a href="#label-Functional+Tests+for+Your+Controllers">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>In Rails, testing the various actions of a single controller is called
writing functional tests for that controller. Controllers handle the
incoming web requests to your application and eventually respond with a
rendered view.</p>

<h3 id="label-What+to+Include+in+your+Functional+Tests">What to Include in your Functional Tests<span><a href="#label-What+to+Include+in+your+Functional+Tests">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You should test for things such as:</p>
<ul><li>
<p>was the web request successful?</p>
</li><li>
<p>was the user redirected to the right page?</p>
</li><li>
<p>was the user successfully authenticated?</p>
</li><li>
<p>was the correct object stored in the response template?</p>
</li><li>
<p>was the appropriate message displayed to the user in the view?</p>
</li></ul>

<p>Now that we have used Rails scaffold generator for our <code>Article</code>
resource, it has already created the controller code and tests. You can
take look at the file <code>articles_controller_test.rb</code> in the
<code>test/controllers</code> directory.</p>

<p>Let me take you through one such test, <code>test_should_get_index</code>
from the file <code>articles_controller_test.rb</code>.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ArticlesControllerTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should get index&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">get</span> :<span class="ruby-identifier">index</span>
    <span class="ruby-identifier">assert_response</span> :<span class="ruby-identifier">success</span>
    <span class="ruby-identifier">assert_not_nil</span> <span class="ruby-identifier">assigns</span>(:<span class="ruby-identifier">articles</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>In the <code>test_should_get_index</code> test, Rails simulates a request
on the action called <code>index</code>, making sure the request was
successful and also ensuring that it assigns a valid <code>articles</code>
instance variable.</p>

<p>The <code>get</code> method kicks off the web request and populates the
results into the response. It accepts 4 arguments:</p>
<ul><li>
<p>The action of the controller you are requesting. This can be in the form of
a string or a symbol.</p>
</li><li>
<p>An optional hash of request parameters to pass into the action (eg. query
string parameters or article variables).</p>
</li><li>
<p>An optional hash of session variables to pass along with the request.</p>
</li><li>
<p>An optional hash of flash values.</p>
</li></ul>

<p>Example: Calling the <code>:show</code> action, passing an <code>id</code>
of 12 as the <code>params</code> and setting a <code>user_id</code> of 5 in
the session:</p>

<pre class="ruby"><span class="ruby-identifier">get</span>(:<span class="ruby-identifier">show</span>, {<span class="ruby-string">&#39;id&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;12&quot;</span>}, {<span class="ruby-string">&#39;user_id&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">5</span>})
</pre>

<p>Another example: Calling the <code>:view</code> action, passing an
<code>id</code> of 12 as the <code>params</code>, this time with no
session, but with a flash message.</p>

<pre class="ruby"><span class="ruby-identifier">get</span>(:<span class="ruby-identifier">view</span>, {<span class="ruby-string">&#39;id&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;12&#39;</span>}, <span class="ruby-keyword">nil</span>, {<span class="ruby-string">&#39;message&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;booya!&#39;</span>})
</pre>

<p>NOTE: If you try running <code>test_should_create_article</code> test from
<code>articles_controller_test.rb</code> it will fail on account of the
newly added model level validation and rightly so.</p>

<p>Let us modify <code>test_should_create_article</code> test in
<code>articles_controller_test.rb</code> so that all our test pass:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should create article&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_difference</span>(<span class="ruby-string">&#39;Article.count&#39;</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">post</span> :<span class="ruby-identifier">create</span>, <span class="ruby-identifier">article</span><span class="ruby-operator">:</span> {<span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Some title&#39;</span>}
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert_redirected_to</span> <span class="ruby-identifier">article_path</span>(<span class="ruby-identifier">assigns</span>(:<span class="ruby-identifier">article</span>))
<span class="ruby-keyword">end</span>
</pre>

<p>Now you can try running all the tests and they should pass.</p>

<h3 id="label-Available+Request+Types+for+Functional+Tests">Available Request Types for Functional Tests<span><a href="#label-Available+Request+Types+for+Functional+Tests">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If you&#39;re familiar with the HTTP protocol, you&#39;ll know that
<code>get</code> is a type of request. There are 6 request types supported
in Rails functional tests:</p>
<ul><li>
<p><code>get</code></p>
</li><li>
<p><code>post</code></p>
</li><li>
<p><code>patch</code></p>
</li><li>
<p><code>put</code></p>
</li><li>
<p><code>head</code></p>
</li><li>
<p><code>delete</code></p>
</li></ul>

<p>All of request types are methods that you can use, however, you&#39;ll
probably end up using the first two more often than the others.</p>

<p>NOTE: Functional tests do not verify whether the specified request type
should be accepted by the action. Request types in this context exist to
make your tests more descriptive.</p>

<h3 id="label-The+Four+Hashes+of+the+Apocalypse">The Four Hashes of the Apocalypse<span><a href="#label-The+Four+Hashes+of+the+Apocalypse">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>After a request has been made using one of the 6 methods (<code>get</code>,
<code>post</code>, etc.) and processed, you will have 4 Hash objects ready
for use:</p>
<ul><li>
<p><code>assigns</code> - Any objects that are stored as instance variables in
actions for use in views.</p>
</li><li>
<p><code>cookies</code> - Any cookies that are set.</p>
</li><li>
<p><code>flash</code> - Any objects living in the flash.</p>
</li><li>
<p><code>session</code> - Any object living in session variables.</p>
</li></ul>

<p>As is the case with normal Hash objects, you can access the values by
referencing the keys by string. You can also reference them by symbol name,
except for <code>assigns</code>. For example:</p>

<pre class="ruby"><span class="ruby-identifier">flash</span>[<span class="ruby-string">&quot;gordon&quot;</span>]               <span class="ruby-identifier">flash</span>[:<span class="ruby-identifier">gordon</span>]
<span class="ruby-identifier">session</span>[<span class="ruby-string">&quot;shmession&quot;</span>]          <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">shmession</span>]
<span class="ruby-identifier">cookies</span>[<span class="ruby-string">&quot;are_good_for_u&quot;</span>]     <span class="ruby-identifier">cookies</span>[:<span class="ruby-identifier">are_good_for_u</span>]

<span class="ruby-comment"># Because you can&#39;t use assigns[:something] for historical reasons:</span>
<span class="ruby-identifier">assigns</span>[<span class="ruby-string">&quot;something&quot;</span>]          <span class="ruby-identifier">assigns</span>(:<span class="ruby-identifier">something</span>)
</pre>

<h3 id="label-Instance+Variables+Available">Instance Variables Available<span><a href="#label-Instance+Variables+Available">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>You also have access to three instance variables in your functional tests:</p>
<ul><li>
<p><code>@controller</code> - The controller processing the request</p>
</li><li>
<p><code>@request</code> - The request</p>
</li><li>
<p><code>@response</code> - The response</p>
</li></ul>

<h3 id="label-Setting+Headers+and+CGI+variables">Setting Headers and CGI variables<span><a href="#label-Setting+Headers+and+CGI+variables">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><a href="http://tools.ietf.org/search/rfc2616#section-5.3">HTTP headers</a>
and <a href="http://tools.ietf.org/search/rfc3875#section-4.1">CGI
variables</a> can be set directly on the <code>@request</code> instance
variable:</p>

<pre class="ruby"><span class="ruby-comment"># setting a HTTP Header</span>
<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;Accept&quot;</span>] = <span class="ruby-string">&quot;text/plain, text/html&quot;</span>
<span class="ruby-identifier">get</span> :<span class="ruby-identifier">index</span> <span class="ruby-comment"># simulate the request with custom header</span>

<span class="ruby-comment"># setting a CGI variable</span>
<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">headers</span>[<span class="ruby-string">&quot;HTTP_REFERER&quot;</span>] = <span class="ruby-string">&quot;http://example.com/home&quot;</span>
<span class="ruby-identifier">post</span> :<span class="ruby-identifier">create</span> <span class="ruby-comment"># simulate the request with custom env variable</span>
</pre>

<h3 id="label-Testing+Templates+and+Layouts">Testing Templates and Layouts<span><a href="#label-Testing+Templates+and+Layouts">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>If you want to make sure that the response rendered the correct template
and layout, you can use the <code>assert_template</code> method:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;index should render correct template and layout&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">get</span> :<span class="ruby-identifier">index</span>
  <span class="ruby-identifier">assert_template</span> :<span class="ruby-identifier">index</span>
  <span class="ruby-identifier">assert_template</span> <span class="ruby-identifier">layout</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;layouts/application&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note that you cannot test for template and layout at the same time, with
one call to <code>assert_template</code> method. Also, for the
<code>layout</code> test, you can give a regular expression instead of a
string, but using the string, makes things clearer. On the other hand, you
have to include the “layouts” directory name even if you save your layout
file in this standard layout directory. Hence,</p>

<pre class="ruby"><span class="ruby-identifier">assert_template</span> <span class="ruby-identifier">layout</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;application&quot;</span>
</pre>

<p>will not work.</p>

<p>If your view renders any partial, when asserting for the layout, you have
to assert for the partial at the same time. Otherwise, assertion will fail.</p>

<p>Hence:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;new should render correct layout&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">get</span> :<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">assert_template</span> <span class="ruby-identifier">layout</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;layouts/application&quot;</span>, <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;_form&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>is the correct way to assert for the layout when the view renders a partial
with name <code>_form</code>. Omitting the <code>:partial</code> key in
your <code>assert_template</code> call will complain.</p>

<h3 id="label-A+Fuller+Functional+Test+Example">A Fuller Functional Test Example<span><a href="#label-A+Fuller+Functional+Test+Example">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Here&#39;s another example that uses <code>flash</code>,
<code>assert_redirected_to</code>, and <code>assert_difference</code>:</p>

<pre class="ruby"><span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should create article&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_difference</span>(<span class="ruby-string">&#39;Article.count&#39;</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">post</span> :<span class="ruby-identifier">create</span>, <span class="ruby-identifier">article</span><span class="ruby-operator">:</span> {<span class="ruby-identifier">title</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;Hi&#39;</span>, <span class="ruby-identifier">body</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;This is my first article.&#39;</span>}
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">assert_redirected_to</span> <span class="ruby-identifier">article_path</span>(<span class="ruby-identifier">assigns</span>(:<span class="ruby-identifier">article</span>))
  <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Article was successfully created.&#39;</span>, <span class="ruby-identifier">flash</span>[:<span class="ruby-identifier">notice</span>]
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Testing+Views">Testing Views<span><a href="#label-Testing+Views">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Testing the response to your request by asserting the presence of key HTML
elements and their content is a useful way to test the views of your
application. The <code>assert_select</code> assertion allows you to do this
by using a simple yet powerful syntax.</p>

<p>NOTE: You may find references to <code>assert_tag</code> in other
documentation. This has been removed in 4.2. Use <code>assert_select</code>
instead.</p>

<p>There are two forms of <code>assert_select</code>:</p>

<p><code>assert_select(selector, [equality], [message])</code> ensures that
the equality condition is met on the selected elements through the
selector. The selector may be a CSS selector expression (String) or an
expression with substitution values.</p>

<p><code>assert_select(element, selector, [equality], [message])</code>
ensures that the equality condition is met on all the selected elements
through the selector starting from the <em>element</em> (instance of
<code>Nokogiri::XML::Node</code> or <code>Nokogiri::XML::NodeSet</code>)
and its descendants.</p>

<p>For example, you could verify the contents on the title element in your
response with:</p>

<pre class="ruby"><span class="ruby-identifier">assert_select</span> <span class="ruby-string">&#39;title&#39;</span>, <span class="ruby-string">&quot;Welcome to Rails Testing Guide&quot;</span>
</pre>

<p>You can also use nested <code>assert_select</code> blocks. In this case the
inner <code>assert_select</code> runs the assertion on the complete
collection of elements selected by the outer <code>assert_select</code>
block:</p>

<pre class="ruby"><span class="ruby-identifier">assert_select</span> <span class="ruby-string">&#39;ul.navigation&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_select</span> <span class="ruby-string">&#39;li.menu_item&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Alternatively the collection of elements selected by the outer
<code>assert_select</code> may be iterated through so that
<code>assert_select</code> may be called separately for each element.
Suppose for example that the response contains two ordered lists, each with
four list elements then the following tests will both pass.</p>

<pre class="ruby"><span class="ruby-identifier">assert_select</span> <span class="ruby-string">&quot;ol&quot;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">elements</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">assert_select</span> <span class="ruby-identifier">element</span>, <span class="ruby-string">&quot;li&quot;</span>, <span class="ruby-value">4</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">assert_select</span> <span class="ruby-string">&quot;ol&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_select</span> <span class="ruby-string">&quot;li&quot;</span>, <span class="ruby-value">8</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The <code>assert_select</code> assertion is quite powerful. For more
advanced usage, refer to its <a
href="https://github.com/rails/rails-dom-testing/blob/master/lib/rails/dom/testing/assertions/selector_assertions.rb">documentation</a>.</p>

<h4 id="label-Additional+View-Based+Assertions">Additional View-Based Assertions<span><a href="#label-Additional+View-Based+Assertions">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>There are more assertions that are primarily used in testing views:</p>

<p>| Assertion | Purpose | | ——————————————————— | ——- | |
<code>assert_select_email</code> | Allows you to make assertions on the
body of an e-mail. | | <code>assert_select_encoded</code> | Allows you to
make assertions on encoded HTML. It does this by un-encoding the contents
of each element and then calling the block with all the un-encoded
elements.| | <code>css_select(selector)</code> or <code>css_select(element,
selector)</code> | Returns an array of all the elements selected by the
<em>selector</em>. In the second variant it first matches the base
<em>element</em> and tries to match the <em>selector</em> expression on any
of its children. If there are no matches both variants return an empty
array.|</p>

<p>Here&#39;s an example of using <code>assert_select_email</code>:</p>

<pre class="ruby"><span class="ruby-identifier">assert_select_email</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">assert_select</span> <span class="ruby-string">&#39;small&#39;</span>, <span class="ruby-string">&#39;Please click the &quot;Unsubscribe&quot; link if you want to opt-out.&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Integration+Testing">Integration Testing<span><a href="#label-Integration+Testing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Integration tests are used to test the interaction among any number of
controllers. They are generally used to test important work flows within
your application.</p>

<p>Unlike Unit and Functional tests, integration tests have to be explicitly
created under the &#39;test/integration&#39; folder within your
application. Rails provides a generator to create an integration test
skeleton for you.</p>

<pre>$ bin/rails generate integration_test user_flows
      exists  test/integration/
      create  test/integration/user_flows_test.rb</pre>

<p>Here&#39;s what a freshly-generated integration test looks like:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">UserFlowsTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">IntegrationTest</span>
  <span class="ruby-comment"># test &quot;the truth&quot; do</span>
  <span class="ruby-comment">#   assert true</span>
  <span class="ruby-comment"># end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Integration tests inherit from
<code>ActionDispatch::IntegrationTest</code>. This makes available some
additional helpers to use in your integration tests. Also you need to
explicitly include the fixtures to be made available to the test.</p>

<h3 id="label-Helpers+Available+for+Integration+Tests">Helpers Available for Integration Tests<span><a href="#label-Helpers+Available+for+Integration+Tests">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In addition to the standard testing helpers, there are some additional
helpers available to integration tests:</p>

<p>| Helper | Purpose | | —————————————————————— | ——- | | <code>https?</code>
| Returns <code>true</code> if the session is mimicking a secure HTTPS
request.| | <code>https!</code> | Allows you to mimic a secure HTTPS
request.| | <code>host!</code> | Allows you to set the host name to use in
the next request.| | <code>redirect?</code> | Returns <code>true</code> if
the last request was a redirect.| | <code>follow_redirect!</code> | Follows
a single redirect response.| | <code>request_via_redirect(http_method,
path, [parameters], [headers])</code> | Allows you to make an HTTP request
and follow any subsequent redirects.| | <code>post_via_redirect(path,
[parameters], [headers])</code> | Allows you to make an HTTP POST request
and follow any subsequent redirects.| | <code>get_via_redirect(path,
[parameters], [headers])</code> | Allows you to make an HTTP GET request
and follow any subsequent redirects.| | <code>patch_via_redirect(path,
[parameters], [headers])</code> | Allows you to make an HTTP PATCH request
and follow any subsequent redirects.| | <code>put_via_redirect(path,
[parameters], [headers])</code> | Allows you to make an HTTP PUT request
and follow any subsequent redirects.| | <code>delete_via_redirect(path,
[parameters], [headers])</code> | Allows you to make an HTTP DELETE request
and follow any subsequent redirects.| | <code>open_session</code> | Opens a
new session instance.|</p>

<h3 id="label-Integration+Testing+Examples">Integration Testing Examples<span><a href="#label-Integration+Testing+Examples">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>A simple integration test that exercises multiple controllers:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">UserFlowsTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">IntegrationTest</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;login and browse site&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># login via https</span>
    <span class="ruby-identifier">https!</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/login&quot;</span>
    <span class="ruby-identifier">assert_response</span> :<span class="ruby-identifier">success</span>

    <span class="ruby-identifier">post_via_redirect</span> <span class="ruby-string">&quot;/login&quot;</span>, <span class="ruby-identifier">username</span><span class="ruby-operator">:</span> <span class="ruby-identifier">users</span>(:<span class="ruby-identifier">david</span>).<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span><span class="ruby-operator">:</span> <span class="ruby-identifier">users</span>(:<span class="ruby-identifier">david</span>).<span class="ruby-identifier">password</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;/welcome&#39;</span>, <span class="ruby-identifier">path</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Welcome david!&#39;</span>, <span class="ruby-identifier">flash</span>[:<span class="ruby-identifier">notice</span>]

    <span class="ruby-identifier">https!</span>(<span class="ruby-keyword">false</span>)
    <span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/articles/all&quot;</span>
    <span class="ruby-identifier">assert_response</span> :<span class="ruby-identifier">success</span>
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">assigns</span>(:<span class="ruby-identifier">articles</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>As you can see the integration test involves multiple controllers and
exercises the entire stack from database to dispatcher. In addition you can
have multiple session instances open simultaneously in a test and extend
those instances with assertion methods to create a very powerful testing
DSL (domain-specific language) just for your application.</p>

<p>Here&#39;s an example of multiple sessions and custom DSL in an integration
test</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">UserFlowsTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionDispatch</span><span class="ruby-operator">::</span><span class="ruby-constant">IntegrationTest</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;login and browse site&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># User david logs in</span>
    <span class="ruby-identifier">david</span> = <span class="ruby-identifier">login</span>(:<span class="ruby-identifier">david</span>)
    <span class="ruby-comment"># User guest logs in</span>
    <span class="ruby-identifier">guest</span> = <span class="ruby-identifier">login</span>(:<span class="ruby-identifier">guest</span>)

    <span class="ruby-comment"># Both are now available in different sessions</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Welcome david!&#39;</span>, <span class="ruby-identifier">david</span>.<span class="ruby-identifier">flash</span>[:<span class="ruby-identifier">notice</span>]
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Welcome guest!&#39;</span>, <span class="ruby-identifier">guest</span>.<span class="ruby-identifier">flash</span>[:<span class="ruby-identifier">notice</span>]

    <span class="ruby-comment"># User david can browse site</span>
    <span class="ruby-identifier">david</span>.<span class="ruby-identifier">browses_site</span>
    <span class="ruby-comment"># User guest can browse site as well</span>
    <span class="ruby-identifier">guest</span>.<span class="ruby-identifier">browses_site</span>

    <span class="ruby-comment"># Continue with other assertions</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">private</span>

    <span class="ruby-keyword">module</span> <span class="ruby-constant">CustomDsl</span>
      <span class="ruby-keyword">def</span> <span class="ruby-identifier">browses_site</span>
        <span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/products/all&quot;</span>
        <span class="ruby-identifier">assert_response</span> :<span class="ruby-identifier">success</span>
        <span class="ruby-identifier">assert</span> <span class="ruby-identifier">assigns</span>(:<span class="ruby-identifier">products</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">def</span> <span class="ruby-identifier">login</span>(<span class="ruby-identifier">user</span>)
      <span class="ruby-identifier">open_session</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sess</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">CustomDsl</span>)
        <span class="ruby-identifier">u</span> = <span class="ruby-identifier">users</span>(<span class="ruby-identifier">user</span>)
        <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">https!</span>
        <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">post</span> <span class="ruby-string">&quot;/login&quot;</span>, <span class="ruby-identifier">username</span><span class="ruby-operator">:</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span><span class="ruby-operator">:</span> <span class="ruby-identifier">u</span>.<span class="ruby-identifier">password</span>
        <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;/welcome&#39;</span>, <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">path</span>
        <span class="ruby-identifier">sess</span>.<span class="ruby-identifier">https!</span>(<span class="ruby-keyword">false</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Rake+Tasks+for+Running+your+Tests">Rake Tasks for Running your Tests<span><a href="#label-Rake+Tasks+for+Running+your+Tests">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Rails comes with a number of built-in rake tasks to help with testing. The
table below lists the commands included in the default <a
href="../Rakefile.html">Rakefile</a> when a Rails project is created.</p>

<p>| Tasks | Description | | ———————– | ———– | | <code>rake test</code> | Runs
all tests in the <code>test</code> folder. You can also simply run
<code>rake</code> as Rails will run all the tests by default | | <code>rake
test:controllers</code> | Runs all the controller tests from
<code>test/controllers</code> | | <code>rake test:functionals</code> | Runs
all the functional tests from <code>test/controllers</code>,
<code>test/mailers</code>, and <code>test/functional</code> | | <code>rake
test:helpers</code> | Runs all the helper tests from
<code>test/helpers</code> | | <code>rake test:integration</code> | Runs all
the integration tests from <code>test/integration</code> | | <code>rake
test:jobs</code> | Runs all the job tests from <code>test/jobs</code> | |
<code>rake test:mailers</code> | Runs all the mailer tests from
<code>test/mailers</code> | | <code>rake test:models</code> | Runs all the
model tests from <code>test/models</code> | | <code>rake test:units</code>
| Runs all the unit tests from <code>test/models</code>,
<code>test/helpers</code>, and <code>test/unit</code> | | <code>rake
test:db</code> | Runs all tests in the <code>test</code> folder and resets
the db |</p>

<h2 id="label-A+Brief+Note+About+Minitest">A Brief Note About <a href="../../Minitest.html">Minitest</a><span><a href="#label-A+Brief+Note+About+Minitest">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Ruby ships with a vast Standard Library for all common use-cases including
testing. Since version 1.9, Ruby provides <code>Minitest</code>, a
framework for testing. All the basic assertions such as
<code>assert_equal</code> discussed above are actually defined in
<code>Minitest::Assertions</code>. The classes
<code>ActiveSupport::TestCase</code>,
<code>ActionController::TestCase</code>,
<code>ActionMailer::TestCase</code>, <code>ActionView::TestCase</code> and
<code>ActionDispatch::IntegrationTest</code> - which we have been
inheriting in our test classes - include <code>Minitest::Assertions</code>,
allowing us to use all of the basic assertions in our tests.</p>

<p>NOTE: For more information on <code>Minitest</code>, refer to <a
href="http://ruby-doc.org/stdlib-2.1.0/libdoc/minitest/rdoc/MiniTest.html">Minitest</a></p>

<h2 id="label-Setup+and+Teardown">Setup and Teardown<span><a href="#label-Setup+and+Teardown">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>If you would like to run a block of code before the start of each test and
another block of code after the end of each test you have two special
callbacks for your rescue. Let&#39;s take note of this by looking at an
example for our functional test in <code>Articles</code> controller:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">ArticlesControllerTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>

  <span class="ruby-comment"># called before every single test</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">setup</span>
    <span class="ruby-ivar">@article</span> = <span class="ruby-identifier">articles</span>(:<span class="ruby-identifier">one</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># called after every single test</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">teardown</span>
    <span class="ruby-comment"># as we are re-initializing @article before every test</span>
    <span class="ruby-comment"># setting it to nil here is not essential but I hope</span>
    <span class="ruby-comment"># you understand how you can use the teardown method</span>
    <span class="ruby-ivar">@article</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should show article&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">get</span> :<span class="ruby-identifier">show</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">assert_response</span> :<span class="ruby-identifier">success</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should destroy article&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span>(<span class="ruby-string">&#39;Article.count&#39;</span>, <span class="ruby-value">-1</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">delete</span> :<span class="ruby-identifier">destroy</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">assert_redirected_to</span> <span class="ruby-identifier">articles_path</span>
  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span>
</pre>

<p>Above, the <code>setup</code> method is called before each test and so
<code>@article</code> is available for each of the tests. Rails implements
<code>setup</code> and <code>teardown</code> as
<code>ActiveSupport::Callbacks</code>. Which essentially means you need not
only use <code>setup</code> and <code>teardown</code> as methods in your
tests. You could specify them by using:</p>
<ul><li>
<p>a block</p>
</li><li>
<p>a method (like in the earlier example)</p>
</li><li>
<p>a method name as a symbol</p>
</li><li>
<p>a lambda</p>
</li></ul>

<p>Let&#39;s see the earlier example by specifying <code>setup</code> callback
by specifying a method name as a symbol:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">ArticlesControllerTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>

  <span class="ruby-comment"># called before every single test</span>
  <span class="ruby-identifier">setup</span> :<span class="ruby-identifier">initialize_article</span>

  <span class="ruby-comment"># called after every single test</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">teardown</span>
    <span class="ruby-ivar">@article</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should show article&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">get</span> :<span class="ruby-identifier">show</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">assert_response</span> :<span class="ruby-identifier">success</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should update article&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">patch</span> :<span class="ruby-identifier">update</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">article</span><span class="ruby-operator">:</span> {}
    <span class="ruby-identifier">assert_redirected_to</span> <span class="ruby-identifier">article_path</span>(<span class="ruby-identifier">assigns</span>(:<span class="ruby-identifier">article</span>))
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should destroy article&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span>(<span class="ruby-string">&#39;Article.count&#39;</span>, <span class="ruby-value">-1</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">delete</span> :<span class="ruby-identifier">destroy</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">assert_redirected_to</span> <span class="ruby-identifier">articles_path</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">private</span>

    <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize_article</span>
      <span class="ruby-ivar">@article</span> = <span class="ruby-identifier">articles</span>(:<span class="ruby-identifier">one</span>)
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Testing+Routes">Testing Routes<span><a href="#label-Testing+Routes">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Like everything else in your Rails application, it is recommended that you
test your routes. Below are example tests for the routes of default
<code>show</code> and <code>create</code> action of <code>Articles</code>
controller above and it should look like:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ArticleRoutesTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should route to article&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_routing</span> <span class="ruby-string">&#39;/articles/1&#39;</span>, { <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;articles&quot;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;show&quot;</span>, <span class="ruby-identifier">id</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;1&quot;</span> }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should route to create article&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_routing</span>({ <span class="ruby-identifier">method</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;post&#39;</span>, <span class="ruby-identifier">path</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;/articles&#39;</span> }, { <span class="ruby-identifier">controller</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;articles&quot;</span>, <span class="ruby-identifier">action</span><span class="ruby-operator">:</span> <span class="ruby-string">&quot;create&quot;</span> })
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Testing+Your+Mailers">Testing Your Mailers<span><a href="#label-Testing+Your+Mailers">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Testing mailer classes requires some specific tools to do a thorough job.</p>

<h3 id="label-Keeping+the+Postman+in+Check">Keeping the Postman in Check<span><a href="#label-Keeping+the+Postman+in+Check">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Your mailer classes - like every other part of your Rails application -
should be tested to ensure that it is working as expected.</p>

<p>The goals of testing your mailer classes are to ensure that:</p>
<ul><li>
<p>emails are being processed (created and sent)</p>
</li><li>
<p>the email content is correct (subject, sender, body, etc)</p>
</li><li>
<p>the right emails are being sent at the right times</p>
</li></ul>

<h4 id="label-From+All+Sides">From All Sides<span><a href="#label-From+All+Sides">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>There are two aspects of testing your mailer, the unit tests and the
functional tests. In the unit tests, you run the mailer in isolation with
tightly controlled inputs and compare the output to a known value (a
fixture.) In the functional tests you don&#39;t so much test the minute
details produced by the mailer; instead, we test that our controllers and
models are using the mailer in the right way. You test to prove that the
right email was sent at the right time.</p>

<h3 id="label-Unit+Testing">Unit Testing<span><a href="#label-Unit+Testing">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>In order to test that your mailer is working as expected, you can use unit
tests to compare the actual results of the mailer with pre-written examples
of what should be produced.</p>

<h4 id="label-Revenge+of+the+Fixtures">Revenge of the Fixtures<span><a href="#label-Revenge+of+the+Fixtures">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>For the purposes of unit testing a mailer, fixtures are used to provide an
example of how the output <em>should</em> look. Because these are example
emails, and not Active Record data like the other fixtures, they are kept
in their own subdirectory apart from the other fixtures. The name of the
directory within <code>test/fixtures</code> directly corresponds to the
name of the mailer. So, for a mailer named <code>UserMailer</code>, the
fixtures should reside in <code>test/fixtures/user_mailer</code> directory.</p>

<p>When you generated your mailer, the generator creates stub fixtures for
each of the mailers actions. If you didn&#39;t use the generator you&#39;ll
have to make those files yourself.</p>

<h4 id="label-The+Basic+Test+Case">The Basic Test Case<span><a href="#label-The+Basic+Test+Case">&para;</a> <a href="#top">&uarr;</a></span></h4>

<p>Here&#39;s a unit test to test a mailer named <code>UserMailer</code> whose
action <code>invite</code> is used to send an invitation to a friend. It is
an adapted version of the base test created by the generator for an
<code>invite</code> action.</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">UserMailerTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;invite&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># Send the email, then test that it got queued</span>
    <span class="ruby-identifier">email</span> = <span class="ruby-constant">UserMailer</span>.<span class="ruby-identifier">create_invite</span>(<span class="ruby-string">&#39;me@example.com&#39;</span>,
                                     <span class="ruby-string">&#39;friend@example.com&#39;</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>).<span class="ruby-identifier">deliver_now</span>
    <span class="ruby-identifier">assert_not</span> <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">empty?</span>

    <span class="ruby-comment"># Test the body of the sent email contains what we expect it to</span>
    <span class="ruby-identifier">assert_equal</span> [<span class="ruby-string">&#39;me@example.com&#39;</span>], <span class="ruby-identifier">email</span>.<span class="ruby-identifier">from</span>
    <span class="ruby-identifier">assert_equal</span> [<span class="ruby-string">&#39;friend@example.com&#39;</span>], <span class="ruby-identifier">email</span>.<span class="ruby-identifier">to</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;You have been invited by me@example.com&#39;</span>, <span class="ruby-identifier">email</span>.<span class="ruby-identifier">subject</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">read_fixture</span>(<span class="ruby-string">&#39;invite&#39;</span>).<span class="ruby-identifier">join</span>, <span class="ruby-identifier">email</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>In the test we send the email and store the returned object in the
<code>email</code> variable. We then ensure that it was sent (the first
assert), then, in the second batch of assertions, we ensure that the email
does indeed contain what we expect. The helper <code>read_fixture</code> is
used to read in the content from this file.</p>

<p>Here&#39;s the content of the <code>invite</code> fixture:</p>

<pre>Hi friend@example.com,

You have been invited.

Cheers!</pre>

<p>This is the right time to understand a little more about writing tests for
your mailers. The line <code>ActionMailer::Base.delivery_method =
:test</code> in <code>config/environments/test.rb</code> sets the delivery
method to test mode so that email will not actually be delivered (useful to
avoid spamming your users while testing) but instead it will be appended to
an array (<code>ActionMailer::Base.deliveries</code>).</p>

<p>NOTE: The <code>ActionMailer::Base.deliveries</code> array is only reset
automatically in <code>ActionMailer::TestCase</code> tests. If you want to
have a clean slate outside Action Mailer tests, you can reset it manually
with: <code>ActionMailer::Base.deliveries.clear</code></p>

<h3 id="label-Functional+Testing">Functional Testing<span><a href="#label-Functional+Testing">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Functional testing for mailers involves more than just checking that the
email body, recipients and so forth are correct. In functional mail tests
you call the mail deliver methods and check that the appropriate emails
have been appended to the delivery list. It is fairly safe to assume that
the deliver methods themselves do their job. You are probably more
interested in whether your own business logic is sending emails when you
expect them to go out. For example, you can check that the invite friend
operation is sending an email appropriately:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">UserControllerTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionController</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;invite friend&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_difference</span> <span class="ruby-string">&#39;ActionMailer::Base.deliveries.size&#39;</span>, <span class="ruby-value">+1</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">post</span> :<span class="ruby-identifier">invite_friend</span>, <span class="ruby-identifier">email</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;friend@example.com&#39;</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">invite_email</span> = <span class="ruby-constant">ActionMailer</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">deliveries</span>.<span class="ruby-identifier">last</span>

    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;You have been invited by me@example.com&quot;</span>, <span class="ruby-identifier">invite_email</span>.<span class="ruby-identifier">subject</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;friend@example.com&#39;</span>, <span class="ruby-identifier">invite_email</span>.<span class="ruby-identifier">to</span>[<span class="ruby-value">0</span>]
    <span class="ruby-identifier">assert_match</span>(<span class="ruby-regexp">/Hi friend@example.com/</span>, <span class="ruby-identifier">invite_email</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">to_s</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Testing+helpers">Testing helpers<span><a href="#label-Testing+helpers">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>In order to test helpers, all you need to do is check that the output of
the helper method matches what you&#39;d expect. Tests related to the
helpers are located under the <code>test/helpers</code> directory.</p>

<p>A helper test looks like so:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">UserHelperTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
<span class="ruby-keyword">end</span>
</pre>

<p>A helper is just a simple module where you can define methods which are
available into your views. To test the output of the helper&#39;s methods,
you just have to use a mixin like this:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">UserHelperTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActionView</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">UserHelper</span>

  <span class="ruby-identifier">test</span> <span class="ruby-string">&quot;should return the user name&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># ...</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Moreover, since the test class extends from
<code>ActionView::TestCase</code>, you have access to Rails&#39; helper
methods such as <code>link_to</code> or <code>pluralize</code>.</p>

<h2 id="label-Testing+Jobs">Testing Jobs<span><a href="#label-Testing+Jobs">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Since your custom jobs can be queued at different levels inside your
application, you&#39;ll need to test both jobs themselves (their behavior
when they get enqueued) and that other entities correctly enqueue them.</p>

<h3 id="label-A+Basic+Test+Case">A Basic Test Case<span><a href="#label-A+Basic+Test+Case">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>By default, when you generate a job, an associated test will be generated
as well under the <code>test/jobs</code> directory. Here&#39;s an example
test with a billing job:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">BillingJobTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveJob</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&#39;that account is charged&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-constant">BillingJob</span>.<span class="ruby-identifier">perform_now</span>(<span class="ruby-identifier">account</span>, <span class="ruby-identifier">product</span>)
    <span class="ruby-identifier">assert</span> <span class="ruby-identifier">account</span>.<span class="ruby-identifier">reload</span>.<span class="ruby-identifier">charged_for?</span>(<span class="ruby-identifier">product</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This test is pretty simple and only asserts that the job get the work done
as expected.</p>

<p>By default, <code>ActiveJob::TestCase</code> will set the queue adapter to
<code>:test</code> so that your jobs are performed inline. It will also
ensure that all previously performed and enqueued jobs are cleared before
any test run so you can safely assume that no jobs have already been
executed in the scope of each test.</p>

<h3 id="label-Custom+Assertions+And+Testing+Jobs+Inside+Other+Components">Custom Assertions And Testing Jobs Inside Other Components<span><a href="#label-Custom+Assertions+And+Testing+Jobs+Inside+Other+Components">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Active Job ships with a bunch of custom assertions that can be used to
lessen the verbosity of tests:</p>

<p>| Assertion | Purpose | | ————————————– | ——- | |
<code>assert_enqueued_jobs(number)</code> | Asserts that the number of
enqueued jobs matches the given number. | |
<code>assert_performed_jobs(number)</code> | Asserts that the number of
performed jobs matches the given number. | | <code>assert_no_enqueued_jobs
{ ... }</code> | Asserts that no jobs have been enqueued. | |
<code>assert_no_performed_jobs { ... }</code> | Asserts that no jobs have
been performed. | | <code>assert_enqueued_with([args]) { ... }</code> |
Asserts that the job passed in the block has been enqueued with the given
arguments. | | <code>assert_performed_with([args]) { ... }</code>| Asserts
that the job passed in the block has been performed with the given
arguments. |</p>

<p>It&#39;s a good practice to ensure that your jobs correctly get enqueued or
performed wherever you invoke them (e.g. inside your controllers). This is
precisely where the custom assertions provided by Active Job are pretty
useful. For instance, within a model:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;test_helper&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">ProductTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveJob</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span>
  <span class="ruby-identifier">test</span> <span class="ruby-string">&#39;billing job scheduling&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">assert_enqueued_with</span>(<span class="ruby-identifier">job</span><span class="ruby-operator">:</span> <span class="ruby-constant">BillingJob</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">product</span>.<span class="ruby-identifier">charge</span>(<span class="ruby-identifier">account</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Other+Testing+Approaches">Other Testing Approaches<span><a href="#label-Other+Testing+Approaches">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The built-in <code>minitest</code> based testing is not the only way to
test Rails applications. Rails developers have come up with a wide variety
of other approaches and aids for testing, including:</p>
<ul><li>
<p><a href="http://avdi.org/projects/nulldb/">NullDB</a>, a way to speed up
testing by avoiding database use.</p>
</li><li>
<p><a href="https://github.com/thoughtbot/factory_girl/tree/master">Factory
Girl</a>, a replacement for fixtures.</p>
</li><li>
<p><a href="https://github.com/rdy/fixture_builder">Fixture Builder</a>, a
tool that compiles Ruby factories into fixtures before a test run.</p>
</li><li>
<p><a href="https://github.com/metaskills/minitest-spec-rails">MiniTest::Spec
Rails</a>, use the MiniTest::Spec DSL within your rails tests.</p>
</li><li>
<p><a href="http://www.thoughtbot.com/projects/shoulda">Shoulda</a>, an
extension to <code>test/unit</code> with additional helpers, macros, and
assertions.</p>
</li><li>
<p><a href="http://relishapp.com/rspec">RSpec</a>, a behavior-driven
development framework</p>
</li><li>
<p><a href="http://jnicklas.github.com/capybara/">Capybara</a>, Acceptance
test framework for web applications</p>
</li></ul>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

