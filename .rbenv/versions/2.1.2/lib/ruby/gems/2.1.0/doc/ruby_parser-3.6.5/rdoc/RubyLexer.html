<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class RubyLexer - ruby_parser-3.6.5 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-action">#action</a>
    
    <li ><a href="#method-i-arg_ambiguous">#arg_ambiguous</a>
    
    <li ><a href="#method-i-arg_state">#arg_state</a>
    
    <li ><a href="#method-i-beginning_of_line-3F">#beginning_of_line?</a>
    
    <li ><a href="#method-i-bol-3F">#bol?</a>
    
    <li ><a href="#method-i-check">#check</a>
    
    <li ><a href="#method-i-comments">#comments</a>
    
    <li ><a href="#method-i-d">#d</a>
    
    <li ><a href="#method-i-end_of_stream-3F">#end_of_stream?</a>
    
    <li ><a href="#method-i-expr_dot-3F">#expr_dot?</a>
    
    <li ><a href="#method-i-expr_fname-3F">#expr_fname?</a>
    
    <li ><a href="#method-i-expr_result">#expr_result</a>
    
    <li ><a href="#method-i-heredoc">#heredoc</a>
    
    <li ><a href="#method-i-heredoc_identifier">#heredoc_identifier</a>
    
    <li ><a href="#method-i-in_arg_state-3F">#in_arg_state?</a>
    
    <li ><a href="#method-i-in_fname-3F">#in_fname?</a>
    
    <li ><a href="#method-i-in_lex_state-3F">#in_lex_state?</a>
    
    <li ><a href="#method-i-int_with_base">#int_with_base</a>
    
    <li ><a href="#method-i-is_arg-3F">#is_arg?</a>
    
    <li ><a href="#method-i-is_beg-3F">#is_beg?</a>
    
    <li ><a href="#method-i-is_end-3F">#is_end?</a>
    
    <li ><a href="#method-i-is_label_possible-3F">#is_label_possible?</a>
    
    <li ><a href="#method-i-is_space_arg-3F">#is_space_arg?</a>
    
    <li ><a href="#method-i-lineno-3D">#lineno=</a>
    
    <li ><a href="#method-i-matched">#matched</a>
    
    <li ><a href="#method-i-matches">#matches</a>
    
    <li ><a href="#method-i-next_token">#next_token</a>
    
    <li ><a href="#method-i-not_end-3F">#not_end?</a>
    
    <li ><a href="#method-i-parse">#parse</a>
    
    <li ><a href="#method-i-parse_file">#parse_file</a>
    
    <li ><a href="#method-i-parse_quote">#parse_quote</a>
    
    <li ><a href="#method-i-parse_string">#parse_string</a>
    
    <li ><a href="#method-i-process_amper">#process_amper</a>
    
    <li ><a href="#method-i-process_backref">#process_backref</a>
    
    <li ><a href="#method-i-process_begin">#process_begin</a>
    
    <li ><a href="#method-i-process_bracing">#process_bracing</a>
    
    <li ><a href="#method-i-process_colon1">#process_colon1</a>
    
    <li ><a href="#method-i-process_colon2">#process_colon2</a>
    
    <li ><a href="#method-i-process_curly_brace">#process_curly_brace</a>
    
    <li ><a href="#method-i-process_float">#process_float</a>
    
    <li ><a href="#method-i-process_gvar">#process_gvar</a>
    
    <li ><a href="#method-i-process_gvar_oddity">#process_gvar_oddity</a>
    
    <li ><a href="#method-i-process_ivar">#process_ivar</a>
    
    <li ><a href="#method-i-process_lchevron">#process_lchevron</a>
    
    <li ><a href="#method-i-process_newline_or_comment">#process_newline_or_comment</a>
    
    <li ><a href="#method-i-process_nthref">#process_nthref</a>
    
    <li ><a href="#method-i-process_paren">#process_paren</a>
    
    <li ><a href="#method-i-process_paren18">#process_paren18</a>
    
    <li ><a href="#method-i-process_paren19">#process_paren19</a>
    
    <li ><a href="#method-i-process_percent">#process_percent</a>
    
    <li ><a href="#method-i-process_plus_minus">#process_plus_minus</a>
    
    <li ><a href="#method-i-process_questionmark">#process_questionmark</a>
    
    <li ><a href="#method-i-process_slash">#process_slash</a>
    
    <li ><a href="#method-i-process_square_bracket">#process_square_bracket</a>
    
    <li ><a href="#method-i-process_string">#process_string</a>
    
    <li ><a href="#method-i-process_symbol">#process_symbol</a>
    
    <li ><a href="#method-i-process_token">#process_token</a>
    
    <li ><a href="#method-i-process_token_keyword">#process_token_keyword</a>
    
    <li ><a href="#method-i-process_underscore">#process_underscore</a>
    
    <li ><a href="#method-i-rb_compile_error">#rb_compile_error</a>
    
    <li ><a href="#method-i-read_escape">#read_escape</a>
    
    <li ><a href="#method-i-regx_options">#regx_options</a>
    
    <li ><a href="#method-i-reset">#reset</a>
    
    <li ><a href="#method-i-ruby18">#ruby18</a>
    
    <li ><a href="#method-i-ruby19">#ruby19</a>
    
    <li ><a href="#method-i-scan">#scan</a>
    
    <li ><a href="#method-i-scanner_class">#scanner_class</a>
    
    <li ><a href="#method-i-space_vs_beginning">#space_vs_beginning</a>
    
    <li ><a href="#method-i-string">#string</a>
    
    <li ><a href="#method-i-tokadd_escape">#tokadd_escape</a>
    
    <li ><a href="#method-i-tokadd_string">#tokadd_string</a>
    
    <li ><a href="#method-i-unescape">#unescape</a>
    
    <li ><a href="#method-i-warning">#warning</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-RubyLexer">
  <h1 id="class-RubyLexer" class="class">
    class RubyLexer
  </h1>

  <section class="description">
    
<p>lexical scanner definition for ruby</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="ESC">ESC
        
        <dd>
        
      
        <dt id="FLOAT">FLOAT
        
        <dd>
        
      
        <dt id="FLOAT_BAD">FLOAT_BAD
        
        <dd>
        
      
        <dt id="IDENT">IDENT
        
        <dd>
        
      
        <dt id="INT_BIN">INT_BIN
        
        <dd>
        
      
        <dt id="INT_DEC">INT_DEC
        
        <dd>
        
      
        <dt id="INT_DEC2">INT_DEC2
        
        <dd>
        
      
        <dt id="INT_HEX">INT_HEX
        
        <dd>
        
      
        <dt id="INT_OCT">INT_OCT
        
        <dd>
        
      
        <dt id="INT_OCT_BAD">INT_OCT_BAD
        
        <dd>
        
      
        <dt id="NUM_BAD">NUM_BAD
        
        <dd>
        
      
        <dt id="SIMPLE_STRING">SIMPLE_STRING
        
        <dd>
        
      
        <dt id="SSTRING">SSTRING
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-brace_nest" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">brace_nest</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-cmdarg" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cmdarg</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-command_start" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">command_start</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-command_state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">command_state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-comments" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">comments</span><span
            class="attribute-access-type">[W]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-cond" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">cond</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-extra_lineno" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">extra_lineno</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-filename" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">filename</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-last_state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">last_state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-lex_state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lex_state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Additional context surrounding tokens that both the lexer and grammar use.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-lex_strterm" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lex_strterm</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-lineno" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lineno</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-lpar_beg" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">lpar_beg</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-match" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">match</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-old_lineno-3D" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">old_lineno=</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-paren_nest" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">paren_nest</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-parser" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">parser</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-space_seen" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">space_seen</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-ss" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">ss</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-state" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">state</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-string_buffer" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">string_buffer</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-string_nest" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">string_nest</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-token" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">token</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Last token read via next_token.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-version" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">version</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>What version of ruby to parse. 18 and 19 are the only valid values
currently supported.</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(v = 18)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 103</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">v</span> = <span class="ruby-value">18</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">version</span> = <span class="ruby-identifier">v</span>

  <span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-action" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">action</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="action-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rex.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">action</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-arg_ambiguous" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">arg_ambiguous</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="arg_ambiguous-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 109</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">arg_ambiguous</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;Ambiguous first argument. make sure.&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-arg_state" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">arg_state</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="arg_state-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 113</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">arg_state</span>
  <span class="ruby-identifier">in_arg_state?</span> <span class="ruby-operator">?</span> <span class="ruby-value">:expr_arg</span> <span class="ruby-operator">:</span> <span class="ruby-value">:expr_beg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-beginning_of_line-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">beginning_of_line?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="beginning_of_line-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 117</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">beginning_of_line?</span>
  <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">bol?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="RubyLexer.html#method-i-bol-3F">bol?</a>
        </div>
        

        
      </div>

    
      <div id="method-i-bol-3F" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">bol?</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="RubyLexer.html#method-i-beginning_of_line-3F">beginning_of_line?</a>
        </div>
        
      </div>

    
      <div id="method-i-check" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">check</span><span
            class="method-args">(re)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="check-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">check</span> <span class="ruby-identifier">re</span>
  <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span> <span class="ruby-identifier">re</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-comments" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">comments</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="comments-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 126</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">comments</span> <span class="ruby-comment"># TODO: remove this... maybe comment_string + attr_accessor</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">join</span>
  <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-d" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">d</span><span
            class="method-args">(o)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="d-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 1169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">d</span> <span class="ruby-identifier">o</span>
  <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">o</span>.<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-end_of_stream-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">end_of_stream?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="end_of_stream-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">end_of_stream?</span>
  <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">eos?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-expr_dot-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">expr_dot?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="expr_dot-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 136</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">expr_dot?</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-value">:expr_dot</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-expr_fname-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">expr_fname?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="expr_fname-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 140</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">expr_fname?</span>
  <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-value">:expr_fname</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-expr_result" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">expr_result</span><span
            class="method-args">(token, text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="expr_result-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">expr_result</span> <span class="ruby-identifier">token</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">push</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-identifier">token</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-heredoc" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">heredoc</span><span
            class="method-args">(here)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="heredoc-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 150</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">heredoc</span> <span class="ruby-identifier">here</span> <span class="ruby-comment"># TODO: rewrite / remove</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">eos</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">last_line</span> = <span class="ruby-identifier">here</span>

  <span class="ruby-identifier">indent</span>  = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_INDENT</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;[ \t]*&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">expand</span>  = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">eos_re</span>  = <span class="ruby-node">/#{indent}#{Regexp.escape eos}(\r*\n|\z)/</span>
  <span class="ruby-identifier">err_msg</span> = <span class="ruby-node">&quot;can&#39;t match #{eos_re.inspect} anywhere in &quot;</span>

  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">beginning_of_line?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">eos_re</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">unread_many</span> <span class="ruby-identifier">last_line</span> <span class="ruby-comment"># TODO: figure out how to remove this</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_END</span>, <span class="ruby-identifier">eos</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> = []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">expand</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#[$@]/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># FIX omg stupid</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DVAR</span>, <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#[{]/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DBEG</span>, <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;#&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">begin</span>
      <span class="ruby-identifier">c</span> = <span class="ruby-identifier">tokadd_string</span> <span class="ruby-identifier">func</span>, <span class="ruby-string">&quot;\n&quot;</span>, <span class="ruby-keyword">nil</span>

      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword">if</span>
        <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;\n&quot;</span> <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_CONTENT</span>, <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;\r&quot;</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\n/</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>
    <span class="ruby-keyword">end</span> <span class="ruby-keyword">until</span> <span class="ruby-identifier">check</span>(<span class="ruby-identifier">eos_re</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">until</span> <span class="ruby-identifier">check</span>(<span class="ruby-identifier">eos_re</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/.*(\n|\z)/</span>)
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">err_msg</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-value">:heredoc</span>, <span class="ruby-identifier">eos</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">last_line</span>]

  <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_CONTENT</span>, <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;\r&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-heredoc_identifier" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">heredoc_identifier</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="heredoc_identifier-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">heredoc_identifier</span> <span class="ruby-comment"># TODO: remove / rewrite</span>
  <span class="ruby-identifier">term</span>, <span class="ruby-identifier">func</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-constant">STR_FUNC_BORING</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> = []

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/(-?)([\\&quot;\`])(.*?)\2/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">term</span> = <span class="ruby-identifier">ss</span>[<span class="ruby-value">2</span>]
    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_INDENT</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-keyword">case</span> <span class="ruby-identifier">term</span>
            <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;\&#39;&quot;</span> <span class="ruby-keyword">then</span>
              <span class="ruby-constant">STR_SQUOTE</span>
            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;&quot;&#39;</span> <span class="ruby-keyword">then</span>
              <span class="ruby-constant">STR_DQUOTE</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-constant">STR_XQUOTE</span>
            <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ss</span>[<span class="ruby-value">3</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/-?([\\&quot;\`])(?!\1*\Z)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated here document identifier&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/(-?)(#{IDENT_CHAR}+)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">term</span> = <span class="ruby-string">&#39;&quot;&#39;</span>
    <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_DQUOTE</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">func</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">STR_FUNC_INDENT</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">ss</span>[<span class="ruby-value">2</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/.*\n/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># TODO: think about storing off the char range instead</span>
    <span class="ruby-identifier">line</span> = <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">line</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-value">:heredoc</span>, <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>, <span class="ruby-identifier">func</span>, <span class="ruby-identifier">line</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">term</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;`&#39;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tXSTRING_BEG</span>, <span class="ruby-string">&quot;`&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSTRING_BEG</span>, <span class="ruby-string">&quot;\&quot;&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-in_arg_state-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">in_arg_state?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="in_arg_state-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 255</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">in_arg_state?</span> <span class="ruby-comment"># TODO: rename is_after_operator?</span>
  <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_fname</span>, <span class="ruby-value">:expr_dot</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-in_fname-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">in_fname?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="in_fname-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 251</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">in_fname?</span>
  <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_fname</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-in_lex_state-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">in_lex_state?</span><span
            class="method-args">(*states)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="in_lex_state-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">states</span>)
  <span class="ruby-identifier">states</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">lex_state</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-int_with_base" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">int_with_base</span><span
            class="method-args">(base)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="int_with_base-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 263</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">int_with_base</span> <span class="ruby-identifier">base</span>
  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid numeric format&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">matched</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/__/</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tINTEGER</span>, <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-identifier">base</span>))
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-is_arg-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_arg?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_arg-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 268</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_arg?</span>
  <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_arg</span>, <span class="ruby-value">:expr_cmdarg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-is_beg-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_beg?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_beg-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 272</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_beg?</span>
  <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:expr_value</span>, <span class="ruby-value">:expr_mid</span>, <span class="ruby-value">:expr_class</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-is_end-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_end?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_end-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 276</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_end?</span>
  <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_end</span>, <span class="ruby-value">:expr_endarg</span>, <span class="ruby-value">:expr_endfn</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-is_label_possible-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_label_possible?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_label_possible-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_label_possible?</span>
  (<span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:expr_endfn</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">command_state</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">is_arg?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-is_space_arg-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">is_space_arg?</span><span
            class="method-args">(c = "x")</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="is_space_arg-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 284</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">is_space_arg?</span> <span class="ruby-identifier">c</span> = <span class="ruby-string">&quot;x&quot;</span>
  <span class="ruby-identifier">is_arg?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/\s/</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-lineno-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">lineno=</span><span
            class="method-args">(n)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="lineno-3D-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 1173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">lineno=</span> <span class="ruby-identifier">n</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_lineno</span>= <span class="ruby-identifier">n</span>
  <span class="ruby-identifier">where</span> = <span class="ruby-identifier">caller</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/:/</span>).<span class="ruby-identifier">first</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;:&quot;</span>)
  <span class="ruby-identifier">d</span> <span class="ruby-value">:lineno</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">n</span>, <span class="ruby-identifier">where</span>, <span class="ruby-identifier">ss</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">rest</span>[<span class="ruby-value">0</span>,<span class="ruby-value">40</span>]]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-matched" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">matched</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="matched-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 288</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">matched</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-matches" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">matches</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="matches-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rex.rb, line 35</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">matches</span>
  <span class="ruby-identifier">m</span> = (<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">9</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ss</span>[<span class="ruby-identifier">i</span>] }
  <span class="ruby-identifier">m</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword">until</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">-1</span>] <span class="ruby-keyword">or</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">m</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-next_token" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">next_token</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="next_token-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rex.rb, line 64</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_token</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">process_string</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_strterm</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_state</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span>    = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">last_state</span>    = <span class="ruby-identifier">lex_state</span>

  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">until</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">eos?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">token</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">token</span> =
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">state</span>
      <span class="ruby-keyword">when</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">case</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[\ \t\r\f\v]/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword">true</span>; <span class="ruby-keyword">next</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/\n|\#/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_newline_or_comment</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[\]\)\}]/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_bracing</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\!/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_arg_state?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\!\@/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_arg</span>, <span class="ruby-value">:tUBANG</span>, <span class="ruby-string">&quot;!@&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\![=~]?/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\!/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\./</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\.\.\.?/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\.\d/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;no .&lt;digit&gt; floating literal anymore put 0 before dot&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\./</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_dot</span>, <span class="ruby-value">:tDOT</span>, <span class="ruby-string">&quot;.&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\./</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\(/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_paren</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\,/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/=/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=\=\=|\=\=|\=~|\=&gt;|\=(?!begin\b)/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-identifier">arg_state</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">bol?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=begin(?=\s)/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_begin</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=(?=begin\b)/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-identifier">arg_state</span>, <span class="ruby-constant">TOKENS</span>[<span class="ruby-identifier">text</span>], <span class="ruby-identifier">text</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /=/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/\&quot;(#{SIMPLE_STRING})\&quot;/o</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tSTRING</span>, <span class="ruby-identifier">text</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESC</span>) { <span class="ruby-identifier">unescape</span> <span class="ruby-node">$1</span> } }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&quot;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_DQUOTE</span>; <span class="ruby-identifier">result</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">:tSTRING_BEG</span>, <span class="ruby-identifier">text</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\@\@?\d/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;`#{text}` is not allowed as a variable name&quot;</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/\@\@?#{IDENT_CHAR}+/o</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_ivar</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/:/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">not_end?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/:([a-zA-Z_]#{IDENT_CHAR}*(?:[?]|[!](?!=)|=(?==&gt;)|=(?![=&gt;]))?)/o</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_symbol</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">not_end?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/\:\&quot;(#{SIMPLE_STRING})\&quot;/o</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_symbol</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">not_end?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/\:\(#{SSTRING})\/o</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_symbol</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\:\:/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_colon2</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\:/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_colon1</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /:/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/-&gt;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_endfn</span>, <span class="ruby-value">:tLAMBDA</span>, <span class="ruby-keyword">nil</span> }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[+-]/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_plus_minus</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/[+\d]/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{NUM_BAD}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid numeric format&quot;</span>  }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{INT_DEC}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">10</span>                           }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{INT_HEX}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">16</span>                           }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{INT_BIN}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">2</span>                            }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{INT_OCT_BAD}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Illegal octal digit.&quot;</span>    }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{INT_OCT}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">8</span>                            }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{FLOAT_BAD}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Trailing &#39;_&#39; in number.&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{FLOAT}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_float</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{INT_DEC2}/o</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">int_with_base</span> <span class="ruby-value">10</span>                           }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[0-9]/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Bad number format&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /[+\d]/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\[/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_square_bracket</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/\#{SSTRING}\/o</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tSTRING</span>, <span class="ruby-identifier">matched</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-2</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\\/</span>, <span class="ruby-string">&quot;\\&quot;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\&#39;/</span>, <span class="ruby-string">&quot;&#39;&quot;</span>) } <span class="ruby-comment"># &quot; stupid emacs</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\|/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\|\|\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;||&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\|\|/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOROP</span>,    <span class="ruby-string">&quot;||&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\|\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;|&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\|/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tPIPE</span>,    <span class="ruby-string">&quot;|&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\|/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\{/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_curly_brace</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\*/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\*\*=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;**&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\*\*/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-identifier">space_vs_beginning</span>(<span class="ruby-value">:tDSTAR</span>, <span class="ruby-value">:tDSTAR</span>, <span class="ruby-value">:tPOW</span>), <span class="ruby-string">&quot;**&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\*\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;*&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\*/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-identifier">space_vs_beginning</span>(<span class="ruby-value">:tSTAR</span>, <span class="ruby-value">:tSTAR</span>, <span class="ruby-value">:tSTAR2</span>), <span class="ruby-string">&quot;*&quot;</span>) }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\*/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/&lt;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&lt;\=\&gt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tCMP</span>, <span class="ruby-string">&quot;&lt;=&gt;&quot;</span>    }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&lt;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tLEQ</span>, <span class="ruby-string">&quot;&lt;=&quot;</span>     }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&lt;\&lt;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&lt;&lt;&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&lt;\&lt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_lchevron</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&lt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tLT</span>, <span class="ruby-string">&quot;&lt;&quot;</span>       }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /&lt;/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/&gt;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&gt;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tGEQ</span>, <span class="ruby-string">&quot;&gt;=&quot;</span>     }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&gt;\&gt;=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&gt;&gt;&quot;</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&gt;\&gt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tRSHFT</span>, <span class="ruby-string">&quot;&gt;&gt;&quot;</span>   }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&gt;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span> <span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tGT</span>, <span class="ruby-string">&quot;&gt;&quot;</span>       }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /&gt;/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\`/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">expr_fname?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\`/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tBACK_REF2</span>, <span class="ruby-string">&quot;`&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">expr_dot?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\`/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>((<span class="ruby-identifier">command_state</span> <span class="ruby-operator">?</span> <span class="ruby-value">:expr_cmdarg</span> <span class="ruby-operator">:</span> <span class="ruby-value">:expr_arg</span>), <span class="ruby-value">:tBACK_REF2</span>, <span class="ruby-string">&quot;`&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\`/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_XQUOTE</span>, <span class="ruby-string">&#39;`&#39;</span>; <span class="ruby-identifier">result</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-value">:tXSTRING_BEG</span>, <span class="ruby-string">&quot;`&quot;</span>) }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\`/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\?/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_questionmark</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/&amp;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&amp;\&amp;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&amp;&amp;&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&amp;\&amp;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tANDOP</span>,   <span class="ruby-string">&quot;&amp;&amp;&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&amp;\=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;&amp;&quot;</span> ) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&amp;/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_amper</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /&amp;/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\//</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_slash</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\^/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\^=/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;^&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\^/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tCARET</span>, <span class="ruby-string">&quot;^&quot;</span>) }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\^/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\;/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>; <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tSEMI</span>, <span class="ruby-string">&quot;;&quot;</span>) }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/~/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_arg_state?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\~@/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tTILDE</span>, <span class="ruby-string">&quot;~&quot;</span>) }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\~/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tTILDE</span>, <span class="ruby-string">&quot;~&quot;</span>) }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /~/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\r?\n/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>; <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword">true</span>; <span class="ruby-keyword">next</span> }
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;bare backslash only allowed before newline&quot;</span> }
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\\/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\%/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_percent</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\$/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-keyword">case</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$_\w+/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$_/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$[~*$?!@\/\;,.=:&lt;&gt;\&quot;]|\$-\w?/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_fname?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([\&amp;\`\\+])/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([\&amp;\`\\+])/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_backref</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_fname?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([1-9]\d*)/</span>)) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$([1-9]\d*)/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_nthref</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$0/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$\W|\$\z/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar_oddity</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\$\w+/</span>) <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
          <span class="ruby-keyword">end</span> <span class="ruby-comment"># group /\$/</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\_/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_underscore</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{IDENT}/o</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">process_token</span> <span class="ruby-identifier">text</span>
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\004|\032|\000|\Z/</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { [<span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>, <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>] }
        <span class="ruby-keyword">when</span> <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/./</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">action</span> { <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;Invalid char #{text.inspect} in expression&quot;</span> }
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">text</span> = <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">string</span>[<span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">..</span> <span class="ruby-value">-1</span>]
          <span class="ruby-identifier">raise</span> <span class="ruby-constant">ScanError</span>, <span class="ruby-node">&quot;can not match (#{state.inspect}): &#39;#{text}&#39;&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">raise</span> <span class="ruby-constant">ScanError</span>, <span class="ruby-node">&quot;undefined state: &#39;#{state}&#39;&quot;</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment"># token = case state</span>

    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">token</span> <span class="ruby-comment"># allow functions to trigger redo w/ nil</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment"># while</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;bad lexical result: #{token.inspect}&quot;</span> <span class="ruby-keyword">unless</span>
    <span class="ruby-identifier">token</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> (<span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">2</span>)

  <span class="ruby-comment"># auto-switch state</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">token</span>.<span class="ruby-identifier">last</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">token</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-value">:state</span>

  <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-not_end-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">not_end?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="not_end-3F-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 292</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">not_end?</span>
  <span class="ruby-keyword">not</span> <span class="ruby-identifier">is_end?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse</span><span
            class="method-args">(str)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rex.rb, line 50</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse</span> <span class="ruby-identifier">str</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ss</span>     = <span class="ruby-identifier">scanner_class</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">str</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">state</span>  <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">do_parse</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_file</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_file-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rex.rb, line 57</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_file</span> <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">filename</span> = <span class="ruby-identifier">path</span>
  <span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">parse</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse_quote" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_quote</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_quote-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 1054</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_quote</span> <span class="ruby-comment"># TODO: remove / rewrite</span>
  <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">nnd</span>, <span class="ruby-identifier">short_hand</span>, <span class="ruby-identifier">c</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-keyword">false</span>, <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[a-z0-9]{1,2}/i</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># Long-hand (e.g. %Q{}).</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unknown type of %string&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">matched_size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">c</span>, <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">short_hand</span> = <span class="ruby-identifier">matched</span>, <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">getch</span>, <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">else</span>                               <span class="ruby-comment"># Short-hand (e.g. %{, %., %!, etc)</span>
    <span class="ruby-identifier">c</span>, <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">short_hand</span> = <span class="ruby-string">&#39;Q&#39;</span>, <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">getch</span>, <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">beg</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated quoted string meets end of file&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Figure nnd-char.  &quot;\0&quot; is special to indicate beg=nnd and that no nesting?</span>
  <span class="ruby-identifier">nnd</span> = { <span class="ruby-string">&quot;(&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;)&quot;</span>, <span class="ruby-string">&quot;[&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;]&quot;</span>, <span class="ruby-string">&quot;{&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;}&quot;</span>, <span class="ruby-string">&quot;&lt;&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;&gt;&quot;</span> }[<span class="ruby-identifier">beg</span>]
  <span class="ruby-identifier">nnd</span>, <span class="ruby-identifier">beg</span> = <span class="ruby-identifier">beg</span>, <span class="ruby-string">&quot;\0&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">nnd</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">token_type</span>, <span class="ruby-identifier">text</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-node">&quot;%#{c}#{beg}&quot;</span>
  <span class="ruby-identifier">token_type</span>, <span class="ruby-identifier">string_type</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">c</span>
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;Q&#39;</span> <span class="ruby-keyword">then</span>
                              <span class="ruby-identifier">ch</span> = <span class="ruby-identifier">short_hand</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">nnd</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">beg</span>
                              <span class="ruby-identifier">text</span> = <span class="ruby-node">&quot;%#{ch}&quot;</span>
                              [<span class="ruby-value">:tSTRING_BEG</span>,   <span class="ruby-constant">STR_DQUOTE</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;q&#39;</span> <span class="ruby-keyword">then</span>
                              [<span class="ruby-value">:tSTRING_BEG</span>,   <span class="ruby-constant">STR_SQUOTE</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;W&#39;</span> <span class="ruby-keyword">then</span>
                              <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s*/</span>)
                              [<span class="ruby-value">:tWORDS_BEG</span>,    <span class="ruby-constant">STR_DQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">then</span>
                              <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s*/</span>)
                              [<span class="ruby-value">:tQWORDS_BEG</span>,   <span class="ruby-constant">STR_SQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;x&#39;</span> <span class="ruby-keyword">then</span>
                              [<span class="ruby-value">:tXSTRING_BEG</span>,  <span class="ruby-constant">STR_XQUOTE</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;r&#39;</span> <span class="ruby-keyword">then</span>
                              [<span class="ruby-value">:tREGEXP_BEG</span>,   <span class="ruby-constant">STR_REGEXP</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;s&#39;</span> <span class="ruby-keyword">then</span>
                              <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>  = <span class="ruby-value">:expr_fname</span>
                              [<span class="ruby-value">:tSYMBEG</span>,       <span class="ruby-constant">STR_SSYM</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;I&#39;</span> <span class="ruby-keyword">then</span>
                              <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s*/</span>)
                              [<span class="ruby-value">:tSYMBOLS_BEG</span>, <span class="ruby-constant">STR_DQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
                            <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;i&#39;</span> <span class="ruby-keyword">then</span>
                              <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s*/</span>)
                              [<span class="ruby-value">:tQSYMBOLS_BEG</span>, <span class="ruby-constant">STR_SQUOTE</span> <span class="ruby-operator">|</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>]
                            <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;Bad %string type. Expected [QqWwIixrs], found &#39;#{c}&#39;.&quot;</span> <span class="ruby-keyword">if</span>
    <span class="ruby-identifier">token_type</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;huh&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">string_type</span>

  <span class="ruby-identifier">string</span> <span class="ruby-identifier">string_type</span>, <span class="ruby-identifier">nnd</span>, <span class="ruby-identifier">beg</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">token_type</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_string</span><span
            class="method-args">(quote)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_string-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 1111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_string</span> <span class="ruby-identifier">quote</span> <span class="ruby-comment"># TODO: rewrite / remove</span>
  <span class="ruby-identifier">_</span>, <span class="ruby-identifier">string_type</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">open</span> = <span class="ruby-identifier">quote</span>

  <span class="ruby-identifier">space</span> = <span class="ruby-keyword">false</span> <span class="ruby-comment"># FIX: remove these</span>
  <span class="ruby-identifier">func</span> = <span class="ruby-identifier">string_type</span>
  <span class="ruby-identifier">paren</span> = <span class="ruby-identifier">open</span>
  <span class="ruby-identifier">term_re</span> = <span class="ruby-identifier">@@regexp_cache</span>[<span class="ruby-identifier">term</span>]

  <span class="ruby-identifier">qwords</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">regexp</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_REGEXP</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">expand</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">func</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># nil&#39;ed from qwords below. *sigh*</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_END</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">space</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">qwords</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s+/</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#{term_re}/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">qwords</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">quote</span>[<span class="ruby-value">1</span>] = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSPACE</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">regexp</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tREGEXP_END</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">regx_options</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_END</span>, <span class="ruby-identifier">term</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-value">:tSPACE</span>, <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">space</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> = []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">expand</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#(?=[$@])/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DVAR</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#[{]/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_DBEG</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;#&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tokadd_string</span>(<span class="ruby-identifier">func</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span>) <span class="ruby-operator">==</span> <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unterminated string meets end of file&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-value">:tSTRING_CONTENT</span>, <span class="ruby-identifier">string_buffer</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_amper" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_amper</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_amper-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 296</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_amper</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
             <span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;`&amp;&#39; interpreted as argument prefix&quot;</span>)
             <span class="ruby-value">:tAMPER</span>
           <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:expr_mid</span> <span class="ruby-keyword">then</span>
             <span class="ruby-value">:tAMPER</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-value">:tAMPER2</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-identifier">token</span>, <span class="ruby-string">&quot;&amp;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_backref" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_backref</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_backref-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 309</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_backref</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_sym</span>
  <span class="ruby-comment"># TODO: can&#39;t do lineno hack w/ symbol</span>
  <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tBACK_REF</span>, <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_begin" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_begin</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_begin-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 315</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_begin</span> <span class="ruby-identifier">text</span>
  <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/.*?\n=end( |\t|\f)*[^\n]*(\n|\z)/m</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@comments</span>.<span class="ruby-identifier">clear</span>
    <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;embedded document meets end of file&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&quot;\n&quot;</span>)

  <span class="ruby-keyword">nil</span> <span class="ruby-comment"># TODO</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_bracing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_bracing</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_bracing-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 329</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_bracing</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">lexpop</span>
  <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">lexpop</span>

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;}&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">brace_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-value">:expr_endarg</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tRCURLY</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;]&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-value">:expr_endarg</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tRBRACK</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;)&quot;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-value">:expr_endfn</span>
    <span class="ruby-keyword">return</span> <span class="ruby-value">:tRPAREN</span>, <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown bracing: #{matched.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_colon1" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_colon1</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_colon1-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 351</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_colon1</span> <span class="ruby-identifier">text</span>
  <span class="ruby-comment"># ?: / then / when</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_end?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span> <span class="ruby-operator">:</span><span class="ruby-identifier">expr_beg</span>, <span class="ruby-value">:tCOLON</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_SSYM</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\&quot;/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_DSYM</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_fname</span>, <span class="ruby-value">:tSYMBEG</span>, <span class="ruby-identifier">text</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_colon2" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_colon2</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_colon2-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 367</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_colon2</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_class</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">is_space_arg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tCOLON3</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_dot</span>, <span class="ruby-value">:tCOLON2</span>, <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_curly_brace" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_curly_brace</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_curly_brace-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 375</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_curly_brace</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">brace_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">lpar_beg</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lpar_beg</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">paren_nest</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lpar_beg</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">expr_result</span>(<span class="ruby-value">:tLAMBEG</span>, <span class="ruby-string">&quot;{&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:expr_endfn</span>) <span class="ruby-keyword">then</span>
             <span class="ruby-value">:tLCURLY</span>      <span class="ruby-comment">#  block (primary)</span>
           <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_endarg</span>) <span class="ruby-keyword">then</span>
             <span class="ruby-value">:tLBRACE_ARG</span>  <span class="ruby-comment">#  block (expr)</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-value">:tLBRACE</span>      <span class="ruby-comment">#  hash</span>
           <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tLBRACE</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">expr_result</span>(<span class="ruby-identifier">token</span>, <span class="ruby-string">&quot;{&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_float" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_float</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_float-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 397</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_float</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid numeric format&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/__/</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tFLOAT</span>, <span class="ruby-identifier">text</span>.<span class="ruby-identifier">to_f</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_gvar" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_gvar</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_gvar-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 402</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_gvar</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>
  <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tGVAR</span>, <span class="ruby-identifier">text</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_gvar_oddity" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_gvar_oddity</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_gvar_oddity-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 407</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_gvar_oddity</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_end</span>, <span class="ruby-string">&quot;$&quot;</span>, <span class="ruby-string">&quot;$&quot;</span> <span class="ruby-comment"># TODO: wtf is this?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_ivar" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_ivar</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_ivar-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 411</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_ivar</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">tok_id</span> = <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^@@/</span> <span class="ruby-operator">?</span> <span class="ruby-value">:tCVAR</span> <span class="ruby-operator">:</span> <span class="ruby-value">:tIVAR</span>
  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-identifier">tok_id</span>, <span class="ruby-identifier">text</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_lchevron" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_lchevron</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_lchevron-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 417</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_lchevron</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> (<span class="ruby-operator">!</span><span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_dot</span>, <span class="ruby-value">:expr_class</span>) <span class="ruby-operator">&amp;&amp;</span>
      <span class="ruby-operator">!</span><span class="ruby-identifier">is_end?</span> <span class="ruby-operator">&amp;&amp;</span>
      (<span class="ruby-operator">!</span><span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">space_seen</span>)) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">tok</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">heredoc_identifier</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">tok</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tok</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tLSHFT</span>, <span class="ruby-string">&quot;\&lt;\&lt;&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_newline_or_comment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_newline_or_comment</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_newline_or_comment-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 428</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_newline_or_comment</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-identifier">matched</span>
  <span class="ruby-identifier">hit</span> = <span class="ruby-keyword">false</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;#&#39;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>

    <span class="ruby-keyword">while</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/\s*\#.*(\n+|\z)/</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">hit</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">size</span>
      <span class="ruby-ivar">@comments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-node">/^ +#/</span>, <span class="ruby-string">&#39;#&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/^ +$/</span>, <span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">hit</span>

  <span class="ruby-comment"># Replace a string of newlines with a single one</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">lines</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">size</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\n+/</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:expr_value</span>, <span class="ruby-value">:expr_class</span>,
                          <span class="ruby-value">:expr_fname</span>, <span class="ruby-value">:expr_dot</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/([\ \t\r\f\v]*)\./</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">empty?</span>

    <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\.\./</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tNL</span>, <span class="ruby-keyword">nil</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_nthref" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_nthref</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_nthref-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 464</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_nthref</span> <span class="ruby-identifier">text</span>
  <span class="ruby-comment"># TODO: can&#39;t do lineno hack w/ number</span>
  <span class="ruby-identifier">result</span> <span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tNTH_REF</span>, <span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_paren" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_paren</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_paren-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 469</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_paren</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">ruby18</span> <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">process_paren18</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">process_paren19</span>
          <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">expr_result</span>(<span class="ruby-identifier">token</span>, <span class="ruby-string">&quot;(&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_paren18" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_paren18</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_paren18-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 481</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_paren18</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLPAREN2</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:expr_mid</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLPAREN</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_cmdarg</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLPAREN_ARG</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_arg</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">warning</span> <span class="ruby-string">&quot;don&#39;t put space before argument parentheses&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># not a ternary -- do nothing?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_paren19" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_paren19</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_paren19-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 500</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_paren19</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-value">:tLPAREN</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_space_arg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-value">:tLPAREN_ARG</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-value">:tLPAREN2</span> <span class="ruby-comment"># plain &#39;(&#39; in parse.y</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_percent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_percent</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_percent-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 510</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_percent</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">parse_quote</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;%&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=/</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">parse_quote</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tPERCENT</span>, <span class="ruby-string">&quot;%&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_plus_minus" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_plus_minus</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_plus_minus-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 520</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_plus_minus</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">sign</span> = <span class="ruby-identifier">matched</span>
  <span class="ruby-identifier">utype</span>, <span class="ruby-identifier">type</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">sign</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;+&quot;</span> <span class="ruby-keyword">then</span>
                  [<span class="ruby-value">:tUPLUS</span>, <span class="ruby-value">:tPLUS</span>]
                <span class="ruby-keyword">else</span>
                  [<span class="ruby-value">:tUMINUS</span>, <span class="ruby-value">:tMINUS</span>]
                <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_arg_state?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/@/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_arg</span>, <span class="ruby-identifier">utype</span>, <span class="ruby-node">&quot;#{sign}@&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_arg</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">sign</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-identifier">sign</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=/</span>)

  <span class="ruby-keyword">if</span> (<span class="ruby-identifier">is_beg?</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s/</span>))) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">arg_ambiguous</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\d/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">utype</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tUPLUS</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tUMINUS_NUM</span>, <span class="ruby-identifier">sign</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-identifier">utype</span>, <span class="ruby-identifier">sign</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">sign</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_questionmark" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_questionmark</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_questionmark-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 552</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_questionmark</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_end?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">state</span> = <span class="ruby-identifier">ruby18</span> <span class="ruby-operator">?</span> <span class="ruby-value">:expr_beg</span> <span class="ruby-operator">:</span> <span class="ruby-value">:expr_value</span> <span class="ruby-comment"># HACK?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-value">:tEH</span>, <span class="ruby-string">&quot;?&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-node">&quot;incomplete character syntax: parsed #{text.inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\s|\v/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">c2</span> = { <span class="ruby-string">&quot; &quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;s&#39;</span>,
            <span class="ruby-string">&quot;\n&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;n&#39;</span>,
            <span class="ruby-string">&quot;\t&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;t&#39;</span>,
            <span class="ruby-string">&quot;\v&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;v&#39;</span>,
            <span class="ruby-string">&quot;\r&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;r&#39;</span>,
            <span class="ruby-string">&quot;\f&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;f&#39;</span> }[<span class="ruby-identifier">matched</span>]

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">c2</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">warning</span>(<span class="ruby-string">&quot;invalid character syntax; use ?\\&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c2</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># ternary</span>
    <span class="ruby-identifier">state</span> = <span class="ruby-identifier">ruby18</span> <span class="ruby-operator">?</span> <span class="ruby-value">:expr_beg</span> <span class="ruby-operator">:</span> <span class="ruby-value">:expr_value</span> <span class="ruby-comment"># HACK?</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-value">:tEH</span>, <span class="ruby-string">&quot;?&quot;</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\w(?=\w)/</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># ternary, also</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tEH</span>, <span class="ruby-string">&quot;?&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">c</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_escape</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">getch</span>
      <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">version</span> <span class="ruby-operator">==</span> <span class="ruby-value">18</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tINTEGER</span>, <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xff</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tSTRING</span>, <span class="ruby-identifier">c</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_slash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_slash</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_slash-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 596</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_slash</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_REGEXP</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-value">:tREGEXP_BEG</span>, <span class="ruby-string">&quot;/&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\=/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tOP_ASGN</span>, <span class="ruby-string">&quot;/&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">arg_ambiguous</span>
      <span class="ruby-identifier">string</span> <span class="ruby-constant">STR_REGEXP</span>, <span class="ruby-string">&quot;/&quot;</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-keyword">nil</span>, <span class="ruby-value">:tREGEXP_BEG</span>, <span class="ruby-string">&quot;/&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:arg_state</span>, <span class="ruby-value">:tDIVIDE</span>, <span class="ruby-string">&quot;/&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_square_bracket" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_square_bracket</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_square_bracket-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 618</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_square_bracket</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_arg_state?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\]\=/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># HACK? I dunno, or bug in MRI</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_arg</span>, <span class="ruby-value">:tASET</span>, <span class="ruby-string">&quot;[]=&quot;</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\]/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-comment"># HACK? I dunno, or bug in MRI</span>
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_arg</span>, <span class="ruby-value">:tAREF</span>, <span class="ruby-string">&quot;[]&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;unexpected &#39;[&#39;&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLBRACK</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">space_seen</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLBRACK</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">token</span> = <span class="ruby-value">:tLBRACK2</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">expr_result</span>(<span class="ruby-identifier">token</span>, <span class="ruby-string">&quot;[&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_string</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_string-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 1037</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_string</span> <span class="ruby-comment"># TODO: rewrite / remove</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">lex_strterm</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:heredoc</span> <span class="ruby-keyword">then</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">heredoc</span> <span class="ruby-identifier">lex_strterm</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parse_string</span> <span class="ruby-identifier">lex_strterm</span>
          <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">token_type</span>, <span class="ruby-identifier">_</span> = <span class="ruby-identifier">token</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">token_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tSTRING_END</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">token_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:tREGEXP_END</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>   = <span class="ruby-value">:expr_end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">token</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_symbol" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_symbol</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_symbol-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 645</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_symbol</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">symbol</span> = <span class="ruby-identifier">match</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-constant">ESC</span>) { <span class="ruby-identifier">unescape</span> <span class="ruby-node">$1</span> }

  <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;symbol cannot contain &#39;\\0&#39;&quot;</span> <span class="ruby-keyword">if</span>
    <span class="ruby-identifier">ruby18</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">symbol</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\0/</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_end</span>, <span class="ruby-value">:tSYMBOL</span>, <span class="ruby-identifier">symbol</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_token" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_token</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_token-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 654</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_token</span> <span class="ruby-identifier">text</span>
  <span class="ruby-comment"># TODO: make this always return [token, lineno]</span>
  <span class="ruby-identifier">token</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">token</span> = <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">token</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[\!\?](?!=)/</span>)

  <span class="ruby-identifier">tok_id</span> =
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[!?]$/</span> <span class="ruby-keyword">then</span>
      <span class="ruby-value">:tFID</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_fname</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/=(?:(?![~&gt;=])|(?==&gt;))/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># ident=, not =~ =&gt; == or followed by =&gt;</span>
      <span class="ruby-comment"># TODO test lexing of a=&gt;b vs a==&gt;b</span>
      <span class="ruby-identifier">token</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
      <span class="ruby-value">:tIDENTIFIER</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">token</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^[A-Z]/</span> <span class="ruby-keyword">then</span>
      <span class="ruby-value">:tCONSTANT</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-value">:tIDENTIFIER</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">ruby18</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">is_label_possible?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/:(?!:)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:tLABEL</span>, [<span class="ruby-identifier">token</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_dot</span> <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># See if it is a reserved word.</span>
    <span class="ruby-identifier">keyword</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">ruby18</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># REFACTOR need 18/19 lexer subclasses</span>
                <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyword</span>.<span class="ruby-identifier">keyword18</span> <span class="ruby-identifier">token</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">Keyword</span>.<span class="ruby-identifier">keyword19</span> <span class="ruby-identifier">token</span>
              <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">process_token_keyword</span> <span class="ruby-identifier">keyword</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">keyword</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment"># unless in_lex_state? :expr_dot</span>

  <span class="ruby-comment"># TODO:</span>
  <span class="ruby-comment"># if (mb == ENC_CODERANGE_7BIT &amp;&amp; lex_state != EXPR_DOT) {</span>

  <span class="ruby-identifier">state</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">is_arg?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_dot</span> <span class="ruby-keyword">then</span>
            <span class="ruby-identifier">command_state</span> <span class="ruby-operator">?</span> <span class="ruby-value">:expr_cmdarg</span> <span class="ruby-operator">:</span> <span class="ruby-value">:expr_arg</span>
          <span class="ruby-keyword">elsif</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">ruby18</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">in_lex_state?</span> <span class="ruby-value">:expr_fname</span> <span class="ruby-keyword">then</span>
            <span class="ruby-value">:expr_endfn</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-value">:expr_end</span>
          <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> [<span class="ruby-value">:expr_dot</span>, <span class="ruby-value">:expr_fname</span>].<span class="ruby-identifier">include?</span> <span class="ruby-identifier">last_state</span> <span class="ruby-keyword">and</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">parser</span>.<span class="ruby-identifier">env</span>[<span class="ruby-identifier">token</span>.<span class="ruby-identifier">to_sym</span>] <span class="ruby-operator">==</span> <span class="ruby-value">:lvar</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">state</span> = <span class="ruby-value">:expr_end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">token</span>.<span class="ruby-identifier">lineno</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span> <span class="ruby-comment"># yes, on a string. I know... I know...</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-identifier">tok_id</span>, <span class="ruby-identifier">token</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_token_keyword" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_token_keyword</span><span
            class="method-args">(keyword)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_token_keyword-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 710</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_token_keyword</span> <span class="ruby-identifier">keyword</span>
  <span class="ruby-identifier">state</span> = <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">state</span>

  <span class="ruby-identifier">value</span> = [<span class="ruby-identifier">token</span>, <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>]

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">state</span> <span class="ruby-operator">==</span> <span class="ruby-value">:expr_beg</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:expr_fname</span>

  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">==</span> <span class="ruby-value">:expr_fname</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span> <span class="ruby-operator">==</span> <span class="ruby-value">:kDO</span> <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">lpar_beg</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lpar_beg</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">paren_nest</span> <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lpar_beg</span> = <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-value">:kDO_LAMBDA</span>, <span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">cond</span>.<span class="ruby-identifier">is_in_state</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-value">:kDO_COND</span>, <span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">cmdarg</span>.<span class="ruby-identifier">is_in_state</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">lex_state</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:expr_cmdarg</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-value">:kDO_BLOCK</span>, <span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:expr_endarg</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-value">:kDO_BLOCK</span>, <span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-value">:kDO</span>, <span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">in_lex_state?</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-value">:expr_value</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id0</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">result</span>(<span class="ruby-value">:expr_beg</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">result</span>(<span class="ruby-identifier">state</span>, <span class="ruby-identifier">keyword</span>.<span class="ruby-identifier">id1</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_underscore" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_underscore</span><span
            class="method-args">(text)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="process_underscore-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 744</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_underscore</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">unscan</span> <span class="ruby-comment"># put back &quot;_&quot;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">beginning_of_line?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\__END__(\r?\n|\Z)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> [<span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>, <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\_\w*/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">process_token</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rb_compile_error" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rb_compile_error</span><span
            class="method-args">(msg)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="rb_compile_error-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 754</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-identifier">msg</span>
  <span class="ruby-identifier">msg</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;. near line #{self.lineno}: #{ss.rest[/^.*/].inspect}&quot;</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">RubyParser</span><span class="ruby-operator">::</span><span class="ruby-constant">SyntaxError</span>, <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-read_escape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_escape</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="read_escape-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 759</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read_escape</span> <span class="ruby-comment"># TODO: remove / rewrite</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>                  <span class="ruby-comment"># Backslash</span>
    <span class="ruby-string">&#39;\&#39;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/n/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># newline</span>
    <span class="ruby-string">&quot;\n&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/t/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># horizontal tab</span>
    <span class="ruby-string">&quot;\t&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/r/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># carriage-return</span>
    <span class="ruby-string">&quot;\r&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/f/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># form-feed</span>
    <span class="ruby-string">&quot;\f&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/v/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># vertical tab</span>
    <span class="ruby-string">&quot;\13&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/a/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># alarm(bell)</span>
    <span class="ruby-string">&quot;\007&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/e/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># escape</span>
    <span class="ruby-string">&quot;\033&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/b/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># backspace</span>
    <span class="ruby-string">&quot;\010&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/s/</span>) <span class="ruby-keyword">then</span>                   <span class="ruby-comment"># space</span>
    <span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[0-7]{1,3}/</span>) <span class="ruby-keyword">then</span>          <span class="ruby-comment"># octal constant</span>
    (<span class="ruby-identifier">matched</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">8</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xFF</span>).<span class="ruby-identifier">chr</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/x([0-9a-fA-F]{1,2})/</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># hex constant</span>
    <span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">chr</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/M-\[\MCc]/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/M-\/</span>) <span class="ruby-comment"># eat it</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_escape</span>
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/M-(.)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>]
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/(C-|c)\[\MCc]/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/(C-|c)\/</span>) <span class="ruby-comment"># eat it</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_escape</span>
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/C-\?|c\?/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-value">127</span>.<span class="ruby-identifier">chr</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/(C-|c)(.)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-identifier">ss</span>[<span class="ruby-value">2</span>]
    <span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">c</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
    <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/^[89]/i</span>) <span class="ruby-keyword">then</span> <span class="ruby-comment"># bad octal or hex... MRI ignores them :(</span>
    <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/u([0-9a-fA-F]{2,4}|\{[0-9a-fA-F]{2,6}\})/</span>) <span class="ruby-keyword">then</span>
    [<span class="ruby-identifier">ss</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;{}&quot;</span>).<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U&quot;</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[McCx0-9]/</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">getch</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-regx_options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">regx_options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="regx_options-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 816</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">regx_options</span> <span class="ruby-comment"># TODO: rewrite / remove</span>
  <span class="ruby-identifier">good</span>, <span class="ruby-identifier">bad</span> = [], []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/[a-z]+/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">good</span>, <span class="ruby-identifier">bad</span> = <span class="ruby-identifier">matched</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>).<span class="ruby-identifier">partition</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^[ixmonesu]$/</span> }
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">bad</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;unknown regexp option%s - %s&quot;</span> <span class="ruby-operator">%</span>
                     [(<span class="ruby-identifier">bad</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&quot;s&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&quot;&quot;</span>), <span class="ruby-identifier">bad</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">inspect</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">good</span>.<span class="ruby-identifier">join</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reset" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="reset-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 831</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">brace_nest</span>    = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">command_start</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">comments</span>      = []
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_state</span>     = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span>   = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lineno</span>        = <span class="ruby-value">1</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lpar_beg</span>      = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">paren_nest</span>    = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">space_seen</span>    = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span>   = <span class="ruby-value">0</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">token</span>         = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extra_lineno</span>  = <span class="ruby-value">0</span>

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cmdarg</span> = <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">StackState</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:cmdarg</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cond</span>   = <span class="ruby-constant">RubyParserStuff</span><span class="ruby-operator">::</span><span class="ruby-constant">StackState</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">:cond</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ruby18" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ruby18</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="ruby18-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 855</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ruby18</span>
  <span class="ruby-constant">Ruby18Parser</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">parser</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ruby19" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ruby19</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="ruby19-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 859</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ruby19</span>
  <span class="ruby-constant">Ruby19Parser</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">parser</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-scan" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scan</span><span
            class="method-args">(re)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="scan-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 863</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">scan</span> <span class="ruby-identifier">re</span>
  <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">scan</span> <span class="ruby-identifier">re</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-scanner_class" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scanner_class</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="scanner_class-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 867</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">scanner_class</span> <span class="ruby-comment"># TODO: design this out of oedipus_lex. or something.</span>
  <span class="ruby-constant">RPStringScanner</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-space_vs_beginning" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">space_vs_beginning</span><span
            class="method-args">(space_type, beg_type, fallback)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="space_vs_beginning-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 871</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">space_vs_beginning</span> <span class="ruby-identifier">space_type</span>, <span class="ruby-identifier">beg_type</span>, <span class="ruby-identifier">fallback</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_space_arg?</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/./m</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">warning</span> <span class="ruby-string">&quot;`**&#39; interpreted as argument prefix&quot;</span>
    <span class="ruby-identifier">space_type</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">is_beg?</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">beg_type</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-comment"># TODO: warn_balanced(&quot;**&quot;, &quot;argument prefix&quot;);</span>
    <span class="ruby-identifier">fallback</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">string</span><span
            class="method-args">(type, beg = matched, nnd = "\0")</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="string-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 883</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">string</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">beg</span> = <span class="ruby-identifier">matched</span>, <span class="ruby-identifier">nnd</span> = <span class="ruby-string">&quot;\0&quot;</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">lex_strterm</span> = [<span class="ruby-value">:strterm</span>, <span class="ruby-identifier">type</span>, <span class="ruby-identifier">beg</span>, <span class="ruby-identifier">nnd</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tokadd_escape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tokadd_escape</span><span
            class="method-args">(term)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>TODO: consider def src= src</p>

<pre class="ruby"><span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;bad src: #{src.inspect}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">src</span>
<span class="ruby-ivar">@src</span> = <span class="ruby-constant">RPStringScanner</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">src</span>)
</pre>

<p>end</p>
          
          

          
          <div class="method-source-code" id="tokadd_escape-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 893</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tokadd_escape</span> <span class="ruby-identifier">term</span> <span class="ruby-comment"># TODO: rewrite / remove</span>
  <span class="ruby-keyword">case</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\n/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># just ignore</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\([0-7]{1,3}|x[0-9a-fA-F]{1,2})/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\([MC]-|c)(?=\)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tokadd_escape</span> <span class="ruby-identifier">term</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\([MC]-|c)(.)/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\[McCx]/</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>
  <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\(.)/m</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tokadd_string" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tokadd_string</span><span
            class="method-args">(func, term, paren)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="tokadd_string-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 913</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tokadd_string</span>(<span class="ruby-identifier">func</span>, <span class="ruby-identifier">term</span>, <span class="ruby-identifier">paren</span>) <span class="ruby-comment"># TODO: rewrite / remove</span>
  <span class="ruby-identifier">qwords</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_QWORDS</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">escape</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_ESCAPE</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">expand</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_EXPAND</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">regexp</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_REGEXP</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">symbol</span> = (<span class="ruby-identifier">func</span> <span class="ruby-operator">&amp;</span> <span class="ruby-constant">STR_FUNC_SYMBOL</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>

  <span class="ruby-identifier">paren_re</span> = <span class="ruby-identifier">@@regexp_cache</span>[<span class="ruby-identifier">paren</span>]
  <span class="ruby-identifier">term_re</span>  = <span class="ruby-identifier">@@regexp_cache</span>[<span class="ruby-identifier">term</span>]

  <span class="ruby-keyword">until</span> <span class="ruby-identifier">end_of_stream?</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">c</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">handled</span> = <span class="ruby-keyword">true</span>

    <span class="ruby-keyword">case</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">paren_re</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">paren_re</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">if</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">string_nest</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#(?=[\$\@\{])/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">qwords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\s/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">ss</span>.<span class="ruby-identifier">pos</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-node">/#(?!\n)/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-comment"># do nothing</span>
    <span class="ruby-keyword">when</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
      <span class="ruby-keyword">case</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">qwords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\n/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">qwords</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\s/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">c</span> = <span class="ruby-string">&#39; &#39;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\n/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">regexp</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">check</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">self</span>.<span class="ruby-identifier">tokadd_escape</span> <span class="ruby-identifier">term</span>
        <span class="ruby-keyword">next</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">expand</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">c</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">read_escape</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\n/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-comment"># do nothing</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\\/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;\&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">escape</span>
        <span class="ruby-identifier">c</span> = <span class="ruby-string">&#39;\&#39;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/\/</span>) <span class="ruby-keyword">then</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">term_re</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">paren</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">scan</span>(<span class="ruby-identifier">paren_re</span>) <span class="ruby-keyword">then</span>
          <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\\&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">handled</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-keyword">end</span> <span class="ruby-comment"># inner /\\/ case</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">handled</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment"># top case</span>

    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">handled</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">t</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span> <span class="ruby-identifier">term</span>
      <span class="ruby-identifier">x</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">paren</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">paren</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">paren</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&quot;\000&quot;</span>
      <span class="ruby-identifier">re</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">qwords</span> <span class="ruby-keyword">then</span>
             <span class="ruby-keyword">if</span> <span class="ruby-constant">RUBY19</span> <span class="ruby-keyword">then</span>
               <span class="ruby-node">/[^#{t}#{x}\#\0\\s]+|./</span> <span class="ruby-comment"># |. to pick up whatever</span>
             <span class="ruby-keyword">else</span>
               <span class="ruby-node">/[^#{t}#{x}\#\0\\s\v]+|./</span> <span class="ruby-comment"># argh. 1.8&#39;s \s doesn&#39;t pick up \v</span>
             <span class="ruby-keyword">end</span>
           <span class="ruby-keyword">else</span>
             <span class="ruby-node">/[^#{t}#{x}\#\0\]+|./</span>
           <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">scan</span> <span class="ruby-identifier">re</span>
      <span class="ruby-identifier">c</span> = <span class="ruby-identifier">matched</span>

      <span class="ruby-identifier">rb_compile_error</span> <span class="ruby-string">&quot;symbol cannot contain &#39;\\0&#39;&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">symbol</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">c</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\0/</span>
    <span class="ruby-keyword">end</span> <span class="ruby-comment"># unless handled</span>

    <span class="ruby-identifier">c</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">matched</span>
    <span class="ruby-identifier">string_buffer</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">c</span>
  <span class="ruby-keyword">end</span> <span class="ruby-comment"># until</span>

  <span class="ruby-identifier">c</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">matched</span>
  <span class="ruby-identifier">c</span> = <span class="ruby-constant">RubyLexer</span><span class="ruby-operator">::</span><span class="ruby-constant">EOF</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_of_stream?</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">c</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unescape" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unescape</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="unescape-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 1004</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unescape</span> <span class="ruby-identifier">s</span>
  <span class="ruby-identifier">r</span> = <span class="ruby-constant">ESCAPES</span>[<span class="ruby-identifier">s</span>]

  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extra_lineno</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;n&quot;</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>

  <span class="ruby-identifier">x</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">s</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[0-7]{1,3}/</span> <span class="ruby-keyword">then</span>
        (<span class="ruby-node">$&amp;</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">8</span>) <span class="ruby-operator">&amp;</span> <span class="ruby-value">0xFF</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^x([0-9a-fA-F]{1,2})/</span> <span class="ruby-keyword">then</span>
        <span class="ruby-node">$1</span>.<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^M-(.)/</span> <span class="ruby-keyword">then</span>
        (<span class="ruby-node">$1</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">|</span> <span class="ruby-value">0x80</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^(C-|c)(.)/</span> <span class="ruby-keyword">then</span>
        (<span class="ruby-node">$2</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">0x9f</span>).<span class="ruby-identifier">chr</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[89a-f]/i</span> <span class="ruby-keyword">then</span> <span class="ruby-comment"># bad octal or hex... ignore? that&#39;s what MRI does :(</span>
        <span class="ruby-identifier">s</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^[McCx0-9]/</span> <span class="ruby-keyword">then</span>
        <span class="ruby-identifier">rb_compile_error</span>(<span class="ruby-string">&quot;Invalid escape character syntax&quot;</span>)
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/u([0-9a-fA-F]{2,4}|\{[0-9a-fA-F]{2,6}\})/</span> <span class="ruby-keyword">then</span>
        [<span class="ruby-node">$1</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;{}&quot;</span>).<span class="ruby-identifier">to_i</span>(<span class="ruby-value">16</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-string">&quot;U&quot;</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">s</span>
      <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">x</span>.<span class="ruby-identifier">force_encoding</span> <span class="ruby-string">&quot;UTF-8&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">RUBY19</span>
  <span class="ruby-identifier">x</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-warning" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">warning</span><span
            class="method-args">(s)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="warning-source">
            <pre><span class="ruby-comment"># File lib/ruby_lexer.rb, line 1033</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">warning</span> <span class="ruby-identifier">s</span>
  <span class="ruby-comment"># do nothing for now</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

