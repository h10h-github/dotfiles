<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Rufus::Scheduler::CronLine - rufus-scheduler-3.0.9 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-brute_frequency">#brute_frequency</a>
    
    <li ><a href="#method-i-date_match-3F">#date_match?</a>
    
    <li ><a href="#method-i-frequency">#frequency</a>
    
    <li ><a href="#method-i-global_time">#global_time</a>
    
    <li ><a href="#method-i-local_time">#local_time</a>
    
    <li ><a href="#method-i-matches-3F">#matches?</a>
    
    <li ><a href="#method-i-monthday_match-3F">#monthday_match?</a>
    
    <li ><a href="#method-i-next_time">#next_time</a>
    
    <li ><a href="#method-i-parse_item">#parse_item</a>
    
    <li ><a href="#method-i-parse_range">#parse_range</a>
    
    <li ><a href="#method-i-parse_weekdays">#parse_weekdays</a>
    
    <li ><a href="#method-i-previous_time">#previous_time</a>
    
    <li ><a href="#method-i-round_to_seconds">#round_to_seconds</a>
    
    <li ><a href="#method-i-sub_match-3F">#sub_match?</a>
    
    <li ><a href="#method-i-to_array">#to_array</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Rufus::Scheduler::CronLine">
  <h1 id="class-Rufus::Scheduler::CronLine" class="class">
    class Rufus::Scheduler::CronLine
  </h1>

  <section class="description">
    
<p>A &#39;cron line&#39; is a line in the sense of a crontab (man 5 crontab)
file line.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="DAY_S">DAY_S
        
        <dd>
        
      
        <dt id="RANGE_REGEX">RANGE_REGEX
        
        <dd>
        
      
        <dt id="WEEKDAYS">WEEKDAYS
        
        <dd>
        
      
        <dt id="WEEK_S">WEEK_S
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-days" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">days</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-hours" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">hours</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-minutes" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">minutes</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-monthdays" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">monthdays</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-months" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">months</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-original" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">original</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        <p>The string used for creating this cronline instance.</p>
        
        </div>
      </div>
      
      <div id="attribute-i-seconds" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">seconds</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-timezone" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">timezone</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-weekdays" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">weekdays</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(line)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">line</span>)

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-node">&quot;not a string: #{line.inspect}&quot;</span>
  ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)

  <span class="ruby-ivar">@original</span> = <span class="ruby-identifier">line</span>

  <span class="ruby-identifier">items</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>

  <span class="ruby-ivar">@timezone</span> = (<span class="ruby-constant">TZInfo</span><span class="ruby-operator">::</span><span class="ruby-constant">Timezone</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">items</span>.<span class="ruby-identifier">last</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">items</span>.<span class="ruby-identifier">pop</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@timezone</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-node">&quot;not a valid cronline : &#39;#{line}&#39;&quot;</span>
  ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">5</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">6</span>

  <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">5</span>

  <span class="ruby-ivar">@seconds</span> = <span class="ruby-identifier">offset</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">parse_item</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>], <span class="ruby-value">0</span>, <span class="ruby-value">59</span>) <span class="ruby-operator">:</span> [ <span class="ruby-value">0</span> ]
  <span class="ruby-ivar">@minutes</span> = <span class="ruby-identifier">parse_item</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">0</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">offset</span>], <span class="ruby-value">0</span>, <span class="ruby-value">59</span>)
  <span class="ruby-ivar">@hours</span> = <span class="ruby-identifier">parse_item</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">offset</span>], <span class="ruby-value">0</span>, <span class="ruby-value">24</span>)
  <span class="ruby-ivar">@days</span> = <span class="ruby-identifier">parse_item</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">offset</span>], <span class="ruby-value">1</span>, <span class="ruby-value">31</span>)
  <span class="ruby-ivar">@months</span> = <span class="ruby-identifier">parse_item</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">3</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">offset</span>], <span class="ruby-value">1</span>, <span class="ruby-value">12</span>)
  <span class="ruby-ivar">@weekdays</span>, <span class="ruby-ivar">@monthdays</span> = <span class="ruby-identifier">parse_weekdays</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">offset</span>])

  [ <span class="ruby-ivar">@seconds</span>, <span class="ruby-ivar">@minutes</span>, <span class="ruby-ivar">@hours</span>, <span class="ruby-ivar">@months</span> ].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">es</span><span class="ruby-operator">|</span>

    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
      <span class="ruby-node">&quot;invalid cronline: &#39;#{line}&#39;&quot;</span>
    ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">es</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">es</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-operator">!</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-brute_frequency" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">brute_frequency</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the shortest delta between two potential occurences of the schedule
described by this cronline.</p>

<p>.</p>

<p>For a simple cronline like “*/5 * * * *”, obviously the frequency is five
minutes. Why does this method look at a whole year of <a
href="CronLine.html#method-i-next_time">next_time</a> ?</p>

<p>Consider “* * * * sun#2,sun#3”, the computed frequency is 1 week (the
shortest delta is the one between the second sunday and the third sunday).
This method takes no chance and runs <a
href="CronLine.html#method-i-next_time">#next_time</a> for the span of a
whole year and keeps the shortest.</p>

<p>Of course, this method can get VERY slow if you call on it a second- based
cronline…</p>

<p>Since it&#39;s a rarely used method, I haven&#39;t taken the time to make
it smarter/faster.</p>

<p>One obvious improvement would be to cache the result once computed…</p>

<p>See <a
href="https://github.com/jmettraux/rufus-scheduler/issues/89">github.com/jmettraux/rufus-scheduler/issues/89</a>
for a discussion about this method.</p>
          
          

          
          <div class="method-source-code" id="brute_frequency-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">brute_frequency</span>

  <span class="ruby-identifier">delta</span> = <span class="ruby-value">366</span> <span class="ruby-operator">*</span> <span class="ruby-constant">DAY_S</span>

  <span class="ruby-identifier">t0</span> = <span class="ruby-identifier">previous_time</span>(<span class="ruby-constant">Time</span>.<span class="ruby-identifier">local</span>(<span class="ruby-value">2000</span>, <span class="ruby-value">1</span>, <span class="ruby-value">1</span>))

  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>

    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">delta</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">delta</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">60</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@seconds</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@seconds</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>

    <span class="ruby-identifier">t1</span> = <span class="ruby-identifier">next_time</span>(<span class="ruby-identifier">t0</span>)
    <span class="ruby-identifier">d</span> = <span class="ruby-identifier">t1</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">t0</span>
    <span class="ruby-identifier">delta</span> = <span class="ruby-identifier">d</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">delta</span>

    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@months</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">t1</span>.<span class="ruby-identifier">month</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t1</span>.<span class="ruby-identifier">year</span> <span class="ruby-operator">==</span> <span class="ruby-value">2001</span>

    <span class="ruby-identifier">t0</span> = <span class="ruby-identifier">t1</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">delta</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-frequency" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">frequency</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns a quickly computed approximation of the frequency for this cron
line.</p>

<p><a href="CronLine.html#method-i-brute_frequency">brute_frequency</a>, on
the other hand, will compute the frequency by examining a whole, that can
take more than seconds for a seconds level cron…</p>
          
          

          
          <div class="method-source-code" id="frequency-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">frequency</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">brute_frequency</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@seconds</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@seconds</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">delta</span> = <span class="ruby-value">60</span>
  <span class="ruby-identifier">prev</span> = <span class="ruby-ivar">@seconds</span>[<span class="ruby-value">0</span>]

  <span class="ruby-ivar">@seconds</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">d</span> = <span class="ruby-identifier">sec</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">prev</span>
    <span class="ruby-identifier">delta</span> = <span class="ruby-identifier">d</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">delta</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">delta</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-matches-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">matches?</span><span
            class="method-args">(time)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns true if the given time matches this cron line.</p>
          
          

          
          <div class="method-source-code" id="matches-3F-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">matches?</span>(<span class="ruby-identifier">time</span>)

  <span class="ruby-identifier">time</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">time</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Time</span>)

  <span class="ruby-identifier">time</span> = <span class="ruby-ivar">@timezone</span>.<span class="ruby-identifier">utc_to_local</span>(<span class="ruby-identifier">time</span>.<span class="ruby-identifier">getutc</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@timezone</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:sec</span>, <span class="ruby-ivar">@seconds</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:min</span>, <span class="ruby-ivar">@minutes</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:hour</span>, <span class="ruby-ivar">@hours</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">date_match?</span>(<span class="ruby-identifier">time</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-next_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">next_time</span><span
            class="method-args">(from=Time.now)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the next time that this cron line is supposed to &#39;fire&#39;</p>

<p>This is raw, 3 secs to iterate over 1 year on my macbook :( brutal. (Well,
I was wrong, takes 0.001 sec on 1.8.7 and 1.9.1)</p>

<p>This method accepts an optional Time parameter. It&#39;s the starting point
for the &#39;search&#39;. By default, it&#39;s Time.now</p>

<p>Note that the time instance returned will be in the same time zone that the
given start point Time (thus a result in the local time zone will be passed
if no start time is specified (search start time set to Time.now))</p>

<pre class="ruby"><span class="ruby-constant">Rufus</span><span class="ruby-operator">::</span><span class="ruby-constant">Scheduler</span><span class="ruby-operator">::</span><span class="ruby-constant">CronLine</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;30 7 * * *&#39;</span>).<span class="ruby-identifier">next_time</span>(
  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">mktime</span>(<span class="ruby-value">2008</span>, <span class="ruby-value">10</span>, <span class="ruby-value">24</span>, <span class="ruby-value">7</span>, <span class="ruby-value">29</span>))
<span class="ruby-comment">#=&gt; Fri Oct 24 07:30:00 -0500 2008</span>

<span class="ruby-constant">Rufus</span><span class="ruby-operator">::</span><span class="ruby-constant">Scheduler</span><span class="ruby-operator">::</span><span class="ruby-constant">CronLine</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;30 7 * * *&#39;</span>).<span class="ruby-identifier">next_time</span>(
  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">utc</span>(<span class="ruby-value">2008</span>, <span class="ruby-value">10</span>, <span class="ruby-value">24</span>, <span class="ruby-value">7</span>, <span class="ruby-value">29</span>))
<span class="ruby-comment">#=&gt; Fri Oct 24 07:30:00 UTC 2008</span>

<span class="ruby-constant">Rufus</span><span class="ruby-operator">::</span><span class="ruby-constant">Scheduler</span><span class="ruby-operator">::</span><span class="ruby-constant">CronLine</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;30 7 * * *&#39;</span>).<span class="ruby-identifier">next_time</span>(
  <span class="ruby-constant">Time</span>.<span class="ruby-identifier">utc</span>(<span class="ruby-value">2008</span>, <span class="ruby-value">10</span>, <span class="ruby-value">24</span>, <span class="ruby-value">7</span>, <span class="ruby-value">29</span>)).<span class="ruby-identifier">localtime</span>
<span class="ruby-comment">#=&gt; Fri Oct 24 02:30:00 -0500 2008</span>
</pre>

<p>(Thanks to K Liu for the note and the examples)</p>
          
          

          
          <div class="method-source-code" id="next_time-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">next_time</span>(<span class="ruby-identifier">from</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)

  <span class="ruby-identifier">time</span> = <span class="ruby-identifier">local_time</span>(<span class="ruby-identifier">from</span>)
  <span class="ruby-identifier">time</span> = <span class="ruby-identifier">round_to_seconds</span>(<span class="ruby-identifier">time</span>)

  <span class="ruby-comment"># start at the next second</span>
  <span class="ruby-identifier">time</span> = <span class="ruby-identifier">time</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">date_match?</span>(<span class="ruby-identifier">time</span>)
      <span class="ruby-identifier">dst</span> = <span class="ruby-identifier">time</span>.<span class="ruby-identifier">isdst</span>
      <span class="ruby-identifier">time</span> <span class="ruby-operator">+=</span> (<span class="ruby-value">24</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">hour</span>) <span class="ruby-operator">*</span> <span class="ruby-value">3600</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">min</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">sec</span>
      <span class="ruby-identifier">time</span> <span class="ruby-operator">-=</span> <span class="ruby-value">3600</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">isdst</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">dst</span> <span class="ruby-comment"># not necessary for winter, but...</span>
      <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:hour</span>, <span class="ruby-ivar">@hours</span>)
      <span class="ruby-identifier">time</span> <span class="ruby-operator">+=</span> (<span class="ruby-value">60</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">min</span>) <span class="ruby-operator">*</span> <span class="ruby-value">60</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">sec</span>; <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:min</span>, <span class="ruby-ivar">@minutes</span>)
      <span class="ruby-identifier">time</span> <span class="ruby-operator">+=</span> <span class="ruby-value">60</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">sec</span>; <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:sec</span>, <span class="ruby-ivar">@seconds</span>)
      <span class="ruby-identifier">time</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>; <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">break</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">global_time</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">from</span>.<span class="ruby-identifier">utc?</span>)

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">TZInfo</span><span class="ruby-operator">::</span><span class="ruby-constant">PeriodNotFound</span>

  <span class="ruby-identifier">next_time</span>(<span class="ruby-identifier">from</span> <span class="ruby-operator">+</span> <span class="ruby-value">3600</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-previous_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">previous_time</span><span
            class="method-args">(from=Time.now)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the previous time the cronline matched. It&#39;s like <a
href="CronLine.html#method-i-next_time">#next_time</a>, but for the past.</p>
          
          

          
          <div class="method-source-code" id="previous_time-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 161</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">previous_time</span>(<span class="ruby-identifier">from</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>)

  <span class="ruby-identifier">time</span> = <span class="ruby-identifier">local_time</span>(<span class="ruby-identifier">from</span>)
  <span class="ruby-identifier">time</span> = <span class="ruby-identifier">round_to_seconds</span>(<span class="ruby-identifier">time</span>)

  <span class="ruby-comment"># start at the previous second</span>
  <span class="ruby-identifier">time</span> = <span class="ruby-identifier">time</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">date_match?</span>(<span class="ruby-identifier">time</span>)
      <span class="ruby-identifier">time</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">hour</span> <span class="ruby-operator">*</span> <span class="ruby-value">3600</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">min</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">sec</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>; <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:hour</span>, <span class="ruby-ivar">@hours</span>)
      <span class="ruby-identifier">time</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">min</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">sec</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>; <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:min</span>, <span class="ruby-ivar">@minutes</span>)
      <span class="ruby-identifier">time</span> <span class="ruby-operator">-=</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">sec</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>; <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-value">:sec</span>, <span class="ruby-ivar">@seconds</span>)
      <span class="ruby-identifier">time</span> <span class="ruby-operator">-=</span> <span class="ruby-value">1</span>; <span class="ruby-keyword">next</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">break</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">global_time</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">from</span>.<span class="ruby-identifier">utc?</span>)

<span class="ruby-keyword">rescue</span> <span class="ruby-constant">TZInfo</span><span class="ruby-operator">::</span><span class="ruby-constant">PeriodNotFound</span>

  <span class="ruby-identifier">previous_time</span>(<span class="ruby-identifier">time</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-to_array" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_array</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of 6 arrays (seconds, minutes, hours, days, months,
weekdays). This method is used by the cronline unit tests.</p>
          
          

          
          <div class="method-source-code" id="to_array-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_array</span>

  [
    <span class="ruby-ivar">@seconds</span>,
    <span class="ruby-ivar">@minutes</span>,
    <span class="ruby-ivar">@hours</span>,
    <span class="ruby-ivar">@days</span>,
    <span class="ruby-ivar">@months</span>,
    <span class="ruby-ivar">@weekdays</span>,
    <span class="ruby-ivar">@monthdays</span>,
    <span class="ruby-ivar">@timezone</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@timezone</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
  ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Protected Instance Methods</h3>
       </header>

    
      <div id="method-i-date_match-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">date_match?</span><span
            class="method-args">(date)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="date_match-3F-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 407</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">date_match?</span>(<span class="ruby-identifier">date</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">date</span>, <span class="ruby-value">:day</span>, <span class="ruby-ivar">@days</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">date</span>, <span class="ruby-value">:month</span>, <span class="ruby-ivar">@months</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">date</span>, <span class="ruby-value">:wday</span>, <span class="ruby-ivar">@weekdays</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">monthday_match?</span>(<span class="ruby-identifier">date</span>, <span class="ruby-ivar">@monthdays</span>)
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-global_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">global_time</span><span
            class="method-args">(time, from_in_utc)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="global_time-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 444</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">global_time</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">from_in_utc</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@timezone</span>
    <span class="ruby-identifier">time</span> =
      <span class="ruby-keyword">begin</span>
        <span class="ruby-ivar">@timezone</span>.<span class="ruby-identifier">local_to_utc</span>(<span class="ruby-identifier">time</span>)
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">TZInfo</span><span class="ruby-operator">::</span><span class="ruby-constant">AmbiguousTime</span>
        <span class="ruby-ivar">@timezone</span>.<span class="ruby-identifier">local_to_utc</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">time</span>.<span class="ruby-identifier">isdst</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">time</span> = <span class="ruby-identifier">time</span>.<span class="ruby-identifier">getlocal</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">from_in_utc</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">time</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-local_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">local_time</span><span
            class="method-args">(time)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="local_time-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 439</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">local_time</span>(<span class="ruby-identifier">time</span>)

  <span class="ruby-ivar">@timezone</span> <span class="ruby-operator">?</span> <span class="ruby-ivar">@timezone</span>.<span class="ruby-identifier">utc_to_local</span>(<span class="ruby-identifier">time</span>.<span class="ruby-identifier">getutc</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">time</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-monthday_match-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">monthday_match?</span><span
            class="method-args">(date, values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="monthday_match-3F-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 398</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">monthday_match?</span>(<span class="ruby-identifier">date</span>, <span class="ruby-identifier">values</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">today_values</span> = <span class="ruby-identifier">monthdays</span>(<span class="ruby-identifier">date</span>)

  (<span class="ruby-identifier">today_values</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">values</span>).<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse_item" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_item</span><span
            class="method-args">(item, min, max)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_item-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 329</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">min</span>, <span class="ruby-identifier">max</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;*&#39;</span>

  <span class="ruby-identifier">r</span> = <span class="ruby-identifier">item</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">parse_range</span>(<span class="ruby-identifier">i</span>.<span class="ruby-identifier">strip</span>, <span class="ruby-identifier">min</span>, <span class="ruby-identifier">max</span>) }.<span class="ruby-identifier">flatten</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-node">&quot;found duplicates in #{item.inspect}&quot;</span>
  ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">size</span>

  <span class="ruby-identifier">r</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse_range" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_range</span><span
            class="method-args">(item, min, max)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_range-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 344</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_range</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">min</span>, <span class="ruby-identifier">max</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-node">%w[ L ]</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;L&#39;</span>

  <span class="ruby-identifier">item</span> = <span class="ruby-string">&#39;*&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">item</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^\//</span>)

  <span class="ruby-identifier">m</span> = <span class="ruby-identifier">item</span>.<span class="ruby-identifier">match</span>(<span class="ruby-constant">RANGE_REGEX</span>)

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-node">&quot;cannot parse #{item.inspect}&quot;</span>
  ) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">m</span>

  <span class="ruby-identifier">sta</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>]
  <span class="ruby-identifier">sta</span> = <span class="ruby-identifier">sta</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;*&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">min</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">sta</span>.<span class="ruby-identifier">to_i</span>

  <span class="ruby-identifier">edn</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">2</span>]
  <span class="ruby-identifier">edn</span> = <span class="ruby-identifier">edn</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">edn</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">sta</span>
  <span class="ruby-identifier">edn</span> = <span class="ruby-identifier">max</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;*&#39;</span>

  <span class="ruby-identifier">inc</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">3</span>]
  <span class="ruby-identifier">inc</span> = <span class="ruby-identifier">inc</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">inc</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>

  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
    <span class="ruby-node">&quot;#{item.inspect} is not in range #{min}..#{max}&quot;</span>
  ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">sta</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">min</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">edn</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max</span>

  <span class="ruby-identifier">r</span> = []
  <span class="ruby-identifier">val</span> = <span class="ruby-identifier">sta</span>

  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">v</span> = <span class="ruby-identifier">val</span>
    <span class="ruby-identifier">v</span> = <span class="ruby-value">0</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">max</span> <span class="ruby-operator">==</span> <span class="ruby-value">24</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">24</span>
    <span class="ruby-identifier">r</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">inc</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">edn</span>
    <span class="ruby-identifier">val</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">inc</span>
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">inc</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">edn</span>
    <span class="ruby-identifier">val</span> = <span class="ruby-identifier">min</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">max</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">r</span>.<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse_weekdays" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_weekdays</span><span
            class="method-args">(item)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_weekdays-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 287</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_weekdays</span>(<span class="ruby-identifier">item</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;*&#39;</span>

  <span class="ruby-identifier">items</span> = <span class="ruby-identifier">item</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;,&#39;</span>)

  <span class="ruby-identifier">weekdays</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">monthdays</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">it</span><span class="ruby-operator">|</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span> = <span class="ruby-identifier">it</span>.<span class="ruby-identifier">match</span>(<span class="ruby-node">/^(.+)#(l|-?[12345])$/</span>)

      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-node">&quot;ranges are not supported for monthdays (#{it})&quot;</span>
      ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">index</span>(<span class="ruby-string">&#39;-&#39;</span>)

      <span class="ruby-identifier">expr</span> = <span class="ruby-identifier">it</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-node">/#l/</span>, <span class="ruby-string">&#39;#-1&#39;</span>)

      (<span class="ruby-identifier">monthdays</span> <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">expr</span>

    <span class="ruby-keyword">else</span>

      <span class="ruby-identifier">expr</span> = <span class="ruby-identifier">it</span>.<span class="ruby-identifier">dup</span>
      <span class="ruby-constant">WEEKDAYS</span>.<span class="ruby-identifier">each_with_index</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-node">/#{a}/</span>, <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_s</span>) }

      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(
        <span class="ruby-node">&quot;invalid weekday expression (#{it})&quot;</span>
      ) <span class="ruby-keyword">if</span> <span class="ruby-identifier">expr</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/^0*[0-7](-0*[0-7])?$/</span>

      <span class="ruby-identifier">its</span> = <span class="ruby-identifier">expr</span>.<span class="ruby-identifier">index</span>(<span class="ruby-string">&#39;-&#39;</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">parse_range</span>(<span class="ruby-identifier">expr</span>, <span class="ruby-value">0</span>, <span class="ruby-value">7</span>) <span class="ruby-operator">:</span> [ <span class="ruby-constant">Integer</span>(<span class="ruby-identifier">expr</span>) ]
      <span class="ruby-identifier">its</span> = <span class="ruby-identifier">its</span>.<span class="ruby-identifier">collect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span> <span class="ruby-operator">==</span> <span class="ruby-value">7</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">i</span> }

      (<span class="ruby-identifier">weekdays</span> <span class="ruby-operator">||=</span> []).<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">its</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">weekdays</span> = <span class="ruby-identifier">weekdays</span>.<span class="ruby-identifier">uniq</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">weekdays</span>

  [ <span class="ruby-identifier">weekdays</span>, <span class="ruby-identifier">monthdays</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-round_to_seconds" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">round_to_seconds</span><span
            class="method-args">(time)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="round_to_seconds-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 459</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">round_to_seconds</span>(<span class="ruby-identifier">time</span>)

  <span class="ruby-comment"># Ruby 1.8 doesn&#39;t have #round</span>
  <span class="ruby-identifier">time</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:round</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">round</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">time</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">time</span>.<span class="ruby-identifier">usec</span> <span class="ruby-operator">*</span> <span class="ruby-value">1e-6</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-sub_match-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">sub_match?</span><span
            class="method-args">(time, accessor, values)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="sub_match-3F-source">
            <pre><span class="ruby-comment"># File lib/rufus/scheduler/cronline.rb, line 386</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">sub_match?</span>(<span class="ruby-identifier">time</span>, <span class="ruby-identifier">accessor</span>, <span class="ruby-identifier">values</span>)

  <span class="ruby-identifier">value</span> = <span class="ruby-identifier">time</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">accessor</span>)

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;L&#39;</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">time</span> <span class="ruby-operator">+</span> <span class="ruby-constant">DAY_S</span>).<span class="ruby-identifier">day</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>

  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">value</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">accessor</span> <span class="ruby-operator">==</span> <span class="ruby-value">:hour</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value">24</span>)

  <span class="ruby-identifier">values</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

