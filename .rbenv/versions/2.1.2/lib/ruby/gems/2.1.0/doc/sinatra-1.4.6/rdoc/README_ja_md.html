<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>README.ja - Sinatra</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Sinatra">Sinatra</a>
    <li><a href="#label-E7-9B-AE-E6-AC-A1">目次</a>
    <li><a href="#label-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-28Routes-29">ルーティング(Routes)</a>
    <li><a href="#label-E6-9D-A1-E4-BB-B6-28Conditions-29">条件(Conditions)</a>
    <li><a href="#label-E6-88-BB-E3-82-8A-E5-80-A4-28Return+Values-29">戻り値(Return Values)</a>
    <li><a href="#label-E3-82-AB-E3-82-B9-E3-82-BF-E3-83-A0-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-E3-83-9E-E3-83-83-E3-83-81-E3-83-A3-E3-83-BC-28Custom+Route+Matchers-29">カスタムルーティングマッチャー(Custom Route Matchers)</a>
    <li><a href="#label-E9-9D-99-E7-9A-84-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-28Static+Files-29">静的ファイル(Static Files)</a>
    <li><a href="#label-E3-83-93-E3-83-A5-E3-83-BC+-2F+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Views+-2F+Templates-29">ビュー / テンプレート(Views / Templates)</a>
    <li><a href="#label-E3-83-AA-E3-83-86-E3-83-A9-E3-83-AB-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Literal+Templates-29">リテラルテンプレート(Literal Templates)</a>
    <li><a href="#label-E5-88-A9-E7-94-A8-E5-8F-AF-E8-83-BD-E3-81-AA-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E8-A8-80-E8-AA-9E">利用可能なテンプレート言語</a>
    <li><a href="#label-Haml+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Haml テンプレート</a>
    <li><a href="#label-Erb+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Erb テンプレート</a>
    <li><a href="#label-Builder+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Builder テンプレート</a>
    <li><a href="#label-Nokogiri+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Nokogiri テンプレート</a>
    <li><a href="#label-Sass+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Sass テンプレート</a>
    <li><a href="#label-Scss+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Scss テンプレート</a>
    <li><a href="#label-Less+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Less テンプレート</a>
    <li><a href="#label-Liquid+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Liquid テンプレート</a>
    <li><a href="#label-Markdown+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Markdown テンプレート</a>
    <li><a href="#label-Textile+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Textile テンプレート</a>
    <li><a href="#label-RDoc+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">RDoc テンプレート</a>
    <li><a href="#label-AsciiDoc+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">AsciiDoc テンプレート</a>
    <li><a href="#label-Radius+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Radius テンプレート</a>
    <li><a href="#label-Markaby+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Markaby テンプレート</a>
    <li><a href="#label-RABL+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">RABL テンプレート</a>
    <li><a href="#label-Slim+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Slim テンプレート</a>
    <li><a href="#label-Creole+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Creole テンプレート</a>
    <li><a href="#label-MediaWiki+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">MediaWiki テンプレート</a>
    <li><a href="#label-CoffeeScript+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">CoffeeScript テンプレート</a>
    <li><a href="#label-Stylus+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Stylus テンプレート</a>
    <li><a href="#label-Yajl+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Yajl テンプレート</a>
    <li><a href="#label-WLang+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">WLang テンプレート</a>
    <li><a href="#label-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E5-86-85-E3-81-A7-E3-81-AE-E5-A4-89-E6-95-B0-E3-81-B8-E3-81-AE-E3-82-A2-E3-82-AF-E3-82-BB-E3-82-B9">テンプレート内での変数へのアクセス</a>
    <li><a href="#label-yield-E3-82-92-E4-BC-B4-E3-81-86-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-81-A8-E3-83-8D-E3-82-B9-E3-83-88-E3-81-97-E3-81-9F-E3-83-AC-E3-82-A4-E3-82-A2-E3-82-A6-E3-83-88"><code>yield</code>を伴うテンプレートとネストしたレイアウト</a>
    <li><a href="#label-E3-82-A4-E3-83-B3-E3-83-A9-E3-82-A4-E3-83-B3-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Inline+Templates-29">インラインテンプレート(Inline Templates)</a>
    <li><a href="#label-E5-90-8D-E5-89-8D-E4-BB-98-E3-81-8D-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Named+Templates-29">名前付きテンプレート(Named Templates)</a>
    <li><a href="#label-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E6-8B-A1-E5-BC-B5-E5-AD-90-E3-81-AE-E9-96-A2-E9-80-A3-E4-BB-98-E3-81-91">ファイル拡張子の関連付け</a>
    <li><a href="#label-E3-82-AA-E3-83-AA-E3-82-B8-E3-83-8A-E3-83-AB-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-82-A8-E3-83-B3-E3-82-B8-E3-83-B3-E3-81-AE-E8-BF-BD-E5-8A-A0">オリジナルテンプレートエンジンの追加</a>
    <li><a href="#label-E3-83-95-E3-82-A3-E3-83-AB-E3-82-BF-28Filters-29">フィルタ(Filters)</a>
    <li><a href="#label-E3-83-98-E3-83-AB-E3-83-91-E3-83-BC-28Helpers-29">ヘルパー(Helpers)</a>
    <li><a href="#label-E3-82-BB-E3-83-83-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E4-BD-BF-E7-94-A8">セッションの使用</a>
    <li><a href="#label-E5-81-9C-E6-AD-A2-28Halting-29">停止(Halting)</a>
    <li><a href="#label-E3-83-91-E3-83-83-E3-82-B7-E3-83-B3-E3-82-B0-28Passing-29">パッシング(Passing)</a>
    <li><a href="#label-E5-88-A5-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-E3-81-AE-E8-AA-98-E7-99-BA">別ルーティングの誘発</a>
    <li><a href="#label-E3-83-9C-E3-83-87-E3-82-A3-E3-80-81-E3-82-B9-E3-83-86-E3-83-BC-E3-82-BF-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-89-E3-81-8A-E3-82-88-E3-81-B3-E3-83-98-E3-83-83-E3-83-80-E3-81-AE-E8-A8-AD-E5-AE-9A">ボディ、ステータスコードおよびヘッダの設定</a>
    <li><a href="#label-E3-82-B9-E3-83-88-E3-83-AA-E3-83-BC-E3-83-9F-E3-83-B3-E3-82-B0-E3-83-AC-E3-82-B9-E3-83-9D-E3-83-B3-E3-82-B9-28Streaming+Responses-29">ストリーミングレスポンス(Streaming Responses)</a>
    <li><a href="#label-E3-83-AD-E3-82-AE-E3-83-B3-E3-82-B0-28Logging-29">ロギング(Logging)</a>
    <li><a href="#label-MIME-E3-82-BF-E3-82-A4-E3-83-97-28Mime+Types-29">MIMEタイプ(Mime Types)</a>
    <li><a href="#label-URL-E3-81-AE-E7-94-9F-E6-88-90">URLの生成</a>
    <li><a href="#label-E3-83-96-E3-83-A9-E3-82-A6-E3-82-B6-E3-83-AA-E3-83-80-E3-82-A4-E3-83-AC-E3-82-AF-E3-83-88-28Browser+Redirect-29">ブラウザリダイレクト(Browser Redirect)</a>
    <li><a href="#label-E3-82-AD-E3-83-A3-E3-83-83-E3-82-B7-E3-83-A5-E5-88-B6-E5-BE-A1-28Cache+Control-29">キャッシュ制御(Cache Control)</a>
    <li><a href="#label-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E3-81-AE-E9-80-81-E4-BF-A1">ファイルの送信</a>
    <li><a href="#label-E3-83-AA-E3-82-AF-E3-82-A8-E3-82-B9-E3-83-88-E3-82-AA-E3-83-96-E3-82-B8-E3-82-A7-E3-82-AF-E3-83-88-E3-81-B8-E3-81-AE-E3-82-A2-E3-82-AF-E3-82-BB-E3-82-B9">リクエストオブジェクトへのアクセス</a>
    <li><a href="#label-E3-82-A2-E3-82-BF-E3-83-83-E3-83-81-E3-83-A1-E3-83-B3-E3-83-88-28Attachments-29">アタッチメント(Attachments)</a>
    <li><a href="#label-E6-97-A5-E4-BB-98-E3-81-A8-E6-99-82-E5-88-BB-E3-81-AE-E5-8F-96-E3-82-8A-E6-89-B1-E3-81-84">日付と時刻の取り扱い</a>
    <li><a href="#label-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E3-81-AE-E6-8E-A2-E7-B4-A2">テンプレートファイルの探索</a>
    <li><a href="#label-E3-82-B3-E3-83-B3-E3-83-95-E3-82-A3-E3-82-AE-E3-83-A5-E3-83-AC-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-28Configuration-29">コンフィギュレーション(Configuration)</a>
    <li><a href="#label-E6-94-BB-E6-92-83-E9-98-B2-E5-BE-A1-E3-81-AB-E5-AF-BE-E3-81-99-E3-82-8B-E8-A8-AD-E5-AE-9A">攻撃防御に対する設定</a>
    <li><a href="#label-E5-88-A9-E7-94-A8-E5-8F-AF-E8-83-BD-E3-81-AA-E8-A8-AD-E5-AE-9A">利用可能な設定</a>
    <li><a href="#label-E7-92-B0-E5-A2-83-E8-A8-AD-E5-AE-9A-28Environments-29">環境設定(Environments)</a>
    <li><a href="#label-E3-82-A8-E3-83-A9-E3-83-BC-E3-83-8F-E3-83-B3-E3-83-89-E3-83-AA-E3-83-B3-E3-82-B0-28Error+Handling-29">エラーハンドリング(Error Handling)</a>
    <li><a href="#label-E6-9C-AA-E6-A4-9C-E5-87-BA-28Not+Found-29">未検出(Not Found)</a>
    <li><a href="#label-E3-82-A8-E3-83-A9-E3-83-BC-28Error-29">エラー(Error)</a>
    <li><a href="#label-Rack-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-28Rack+Middleware-29">Rackミドルウェア(Rack Middleware)</a>
    <li><a href="#label-E3-83-86-E3-82-B9-E3-83-88-28Testing-29">テスト(Testing)</a>
    <li><a href="#label-Sinatra-3A-3ABase+-+-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-E3-80-81-E3-83-A9-E3-82-A4-E3-83-96-E3-83-A9-E3-83-AA-E3-81-8A-E3-82-88-E3-81-B3-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-A2-E3-83-97-E3-83-AA">Sinatra::Base - ミドルウェア、ライブラリおよびモジュラーアプリ</a>
    <li><a href="#label-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB+vs+-E3-82-AF-E3-83-A9-E3-83-83-E3-82-B7-E3-83-83-E3-82-AF-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB">モジュラースタイル vs クラッシックスタイル</a>
    <li><a href="#label-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E6-8F-90-E4-BE-9B">モジュラーアプリケーションの提供</a>
    <li><a href="#label-config.ru-E3-82-92-E7-94-A8-E3-81-84-E3-81-9F-E3-82-AF-E3-83-A9-E3-83-83-E3-82-B7-E3-83-83-E3-82-AF-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E4-BD-BF-E7-94-A8">config.ruを用いたクラッシックスタイルアプリケーションの使用</a>
    <li><a href="#label-config.ru-E3-81-AF-E3-81-84-E3-81-A4-E4-BD-BF-E3-81-86-E3-81-AE-E3-81-8B-EF-BC-9F">config.ruはいつ使うのか？</a>
    <li><a href="#label-Sinatra-E3-81-AE-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-E3-81-A8-E3-81-97-E3-81-A6-E3-81-AE-E5-88-A9-E7-94-A8">Sinatraのミドルウェアとしての利用</a>
    <li><a href="#label-E5-8B-95-E7-9A-84-E3-81-AA-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E7-94-9F-E6-88-90">動的なアプリケーションの生成</a>
    <li><a href="#label-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-E3-81-A8-E3-83-90-E3-82-A4-E3-83-B3-E3-83-87-E3-82-A3-E3-83-B3-E3-82-B0-28Scopes+and+Binding-29">スコープとバインディング(Scopes and Binding)</a>
    <li><a href="#label-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-2F-E3-82-AF-E3-83-A9-E3-82-B9-E3-81-AE-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">アプリケーション/クラスのスコープ</a>
    <li><a href="#label-E3-83-AA-E3-82-AF-E3-82-A8-E3-82-B9-E3-83-88-2F-E3-82-A4-E3-83-B3-E3-82-B9-E3-82-BF-E3-83-B3-E3-82-B9-E3-81-AE-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">リクエスト/インスタンスのスコープ</a>
    <li><a href="#label-E3-83-87-E3-83-AA-E3-82-B2-E3-83-BC-E3-83-88-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">デリゲートスコープ</a>
    <li><a href="#label-E3-82-B3-E3-83-9E-E3-83-B3-E3-83-89-E3-83-A9-E3-82-A4-E3-83-B3">コマンドライン</a>
    <li><a href="#label-E5-BF-85-E8-A6-81-E7-92-B0-E5-A2-83">必要環境</a>
    <li><a href="#label-E6-9C-80-E6-96-B0-E9-96-8B-E7-99-BA-E7-89-88">最新開発版</a>
    <li><a href="#label-Bundler-E3-82-92-E4-BD-BF-E3-81-86-E5-A0-B4-E5-90-88">Bundlerを使う場合</a>
    <li><a href="#label-E7-9B-B4-E6-8E-A5-E7-B5-84-E3-81-BF-E8-BE-BC-E3-82-80-E5-A0-B4-E5-90-88">直接組み込む場合</a>
    <li><a href="#label-E3-82-B0-E3-83-AD-E3-83-BC-E3-83-90-E3-83-AB-E7-92-B0-E5-A2-83-E3-81-AB-E3-82-A4-E3-83-B3-E3-82-B9-E3-83-88-E3-83-BC-E3-83-AB-E3-81-99-E3-82-8B-E5-A0-B4-E5-90-88">グローバル環境にインストールする場合</a>
    <li><a href="#label-E3-83-90-E3-83-BC-E3-82-B8-E3-83-A7-E3-83-8B-E3-83-B3-E3-82-B0-28Versioning-29">バージョニング(Versioning)</a>
    <li><a href="#label-E5-8F-82-E8-80-83-E6-96-87-E7-8C-AE">参考文献</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./LICENSE.html">LICENSE</a>
  
    <li><a href="./README_de_md.html">README.de</a>
  
    <li><a href="./README_es_md.html">README.es</a>
  
    <li><a href="./README_fr_md.html">README.fr</a>
  
    <li><a href="./README_hu_md.html">README.hu</a>
  
    <li><a href="./README_ja_md.html">README.ja</a>
  
    <li><a href="./README_ko_md.html">README.ko</a>
  
    <li><a href="./README_md.html">README</a>
  
    <li><a href="./README_pt-br_md.html">README.pt-br</a>
  
    <li><a href="./README_pt-pt_md.html">README.pt-pt</a>
  
    <li><a href="./README_ru_md.html">README.ru</a>
  
    <li><a href="./README_zh_md.html">README.zh</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page README.ja.md">

<h1 id="label-Sinatra"><a href="Sinatra.html">Sinatra</a><span><a href="#label-Sinatra">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p>注） 本文書は英語から翻訳したものであり、その内容が最新でない場合もあります。最新の情報はオリジナルの英語版を参照して下さい。*</p>

<p>Sinatraは最小の労力でRubyによるWebアプリケーションを手早く作るための<a
href="http://ja.wikipedia.org/wiki/ドメイン固有言語">DSL</a>です。</p>

<pre class="ruby"><span class="ruby-comment"># myapp.rb</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Hello world!&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>gemをインストールし、</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">sinatra</span>
</pre>

<p>次のように実行します。</p>

<pre class="ruby"><span class="ruby-identifier">ruby</span> <span class="ruby-identifier">myapp</span>.<span class="ruby-identifier">rb</span>
</pre>

<p><a href="http://localhost:4567">localhost:4567</a> を開きます。</p>

<p>ThinがあればSinatraはこれを利用するので、<code>gem install thin</code>することをお薦めします。</p>

<h2 id="label-E7-9B-AE-E6-AC-A1">目次<span><a href="#label-E7-9B-AE-E6-AC-A1">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="#sinatra">Sinatra</a>  <a href="#目次">目次</a>  <a
href="#ルーティングroutes">ルーティング(Routes)</a>  <a
href="#条件conditions">条件(Conditions)</a>  <a
href="#戻り値return-values">戻り値(Return Values)</a>  <a
href="#カスタムルーティングマッチャーcustom-route-matchers">カスタムルーティングマッチャー(Custom Route
Matchers)</a>  <a href="#静的ファイルstatic-files">静的ファイル(Static Files)</a>  <a
href="#ビュー--テンプレートviews--templates">ビュー / テンプレート(Views / Templates)</a>  <a
href="#リテラルテンプレートliteral-templates">リテラルテンプレート(Literal Templates)</a>  <a
href="#利用可能なテンプレート言語">利用可能なテンプレート言語</a>  <a href="#haml-テンプレート">Haml
テンプレート</a>  <a href="#erb-テンプレート">Erb テンプレート</a>  <a
href="#builder-テンプレート">Builder テンプレート</a>  <a
href="#nokogiri-テンプレート">Nokogiri テンプレート</a>  <a href="#sass-テンプレート">Sass
テンプレート</a>  <a href="#scss-テンプレート">SCSS テンプレート</a>  <a
href="#less-テンプレート">Less テンプレート</a>  <a href="#liquid-テンプレート">Liquid
テンプレート</a>  <a href="#markdown-テンプレート">Markdown テンプレート</a>  <a
href="#textile-テンプレート">Textile テンプレート</a>  <a href="#rdoc-テンプレート">RDoc
テンプレート</a>  <a href="#asciidoc-テンプレート">AsciiDoc テンプレート</a>  <a
href="#radius-テンプレート">Radius テンプレート</a>  <a href="#markaby-テンプレート">Markaby
テンプレート</a>  <a href="#rabl-テンプレート">RABL テンプレート</a>  <a
href="#slim-テンプレート">Slim テンプレート</a>  <a href="#creole-テンプレート">Creole
テンプレート</a>  <a href="#mediawiki-テンプレート">MediaWiki テンプレート</a>  <a
href="#coffeescript-テンプレート">CoffeeScript テンプレート</a>  <a
href="#stylus-テンプレート">Stylus テンプレート</a>  <a href="#yajl-テンプレート">Yajl
テンプレート</a>  <a href="#wlang-テンプレート">WLang テンプレート</a>  <a
href="#テンプレート内での変数へのアクセス">テンプレート内での変数へのアクセス</a>  <a
href="#yieldを伴うテンプレートとネストしたレイアウト">yieldを伴うテンプレートとネストしたレイアウト</a>  <a
href="#インラインテンプレートinline-templates">インラインテンプレート(Inline Templates)</a>  <a
href="#名前付きテンプレートnamed-templates">名前付きテンプレート(Named Templates)</a>  <a
href="#ファイル拡張子の関連付け">ファイル拡張子の関連付け</a>  <a
href="#オリジナルテンプレートエンジンの追加">オリジナルテンプレートエンジンの追加</a>  <a
href="#フィルタfilters">フィルタ(Filters)</a>  <a
href="#ヘルパーhelpers">ヘルパー(Helpers)</a>  <a href="#セッションの使用">セッションの使用</a>  <a
href="#停止halting">停止(Halting)</a>  <a
href="#パッシングpassing">パッシング(Passing)</a>  <a
href="#別ルーティングの誘発">別ルーティングの誘発</a>  <a
href="#ボディステータスコードおよびヘッダの設定">ボディ、ステータスコードおよびヘッダの設定</a>  <a
href="#ストリーミングレスポンスstreaming-responses">ストリーミングレスポンス(Streaming
Responses)</a>  <a href="#ロギングlogging">ロギング(Logging)</a>  <a
href="#mimeタイプmime-types">MIMEタイプ(Mime Types)</a>  <a
href="#urlの生成">URLの生成</a>  <a
href="#ブラウザリダイレクトbrowser-redirect">ブラウザリダイレクト(Browser Redirect)</a>  <a
href="#キャッシュ制御cache-control">キャッシュ制御(Cache Control)</a>  <a
href="#ファイルの送信">ファイルの送信</a>  <a
href="#リクエストオブジェクトへのアクセス">リクエストオブジェクトへのアクセス</a>  <a
href="#アタッチメントattachments">アタッチメント(Attachments)</a>  <a
href="#日付と時刻の取り扱い">日付と時刻の取り扱い</a>  <a
href="#テンプレートファイルの探索">テンプレートファイルの探索</a>  <a
href="#コンフィギュレーションconfiguration">コンフィギュレーション(Configuration)</a>  <a
href="#攻撃防御に対する設定">攻撃防御に対する設定</a>  <a href="#利用可能な設定">利用可能な設定</a>  <a
href="#環境設定environments">環境設定(Environments)</a>  <a
href="#エラーハンドリングerror-handling">エラーハンドリング(Error Handling)</a>  <a
href="#not-found">Not Found</a>  <a href="#エラーerror">エラー(Error)</a>  <a
href="#rackミドルウェアrack-middleware">Rackミドルウェア(Rack Middleware)</a>  <a
href="#テストtesting">テスト(Testing)</a>  <a
href="#sinatrabase---ミドルウェアライブラリおよびモジュラーアプリ">Sinatra::Base -
ミドルウェア、ライブラリおよびモジュラーアプリ</a>  <a href="#モジュラースタイル-vs-クラッシックスタイル">モジュラースタイル
vs クラッシックスタイル</a>  <a href="#モジュラーアプリケーションの提供">モジュラーアプリケーションの提供</a>  <a
href="#configruを用いたクラッシックスタイルアプリケーションの使用">config.ruを用いたクラッシックスタイルアプリケーションの使用</a>
<a href="#configruはいつ使うのか">config.ruはいつ使うのか？</a>  <a
href="#sinatraのミドルウェアとしての利用">Sinatraのミドルウェアとしての利用</a>  <a
href="#動的なアプリケーションの生成">動的なアプリケーションの生成</a>  <a
href="#スコープとバインディングscopes-and-binding">スコープとバインディング(Scopes and Binding)</a>
<a href="#アプリケーションクラスのスコープ">アプリケーション/クラスのスコープ</a>  <a
href="#リクエストインスタンスのスコープ">リクエスト/インスタンスのスコープ</a>  <a
href="#デリゲートスコープ">デリゲートスコープ</a>  <a href="#コマンドライン">コマンドライン</a>  <a
href="#必要環境">必要環境</a>  <a href="#最新開発版">最新開発版</a>  <a
href="#bundlerを使う場合">Bundlerを使う場合</a>  <a href="#直接組み込む場合">直接組み込む場合</a>  <a
href="#グローバル環境にインストールする場合">グローバル環境にインストールする場合</a>  <a
href="#バージョニングversioning">バージョニング(Versioning)</a>  <a href="#参考文献">参考文献</a></p>

<h2 id="label-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-28Routes-29">ルーティング(Routes)<span><a href="#label-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-28Routes-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Sinatraでは、ルーティングはHTTPメソッドとURLマッチングパターンがペアになっています。 ルーティングはブロックに結び付けられています。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何か見せる</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">post</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何か生成する</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">put</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何か更新する</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">patch</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何か修正する</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">delete</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何か削除する</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">options</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何か満たす</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">link</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何かリンクを張る</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">unlink</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">何かアンリンクする</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ルーティングは定義された順番にマッチします。 リクエストに最初にマッチしたルーティングが呼び出されます。</p>

<p>ルーティングのパターンは名前付きパラメータを含むことができ、 <code>params</code>ハッシュで取得できます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/hello/:name&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># &quot;GET /hello/foo&quot; と &quot;GET /hello/bar&quot; にマッチ</span>
  <span class="ruby-comment"># params[&#39;name&#39;] は &#39;foo&#39; か &#39;bar&#39;</span>
  <span class="ruby-node">&quot;Hello #{params[&#39;name&#39;]}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>また、ブロックパラメータで名前付きパラメータにアクセスすることもできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/hello/:name&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># &quot;GET /hello/foo&quot; と &quot;GET /hello/bar&quot; にマッチ</span>
  <span class="ruby-comment"># params[&#39;name&#39;] は &#39;foo&#39; か &#39;bar&#39;</span>
  <span class="ruby-comment"># n が params[&#39;name&#39;] を保持</span>
  <span class="ruby-node">&quot;Hello #{n}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ルーティングパターンはアスタリスク(すなわちワイルドカード)を含むこともでき、 <code>params['splat']</code>
で取得できます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/say  /to/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># /say/hello/to/world にマッチ</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment"># =&gt; [&quot;hello&quot;, &quot;world&quot;]</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/download/*.*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># /download/path/to/file.xml にマッチ</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ここで、ブロックパラメータを使うこともできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/download/*.*&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span>, <span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>
  [<span class="ruby-identifier">path</span>, <span class="ruby-identifier">ext</span>] <span class="ruby-comment"># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ルーティングを正規表現にマッチさせることもできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">/\A\/hello\/([\w]+)\z/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-node">&quot;Hello, #{params[&#39;captures&#39;].first}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ここでも、ブロックパラメータが使えます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">%r{/hello/([\w]+)}</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
  <span class="ruby-node">&quot;Hello, #{c}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ルーティングパターンは、オプショナルパラメータを取ることもできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/posts.?:format?&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># &quot;GET /posts&quot; と &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot; の拡張子などにマッチ</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ところで、ディレクトリトラバーサル攻撃防御設定を無効にしないと（下記参照）、 ルーティングにマッチする前にリクエストパスが修正される可能性があります。</p>

<h2 id="label-E6-9D-A1-E4-BB-B6-28Conditions-29">条件(Conditions)<span><a href="#label-E6-9D-A1-E4-BB-B6-28Conditions-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>ルーティングにはユーザエージェントのようなさまざまな条件を含めることができます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span>, :<span class="ruby-identifier">agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/Songbird (\d\.\d)[\d\/]*?/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-node">&quot;Songbirdのバージョン #{params[&#39;agent&#39;][0]}を使ってます。&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># Songbird以外のブラウザにマッチ</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ほかに<code>host_name</code>と<code>provides</code>条件が利用可能です。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">host_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/^admin\./</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Adminエリアです。アクセスを拒否します!&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">provides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;html&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">provides</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;rss&#39;</span>, <span class="ruby-string">&#39;atom&#39;</span>, <span class="ruby-string">&#39;xml&#39;</span>] <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">builder</span> :<span class="ruby-identifier">feed</span>
<span class="ruby-keyword">end</span>
</pre>

<p>独自の条件を定義することも簡単にできます。</p>

<pre class="ruby"><span class="ruby-identifier">set</span>(:<span class="ruby-identifier">probability</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">condition</span> { <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">value</span> } }

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/win_a_car&#39;</span>, :<span class="ruby-identifier">probability</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0.1</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;あなたの勝ちです!&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/win_a_car&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;残念、あなたの負けです。&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>複数の値を取る条件には、アスタリスクを使います。</p>

<pre class="ruby"><span class="ruby-identifier">set</span>(:<span class="ruby-identifier">auth</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">roles</span><span class="ruby-operator">|</span>   <span class="ruby-comment"># &lt;- ここでアスタリスクを使う</span>
  <span class="ruby-identifier">condition</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">logged_in?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">in_role?</span> <span class="ruby-identifier">role</span> }
      <span class="ruby-identifier">redirect</span> <span class="ruby-string">&quot;/login/&quot;</span>, <span class="ruby-value">303</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/my/account/&quot;</span>, :<span class="ruby-identifier">auth</span> =<span class="ruby-operator">&gt;</span> [:<span class="ruby-identifier">user</span>, :<span class="ruby-identifier">admin</span>] <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;アカウントの詳細&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/only/admin/&quot;</span>, :<span class="ruby-identifier">auth</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">admin</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;ここは管理者だけ!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-E6-88-BB-E3-82-8A-E5-80-A4-28Return+Values-29">戻り値(Return Values)<span><a href="#label-E6-88-BB-E3-82-8A-E5-80-A4-28Return+Values-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>ルーティングブロックの戻り値は、HTTPクライアントまたはRackスタックでの次のミドルウェアに渡されるレスポンスボディを決定します。</p>

<p>これは大抵の場合、上の例のように文字列ですが、それ以外の値も使用することができます。</p>

<p>Rackレスポンス、Rackボディオブジェクト、HTTPステータスコードのいずれかとして妥当なオブジェクトであればどのようなオブジェクトでも返すことができます。</p>

<p>3つの要素を含む配列:  <code>[ステータス(Fixnum), ヘッダ(Hash), レスポンスボディ(#eachに応答する)]</code> 
2つの要素を含む配列:  <code>[ステータス(Fixnum), レスポンスボディ(#eachに応答する)]</code> 
<code>#each</code>に応答するオブジェクト。通常はそのまま何も返さないが、 与えられたブロックに文字列を渡す。 
ステータスコードを表現する整数(Fixnum)</p>

<p>これにより、例えばストリーミングを簡単に実装することができます。</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Stream</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">each</span>
    <span class="ruby-value">100</span>.<span class="ruby-identifier">times</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-node">&quot;#{i}\n&quot;</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-constant">Stream</span>.<span class="ruby-identifier">new</span> }
</pre>

<p>後述する<code>stream</code>ヘルパーメソッドを使って、定型パターンを減らしつつストリーミングロジックをルーティングに埋め込むこともできます。</p>

<h2 id="label-E3-82-AB-E3-82-B9-E3-82-BF-E3-83-A0-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-E3-83-9E-E3-83-83-E3-83-81-E3-83-A3-E3-83-BC-28Custom+Route+Matchers-29">カスタムルーティングマッチャー(Custom Route Matchers)<span><a href="#label-E3-82-AB-E3-82-B9-E3-82-BF-E3-83-A0-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-E3-83-9E-E3-83-83-E3-83-81-E3-83-A3-E3-83-BC-28Custom+Route+Matchers-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>先述のようにSinatraはルーティングマッチャーとして、文字列パターンと正規表現を使うことをビルトインでサポートしています。しかしこれに留まらず、独自のマッチャーを簡単に定義することもできるのです。</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">AllButPattern</span>
  <span class="ruby-constant">Match</span> = <span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">captures</span>)

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">except</span>)
    <span class="ruby-ivar">@except</span>   = <span class="ruby-identifier">except</span>
    <span class="ruby-ivar">@captures</span> = <span class="ruby-constant">Match</span>.<span class="ruby-identifier">new</span>([])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">match</span>(<span class="ruby-identifier">str</span>)
    <span class="ruby-ivar">@captures</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@except</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">str</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_but</span>(<span class="ruby-identifier">pattern</span>)
  <span class="ruby-constant">AllButPattern</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-identifier">all_but</span>(<span class="ruby-string">&quot;/index&quot;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ノート: この例はオーバースペックであり、以下のようにも書くことができます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">//</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;/index&quot;</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>または、否定先読みを使って:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">%r{^(?!/index$)}</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-E9-9D-99-E7-9A-84-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-28Static+Files-29">静的ファイル(Static Files)<span><a href="#label-E9-9D-99-E7-9A-84-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-28Static+Files-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>静的ファイルは<code>./public</code>ディレクトリから配信されます。
<code>:public_folder</code>オプションを指定することで別の場所を指定することができます。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">public_folder</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/static&#39;</span>
</pre>

<p>ノート: この静的ファイル用のディレクトリ名はURL中に含まれません。
例えば、<code>./public/css/style.css</code>は<code>http://example.com/css/style.css</code>でアクセスできます。</p>

<p><code>Cache-Control</code>の設定をヘッダーへ追加するには<code>:static_cache_control</code>の設定(下記参照)を加えてください。</p>

<h2 id="label-E3-83-93-E3-83-A5-E3-83-BC+-2F+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Views+-2F+Templates-29">ビュー / テンプレート(Views / Templates)<span><a href="#label-E3-83-93-E3-83-A5-E3-83-BC+-2F+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Views+-2F+Templates-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>各テンプレート言語はそれ自身のレンダリングメソッドを通して展開されます。それらのメソッドは単に文字列を返します。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これは、<code>views/index.erb</code>をレンダリングします。</p>

<p>テンプレート名を渡す代わりに、直接そのテンプレートの中身を渡すこともできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">code</span> = <span class="ruby-string">&quot;&lt;%= Time.now %&gt;&quot;</span>
  <span class="ruby-identifier">erb</span> <span class="ruby-identifier">code</span>
<span class="ruby-keyword">end</span>
</pre>

<p>テンプレートのレイアウトは第２引数のハッシュ形式のオプションをもとに表示されます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">post</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これは、<code>views/post.erb</code>内に埋め込まれた<code>views/index.erb</code>をレンダリングします（デフォルトは<code>views/layout.erb</code>があればそれになります）。</p>

<p>Sinatraが理解できないオプションは、テンプレートエンジンに渡されることになります。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">html5</span>
<span class="ruby-keyword">end</span>
</pre>

<p>テンプレート言語ごとにオプションをセットすることもできます。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">haml</span>, :<span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">html5</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>レンダリングメソッドに渡されたオプションは<code>set</code>で設定されたオプションを上書きします。</p>

<p>利用可能なオプション:</p>
<dl>
  <dt>locals</dt>
  <dd>
    ドキュメントに渡されるローカルのリスト。パーシャルに便利。
    例: <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    文字エンコーディング（不確かな場合に使用される）。デフォルトは、<tt>settings.default_encoding</tt>。
  </dd>

  <dt>views</dt>
  <dd>
    テンプレートを読み出すビューのディレクトリ。デフォルトは、<tt>settings.views</tt>。
  </dd>

  <dt>layout</dt>
  <dd>
    レイアウトを使うかの指定(<tt>true</tt> または <tt>false</tt>)。値がシンボルの場合は、使用するテンプレートが指定される。例: <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    テンプレートが生成するContent-Type。デフォルトはテンプレート言語ごとに異なる。
  </dd>

  <dt>scope</dt>
  <dd>
    テンプレートをレンダリングするときのスコープ。デフォルトは、アプリケーションのインスタンス。これを変更した場合、インスタンス変数およびヘルパーメソッドが利用できなくなる。
  </dd>

  <dt>layout_engine</dt>
  <dd>
    レイアウトをレンダリングするために使用するテンプレートエンジン。レイアウトをサポートしない言語で有用。デフォルトはテンプレートに使われるエンジン。例: <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>

  <dt>layout_options</dt>
  <dd>
    レイアウトをレンダリングするときだけに使う特別なオプション。例:
    <tt>set :rdoc, :layout_options => { :views => 'views/layouts' }</tt>
  </dd>
</dl>
<p>テンプレートは<code>./views</code>ディレクトリ下に配置されています。 他のディレクトリを使用する場合の例:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span>, <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/templates&#39;</span>
</pre>

<p>テンプレートはシンボルを使用して参照させることを覚えておいて下さい。
サブディレクトリでもこの場合は<code>:&#39;subdir/template&#39;</code>のようにします。
レンダリングメソッドは文字列が渡されると、それをそのまま文字列として出力するので、シンボルを使ってください。</p>

<h3 id="label-E3-83-AA-E3-83-86-E3-83-A9-E3-83-AB-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Literal+Templates-29">リテラルテンプレート(Literal Templates)<span><a href="#label-E3-83-AA-E3-83-86-E3-83-A9-E3-83-AB-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Literal+Templates-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%div.title Hello World&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これはそのテンプレート文字列をレンダリングします。</p>

<h3 id="label-E5-88-A9-E7-94-A8-E5-8F-AF-E8-83-BD-E3-81-AA-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E8-A8-80-E8-AA-9E">利用可能なテンプレート言語<span><a href="#label-E5-88-A9-E7-94-A8-E5-8F-AF-E8-83-BD-E3-81-AA-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E8-A8-80-E8-AA-9E">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>いくつかの言語には複数の実装があります。使用する（そしてスレッドセーフにする）実装を指定するには、それを最初にrequireしてください。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdiscount&#39;</span> <span class="ruby-comment"># または require &#39;bluecloth&#39;</span>
<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-identifier">markdown</span> :<span class="ruby-identifier">index</span> }
</pre>

<h4 id="label-Haml+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Haml テンプレート<span><a href="#label-Haml+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>
<h4 id="label-Erb+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Erb テンプレート<span><a href="#label-Erb+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
      または erb (Rubyに同梱)
    </td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.erb</tt>, <tt>.rhtml</tt> or <tt>.erubis</tt> (Erubisだけ)</td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>
<h4 id="label-Builder+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Builder テンプレート<span><a href="#label-Builder+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td>
      <a href="https://github.com/jimweirich/builder" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<p>インラインテンプレート用にブロックを取ることもできます（例を参照）。</p>

<h4 id="label-Nokogiri+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Nokogiri テンプレート<span><a href="#label-Nokogiri+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<p>インラインテンプレート用にブロックを取ることもできます（例を参照）。</p>

<h4 id="label-Sass+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Sass テンプレート<span><a href="#label-Sass+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>
<h4 id="label-Scss+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Scss テンプレート<span><a href="#label-Scss+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>
<h4 id="label-Less+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Less テンプレート<span><a href="#label-Less+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.less</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>
<h4 id="label-Liquid+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Liquid テンプレート<span><a href="#label-Liquid+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>LiquidテンプレートからRubyのメソッド(<code>yield</code>を除く)を呼び出すことができないため、ほぼ全ての場合にlocalsを指定する必要があるでしょう。</p>

<h4 id="label-Markdown+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Markdown テンプレート<span><a href="#label-Markdown+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td>
      次の何れか:
        <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
        <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
        <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
        <a href="http://kramdown.gettalong.org/" title="kramdown">kramdown</a>,
        <a href="https://github.com/bhollis/maruku" title="maruku">maruku</a>
    </td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt> and <tt>.md</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Markdownからメソッドを呼び出すことも、localsに変数を渡すこともできません。
それゆえ、他のレンダリングエンジンとの組み合わせで使うのが普通です。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">markdown</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>ノート: 他のテンプレート内で<code>markdown</code>メソッドを呼び出せます。</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">markdown</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>MarkdownからはRubyを呼ぶことができないので、Markdownで書かれたレイアウトを使うことはできません。しかしながら、<code>:layout_engine</code>オプションを渡すことでテンプレートのものとは異なるレンダリングエンジンをレイアウトのために使うことができます。</p>

<h4 id="label-Textile+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Textile テンプレート<span><a href="#label-Textile+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.textile</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Textileからメソッドを呼び出すことも、localsに変数を渡すこともできません。
それゆえ、他のレンダリングエンジンとの組み合わせで使うのが普通です。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">textile</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>ノート: 他のテンプレート内で<code>textile</code>メソッドを呼び出せます。</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">textile</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>TexttileからはRubyを呼ぶことができないので、Textileで書かれたレイアウトを使うことはできません。しかしながら、<code>:layout_engine</code>オプションを渡すことでテンプレートのものとは異なるレンダリングエンジンをレイアウトのために使うことができます。</p>

<h4 id="label-RDoc+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">RDoc テンプレート<span><a href="#label-RDoc+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://rdoc.sourceforge.net/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>RDocからメソッドを呼び出すことも、localsに変数を渡すこともできません。 それゆえ、他のレンダリングエンジンとの組み合わせで使うのが普通です。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rdoc</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>ノート: 他のテンプレート内で<code>rdoc</code>メソッドを呼び出せます。</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">rdoc</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>RDocからはRubyを呼ぶことができないので、RDocで書かれたレイアウトを使うことはできません。しかしながら、<code>:layout_engine</code>オプションを渡すことでテンプレートのものとは異なるレンダリングエンジンをレイアウトのために使うことができます。</p>

<h4 id="label-AsciiDoc+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">AsciiDoc テンプレート<span><a href="#label-AsciiDoc+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
 <tr>
   <td>依存</td>
   <td><a href="http://asciidoctor.org/" title="Asciidoctor">Asciidoctor</a></td>
 </tr>
 <tr>
   <td>ファイル拡張子</td>
   <td><tt>.asciidoc</tt>, <tt>.adoc</tt> and <tt>.ad</tt></td>
 </tr>
 <tr>
   <td>例</td>
   <td><tt>asciidoc :README, :layout_engine => :erb</tt></td>
 </tr>
</table>
<p>AsciiDocテンプレートからRubyのメソッドを直接呼び出すことができないため、ほぼ全ての場合にlocalsを指定する必要があるでしょう。</p>

<h4 id="label-Radius+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Radius テンプレート<span><a href="#label-Radius+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="https://github.com/jlong/radius" title="Radius">Radius</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.radius</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>radius :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>RadiusテンプレートからRubyのメソッドを直接呼び出すことができないため、ほぼ全ての場合にlocalsを指定する必要があるでしょう。</p>

<h4 id="label-Markaby+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Markaby テンプレート<span><a href="#label-Markaby+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>
<p>インラインテンプレート用にブロックを取ることもできます（例を参照）。</p>

<h4 id="label-RABL+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">RABL テンプレート<span><a href="#label-RABL+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>
<h4 id="label-Slim+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Slim テンプレート<span><a href="#label-Slim+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>
<h4 id="label-Creole+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Creole テンプレート<span><a href="#label-Creole+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.creole</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Creoleからメソッドを呼び出すことも、localsに変数を渡すこともできません。
それゆえ、他のレンダリングエンジンとの組み合わせで使うのが普通です。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creole</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>ノート: 他のテンプレート内で<code>creole</code>メソッドを呼び出せます。</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">creole</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>CreoleからはRubyを呼ぶことができないので、Creoleで書かれたレイアウトを使うことはできません。しかしながら、<code>:layout_engine</code>オプションを渡すことでテンプレートのものとは異なるレンダリングエンジンをレイアウトのために使うことができます。</p>

<h4 id="label-MediaWiki+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">MediaWiki テンプレート<span><a href="#label-MediaWiki+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="https://github.com/nricciar/wikicloth" title="WikiCloth">WikiCloth</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.mediawiki</tt> および <tt>.mw</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>mediawiki :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>MediaWikiのテンプレートは直接メソッドから呼び出したり、ローカル変数を通すことはできません。それゆえに、通常は別のレンダリングエンジンと組み合わせて利用します。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mediawiki</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>ノート: 他のテンプレートから部分的に<code>mediawiki</code>メソッドを呼び出すことも可能です。</p>

<h4 id="label-CoffeeScript+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">CoffeeScript テンプレート<span><a href="#label-CoffeeScript+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a> および
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        JavaScriptの起動方法
      </a>
    </td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.coffee</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>
<h4 id="label-Stylus+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Stylus テンプレート<span><a href="#label-Stylus+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td>
      <a href="https://github.com/lucasmazza/ruby-stylus" title="Ruby Stylus">
        Stylus
      </a> および
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        JavaScriptの起動方法
      </a>
    </td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.styl</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>stylus :index</tt></td>
  </tr>
</table>
<p>Stylusテンプレートを使えるようにする前に、まず<code>stylus</code>と<code>stylus/tilt</code>を読み込む必要があります。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stylus&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stylus/tilt&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">stylus</span> :<span class="ruby-identifier">example</span>
<span class="ruby-keyword">end</span>
</pre>

<h4 id="label-Yajl+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">Yajl テンプレート<span><a href="#label-Yajl+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td>
      <tt>
        yajl :index,
             :locals => { :key => 'qux' },
             :callback => 'present',
             :variable => 'resource'
      </tt>
    </td>
  </tr>
</table>
<p>テンプレートのソースはRubyの文字列として評価され、その結果のJSON変数は<code>#to_json</code>を使って変換されます。</p>

<pre class="ruby"><span class="ruby-identifier">json</span> = { :<span class="ruby-identifier">foo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;bar&#39;</span> }
<span class="ruby-identifier">json</span>[:<span class="ruby-identifier">baz</span>] = <span class="ruby-identifier">key</span>
</pre>

<p><code>:callback</code>および<code>:variable</code>オプションは、レンダリングされたオブジェクトを装飾するために使うことができます。</p>

<pre class="ruby"><span class="ruby-identifier">var</span> <span class="ruby-identifier">resource</span> = {<span class="ruby-string">&quot;foo&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;bar&quot;</span>,<span class="ruby-string">&quot;baz&quot;</span><span class="ruby-operator">:</span><span class="ruby-string">&quot;qux&quot;</span>}; <span class="ruby-identifier">present</span>(<span class="ruby-identifier">resource</span>);
</pre>

<h4 id="label-WLang+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">WLang テンプレート<span><a href="#label-WLang+-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>依存</td>
    <td><a href="https://github.com/blambeau/wlang/" title="wlang">wlang</a></td>
  </tr>
  <tr>
    <td>ファイル拡張子</td>
    <td><tt>.wlang</tt></td>
  </tr>
  <tr>
    <td>例</td>
    <td><tt>wlang :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>WLang内でのRubyメソッドの呼び出しは一般的ではないので、ほとんどの場合にlocalsを指定する必要があるでしょう。しかしながら、WLangで書かれたレイアウトは<code>yield</code>をサポートしています。</p>

<h3 id="label-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E5-86-85-E3-81-A7-E3-81-AE-E5-A4-89-E6-95-B0-E3-81-B8-E3-81-AE-E3-82-A2-E3-82-AF-E3-82-BB-E3-82-B9">テンプレート内での変数へのアクセス<span><a href="#label-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E5-86-85-E3-81-A7-E3-81-AE-E5-A4-89-E6-95-B0-E3-81-B8-E3-81-AE-E3-82-A2-E3-82-AF-E3-82-BB-E3-82-B9">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>テンプレートはルーティングハンドラと同じコンテキストの中で評価されます。ルーティングハンドラでセットされたインスタンス変数はテンプレート内で直接使うことができます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:id&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@foo</span> = <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>])
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%h1= @foo.name&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>また、ローカル変数のハッシュで明示的に指定することもできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:id&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">foo</span> = <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>])
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%h1= bar.name&#39;</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">bar</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">foo</span> }
<span class="ruby-keyword">end</span>
</pre>

<p>このやり方は他のテンプレート内で部分テンプレートとして表示する時に典型的に使用されます。</p>

<h3 id="label-yield-E3-82-92-E4-BC-B4-E3-81-86-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-81-A8-E3-83-8D-E3-82-B9-E3-83-88-E3-81-97-E3-81-9F-E3-83-AC-E3-82-A4-E3-82-A2-E3-82-A6-E3-83-88"><code>yield</code>を伴うテンプレートとネストしたレイアウト<span><a href="#label-yield-E3-82-92-E4-BC-B4-E3-81-86-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-81-A8-E3-83-8D-E3-82-B9-E3-83-88-E3-81-97-E3-81-9F-E3-83-AC-E3-82-A4-E3-82-A2-E3-82-A6-E3-83-88">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>レイアウトは通常、<code>yield</code>を呼ぶ単なるテンプレートに過ぎません。
そのようなテンプレートは、既に説明した<code>:template</code>オプションを通して使われるか、または次のようなブロックを伴ってレンダリングされます。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">post</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>このコードは、<code>erb :index, :layout =&gt; :post</code>とほぼ等価です。</p>

<p>レンダリングメソッドにブロックを渡すスタイルは、ネストしたレイアウトを作るために最も役立ちます。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">main_layout</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">admin_layout</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">user</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これはまた次のより短いコードでも達成できます。</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">admin_layout</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">main_layout</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span>
</pre>

<p>現在、次のレンダリングメソッドがブロックを取れます: <code>erb</code>, <code>haml</code>,
<code>liquid</code>, <code>slim</code>, <code>wlang</code>。
また汎用の<code>render</code>メソッドもブロックを取れます。</p>

<h3 id="label-E3-82-A4-E3-83-B3-E3-83-A9-E3-82-A4-E3-83-B3-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Inline+Templates-29">インラインテンプレート(Inline Templates)<span><a href="#label-E3-82-A4-E3-83-B3-E3-83-A9-E3-82-A4-E3-83-B3-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Inline+Templates-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>テンプレートはソースファイルの最後で定義することもできます。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>

__END__

<span class="ruby-identifier">@@</span> <span class="ruby-identifier">layout</span>
<span class="ruby-operator">%</span><span class="ruby-identifier">tml</span>
  = <span class="ruby-keyword">yield</span>

<span class="ruby-identifier">@@</span> <span class="ruby-identifier">index</span>
<span class="ruby-operator">%</span><span class="ruby-identifier">iv</span>.<span class="ruby-identifier">title</span> <span class="ruby-constant">Hello</span> <span class="ruby-identifier">world!</span><span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-operator">!</span>
</pre>

<p>ノート:
Sinatraをrequireするソースファイル内で定義されたインラインテンプレートは自動的に読み込まれます。他のソースファイル内にインラインテンプレートがある場合には<code>enable
:inline_templates</code>を明示的に呼んでください。</p>

<h3 id="label-E5-90-8D-E5-89-8D-E4-BB-98-E3-81-8D-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Named+Templates-29">名前付きテンプレート(Named Templates)<span><a href="#label-E5-90-8D-E5-89-8D-E4-BB-98-E3-81-8D-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-28Named+Templates-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>テンプレートはトップレベルの<code>template</code>メソッドで定義することもできます。</p>

<pre class="ruby"><span class="ruby-identifier">template</span> :<span class="ruby-identifier">layout</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;%html\n  =yield\n&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">template</span> :<span class="ruby-identifier">index</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;%div.title Hello World!&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>「layout」というテンプレートが存在する場合、そのテンプレートファイルは他のテンプレートがレンダリングされる度に使用されます。<code>:layout
=&gt; false</code>で個別に、または<code>set :haml, :layout =&gt;
false</code>でデフォルトとして、レイアウトを無効にすることができます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E6-8B-A1-E5-BC-B5-E5-AD-90-E3-81-AE-E9-96-A2-E9-80-A3-E4-BB-98-E3-81-91">ファイル拡張子の関連付け<span><a href="#label-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E6-8B-A1-E5-BC-B5-E5-AD-90-E3-81-AE-E9-96-A2-E9-80-A3-E4-BB-98-E3-81-91">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>任意のテンプレートエンジンにファイル拡張子を関連付ける場合は、<code>Tilt.register</code>を使います。例えば、Textileテンプレートに<code>tt</code>というファイル拡張子を使いたい場合は、以下のようにします。</p>

<pre class="ruby"><span class="ruby-constant">Tilt</span>.<span class="ruby-identifier">register</span> :<span class="ruby-identifier">tt</span>, <span class="ruby-constant">Tilt</span>[:<span class="ruby-identifier">textile</span>]
</pre>

<h3 id="label-E3-82-AA-E3-83-AA-E3-82-B8-E3-83-8A-E3-83-AB-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-82-A8-E3-83-B3-E3-82-B8-E3-83-B3-E3-81-AE-E8-BF-BD-E5-8A-A0">オリジナルテンプレートエンジンの追加<span><a href="#label-E3-82-AA-E3-83-AA-E3-82-B8-E3-83-8A-E3-83-AB-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-82-A8-E3-83-B3-E3-82-B8-E3-83-B3-E3-81-AE-E8-BF-BD-E5-8A-A0">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>まず、Tiltでそのエンジンを登録し、次にレンダリングメソッドを作ります。</p>

<pre class="ruby"><span class="ruby-constant">Tilt</span>.<span class="ruby-identifier">register</span> :<span class="ruby-identifier">myat</span>, <span class="ruby-constant">MyAwesomeTemplateEngine</span>

<span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">myat</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-identifier">render</span>(:<span class="ruby-identifier">myat</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">myat</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これは、<code>./views/index.myat</code>をレンダリングします。Tiltについての詳細は、<a
href="https://github.com/rtomayko/tilt">github.com/rtomayko/tilt</a>
を参照してください。</p>

<h2 id="label-E3-83-95-E3-82-A3-E3-83-AB-E3-82-BF-28Filters-29">フィルタ(Filters)<span><a href="#label-E3-83-95-E3-82-A3-E3-83-AB-E3-82-BF-28Filters-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>beforeフィルタは、リクエストのルーティングと同じコンテキストで各リクエストの前に評価され、それによってリクエストとレスポンスを変更可能にします。フィルタ内でセットされたインスタンス変数はルーティングとテンプレートからアクセスすることができます。</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@note</span> = <span class="ruby-string">&#39;Hi!&#39;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-string">&#39;/foo/bar/baz&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@note</span> <span class="ruby-comment">#=&gt; &#39;Hi!&#39;</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment">#=&gt; &#39;bar/baz&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>afterフィルタは、リクエストのルーティングと同じコンテキストで各リクエストの後に評価され、それによってこれもリクエストとレスポンスを変更可能にします。beforeフィルタとルーティング内でセットされたインスタンス変数はafterフィルタからアクセスすることができます。</p>

<pre class="ruby"><span class="ruby-identifier">after</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ノート:
<code>body</code>メソッドを使わずにルーティングから文字列を返すだけの場合、その内容はafterフィルタでまだ利用できず、その後に生成されることになります。</p>

<p>フィルタにはオプションとしてパターンを渡すことができ、この場合はリクエストのパスがパターンにマッチした場合にのみフィルタが評価されるようになります。</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-string">&#39;/protected/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">authenticate!</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">after</span> <span class="ruby-string">&#39;/create/:slug&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">slug</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">last_slug</span>] = <span class="ruby-identifier">slug</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ルーティング同様、フィルタもまた条件を取ることができます。</p>

<pre class="ruby"><span class="ruby-identifier">before</span> :<span class="ruby-identifier">agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/Songbird/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">after</span> <span class="ruby-string">&#39;/blog/*&#39;</span>, :<span class="ruby-identifier">host_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;example.com&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-E3-83-98-E3-83-AB-E3-83-91-E3-83-BC-28Helpers-29">ヘルパー(Helpers)<span><a href="#label-E3-83-98-E3-83-AB-E3-83-91-E3-83-BC-28Helpers-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>トップレベルの<code>helpers</code>メソッドを使用してルーティングハンドラやテンプレートで使うヘルパーメソッドを定義できます。</p>

<pre class="ruby"><span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">name</span>)
    <span class="ruby-node">&quot;#{name}bar&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:name&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;name&#39;</span>])
<span class="ruby-keyword">end</span>
</pre>

<p>あるいは、ヘルパーメソッドをモジュール内で個別に定義することもできます。</p>

<pre class="ruby"><span class="ruby-keyword">module</span> <span class="ruby-constant">FooUtils</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">foo</span>(<span class="ruby-identifier">name</span>) <span class="ruby-node">&quot;#{name}foo&quot;</span> <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">module</span> <span class="ruby-constant">BarUtils</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">name</span>) <span class="ruby-node">&quot;#{name}bar&quot;</span> <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">helpers</span> <span class="ruby-constant">FooUtils</span>, <span class="ruby-constant">BarUtils</span>
</pre>

<p>その効果は、アプリケーションクラスにモジュールをインクルードするのと同じです。</p>

<h3 id="label-E3-82-BB-E3-83-83-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E4-BD-BF-E7-94-A8">セッションの使用<span><a href="#label-E3-82-BB-E3-83-83-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E4-BD-BF-E7-94-A8">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>セッションはリクエスト間での状態維持のために使用されます。その起動により、ユーザセッションごとに一つのセッションハッシュが与えられます。</p>

<pre class="ruby"><span class="ruby-identifier">enable</span> :<span class="ruby-identifier">sessions</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;value = &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>].<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:value&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;value&#39;</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>ノート: <code>enable
:sessions</code>は実際にはすべてのデータをクッキーに保持します。これは必ずしも期待通りのものにならないかもしれません（例えば、大量のデータを保持することでトラフィックが増大するなど）。Rackセッションミドルウェアの利用が可能であり、その場合は<code>enable
:sessions</code>を呼ばずに、選択したミドルウェアを他のミドルウェアのときと同じようにして取り込んでください。</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">Pool</span>, :<span class="ruby-identifier">expire_after</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2592000</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;value = &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>].<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:value&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;value&#39;</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>セキュリティ向上のため、クッキー内のセッションデータはセッション秘密鍵(session
secret)で署名されます。Sinatraによりランダムな秘密鍵が個別に生成されます。しかし、この秘密鍵はアプリケーションの立ち上げごとに変わってしまうので、すべてのアプリケーションのインスタンスで共有できる秘密鍵をセットしたくなるかもしれません。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">session_secret</span>, <span class="ruby-string">&#39;super secret&#39;</span>
</pre>

<p>更に、設定変更をしたい場合は、<code>sessions</code>の設定においてオプションハッシュを保持することもできます。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, :<span class="ruby-identifier">domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;foo.com&#39;</span>
</pre>

<p>foo.comのサブドメイン上のアプリ間でセッションを共有化したいときは、代わりにドメインの前に <em>.</em> を付けます。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, :<span class="ruby-identifier">domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;.foo.com&#39;</span>
</pre>

<h3 id="label-E5-81-9C-E6-AD-A2-28Halting-29">停止(Halting)<span><a href="#label-E5-81-9C-E6-AD-A2-28Halting-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>フィルタまたはルーティング内で直ちにリクエストを止める場合</p>

<pre class="ruby"><span class="ruby-identifier">halt</span>
</pre>

<p>この際、ステータスを指定することもできます。</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">410</span>
</pre>

<p>body部を指定することも、</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-string">&#39;ここにbodyを書く&#39;</span>
</pre>

<p>ステータスとbody部を指定することも、</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">401</span>, <span class="ruby-string">&#39;立ち去れ!&#39;</span>
</pre>

<p>ヘッダを付けることもできます。</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, {<span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>}, <span class="ruby-string">&#39;リベンジ&#39;</span>
</pre>

<p>もちろん、テンプレートを<code>halt</code>に結びつけることも可能です。</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-identifier">erb</span>(:<span class="ruby-identifier">error</span>)
</pre>

<h3 id="label-E3-83-91-E3-83-83-E3-82-B7-E3-83-B3-E3-82-B0-28Passing-29">パッシング(Passing)<span><a href="#label-E3-83-91-E3-83-83-E3-82-B7-E3-83-B3-E3-82-B0-28Passing-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>ルーティングは<code>pass</code>を使って次のルーティングに飛ばすことができます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/guess/:who&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;who&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Frank&#39;</span>
  <span class="ruby-string">&quot;見つかっちゃった!&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/guess/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;はずれです!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ルーティングブロックからすぐに抜け出し、次にマッチするルーティングを実行します。マッチするルーティングが見当たらない場合は404が返されます。</p>

<h3 id="label-E5-88-A5-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-E3-81-AE-E8-AA-98-E7-99-BA">別ルーティングの誘発<span><a href="#label-E5-88-A5-E3-83-AB-E3-83-BC-E3-83-86-E3-82-A3-E3-83-B3-E3-82-B0-E3-81-AE-E8-AA-98-E7-99-BA">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>pass</code>を使ってルーティングを飛ばすのではなく、他のルーティングを呼んだ結果を得たいというときがあります。これを実現するには<code>call</code>を使えばいいです。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">call</span> <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-string">&quot;PATH_INFO&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;/bar&#39;</span>)
  [<span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span>:<span class="ruby-identifier">upcase</span>)]
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/bar&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;bar&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ノート:
先の例において、テストを楽にしパフォーマンスを改善するには、<code>&quot;bar&quot;</code>を単にヘルパーに移し、<code>/foo</code>および<code>/bar</code>から使えるようにするのがいいです。</p>

<p>リクエストが、その複製物でない同じアプリケーションのインスタンスに送られるようにしたいときは、<code>call</code>に代えて<code>call!</code>を使ってください。</p>

<p><code>call</code>についての詳細はRackの仕様書を参照してください。</p>

<h3 id="label-E3-83-9C-E3-83-87-E3-82-A3-E3-80-81-E3-82-B9-E3-83-86-E3-83-BC-E3-82-BF-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-89-E3-81-8A-E3-82-88-E3-81-B3-E3-83-98-E3-83-83-E3-83-80-E3-81-AE-E8-A8-AD-E5-AE-9A">ボディ、ステータスコードおよびヘッダの設定<span><a href="#label-E3-83-9C-E3-83-87-E3-82-A3-E3-80-81-E3-82-B9-E3-83-86-E3-83-BC-E3-82-BF-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-89-E3-81-8A-E3-82-88-E3-81-B3-E3-83-98-E3-83-83-E3-83-80-E3-81-AE-E8-A8-AD-E5-AE-9A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>ステータスコードおよびレスポンスボディを、ルーティングブロックの戻り値にセットすることが可能であり、これは推奨されています。しかし、あるケースでは実行フローの任意のタイミングでボディをセットしたくなるかもしれません。<code>body</code>ヘルパーメソッドを使えばそれができます。そうすると、それ以降、ボディにアクセスするためにそのメソッドを使うことができるようになります。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">body</span> <span class="ruby-string">&quot;bar&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">after</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">body</span>
<span class="ruby-keyword">end</span>
</pre>

<p>また、<code>body</code>にはブロックを渡すことができ、これはRackハンドラにより実行されることになります(これはストリーミングを実装するのに使われます。“戻り値”の項を参照してください。)</p>

<p>ボディと同様に、ステータスコードおよびヘッダもセットできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">status</span> <span class="ruby-value">418</span>
  <span class="ruby-identifier">headers</span>      <span class="ruby-string">&quot;Allow&quot;</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;BREW, POST, GET, PROPFIND, WHEN&quot;</span>,
    <span class="ruby-string">&quot;Refresh&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;Refresh: 20; http://www.ietf.org/rfc/rfc2324.txt&quot;</span>
  <span class="ruby-identifier">body</span> <span class="ruby-string">&quot;I&#39;m a tea pot!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>引数を伴わない<code>body</code>、<code>headers</code>、<code>status</code>などは、それらの現在の値にアクセスするために使えます。</p>

<h3 id="label-E3-82-B9-E3-83-88-E3-83-AA-E3-83-BC-E3-83-9F-E3-83-B3-E3-82-B0-E3-83-AC-E3-82-B9-E3-83-9D-E3-83-B3-E3-82-B9-28Streaming+Responses-29">ストリーミングレスポンス(Streaming Responses)<span><a href="#label-E3-82-B9-E3-83-88-E3-83-AA-E3-83-BC-E3-83-9F-E3-83-B3-E3-82-B0-E3-83-AC-E3-82-B9-E3-83-9D-E3-83-B3-E3-82-B9-28Streaming+Responses-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>レスポンスボディの部分を未だ生成している段階で、データを送り出したいということがあります。極端な例では、クライアントがコネクションを閉じるまでデータを送り続けたいことがあります。<code>stream</code>ヘルパーを使えば、独自ラッパーを作る必要はありません。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">stream</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;それは伝 -\n&quot;</span>
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">0.5</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot; (少し待つ) \n&quot;</span>
    <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;- 説になる！\n&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これはストリーミングAPI、<a href="http://en.wikipedia.org/wiki/WebSocket">Server Sent
Events}[http://dev.w3.org/html5/eventsource/]の実装を可能にし、{WebSockets</a>の土台に使うことができます。また、一部のコンテンツが遅いリソースに依存しているときに、スループットを上げるために使うこともできます。</p>

<p>ノート: ストリーミングの挙動、特に並行リクエスト(cuncurrent
requests)の数は、アプリケーションを提供するのに使われるWebサーバに強く依存します。WEBRickを含むいくつかのサーバは、ストリーミングを全くサポートしません。サーバがストリーミングをサポートしない場合、ボディは<code>stream</code>に渡されたブロックの実行が終了した後、一度に全部送られることになります。ストリーミングは、Shotgunを使った場合は全く動作しません。</p>

<p>オプション引数が<code>keep_open</code>にセットされている場合、ストリームオブジェクト上で<code>close</code>は呼ばれず、実行フローの任意の遅れたタイミングでユーザがこれを閉じることを可能にします。これはThinやRainbowsのようなイベント型サーバ上でしか機能しません。他のサーバでは依然ストリームは閉じられます。</p>

<pre class="ruby"><span class="ruby-comment"># ロングポーリング</span>

<span class="ruby-identifier">set</span> :<span class="ruby-identifier">server</span>, :<span class="ruby-identifier">thin</span>
<span class="ruby-identifier">connections</span> = []

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/subscribe&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># サーバイベントにおけるクライアントの関心を登録</span>
  <span class="ruby-identifier">stream</span>(:<span class="ruby-identifier">keep_open</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">connections</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">out</span>
    <span class="ruby-comment"># 死んでいるコネクションを排除</span>
    <span class="ruby-identifier">connections</span>.<span class="ruby-identifier">reject!</span>(<span class="ruby-operator">&amp;</span>:<span class="ruby-identifier">closed?</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">post</span> <span class="ruby-string">&#39;/message&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">connections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">out</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># クライアントへ新規メッセージ到着の通知</span>
    <span class="ruby-identifier">out</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;message&#39;</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&quot;\n&quot;</span>

    <span class="ruby-comment"># クライアントへの再接続の指示</span>
    <span class="ruby-identifier">out</span>.<span class="ruby-identifier">close</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># 肯定応答</span>
  <span class="ruby-string">&quot;message received&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E3-83-AD-E3-82-AE-E3-83-B3-E3-82-B0-28Logging-29">ロギング(Logging)<span><a href="#label-E3-83-AD-E3-82-AE-E3-83-B3-E3-82-B0-28Logging-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>リクエストスコープにおいて、<code>logger</code>ヘルパーは<code>Logger</code>インスタンスを作り出します。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;loading data&quot;</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>このロガーは、自動でRackハンドラのロギング設定を参照します。ロギングが無効(disabled)にされている場合、このメソッドはダミーオブジェクトを返すので、ルーティングやフィルタにおいて特に心配することはありません。</p>

<p>ノート:
ロギングは、<code>Sinatra::Application</code>に対してのみデフォルトで有効にされているので、<code>Sinatra::Base</code>を継承している場合は、ユーザがこれを有効化する必要があります。</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span>, :<span class="ruby-identifier">development</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">logging</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p><a
href="'rack.logger'">ロギングミドルウェアが設定されてしまうのを避けるには、logging設定をnilにセットします。しかしこの場合、loggerがnilを返すことを忘れないように。よくあるユースケースは、オリジナルのロガーをセットしたいときです。Sinatraは、とにかくenv</a>で見つかるものを使います。</p>

<h3 id="label-MIME-E3-82-BF-E3-82-A4-E3-83-97-28Mime+Types-29">MIMEタイプ(Mime Types)<span><a href="#label-MIME-E3-82-BF-E3-82-A4-E3-83-97-28Mime+Types-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>send_file</code>か静的ファイルを使う時、SinatraがMIMEタイプを理解できない場合があります。その時は
<code>mime_type</code> を使ってファイル拡張子毎に登録して下さい。</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">mime_type</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;text/foo&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これは<code>content_type</code>ヘルパーで利用することができます:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">content_type</span> :<span class="ruby-identifier">foo</span>
  <span class="ruby-string">&quot;foo foo foo&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-URL-E3-81-AE-E7-94-9F-E6-88-90">URLの生成<span><a href="#label-URL-E3-81-AE-E7-94-9F-E6-88-90">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>URLを生成するためには<code>url</code>ヘルパーメソッドが使えます。Hamlではこのようにします。</p>

<pre class="ruby"><span class="ruby-operator">%</span>{:<span class="ruby-identifier">href</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">url</span>(<span class="ruby-string">&#39;/foo&#39;</span>)} <span class="ruby-identifier">foo</span>
</pre>

<p>これはリバースプロキシおよびRackルーティングを、それらがあれば考慮に入れます。</p>

<p>このメソッドには<code>to</code>というエイリアスがあります(以下の例を参照)。</p>

<h3 id="label-E3-83-96-E3-83-A9-E3-82-A6-E3-82-B6-E3-83-AA-E3-83-80-E3-82-A4-E3-83-AC-E3-82-AF-E3-83-88-28Browser+Redirect-29">ブラウザリダイレクト(Browser Redirect)<span><a href="#label-E3-83-96-E3-83-A9-E3-82-A6-E3-82-B6-E3-83-AA-E3-83-80-E3-82-A4-E3-83-AC-E3-82-AF-E3-83-88-28Browser+Redirect-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>redirect</code> ヘルパーメソッドを使うことで、ブラウザをリダイレクトさせることができます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar&#39;</span>)
<span class="ruby-keyword">end</span>
</pre>

<p>他に追加されるパラメータは、<code>halt</code>に渡される引数と同様に取り扱われます。</p>

<pre class="ruby"><span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar&#39;</span>), <span class="ruby-value">303</span>
<span class="ruby-identifier">redirect</span> <span class="ruby-string">&#39;http://google.com&#39;</span>, <span class="ruby-string">&#39;wrong place, buddy&#39;</span>
</pre>

<p>また、<code>redirect back</code>を使えば、簡単にユーザが来たページへ戻るリダイレクトを作れます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;&lt;a href=&#39;/bar&#39;&gt;do something&lt;/a&gt;&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/bar&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">do_something</span>
  <span class="ruby-identifier">redirect</span> <span class="ruby-identifier">back</span>
<span class="ruby-keyword">end</span>
</pre>

<p>redirectに引数を渡すには、それをクエリーに追加するか、</p>

<pre class="ruby"><span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar?sum=42&#39;</span>)
</pre>

<p>または、セッションを使います。</p>

<pre class="ruby"><span class="ruby-identifier">enable</span> :<span class="ruby-identifier">sessions</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">secret</span>] = <span class="ruby-string">&#39;foo&#39;</span>
  <span class="ruby-identifier">redirect</span> <span class="ruby-identifier">to</span>(<span class="ruby-string">&#39;/bar&#39;</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/bar&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">secret</span>]
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E3-82-AD-E3-83-A3-E3-83-83-E3-82-B7-E3-83-A5-E5-88-B6-E5-BE-A1-28Cache+Control-29">キャッシュ制御(Cache Control)<span><a href="#label-E3-82-AD-E3-83-A3-E3-83-83-E3-82-B7-E3-83-A5-E5-88-B6-E5-BE-A1-28Cache+Control-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>ヘッダを正しく設定することが、適切なHTTPキャッシングのための基礎となります。</p>

<p>キャッシュ制御ヘッダ(Cache-Control header)は、次のように簡単に設定できます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">cache_control</span> :<span class="ruby-identifier">public</span>
  <span class="ruby-string">&quot;キャッシュしました!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ヒント: キャッシングをbeforeフィルタ内で設定します。</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">cache_control</span> :<span class="ruby-identifier">public</span>, :<span class="ruby-identifier">must_revalidate</span>, :<span class="ruby-identifier">max_age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">60</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>expires</code>ヘルパーを対応するヘッダに使っている場合は、キャッシュ制御は自動で設定されます。</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">expires</span> <span class="ruby-value">500</span>, :<span class="ruby-identifier">public</span>, :<span class="ruby-identifier">must_revalidate</span>
<span class="ruby-keyword">end</span>
</pre>

<p>キャッシュを適切に使うために、<code>etag</code>または<code>last_modified</code>を使うことを検討してください。これらのヘルパーを、重い仕事をさせる
<em>前</em>
に呼ぶことを推奨します。そうすれば、クライアントが既にキャッシュに最新版を持っている場合はレスポンスを直ちに破棄するようになります。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/article/:id&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@article</span> = <span class="ruby-constant">Article</span>.<span class="ruby-identifier">find</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>]
  <span class="ruby-identifier">last_modified</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">updated_at</span>
  <span class="ruby-identifier">etag</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">sha1</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">article</span>
<span class="ruby-keyword">end</span>
</pre>

<p>また、<a
href="http://ja.wikipedia.org/wiki/HTTP_ETag#Strong_and_weak_validation">weak
ETag</a>を使うこともできます。</p>

<pre class="ruby"><span class="ruby-identifier">etag</span> <span class="ruby-ivar">@article</span>.<span class="ruby-identifier">sha1</span>, :<span class="ruby-identifier">weak</span>
</pre>

<p>これらのヘルパーは、キャッシングをしてくれませんが、必要な情報をキャッシュに与えてくれます。もし手早いリバースプロキシキャッシングの解決策をお探しなら、
<a href="https://github.com/rtomayko/rack-cache">rack-cache</a>を試してください。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&quot;rack/cache&quot;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;sinatra&quot;</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">cache_control</span> :<span class="ruby-identifier">public</span>, :<span class="ruby-identifier">max_age</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">36000</span>
  <span class="ruby-identifier">sleep</span> <span class="ruby-value">5</span>
  <span class="ruby-string">&quot;hello&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>:static_cache_control</code>設定(以下を参照)を、キャッシュ制御ヘッダ情報を静的ファイルに追加するために使ってください。</p>

<p>RFC
2616によれば、アプリケーションは、If-MatchまたはIf-None-Matchヘッダが<code>*</code>に設定されている場合には、要求されたリソースが既に存在するか否かに応じて、異なる振る舞いをすべきとなっています。Sinatraは、getのような安全なリクエストおよびputのような冪等なリクエストは既に存在しているものとして仮定し、一方で、他のリソース(例えば、postリクエスト)は新たなリソースとして取り扱われるよう仮定します。この振る舞いは、<code>:new_resource</code>オプションを渡すことで変更できます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/create&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">etag</span> <span class="ruby-string">&#39;&#39;</span>, :<span class="ruby-identifier">new_resource</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
  <span class="ruby-constant">Article</span>.<span class="ruby-identifier">create</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">new_article</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ここでもWeak ETagを使いたい場合は、<code>:kind</code>オプションを渡してください。</p>

<pre class="ruby"><span class="ruby-identifier">etag</span> <span class="ruby-string">&#39;&#39;</span>, :<span class="ruby-identifier">new_resource</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, :<span class="ruby-identifier">kind</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">weak</span>
</pre>

<h3 id="label-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E3-81-AE-E9-80-81-E4-BF-A1">ファイルの送信<span><a href="#label-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E3-81-AE-E9-80-81-E4-BF-A1">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>ファイルを送信するには、<code>send_file</code>ヘルパーメソッドを使います。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">send_file</span> <span class="ruby-string">&#39;foo.png&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これはオプションを取ることもできます。</p>

<pre class="ruby"><span class="ruby-identifier">send_file</span> <span class="ruby-string">&#39;foo.png&#39;</span>, :<span class="ruby-identifier">type</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">jpg</span>
</pre>

<p>オプション一覧</p>
<dl>
  <dt>filename</dt>
    <dd>ファイル名。デフォルトは実際のファイル名。</dd>

  <dt>last_modified</dt>
    <dd>Last-Modifiedヘッダの値。デフォルトはファイルのmtime。</dd>

  <dt>type</dt>
    <dd>コンテンツの種類。設定がない場合、ファイル拡張子から類推される。</dd>

  <dt>disposition</dt>
    <dd>
      Content-Dispositionに使われる。許容値: <tt>nil</tt> (デフォルト)、
      <tt>:attachment</tt> および <tt>:inline</tt>
    </dd>

  <dt>length</dt>
    <dd>Content-Lengthヘッダ。デフォルトはファイルサイズ。</dd>

  <dt>status</dt>
    <dd>
      送られるステータスコード。静的ファイルをエラーページとして送るときに便利。

      Rackハンドラでサポートされている場合は、Rubyプロセスからのストリーミング以外の手段が使われる。このヘルパーメソッドを使うと、Sinatraは自動で範囲リクエスト(range requests)を扱う。
    </dd>
</dl>
<h3 id="label-E3-83-AA-E3-82-AF-E3-82-A8-E3-82-B9-E3-83-88-E3-82-AA-E3-83-96-E3-82-B8-E3-82-A7-E3-82-AF-E3-83-88-E3-81-B8-E3-81-AE-E3-82-A2-E3-82-AF-E3-82-BB-E3-82-B9">リクエストオブジェクトへのアクセス<span><a href="#label-E3-83-AA-E3-82-AF-E3-82-A8-E3-82-B9-E3-83-88-E3-82-AA-E3-83-96-E3-82-B8-E3-82-A7-E3-82-AF-E3-83-88-E3-81-B8-E3-81-AE-E3-82-A2-E3-82-AF-E3-82-BB-E3-82-B9">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>受信するリクエストオブジェクトは、<code>request</code>メソッドを通じてリクエストレベル(フィルタ、ルーティング、エラーハンドラ)からアクセスすることができます。</p>

<pre class="ruby"><span class="ruby-comment"># アプリケーションが http://example.com/example で動作している場合</span>
<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">t</span> = <span class="ruby-node">%w[text/css text/html application/javascript]</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">accept</span>              <span class="ruby-comment"># [&#39;text/html&#39;, &#39;  *&#39;]</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">accept?</span> <span class="ruby-string">&#39;text/xml&#39;</span>  <span class="ruby-comment"># true</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">preferred_type</span>(<span class="ruby-identifier">t</span>)   <span class="ruby-comment"># &#39;text/html&#39;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">body</span>                <span class="ruby-comment"># クライアントによって送信されたリクエストボディ(下記参照)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">scheme</span>              <span class="ruby-comment"># &quot;http&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">script_name</span>         <span class="ruby-comment"># &quot;/example&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span>           <span class="ruby-comment"># &quot;/foo&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">port</span>                <span class="ruby-comment"># 80</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">request_method</span>      <span class="ruby-comment"># &quot;GET&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">query_string</span>        <span class="ruby-comment"># &quot;&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">content_length</span>      <span class="ruby-comment"># request.bodyの長さ</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">media_type</span>          <span class="ruby-comment"># request.bodyのメディアタイプ</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host</span>                <span class="ruby-comment"># &quot;example.com&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">get?</span>                <span class="ruby-comment"># true (他の動詞にも同種メソッドあり)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">form_data?</span>          <span class="ruby-comment"># false</span>
  <span class="ruby-identifier">request</span>[<span class="ruby-string">&quot;some_param&quot;</span>]       <span class="ruby-comment"># some_param変数の値。[]はパラメータハッシュのショートカット</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">referrer</span>            <span class="ruby-comment"># クライアントのリファラまたは&#39;/&#39;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">user_agent</span>          <span class="ruby-comment"># ユーザエージェント (:agent 条件によって使用される)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">cookies</span>             <span class="ruby-comment"># ブラウザクッキーのハッシュ</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>                <span class="ruby-comment"># Ajaxリクエストかどうか</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">url</span>                 <span class="ruby-comment"># &quot;http://example.com/example/foo&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path</span>                <span class="ruby-comment"># &quot;/example/foo&quot;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">ip</span>                  <span class="ruby-comment"># クライアントのIPアドレス</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">secure?</span>             <span class="ruby-comment"># false (sslではtrueになる)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">forwarded?</span>          <span class="ruby-comment"># true (リバースプロキシの裏で動いている場合)</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>                 <span class="ruby-comment"># Rackによって渡された生のenvハッシュ</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>script_name</code>や<code>path_info</code>などのオプションは次のように利用することもできます。</p>

<pre class="ruby"><span class="ruby-identifier">before</span> { <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-string">&quot;/&quot;</span> }

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;全てのリクエストはここに来る&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>request.body</code>はIOまたはStringIOのオブジェクトです。</p>

<pre class="ruby"><span class="ruby-identifier">post</span> <span class="ruby-string">&quot;/api&quot;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">rewind</span>  <span class="ruby-comment"># 既に読まれているときのため</span>
  <span class="ruby-identifier">data</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-node">&quot;Hello #{data[&#39;name&#39;]}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E3-82-A2-E3-82-BF-E3-83-83-E3-83-81-E3-83-A1-E3-83-B3-E3-83-88-28Attachments-29">アタッチメント(Attachments)<span><a href="#label-E3-82-A2-E3-82-BF-E3-83-83-E3-83-81-E3-83-A1-E3-83-B3-E3-83-88-28Attachments-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>attachment</code>ヘルパーを使って、レスポンスがブラウザに表示されるのではなく、ディスクに保存されることをブラウザに対し通知することができます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">attachment</span>
  <span class="ruby-string">&quot;保存しました!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ファイル名を渡すこともできます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">attachment</span> <span class="ruby-string">&quot;info.txt&quot;</span>
  <span class="ruby-string">&quot;保存しました!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E6-97-A5-E4-BB-98-E3-81-A8-E6-99-82-E5-88-BB-E3-81-AE-E5-8F-96-E3-82-8A-E6-89-B1-E3-81-84">日付と時刻の取り扱い<span><a href="#label-E6-97-A5-E4-BB-98-E3-81-A8-E6-99-82-E5-88-BB-E3-81-AE-E5-8F-96-E3-82-8A-E6-89-B1-E3-81-84">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sinatraは<code>time_for</code>ヘルパーメソッドを提供しており、それは与えられた値からTimeオブジェクトを生成します。これはまた<code>DateTime</code>、<code>Date</code>および類似のクラスを変換できます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">time_for</span>(<span class="ruby-string">&#39;Dec 23, 2012&#39;</span>)
  <span class="ruby-string">&quot;まだ時間がある&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>このメソッドは、<code>expires</code>、<code>last_modified</code>といった種類のものの内部で使われています。そのため、アプリケーションにおいて、<code>time_for</code>をオーバーライドすることでそれらのメソッドの挙動を簡単に拡張できます。</p>

<pre class="ruby"><span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">time_for</span>(<span class="ruby-identifier">value</span>)
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>
    <span class="ruby-keyword">when</span> :<span class="ruby-identifier">yesterday</span> <span class="ruby-keyword">then</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-value">24</span><span class="ruby-operator">*</span><span class="ruby-value">60</span><span class="ruby-operator">*</span><span class="ruby-value">60</span>
    <span class="ruby-keyword">when</span> :<span class="ruby-identifier">tomorrow</span>  <span class="ruby-keyword">then</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">+</span> <span class="ruby-value">24</span><span class="ruby-operator">*</span><span class="ruby-value">60</span><span class="ruby-operator">*</span><span class="ruby-value">60</span>
    <span class="ruby-keyword">else</span> <span class="ruby-keyword">super</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">last_modified</span> :<span class="ruby-identifier">yesterday</span>
  <span class="ruby-identifier">expires</span> :<span class="ruby-identifier">tomorrow</span>
  <span class="ruby-string">&quot;hello&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E3-81-AE-E6-8E-A2-E7-B4-A2">テンプレートファイルの探索<span><a href="#label-E3-83-86-E3-83-B3-E3-83-97-E3-83-AC-E3-83-BC-E3-83-88-E3-83-95-E3-82-A1-E3-82-A4-E3-83-AB-E3-81-AE-E6-8E-A2-E7-B4-A2">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>find_template</code>ヘルパーは、レンダリングのためのテンプレートファイルを見つけるために使われます。</p>

<pre class="ruby"><span class="ruby-identifier">find_template</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">views</span>, <span class="ruby-string">&#39;foo&#39;</span>, <span class="ruby-constant">Tilt</span>[:<span class="ruby-identifier">haml</span>] <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;could be #{file}&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>この例はあまり有益ではありません。しかし、このメソッドを、独自の探索機構で働くようオーバーライドするなら有益になります。例えば、複数のビューディレクトリを使えるようにしたいときがあります。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span>, [<span class="ruby-string">&#39;views&#39;</span>, <span class="ruby-string">&#39;templates&#39;</span>]

<span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">find_template</span>(<span class="ruby-identifier">views</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-constant">Array</span>(<span class="ruby-identifier">views</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-keyword">super</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>他の例としては、異なるエンジン用の異なるディレクトリを使う場合です。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span>, :<span class="ruby-identifier">sass</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;views/sass&#39;</span>, :<span class="ruby-identifier">haml</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;templates&#39;</span>, :<span class="ruby-identifier">default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;views&#39;</span>

<span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">find_template</span>(<span class="ruby-identifier">views</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
    <span class="ruby-identifier">_</span>, <span class="ruby-identifier">folder</span> = <span class="ruby-identifier">views</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">engine</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Tilt</span>[<span class="ruby-identifier">k</span>] }
    <span class="ruby-identifier">folder</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">views</span>[:<span class="ruby-identifier">default</span>]
    <span class="ruby-keyword">super</span>(<span class="ruby-identifier">folder</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>これをエクステンションとして書いて、他の人と簡単に共有することもできます！</p>

<p>ノート:
<code>find_template</code>はファイルが実際に存在するかのチェックをしませんが、与えられたブロックをすべての可能なパスに対し呼び出します。これがパフォーマンス上の問題にはならないのは、<code>render</code>はファイルを見つけると直ちに<code>break</code>を使うからです。また、テンプレートの場所（および内容）は、developmentモードでの起動でない限りはキャッシュされます。このことは、複雑なメソッド(a
really crazy method)を書いた場合は記憶しておく必要があります。</p>

<h2 id="label-E3-82-B3-E3-83-B3-E3-83-95-E3-82-A3-E3-82-AE-E3-83-A5-E3-83-AC-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-28Configuration-29">コンフィギュレーション(Configuration)<span><a href="#label-E3-82-B3-E3-83-B3-E3-83-95-E3-82-A3-E3-82-AE-E3-83-A5-E3-83-AC-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-28Configuration-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>どの環境でも起動時に１回だけ実行されます。</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># １つのオプションをセット</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">option</span>, <span class="ruby-string">&#39;value&#39;</span>

  <span class="ruby-comment"># 複数のオプションをセット</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">a</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, :<span class="ruby-identifier">b</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span>

  <span class="ruby-comment"># `set :option, true`と同じ</span>
  <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">option</span>

  <span class="ruby-comment"># `set :option, false`と同じ</span>
  <span class="ruby-identifier">disable</span> :<span class="ruby-identifier">option</span>

  <span class="ruby-comment"># ブロックを使って動的な設定をすることもできます。</span>
  <span class="ruby-identifier">set</span>(:<span class="ruby-identifier">css_dir</span>) { <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">views</span>, <span class="ruby-string">&#39;css&#39;</span>) }
<span class="ruby-keyword">end</span>
</pre>

<p>環境設定(<code>RACK_ENV</code>環境変数)が<code>:production</code>に設定されている時だけ実行する方法:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>環境設定が<code>:production</code>か<code>:test</code>に設定されている時だけ実行する方法:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span>, :<span class="ruby-identifier">test</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>設定したオプションには<code>settings</code>からアクセスできます:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;bar&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">foo?</span> <span class="ruby-comment"># =&gt; true</span>
  <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">foo</span>  <span class="ruby-comment"># =&gt; &#39;bar&#39;</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E6-94-BB-E6-92-83-E9-98-B2-E5-BE-A1-E3-81-AB-E5-AF-BE-E3-81-99-E3-82-8B-E8-A8-AD-E5-AE-9A">攻撃防御に対する設定<span><a href="#label-E6-94-BB-E6-92-83-E9-98-B2-E5-BE-A1-E3-81-AB-E5-AF-BE-E3-81-99-E3-82-8B-E8-A8-AD-E5-AE-9A">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sinatraは、<a
href="https://github.com/rkh/rack-protection#readme">Rack::Protection</a>を使って、アプリケーションを多発する日和見的攻撃から守っています。この挙動は簡単に無効化できます(これはアプリケーションを大量の脆弱性攻撃に晒すことになります)。</p>

<pre class="ruby"><span class="ruby-identifier">disable</span> :<span class="ruby-identifier">protection</span>
</pre>

<p>単一の防御層を外すためには、<code>protection</code>をオプションハッシュにセットします。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">protection</span>, :<span class="ruby-identifier">except</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">path_traversal</span>
</pre>

<p>また配列を渡して、複数の防御を無効にすることもできます。</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">protection</span>, :<span class="ruby-identifier">except</span> =<span class="ruby-operator">&gt;</span> [:<span class="ruby-identifier">path_traversal</span>, :<span class="ruby-identifier">session_hijacking</span>]
</pre>

<p>デフォルトでSinatraは、<code>:sessions</code>が有効になっている場合、セッションベースの防御だけを設定します。しかし、自身でセッションを設定したい場合があります。その場合は、<code>:session</code>オプションを渡すことにより、セッションベースの防御を設定することができます。</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">Pool</span>
<span class="ruby-identifier">set</span> :<span class="ruby-identifier">protection</span>, :<span class="ruby-identifier">session</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
</pre>

<h3 id="label-E5-88-A9-E7-94-A8-E5-8F-AF-E8-83-BD-E3-81-AA-E8-A8-AD-E5-AE-9A">利用可能な設定<span><a href="#label-E5-88-A9-E7-94-A8-E5-8F-AF-E8-83-BD-E3-81-AA-E8-A8-AD-E5-AE-9A">&para;</a> <a href="#top">&uarr;</a></span></h3>
<dl>
  <dt>absolute_redirects</dt>
  <dd>
    無効のとき、Sinatraは相対リダイレクトを許容するが、RFC 2616 (HTTP 1.1)は絶対リダイレクトのみを許容するので、これには準拠しなくなる。
  </dd>
  <dd>
    アプリケーションが、適切に設定されていないリバースプロキシの裏で走っている場合は有効。ノート: <tt>url</tt>ヘルパーは、第２引数に<tt>false</tt>を渡さない限り、依然として絶対URLを生成する。
  </dd>
  <dd>デフォルトは無効。</dd>

  <dt>add_charset</dt>
  <dd>
    Mimeタイプ <tt>content_type</tt>ヘルパーが自動的にキャラクタセット情報をここに追加する。このオプションは書き換えるのではなく、値を追加するようにすること。
    <tt>settings.add_charset << "application/foobar"</tt>
  </dd>

  <dt>app_file</dt>
  <dd>
    メインのアプリケーションファイルのパスであり、プロジェクトのルート、viewsおよびpublicフォルダを見つけるために使われる。
  </dd>

  <dt>bind</dt>
  <dd>バインドするIPアドレス(デフォルト: `environment`がdevelopmentにセットされているときは、<tt>0.0.0.0</tt> <em>または</em> <tt>localhost</tt>)。ビルトインサーバでのみ使われる。</dd>

  <dt>default_encoding</dt>
  <dd>不明なときに仮定されるエンコーディング(デフォルトは<tt>"utf-8"</tt>)。</dd>

  <dt>dump_errors</dt>
  <dd>ログにおけるエラーの表示。</dd>

  <dt>environment</dt>
  <dd>
    現在の環境。デフォルトは<tt>ENV['RACK_ENV']</tt>、それが無い場合は<tt>"development"</tt>。
  </dd>

  <dt>logging</dt>
  <dd>ロガーの使用。</dd>

  <dt>lock</dt>
  <dd>
    各リクエスト周りのロックの配置で、Rubyプロセスごとにリクエスト処理を並行して走らせるようにする。
  </dd>
  <dd>アプリケーションがスレッドセーフでなければ有効。デフォルトは無効。</dd>

  <dt>method_override</dt>
  <dd>
    put/deleteフォームを、それらをサポートしないブラウザで使えるように<tt>_method</tt>のおまじないを使えるようにする。
  </dd>

  <dt>port</dt>
  <dd>待ち受けポート。ビルトインサーバのみで有効。</dd>

  <dt>prefixed_redirects</dt>
  <dd>
    絶対パスが与えられていないときに、リダイレクトに<tt>request.script_name</tt>を挿入するか否かの設定。これにより<tt>redirect '/foo'</tt>は、<tt>redirect to('/foo')</tt>のように振る舞う。デフォルトは無効。
  </dd>

  <dt>protection</dt>
  <dd>Web攻撃防御を有効にするか否かの設定。上述の攻撃防御の項を参照。</dd>

  <dt>public_dir</dt>
  <dd><tt>public_folder</tt>のエイリアス。以下を参照。</dd>

  <dt>public_folder</dt>
  <dd>
    publicファイルが提供されるディレクトリのパス。静的ファイルの提供が有効になっている場合にのみ使われる (以下の<tt>static</tt>設定を参照)。設定されていない場合、<tt>app_file</tt>設定から推定。
  </dd>

  <dt>reload_templates</dt>
  <dd>
    リクエスト間でテンプレートを再ロードするか否かの設定。developmentモードでは有効。
  </dd>

  <dt>root</dt>
  <dd>
    プロジェクトのルートディレクトリのパス。設定されていない場合、<tt>app_file</tt>設定から推定。
  </dd>

  <dt>raise_errors</dt>
  <dd>
    例外発生の設定(アプリケーションは止まる)。<tt>environment</tt>が<tt>"test"</tt>に設定されているときはデフォルトは有効。それ以外は無効。
  </dd>

  <dt>run</dt>
  <dd>
    有効のとき、SinatraがWebサーバの起動を取り扱う。rackupまたは他の手段を使うときは有効にしないこと。
  </dd>

  <dt>running</dt>
  <dd>ビルトインサーバが稼働中か？この設定を変更しないこと！</dd>

  <dt>server</dt>
  <dd>
    ビルトインサーバとして使用するサーバまたはサーバ群の指定。指定順位は優先度を表し、デフォルトはRuby実装に依存。
  </dd>

  <dt>sessions</dt>
  <dd>
    <tt>Rack::Session::Cookie</tt>を使ったクッキーベースのセッションサポートの有効化。詳しくは、'セッションの使用'の項を参照のこと。
  </dd>

  <dt>show_exceptions</dt>
  <dd>
    例外発生時にブラウザにスタックトレースを表示する。<tt>environment</tt>が<tt>"development"</tt>に設定されているときは、デフォルトで有効。それ以外は無効。
  </dd>
  <dd>
    また、<tt>:after_handler</tt>をセットすることができ、これにより、ブラウザにスタックトレースを表示する前に、アプリケーション固有のエラーハンドリングを起動させられる。
  </dd>

  <dt>static</dt>
  <dd>Sinatraが静的ファイルの提供を取り扱うかの設定。</dd>
  <dd>その取り扱いができるサーバを使う場合は無効。</dd>
  <dd>無効化でパフォーマンスは改善する</dd>
  <dd>
    クラッシックスタイルではデフォルトで有効。モジュラースタイルでは無効。
  </dd>

  <dt>static_cache_control</dt>
  <dd>
    Sinatraが静的ファイルを提供するときこれをセットして、レスポンスに<tt>Cache-Control</tt>ヘッダを追加するようにする。<tt>cache_control</tt>ヘルパーを使うこと。デフォルトは無効。
  </dd>
  <dd>
    複数の値をセットするときは明示的に配列を使う:
    <tt>set :static_cache_control, [:public, :max_age => 300]</tt>
  </dd>

  <dt>threaded</dt>
  <dd>
    <tt>true</tt>に設定されているときは、Thinにリクエストを処理するために<tt>EventMachine.defer</tt>を使うことを通知する。
  </dd>

  <dt>views</dt>
  <dd>
    ビューディレクトリのパス。設定されていない場合、<tt>app_file</tt>設定から推定する。
  </dd>

  <dt>x_cascade</dt>
  <dd>
    マッチするルーティングが無い場合に、X-Cascadeヘッダをセットするか否かの設定。デフォルトは<tt>true</tt>。
  </dd>
</dl>
<h2 id="label-E7-92-B0-E5-A2-83-E8-A8-AD-E5-AE-9A-28Environments-29">環境設定(Environments)<span><a href="#label-E7-92-B0-E5-A2-83-E8-A8-AD-E5-AE-9A-28Environments-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>３種類の既定環境、<code>&quot;development&quot;</code>、<code>&quot;production&quot;</code>および<code>&quot;test&quot;</code>があります。環境は、<code>RACK_ENV</code>環境変数を通して設定できます。デフォルト値は、<code>&quot;development&quot;</code>です。<code>&quot;development&quot;</code>環境において、すべてのテンプレートは、各リクエスト間で再ロードされ、そして、特別の<code>not_found</code>および<code>error</code>ハンドラがブラウザにスタックトレースを表示します。<code>&quot;production&quot;</code>および<code>&quot;test&quot;</code>環境においては、テンプレートはデフォルトでキャッシュされます。</p>

<p>異なる環境を走らせるには、<code>RACK_ENV</code>環境変数を設定します。</p>

<pre class="ruby"><span class="ruby-constant">RACK_ENV</span>=<span class="ruby-identifier">production</span> <span class="ruby-identifier">ruby</span> <span class="ruby-identifier">my_app</span>.<span class="ruby-identifier">rb</span>
</pre>

<p>既定メソッド、<code>development?</code>、<code>test?</code>および<code>production?</code>を、現在の環境設定を確認するために使えます。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">development?</span>
    <span class="ruby-string">&quot;development!&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-string">&quot;not development!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-E3-82-A8-E3-83-A9-E3-83-BC-E3-83-8F-E3-83-B3-E3-83-89-E3-83-AA-E3-83-B3-E3-82-B0-28Error+Handling-29">エラーハンドリング(Error Handling)<span><a href="#label-E3-82-A8-E3-83-A9-E3-83-BC-E3-83-8F-E3-83-B3-E3-83-89-E3-83-AA-E3-83-B3-E3-82-B0-28Error+Handling-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>エラーハンドラはルーティングおよびbeforeフィルタと同じコンテキストで実行されます。すなわちこれは、<code>haml</code>、<code>erb</code>、<code>halt</code>といった便利なものが全て使えることを意味します。</p>

<h3 id="label-E6-9C-AA-E6-A4-9C-E5-87-BA-28Not+Found-29">未検出(Not Found)<span><a href="#label-E6-9C-AA-E6-A4-9C-E5-87-BA-28Not+Found-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>Sinatra::NotFound</code>例外が発生したとき、またはレスポンスのステータスコードが404のときに、<code>not_found</code>ハンドラが発動します。</p>

<pre class="ruby"><span class="ruby-identifier">not_found</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;ファイルが存在しません&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E3-82-A8-E3-83-A9-E3-83-BC-28Error-29">エラー(Error)<span><a href="#label-E3-82-A8-E3-83-A9-E3-83-BC-28Error-29">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>error</code>ハンドラはルーティングブロックまたはフィルタ内で例外が発生したときはいつでも発動します。例外オブジェクトはRack変数<code>sinatra.error</code>から取得できます。</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;エラーが発生しました。 - &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>].<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span>
</pre>

<p>エラーをカスタマイズする場合は、</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-constant">MyCustomError</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;エラーメッセージ...&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>].<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span>
</pre>

<p>と書いておいて、下記のように呼び出します。</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">MyCustomError</span>, <span class="ruby-string">&#39;何かがまずかったようです&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>そうするとこうなります。</p>

<pre class="ruby"><span class="ruby-identifier">エラーメッセージ</span><span class="ruby-operator">...</span> <span class="ruby-identifier">何かがまずかったようです</span>
</pre>

<p>あるいは、ステータスコードに対応するエラーハンドラを設定することもできます。</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-value">403</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Access forbidden&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/secret&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-value">403</span>
<span class="ruby-keyword">end</span>
</pre>

<p>範囲指定もできます。</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-value">400</span><span class="ruby-operator">..</span><span class="ruby-value">510</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Boom&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Sinatraを開発環境の下で実行している場合は、特別な<code>not_found</code>および<code>error</code>ハンドラが導入され、これは親切なスタックトレースと追加のデバッギング情報をブラウザに表示します。</p>

<h2 id="label-Rack-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-28Rack+Middleware-29">Rackミドルウェア(Rack Middleware)<span><a href="#label-Rack-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-28Rack+Middleware-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>SinatraはRuby製Webフレームワークのミニマルな標準的インタフェースである{Rack}[http://rack.github.io/]上に構築されています。アプリケーションデベロッパーにとってRackにおける最も興味深い機能は、「ミドルウェア(middleware)」をサポートしていることであり、これは、サーバとアプリケーションとの間に置かれ、HTTPリクエスト/レスポンスを監視および/または操作することで、各種の汎用的機能を提供するコンポーネントです。</p>

<p>Sinatraはトップレベルの<code>use</code>メソッドを通して、Rackミドルウェアパイプラインの構築を楽にします。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;my_custom_middleware&#39;</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Lint</span>
<span class="ruby-identifier">use</span> <span class="ruby-constant">MyCustomMiddleware</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/hello&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Hello World&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>use</code>の文法は、{Rack::Builder}[http://rubydoc.info/github/rack/rack/master/Rack/Builder]DSLで定義されているそれ（rackupファイルで最もよく使われる）と同じです。例えば
<code>use</code>メソッドは複数の引数、そしてブロックも取ることができます。</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Auth</span><span class="ruby-operator">::</span><span class="ruby-constant">Basic</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">username</span>, <span class="ruby-identifier">password</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">username</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;admin&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">password</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;secret&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Rackは、ロギング、デバッギング、URLルーティング、認証、セッション管理など、多様な標準的ミドルウェアを共に配布されています。Sinatraはその多くのコンポーネントを自動で使うよう基本設定されているため、通常、それらを<code>use</code>で明示的に指定する必要はありません。</p>

<p>便利なミドルウェアを以下で見つけられます。</p>

<p><a href="https://github.com/rack/rack/tree/master/lib/rack">rack</a>、 <a
href="https://github.com/rack/rack-contrib#readm">rack-contrib</a>、 または<a
href="https://github.com/rack/rack/wiki/List-of-Middleware">Rack wiki</a>。</p>

<h2 id="label-E3-83-86-E3-82-B9-E3-83-88-28Testing-29">テスト(Testing)<span><a href="#label-E3-83-86-E3-82-B9-E3-83-88-28Testing-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>SinatraでのテストはRackベースのテストライブラリまたはフレームワークを使って書くことができます。<a
href="http://rdoc.info/github/brynary/rack-test/master/frames">Rack::Test</a>をお薦めします。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;my_sinatra_app&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;minitest/autorun&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rack/test&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyAppTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Minitest</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">Methods</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">app</span>
    <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_my_default</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Hello World!&#39;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_with_params</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/meet&#39;</span>, :<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Frank&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Hello Frank!&#39;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_with_rack_env</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, {}, <span class="ruby-string">&#39;HTTP_USER_AGENT&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Songbird&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;Songbirdを使ってます!&quot;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>ノート:
モジュラースタイルでSinatraを使う場合は、上記<code>Sinatra::Application</code>をアプリケーションのクラス名に置き換えてください。</p>

<h2 id="label-Sinatra-3A-3ABase+-+-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-E3-80-81-E3-83-A9-E3-82-A4-E3-83-96-E3-83-A9-E3-83-AA-E3-81-8A-E3-82-88-E3-81-B3-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-A2-E3-83-97-E3-83-AA">Sinatra::Base - ミドルウェア、ライブラリおよびモジュラーアプリ<span><a href="#label-Sinatra-3A-3ABase+-+-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-E3-80-81-E3-83-A9-E3-82-A4-E3-83-96-E3-83-A9-E3-83-AA-E3-81-8A-E3-82-88-E3-81-B3-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-A2-E3-83-97-E3-83-AA">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>軽量なアプリケーションであれば、トップレベルでアプリケーションを定義していくことはうまくいきますが、再利用性可能なコンポーネント、例えばRackミドルウェア、RailsのMetal、サーバコンポーネントを含むシンプルなライブラリ、あるいはSinatraの拡張プログラムを構築するような場合、これは無視できない欠点を持つものとなります。トップレベルは、軽量なアプリケーションのスタイルにおける設定（例えば、単一のアプリケーションファイル、<code>./public</code>および<code>./views</code>ディレクトリ、ロギング、例外詳細ページなど）を仮定しています。そこで<code>Sinatra::Base</code>の出番です。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;bar&#39;</span>

  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-string">&#39;Hello world!&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>Sinatra::Base</code>のサブクラスで利用できるメソッドは、トップレベルDSLで利用できるものと全く同じです。ほとんどのトップレベルで記述されたアプリは、以下の２点を修正することで<code>Sinatra::Base</code>コンポーネントに変えることができます。</p>

<p><code>sinatra</code>の代わりに<code>sinatra/base</code>を読み込む 
(そうしない場合、SinatraのDSLメソッドの全てがmainの名前空間にインポートされます) 
ルーティング、エラーハンドラ、フィルタ、オプションを<code>Sinatra::Base</code>のサブクラスに書く</p>

<p><code>Sinatra::Base</code>はまっさらです。ビルトインサーバを含む、ほとんどのオプションがデフォルトで無効になっています。利用可能なオプションとその挙動の詳細については<a
href="http://sinatra.github.com/configuration.html">Configuring
Settings</a>(英語)をご覧下さい。</p>

<p>もしもクラシックスタイルと同じような挙動のアプリケーションをトップレベルで定義させる必要があれば、<code>Sinatra::Application</code>をサブクラス化させてください。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&quot;sinatra/base&quot;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
  <span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/&quot;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-string">&#39;Hello world!&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB+vs+-E3-82-AF-E3-83-A9-E3-83-83-E3-82-B7-E3-83-83-E3-82-AF-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB">モジュラースタイル vs クラッシックスタイル<span><a href="#label-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB+vs+-E3-82-AF-E3-83-A9-E3-83-83-E3-82-B7-E3-83-83-E3-82-AF-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>一般的認識と違って、クラッシックスタイルを使うことに問題はなにもありません。それがそのアプリケーションに合っているのであれば、モジュラーアプリケーションに移行する必要はありません。</p>

<p>モジュラースタイルを使わずにクラッシックスタイルを使った場合の一番の不利な点は、Rubyプロセスごとにただ一つのSinatraアプリケーションしか持てない点です。複数が必要な場合はモジュラースタイルに移行してください。モジュラースタイルとクラッシックスタイルを混合できないということはありません。</p>

<p>一方のスタイルから他方へ移行する場合、デフォルト設定がわずかに異なる点に注意が必要です。</p>
<table>
  <tr>
    <th>設定</th>
    <th>クラッシック</th>
    <th>モジュラー</th>
    <th>モジュラー</th>
  </tr>

  <tr>
    <td>app_file</td>
    <td>sinatraを読み込むファイル</td>
    <td>Sinatra::Baseをサブクラス化したファイル</td>
    <td>Sinatra::Applicationをサブクラス化したファイル</td>
  </tr>

  <tr>
    <td>run</td>
    <td>$0 == app_file</td>
    <td>false</td>
    <td>false</td>
  </tr>

  <tr>
    <td>logging</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>method_override</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>inline_templates</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>

  <tr>
    <td>static</td>
    <td>true</td>
    <td>false</td>
    <td>true</td>
  </tr>
</table>
<h3 id="label-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E6-8F-90-E4-BE-9B">モジュラーアプリケーションの提供<span><a href="#label-E3-83-A2-E3-82-B8-E3-83-A5-E3-83-A9-E3-83-BC-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E6-8F-90-E4-BE-9B">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>モジュラーアプリケーションを開始、つまり<code>run!</code>を使って開始させる二種類のやり方があります。</p>

<pre class="ruby"><span class="ruby-comment"># my_app.rb</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># ... アプリケーションのコードを書く ...</span>

  <span class="ruby-comment"># Rubyファイルが直接実行されたらサーバを立ち上げる</span>
  <span class="ruby-identifier">run!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">app_file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">$0</span>
<span class="ruby-keyword">end</span>
</pre>

<p>として、次のように起動するか、</p>

<pre class="ruby"><span class="ruby-identifier">ruby</span> <span class="ruby-identifier">my_app</span>.<span class="ruby-identifier">rb</span>
</pre>

<p>または、Rackハンドラを使えるようにする<code>config.ru</code>ファイルを書いて、</p>

<pre class="ruby"><span class="ruby-comment"># config.ru (rackupで起動)</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;./my_app&#39;</span>
<span class="ruby-identifier">run</span> <span class="ruby-constant">MyApp</span>
</pre>

<p>起動します。</p>

<pre>rackup -p 4567</pre>

<h3 id="label-config.ru-E3-82-92-E7-94-A8-E3-81-84-E3-81-9F-E3-82-AF-E3-83-A9-E3-83-83-E3-82-B7-E3-83-83-E3-82-AF-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E4-BD-BF-E7-94-A8">config.ruを用いたクラッシックスタイルアプリケーションの使用<span><a href="#label-config.ru-E3-82-92-E7-94-A8-E3-81-84-E3-81-9F-E3-82-AF-E3-83-A9-E3-83-83-E3-82-B7-E3-83-83-E3-82-AF-E3-82-B9-E3-82-BF-E3-82-A4-E3-83-AB-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E4-BD-BF-E7-94-A8">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>アプリケーションファイルと、</p>

<pre class="ruby"><span class="ruby-comment"># app.rb</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Hello world!&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>対応する<code>config.ru</code>を書きます。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;./app&#39;</span>
<span class="ruby-identifier">run</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
</pre>

<h3 id="label-config.ru-E3-81-AF-E3-81-84-E3-81-A4-E4-BD-BF-E3-81-86-E3-81-AE-E3-81-8B-EF-BC-9F">config.ruはいつ使うのか？<span><a href="#label-config.ru-E3-81-AF-E3-81-84-E3-81-A4-E4-BD-BF-E3-81-86-E3-81-AE-E3-81-8B-EF-BC-9F">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p><code>config.ru</code>ファイルは、以下の場合に適しています。</p>

<p>異なるRackハンドラ(Passenger, Unicorn, Herokuなど)でデプロイしたいとき 
<code>Sinatra::Base</code>の複数のサブクラスを使いたいとき 
Sinatraをミドルウェアとして利用し、エンドポイントとしては利用しないとき</p>

<p><em>モジュラースタイルに移行したという理由だけで、<code>config.ru</code>に移行する必要はなく、<code>config.ru</code>で起動するためにモジュラースタイルを使う必要はありません。</em>*</p>

<h3 id="label-Sinatra-E3-81-AE-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-E3-81-A8-E3-81-97-E3-81-A6-E3-81-AE-E5-88-A9-E7-94-A8">Sinatraのミドルウェアとしての利用<span><a href="#label-Sinatra-E3-81-AE-E3-83-9F-E3-83-89-E3-83-AB-E3-82-A6-E3-82-A7-E3-82-A2-E3-81-A8-E3-81-97-E3-81-A6-E3-81-AE-E5-88-A9-E7-94-A8">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sinatraは他のRackミドルウェアを利用することができるだけでなく、
全てのSinatraアプリケーションは、それ自体ミドルウェアとして別のRackエンドポイントの前に追加することが可能です。</p>

<p>このエンドポイントには、別のSinatraアプリケーションまたは他のRackベースのアプリケーション(Rails/Ramaze/Camping/…)が用いられるでしょう。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">LoginScreen</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">sessions</span>

  <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/login&#39;</span>) { <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">login</span> }

  <span class="ruby-identifier">post</span>(<span class="ruby-string">&#39;/login&#39;</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;name&#39;</span>] = <span class="ruby-string">&#39;admin&#39;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;password&#39;</span>] = <span class="ruby-string">&#39;admin&#39;</span>
      <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;user_name&#39;</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;name&#39;</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">redirect</span> <span class="ruby-string">&#39;/login&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># ミドルウェアはbeforeフィルタの前に実行される</span>
  <span class="ruby-identifier">use</span> <span class="ruby-constant">LoginScreen</span>

  <span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;user_name&#39;</span>]
      <span class="ruby-identifier">halt</span> <span class="ruby-string">&quot;アクセスは拒否されました。&lt;a href=&#39;/login&#39;&gt;ログイン&lt;/a&gt;してください。&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-node">&quot;Hello #{session[&#39;user_name&#39;]}.&quot;</span> }
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-E5-8B-95-E7-9A-84-E3-81-AA-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E7-94-9F-E6-88-90">動的なアプリケーションの生成<span><a href="#label-E5-8B-95-E7-9A-84-E3-81-AA-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-E3-81-AE-E7-94-9F-E6-88-90">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>新しいアプリケーションを実行時に、定数に割り当てることなく生成したくなる場合があるでしょう。<code>Sinatra.new</code>を使えばそれができます。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>
<span class="ruby-identifier">my_app</span> = <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-string">&quot;hi&quot;</span> } }
<span class="ruby-identifier">my_app</span>.<span class="ruby-identifier">run!</span>
</pre>

<p>これは省略できる引数として、それが継承するアプリケーションを取ります。</p>

<pre class="ruby"><span class="ruby-comment"># config.ru (rackupで起動)</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-identifier">controller</span> = <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">enable</span> :<span class="ruby-identifier">logging</span>
  <span class="ruby-identifier">helpers</span> <span class="ruby-constant">MyHelpers</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">map</span>(<span class="ruby-string">&#39;/a&#39;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">run</span> <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">controller</span>) { <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-string">&#39;a&#39;</span> } }
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">map</span>(<span class="ruby-string">&#39;/b&#39;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">run</span> <span class="ruby-constant">Sinatra</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">controller</span>) { <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-string">&#39;b&#39;</span> } }
<span class="ruby-keyword">end</span>
</pre>

<p>これは特にSinatraのextensionをテストするときや、Sinatraを自身のライブラリで利用する場合に役立ちます。</p>

<p>これはまた、Sinatraをミドルウェアとして利用することを極めて簡単にします。</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Sinatra</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-operator">...</span> }
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">run</span> <span class="ruby-constant">RailsProject</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
</pre>

<h2 id="label-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-E3-81-A8-E3-83-90-E3-82-A4-E3-83-B3-E3-83-87-E3-82-A3-E3-83-B3-E3-82-B0-28Scopes+and+Binding-29">スコープとバインディング(Scopes and Binding)<span><a href="#label-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97-E3-81-A8-E3-83-90-E3-82-A4-E3-83-B3-E3-83-87-E3-82-A3-E3-83-B3-E3-82-B0-28Scopes+and+Binding-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>現在のスコープはどのメソッドや変数が利用可能かを決定します。</p>

<h3 id="label-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-2F-E3-82-AF-E3-83-A9-E3-82-B9-E3-81-AE-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">アプリケーション/クラスのスコープ<span><a href="#label-E3-82-A2-E3-83-97-E3-83-AA-E3-82-B1-E3-83-BC-E3-82-B7-E3-83-A7-E3-83-B3-2F-E3-82-AF-E3-83-A9-E3-82-B9-E3-81-AE-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>全てのSinatraアプリケーションはSinatra::Baseのサブクラスに相当します。
もしトップレベルDSLを利用しているならば(<code>require
&#39;sinatra&#39;</code>)このクラスはSinatra::Applicationであり、
そうでなければ、あなたが明示的に作成したサブクラスです。
クラスレベルでは<code>get</code>や<code>before</code>のようなメソッドを持っています。
しかし<code>request</code>や<code>session</code>オブジェクトには、全てのリクエストに対する単一のアプリケーションクラスがあるだけなので、アクセスできません。</p>

<p><code>set</code>によって作られたオプションはクラスレベルのメソッドです。</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># アプリケーションスコープの中だよ!</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-value">42</span>
  <span class="ruby-identifier">foo</span> <span class="ruby-comment"># =&gt; 42</span>

  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># もうアプリケーションスコープの中にいないよ!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>次の場所ではアプリケーションスコープバインディングを持ちます。</p>

<p>アプリケーションクラス本体  拡張によって定義されたメソッド  <code>helpers</code>に渡されたブロック 
<code>set</code>の値として使われるProcまたはブロック  <code>Sinatra.new</code>に渡されたブロック</p>

<p>このスコープオブジェクト(クラス)は次のように利用できます。</p>

<p>configureブロックに渡されたオブジェクト経由(<code>configure { |c| ... }</code>) 
リクエストスコープの中での<code>settings</code></p>

<h3 id="label-E3-83-AA-E3-82-AF-E3-82-A8-E3-82-B9-E3-83-88-2F-E3-82-A4-E3-83-B3-E3-82-B9-E3-82-BF-E3-83-B3-E3-82-B9-E3-81-AE-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">リクエスト/インスタンスのスコープ<span><a href="#label-E3-83-AA-E3-82-AF-E3-82-A8-E3-82-B9-E3-83-88-2F-E3-82-A4-E3-83-B3-E3-82-B9-E3-82-BF-E3-83-B3-E3-82-B9-E3-81-AE-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>やってくるリクエストごとに、あなたのアプリケーションクラスの新しいインスタンスが作成され、全てのハンドラブロックがそのスコープで実行されます。
このスコープの内側からは<code>request</code>や<code>session</code>オブジェクトにアクセスすることができ、<code>erb</code>や<code>haml</code>のようなレンダリングメソッドを呼び出すことができます。
リクエストスコープの内側からは、<code>settings</code>ヘルパーによってアプリケーションスコープにアクセスすることができます。</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">MyApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-comment"># アプリケーションスコープの中だよ!</span>
  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/define_route/:name&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># &#39;/define_route/:name&#39;のためのリクエストスコープ</span>
    <span class="ruby-ivar">@value</span> = <span class="ruby-value">42</span>

    <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">get</span>(<span class="ruby-node">&quot;/#{params[&#39;name&#39;]}&quot;</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-comment"># &quot;/#{params[&#39;name&#39;]}&quot;のためのリクエストスコープ</span>
      <span class="ruby-ivar">@value</span> <span class="ruby-comment"># =&gt; nil (not the same request)</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-string">&quot;ルーティングが定義された!&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>次の場所ではリクエストスコープバインディングを持ちます。</p>

<p>get/head/post/put/delete/options/patch/link/unlink ブロック  before/after フィルタ 
helper メソッド  テンプレート/ビュー</p>

<h3 id="label-E3-83-87-E3-83-AA-E3-82-B2-E3-83-BC-E3-83-88-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">デリゲートスコープ<span><a href="#label-E3-83-87-E3-83-AA-E3-82-B2-E3-83-BC-E3-83-88-E3-82-B9-E3-82-B3-E3-83-BC-E3-83-97">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>デリゲートスコープは、単にクラススコープにメソッドを転送します。
しかしながら、クラスのバインディングを持っていないため、クラススコープと全く同じふるまいをするわけではありません。
委譲すると明示的に示されたメソッドのみが利用可能であり、またクラススコープと変数/状態を共有することはできません(注:
異なった<code>self</code>を持っています)。 <code>Sinatra::Delegator.delegate
:method_name</code>を呼び出すことによってデリゲートするメソッドを明示的に追加することができます。</p>

<p>次の場所ではデリゲートスコープを持ちます。</p>

<p>もし<code>require &quot;sinatra&quot;</code>しているならば、トップレベルバインディング 
<code>Sinatra::Delegator</code> mixinでextendされたオブジェクト</p>

<p>コードをご覧ください: ここでは <a
href="https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/main.rb#L28-30">Sinatra::Delegator
mixin}[https://github.com/sinatra/sinatra/blob/ca06364/lib/sinatra/base.rb#L1609-1633]は{mainオブジェクトにextendされています</a>。</p>

<h2 id="label-E3-82-B3-E3-83-9E-E3-83-B3-E3-83-89-E3-83-A9-E3-82-A4-E3-83-B3">コマンドライン<span><a href="#label-E3-82-B3-E3-83-9E-E3-83-B3-E3-83-89-E3-83-A9-E3-82-A4-E3-83-B3">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Sinatraアプリケーションは直接実行できます。</p>

<pre>ruby myapp.rb [-h] [-x] [-e ENVIRONMENT] [-p PORT] [-o HOST] [-s HANDLER]</pre>

<p>オプション:</p>

<pre class="ruby"><span class="ruby-operator">-</span><span class="ruby-identifier">h</span> <span class="ruby-comment"># ヘルプ</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">p</span> <span class="ruby-comment"># ポート指定(デフォルトは4567)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">o</span> <span class="ruby-comment"># ホスト指定(デフォルトは0.0.0.0)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">e</span> <span class="ruby-comment"># 環境を指定 (デフォルトはdevelopment)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">s</span> <span class="ruby-comment"># rackserver/handlerを指定 (デフォルトはthin)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">x</span> <span class="ruby-comment"># mutex lockを付ける (デフォルトはoff)</span>
</pre>

<h2 id="label-E5-BF-85-E8-A6-81-E7-92-B0-E5-A2-83">必要環境<span><a href="#label-E5-BF-85-E8-A6-81-E7-92-B0-E5-A2-83">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>次のRubyバージョンが公式にサポートされています。</p>
<dl>
  <dt>Ruby 1.8.7</dt>
  <dd>
    1.8.7は完全にサポートされていますが、特にそれでなければならないという理由がないのであれば、アップグレードまたはJRubyまたはRubiniusへの移行を薦めます。1.8.7のサポートがSinatra 2.0の前に終わることはないでしょう。Ruby 1.8.6はサポート対象外です。
  </dd>

  <dt>Ruby 1.9.2</dt>
  <dd>
    1.9.2は完全にサポートされています。1.9.2p0は、Sinatraを起動したときにセグメントフォルトを引き起こすことが分かっているので、使わないでください。公式なサポートは、少なくともSinatra 1.5のリリースまでは続きます。
  </dd>

  <dt>Ruby 1.9.3</dt>
  <dd>
    1.9.3は完全にサポート、そして推奨されています。以前のバージョンからの1.9.3への移行は全セッションを無効にする点、覚えておいてください。
  </dd>

  <dt>Ruby 2.0.0</dt>
  <dd>
    2.0.0は完全にサポート、そして推奨されています。現在、その公式サポートを終了する計画はありません。
  </dd>

  <dt>Rubinius</dt>
  <dd>
    Rubiniusは公式にサポートされています(Rubinius >= 2.x)。
    <tt>gem install puma</tt>することが推奨されています。
  </dd>

  <dt>JRuby</dt>
  <dd>
    JRubyの最新安定版が公式にサポートされています。JRubyでC拡張を使うことは推奨されていません。
    <tt>gem install trinidad</tt>することが推奨されています。
  </dd>
</dl>
<p>開発チームは常に最新となるRubyバージョンに注視しています。</p>

<p>次のRuby実装は公式にはサポートされていませんが、Sinatraが起動すると報告されています。</p>

<p>JRubyとRubiniusの古いバージョン  Ruby Enterprise Edition  MacRuby, Maglev, IronRuby 
Ruby 1.9.0と1.9.1 (これらの使用はお薦めしません)</p>

<p>公式サポートをしないという意味は、問題がそこだけで起こり、サポートされているプラットフォーム上では起きない場合に、開発チームはそれはこちら側の問題ではないとみなすということです。</p>

<p>開発チームはまた、ruby-head(最新となる2.1.0)に対しCIを実行していますが、それが一貫して動くようになるまで何も保証しません。2.1.0が完全にサポートされればその限りではありません。</p>

<p>Sinatraは、利用するRuby実装がサポートしているオペレーティングシステム上なら動作するはずです。</p>

<p>MacRubyを使う場合は、<code>gem install control_tower</code>してください。</p>

<p>Sinatraは現在、Cardinal、SmallRuby、BlueRubyまたは1.8.7以前のバージョンのRuby上では動作しません。</p>

<h2 id="label-E6-9C-80-E6-96-B0-E9-96-8B-E7-99-BA-E7-89-88">最新開発版<span><a href="#label-E6-9C-80-E6-96-B0-E9-96-8B-E7-99-BA-E7-89-88">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Sinatraの最新開発版のコードを使いたい場合は、マスターブランチに対してアプリケーションを走らせて構いません。ある程度安定しています。また、適宜プレリリース版gemをpushしているので、</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">sinatra</span> <span class="ruby-operator">-</span><span class="ruby-operator">-</span><span class="ruby-identifier">pre</span>
</pre>

<p>すれば、最新の機能のいくつかを利用できます。</p>

<h3 id="label-Bundler-E3-82-92-E4-BD-BF-E3-81-86-E5-A0-B4-E5-90-88">Bundlerを使う場合<span><a href="#label-Bundler-E3-82-92-E4-BD-BF-E3-81-86-E5-A0-B4-E5-90-88">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>最新のSinatraでアプリケーションを動作させたい場合には、<a
href="http://gembundler.com/">Bundler</a>を使うのがお薦めのやり方です。</p>

<p>まず、Bundlerがなければそれをインストールします。</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">bundler</span>
</pre>

<p>そして、プロジェクトのディレクトリで、<code>Gemfile</code>を作ります。</p>

<pre class="ruby"><span class="ruby-identifier">source</span> <span class="ruby-string">&#39;https://rubygems.org&#39;</span>
<span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;sinatra&#39;</span>, :<span class="ruby-identifier">github</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&quot;sinatra/sinatra&quot;</span>

<span class="ruby-comment"># 他の依存ライブラリ</span>
<span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;haml&#39;</span>                    <span class="ruby-comment"># Hamlを使う場合</span>
<span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;activerecord&#39;</span>, <span class="ruby-string">&#39;~&gt; 3.0&#39;</span>  <span class="ruby-comment"># ActiveRecord 3.xが必要かもしれません</span>
</pre>

<p>ノート:
<code>Gemfile</code>にアプリケーションの依存ライブラリのすべてを並べる必要があります。しかし、Sinatraが直接依存するもの(RackおよびTile)はBundlerによって自動的に取り込まれ、追加されます。</p>

<p>これで、以下のようにしてアプリケーションを起動することができます。</p>

<pre class="ruby"><span class="ruby-identifier">bundle</span> <span class="ruby-identifier">exec</span> <span class="ruby-identifier">ruby</span> <span class="ruby-identifier">myapp</span>.<span class="ruby-identifier">rb</span>
</pre>

<h3 id="label-E7-9B-B4-E6-8E-A5-E7-B5-84-E3-81-BF-E8-BE-BC-E3-82-80-E5-A0-B4-E5-90-88">直接組み込む場合<span><a href="#label-E7-9B-B4-E6-8E-A5-E7-B5-84-E3-81-BF-E8-BE-BC-E3-82-80-E5-A0-B4-E5-90-88">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>ローカルにクローンを作って、<code>sinatra/lib</code>ディレクトリを<code>$LOAD_PATH</code>に追加してアプリケーションを起動します。</p>

<pre>cd myapp
git clone git://github.com/sinatra/sinatra.git
ruby -I sinatra/lib myapp.rb</pre>

<p>追ってSinatraのソースを更新する方法。</p>

<pre class="ruby"><span class="ruby-identifier">cd</span> <span class="ruby-identifier">myapp</span><span class="ruby-operator">/</span><span class="ruby-identifier">sinatra</span>
<span class="ruby-identifier">git</span> <span class="ruby-identifier">pull</span>
</pre>

<h3 id="label-E3-82-B0-E3-83-AD-E3-83-BC-E3-83-90-E3-83-AB-E7-92-B0-E5-A2-83-E3-81-AB-E3-82-A4-E3-83-B3-E3-82-B9-E3-83-88-E3-83-BC-E3-83-AB-E3-81-99-E3-82-8B-E5-A0-B4-E5-90-88">グローバル環境にインストールする場合<span><a href="#label-E3-82-B0-E3-83-AD-E3-83-BC-E3-83-90-E3-83-AB-E7-92-B0-E5-A2-83-E3-81-AB-E3-82-A4-E3-83-B3-E3-82-B9-E3-83-88-E3-83-BC-E3-83-AB-E3-81-99-E3-82-8B-E5-A0-B4-E5-90-88">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sinatraのgemを自身でビルドすることもできます。</p>

<pre>git clone git://github.com/sinatra/sinatra.git
cd sinatra
rake sinatra.gemspec
rake install</pre>

<p>gemをルートとしてインストールする場合は、最後のステップはこうなります。</p>

<pre class="ruby"><span class="ruby-identifier">sudo</span> <span class="ruby-identifier">rake</span> <span class="ruby-identifier">install</span>
</pre>

<h2 id="label-E3-83-90-E3-83-BC-E3-82-B8-E3-83-A7-E3-83-8B-E3-83-B3-E3-82-B0-28Versioning-29">バージョニング(Versioning)<span><a href="#label-E3-83-90-E3-83-BC-E3-82-B8-E3-83-A7-E3-83-8B-E3-83-B3-E3-82-B0-28Versioning-29">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Sinatraは、{Semantic
Versioning}[http://semver.org/]におけるSemVerおよびSemVerTagの両方に準拠しています。</p>

<h2 id="label-E5-8F-82-E8-80-83-E6-96-87-E7-8C-AE">参考文献<span><a href="#label-E5-8F-82-E8-80-83-E6-96-87-E7-8C-AE">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p><a href="http://sinatra.github.com/">プロジェクトサイト</a> -
ドキュメント、ニュース、他のリソースへのリンクがあります。  <a
href="http://sinatra.github.com/contributing.html">プロジェクトに参加(貢献)する</a> -
バグレポート パッチの送信、サポートなど  <a
href="http://github.com/sinatra/sinatra/issues">Issue tracker</a>  <a
href="http://twitter.com/sinatra">Twitter</a>  <a
href="http://groups.google.com/group/sinatrarb/topics">メーリングリスト</a>  <a
href="http://freenode.net上のIRC">freenode.net上のIRC</a>: <a
href="irc://chat.freenode.net/#sinatra">#sinatra</a>  <a
href="https://github.com/sinatra/sinatra-book/">Sinatra Book</a>
クックブック、チュートリアル  <a href="http://recipes.sinatrarb.com/">Sinatra Recipes</a>
コミュニティによるレシピ集  <a
href="http://rubydoc.info上のAPI">rubydoc.info上のAPI</a>ドキュメント: <a
href="http://rubydoc.info/github/sinatra/sinatra">最新版(latest
release)用}[http://rubydoc.info/gems/sinatra]または{現在のHEAD用</a>  <a
href="http://travis-ci.org/sinatra/sinatra">CIサーバ</a>  <a
href="http://route477.net/w/RackReferenceJa.html">Greenbear Laboratory
Rack日本語マニュアル</a></p>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

