<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>README.pt-br - Sinatra</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#label-Sinatra">Sinatra</a>
    <li><a href="#label-Conte-C3-BAdo">Conteúdo</a>
    <li><a href="#label-Rotas">Rotas</a>
    <li><a href="#label-Condi-C3-A7-C3-B5es">Condições</a>
    <li><a href="#label-Retorno+de+valores">Retorno de valores</a>
    <li><a href="#label-Validadores+de+Rota+Personalizados">Validadores de Rota Personalizados</a>
    <li><a href="#label-Arquivos+est-C3-A1ticos">Arquivos estáticos</a>
    <li><a href="#label-Views+-2F+Templates">Views / Templates</a>
    <li><a href="#label-Literal+Templates">Literal Templates</a>
    <li><a href="#label-Linguagens+de+template+dispon-C3-ADveis">Linguagens de template disponíveis</a>
    <li><a href="#label-Haml+Templates">Haml Templates</a>
    <li><a href="#label-Erb+Templates">Erb Templates</a>
    <li><a href="#label-Builder+Templates">Builder Templates</a>
    <li><a href="#label-Nokogiri+Templates">Nokogiri Templates</a>
    <li><a href="#label-Sass+Templates">Sass Templates</a>
    <li><a href="#label-SCSS+Templates">SCSS Templates</a>
    <li><a href="#label-Less+Templates">Less Templates</a>
    <li><a href="#label-Liquid+Templates">Liquid Templates</a>
    <li><a href="#label-Markdown+Templates">Markdown Templates</a>
    <li><a href="#label-RDoc+Templates">RDoc Templates</a>
    <li><a href="#label-AsciiDoc+Templates">AsciiDoc Templates</a>
    <li><a href="#label-Radius+Templates">Radius Templates</a>
    <li><a href="#label-Markaby+Templates">Markaby Templates</a>
    <li><a href="#label-RABL+Templates">RABL Templates</a>
    <li><a href="#label-Slim+Templates">Slim Templates</a>
    <li><a href="#label-Creole+Templates">Creole Templates</a>
    <li><a href="#label-MediaWiki+Templates">MediaWiki Templates</a>
    <li><a href="#label-CoffeeScript+Templates">CoffeeScript Templates</a>
    <li><a href="#label-Stylus+Templates">Stylus Templates</a>
    <li><a href="#label-Yajl+Templates">Yajl Templates</a>
    <li><a href="#label-WLang+Templates">WLang Templates</a>
    <li><a href="#label-Acessando+Vari-C3-A1veis+nos+Templates">Acessando Variáveis nos Templates</a>
    <li><a href="#label-Templates+com+yield+e+layouts+aninhados">Templates com <code>yield</code> e layouts aninhados</a>
    <li><a href="#label-Templates+Inline">Templates Inline</a>
    <li><a href="#label-Templates+nomeados">Templates nomeados</a>
    <li><a href="#label-Associando+extens-C3-B5es+de+arquivos">Associando extensões de arquivos</a>
    <li><a href="#label-Adicionando+seu+Pr-C3-B3prio+Engine+de+Template">Adicionando seu Próprio Engine de Template</a>
    <li><a href="#label-Customizando+l-C3-B3gica+para+encontrar+templates">Customizando lógica para encontrar templates</a>
    <li><a href="#label-Filtros">Filtros</a>
    <li><a href="#label-Helpers">Helpers</a>
    <li><a href="#label-Utilizando+Sess-C3-B5es">Utilizando Sessões</a>
    <li><a href="#label-Halting">Halting</a>
    <li><a href="#label-Passing">Passing</a>
    <li><a href="#label-Desencadeando+Outra+Rota">Desencadeando Outra Rota</a>
    <li><a href="#label-Configura-C3-A7-C3-A3o">Configuração</a>
    <li><a href="#label-Tratamento+de+Erros">Tratamento de Erros</a>
    <li><a href="#label-N-C3-A3o+Encontrado">Não Encontrado</a>
    <li><a href="#label-Erro">Erro</a>
    <li><a href="#label-Mime+Types">Mime Types</a>
    <li><a href="#label-Rack+Middleware">Rack Middleware</a>
    <li><a href="#label-Testando">Testando</a>
    <li><a href="#label-Sinatra-3A-3ABase+-+Middleware-2C+Bibliotecas+e+aplicativos+modulares">Sinatra::Base - Middleware, Bibliotecas e aplicativos modulares</a>
    <li><a href="#label-Linha+de+Comando">Linha de Comando</a>
    <li><a href="#label-A+-C3-BAltima+vers-C3-A3o">A última versão</a>
    <li><a href="#label-Mais">Mais</a>
  </ul>
</div>


  <div id="project-metadata">
    <div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
  
    <li><a href="./LICENSE.html">LICENSE</a>
  
    <li><a href="./README_de_md.html">README.de</a>
  
    <li><a href="./README_es_md.html">README.es</a>
  
    <li><a href="./README_fr_md.html">README.fr</a>
  
    <li><a href="./README_hu_md.html">README.hu</a>
  
    <li><a href="./README_ja_md.html">README.ja</a>
  
    <li><a href="./README_ko_md.html">README.ko</a>
  
    <li><a href="./README_md.html">README</a>
  
    <li><a href="./README_pt-br_md.html">README.pt-br</a>
  
    <li><a href="./README_pt-pt_md.html">README.pt-pt</a>
  
    <li><a href="./README_ru_md.html">README.ru</a>
  
    <li><a href="./README_zh_md.html">README.zh</a>
  
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page README.pt-br.md">

<h1 id="label-Sinatra"><a href="Sinatra.html">Sinatra</a><span><a href="#label-Sinatra">&para;</a> <a href="#top">&uarr;</a></span></h1>

<p><em>Atenção: Este documento é apenas uma tradução da versão em inglês e
pode estar desatualizado.</em></p>

<p>Alguns dos trechos de código a seguir utilizam caracteres UTF-8. Então,
caso esteja utilizando uma versão de ruby inferior à <code>2.0.0</code>,
adicione o encoding no início de seus arquivos:</p>

<pre class="ruby"><span class="ruby-comment"># encoding: utf-8</span>
</pre>

<p><a href="Sinatra.html">Sinatra</a> é uma <a
href="http://pt.wikipedia.org/wiki/Linguagem_de_domínio_específico">DSL</a>
para criar aplicações web em Ruby com o mínimo de esforço e rapidez:</p>

<pre class="ruby"><span class="ruby-comment"># minha_app.rb</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Olá Mundo!&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Instale a gem:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-identifier">install</span> <span class="ruby-identifier">sinatra</span>
</pre>

<p>Em seguida execute:</p>

<pre class="ruby"><span class="ruby-identifier">ruby</span> <span class="ruby-identifier">minha_app</span>.<span class="ruby-identifier">rb</span>
</pre>

<p>Acesse: <a href="http://localhost:4567">localhost:4567</a></p>

<p>É recomendado também executar <code>gem install thin</code>. Caso esta gem
esteja disponível, o <a href="Sinatra.html">Sinatra</a> irá utilizá-la.</p>

<h2 id="label-Conte-C3-BAdo">Conteúdo<span><a href="#label-Conte-C3-BAdo">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p><a href="#sinatra">Sinatra</a></p>
<ul><li>
<p><a href="#conteúdo">Conteúdo</a></p>
</li><li>
<p><a href="#rotas">Rotas</a></p>
</li><li>
<p><a href="#condições">Condições</a></p>
</li><li>
<p><a href="#retorno-de-valores">Retorno de valores</a></p>
</li><li>
<p><a href="#validadores-de-rota-personalizados">Validadores de rota
personalizados</a></p>
</li><li>
<p><a href="#arquivos-estáticos">Arquivos estáticos</a></p>
</li><li>
<p><a href="#views--templates">Views / Templates</a></p>
<ul><li>
<p><a href="#literal-templates">Literal Templates</a></p>
</li><li>
<p><a href="#linguagens-de-template-disponíveis">Linguagens de template
disponíveis</a></p>
<ul><li>
<p><a href="#haml-templates">Haml Templates</a></p>
</li><li>
<p><a href="#erb-templates">Erb Templates</a></p>
</li><li>
<p><a href="#builder-templates">Builder Templates</a></p>
</li><li>
<p><a href="#nokogiri-templates">Nokogiri Templates</a></p>
</li><li>
<p><a href="#sass-templates">Sass Templates</a></p>
</li><li>
<p><a href="#scss-templates">SCSS Templates</a></p>
</li><li>
<p><a href="#less-templates">Less Templates</a></p>
</li><li>
<p><a href="#liquid-templates">Liquid Templates</a></p>
</li><li>
<p><a href="#markdown-templates">Markdown Templates</a></p>
</li><li>
<p><a href="#textile-templates">Textile Templates</a></p>
</li><li>
<p><a href="#rdoc-templates">RDoc Templates</a></p>
</li><li>
<p><a href="#asciidoc-templates">AsciiDoc Templates</a></p>
</li><li>
<p><a href="#radius-templates">Radius Templates</a></p>
</li><li>
<p><a href="#markaby-templates">Markaby Templates</a></p>
</li><li>
<p><a href="#rabl-templates">RABL Templates</a></p>
</li><li>
<p><a href="#slim-templates">Slim Templates</a></p>
</li><li>
<p><a href="#creole-templates">Creole Templates</a></p>
</li><li>
<p><a href="#mediawiki-templates">MediaWiki Templates</a></p>
</li><li>
<p><a href="#coffeescript-templates">CoffeeScript Templates</a></p>
</li><li>
<p><a href="#stylus-templates">Stylus Templates</a></p>
</li><li>
<p><a href="#yajl-templates">Yajl Templates</a></p>
</li><li>
<p><a href="#wlang-templates">WLang Templates</a></p>
</li></ul>
</li><li>
<p><a href="#acessando-variáveis-nos-templates">Acessando Variáveis nos
Templates</a></p>
</li><li>
<p><a href="#templates-com-yield-e-layouts-aninhados">Templates com yield e
layouts aninhados</a></p>
</li><li>
<p><a href="#templates-inline">Templates Inline</a></p>
</li><li>
<p><a href="#templates-nomeados">Templates Nomeados</a></p>
</li><li>
<p><a href="#associando-extensões-de-arquivos">Associando extensões de
arquivos</a></p>
</li><li>
<p><a href="#adicionando-seu-próprio-engine-de-template">Adicionando seu
Próprio Engine de Template</a></p>
</li><li>
<p><a href="#customizando-lógica-para-encontrar-templates">Customizando lógica
para encontrar templates</a></p>
</li></ul>
</li><li>
<p><a href="#filtros">Filtros</a></p>
</li><li>
<p><a href="#helpers">Helpers</a></p>
<ul><li>
<p><a href="#utilizando-sessões">Utilizando Sessões</a></p>
</li><li>
<p><a href="#halting">Halting</a></p>
</li><li>
<p><a href="#passing">Passing</a></p>
</li><li>
<p><a href="#desencadeando-outra-rota">Desencadeando Outra Rota</a></p>
</li></ul>
</li><li>
<p><a href="#configuração">Configuração</a></p>
</li><li>
<p><a href="#tratamento-de-erros">Tratamento de Erros</a></p>
<ul><li>
<p><a href="#erro">Erro</a></p>
</li></ul>
</li><li>
<p><a href="#mime-types">Mime Types</a></p>
</li><li>
<p><a href="#rack-middleware">Rack Middleware</a></p>
</li><li>
<p><a href="#testando">Testando</a></p>
</li><li>
<p><a
href="#sinatrabase---middleware-bibliotecas-e-aplicativos-modulares">Sinatra::Base
- Middleware, Bibliotecas e aplicativos modulares</a></p>
</li><li>
<p><a href="#linha-de-comando">Linha de comando</a></p>
</li><li>
<p><a href="#a-última-versão">A última versão</a></p>
</li><li>
<p><a href="#mais">Mais</a></p>
</li></ul>
</li></ul>

<h2 id="label-Rotas">Rotas<span><a href="#label-Rotas">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>No <a href="Sinatra.html">Sinatra</a>, uma rota é um método HTTP
emparelhado com um padrão de URL. Cada rota possui um bloco de execução:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">mostrando</span> <span class="ruby-identifier">alguma</span> <span class="ruby-identifier">coisa</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">post</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">criando</span> <span class="ruby-identifier">alguma</span> <span class="ruby-identifier">coisa</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">put</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">atualizando</span> <span class="ruby-identifier">alguma</span> <span class="ruby-identifier">coisa</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">patch</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">modificando</span> <span class="ruby-identifier">alguma</span> <span class="ruby-identifier">coisa</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">delete</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">removendo</span> <span class="ruby-identifier">alguma</span> <span class="ruby-identifier">coisa</span> <span class="ruby-operator">..</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">options</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">..</span> <span class="ruby-identifier">estabelecendo</span> <span class="ruby-identifier">alguma</span> <span class="ruby-identifier">coisa</span> <span class="ruby-operator">..</span><span class="ruby-identifier">pe</span>
<span class="ruby-keyword">end</span>
</pre>

<p>As rotas são interpretadas na ordem em que são definidas. A primeira rota
encontrada responde a requisição.</p>

<p>Padrões de rota podem conter parâmetros nomeados, acessíveis por meio do
hash <code>params</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/ola/:nome&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># corresponde a &quot;GET /ola/foo&quot; e &quot;GET /ola/bar&quot;</span>
  <span class="ruby-comment"># params[&#39;nome&#39;] é &#39;foo&#39; ou &#39;bar&#39;</span>
  <span class="ruby-node">&quot;Olá #{params[&#39;nome&#39;]}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Você também pode acessar parâmetros nomeados por meio dos parâmetros de um
bloco:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/ola/:nome&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># corresponde a &quot;GET /ola/foo&quot; e &quot;GET /ola/bar&quot;</span>
  <span class="ruby-comment"># params[&#39;nome&#39;] é &#39;foo&#39; ou &#39;bar&#39;</span>
  <span class="ruby-comment"># n guarda o valor de params[&#39;nome&#39;]</span>
  <span class="ruby-node">&quot;Olá #{n}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Padrões de rota também podem conter parâmetros splat (curinga), acessível
por meio do array <code>params['splat']</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/diga/*/para/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># corresponde a /diga/ola/para/mundo</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment"># =&gt; [&quot;ola&quot;, &quot;mundo&quot;]</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/download/*.*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># corresponde a /download/caminho/do/arquivo.xml</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment"># =&gt; [&quot;caminho/do/arquivo&quot;, &quot;xml&quot;]</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Ou com parâmetros de um bloco:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/download/*.*&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">caminho</span>, <span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>
  [<span class="ruby-identifier">caminho</span>, <span class="ruby-identifier">ext</span>] <span class="ruby-comment"># =&gt; [&quot;caminho/do/arquivo&quot;, &quot;xml&quot;]</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Rotas podem casar com expressões regulares:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">/\A\/ola\/([\w]+)\z/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-node">&quot;Olá, #{params[&#39;captures&#39;].first}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Ou com parâmetros de um bloco:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">%r{/ola/([\w]+)}</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
  <span class="ruby-comment"># corresponde a &quot;GET /meta/ola/mundo&quot;, &quot;GET /ola/mundo/1234&quot; etc.</span>
  <span class="ruby-node">&quot;Olá, #{c}!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Padrões de rota podem contar com parâmetros opcionais:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/posts.?:formato?&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># corresponde a &quot;GET /posts&quot; e qualquer extensão &quot;GET /posts.json&quot;, &quot;GET /posts.xml&quot;, etc.</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Rotas também podem utilizar query strings:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/posts&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># corresponde a &quot;GET /posts?titulo=foo&amp;autor=bar&quot;</span>
  <span class="ruby-identifier">titulo</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;titulo&#39;</span>]
  <span class="ruby-identifier">autor</span> = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;autor&#39;</span>]
  <span class="ruby-comment"># utiliza as variaveis titulo e autor; a query é opicional para a rota /posts</span>
<span class="ruby-keyword">end</span>
</pre>

<p>A propósito, a menos que você desative a proteção contra ataques (veja
abaixo), o caminho solicitado pode ser alterado antes de concluir a
comparação com as suas rotas.</p>

<h2 id="label-Condi-C3-A7-C3-B5es">Condições<span><a href="#label-Condi-C3-A7-C3-B5es">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Rotas podem incluir uma variedade de condições, tal como o <code>user
agent</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span>, :<span class="ruby-identifier">agent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/Songbird (\d\.\d)[\d\/]*?/</span> <span class="ruby-keyword">do</span>
  <span class="ruby-node">&quot;Você está usando o Songbird versão #{params[&#39;agent&#39;][0]}&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># Correspondente a navegadores que não sejam Songbird</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Outras condições disponíveis são <code>host_name</code> e
<code>provides</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">host_name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-regexp">/^admin\./</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Área administrativa. Acesso negado!&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">provides</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;html&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, :<span class="ruby-identifier">provides</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-string">&#39;rss&#39;</span>, <span class="ruby-string">&#39;atom&#39;</span>, <span class="ruby-string">&#39;xml&#39;</span>] <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">builder</span> :<span class="ruby-identifier">feed</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>provides</code> procura pelos Accept header das requisições</p>

<p>Você pode facilmente definir suas próprias condições:</p>

<pre class="ruby"><span class="ruby-identifier">set</span>(:<span class="ruby-identifier">probabilidade</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">valor</span><span class="ruby-operator">|</span> <span class="ruby-identifier">condition</span> { <span class="ruby-identifier">rand</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">valor</span> } }

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/ganha_um_carro&#39;</span>, :<span class="ruby-identifier">probabilidade</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0.1</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Você ganhou!&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/ganha_um_carro&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Sinto muito, você perdeu.&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Use splat, para uma condição que leva vários valores:</p>

<pre class="ruby"><span class="ruby-identifier">set</span>(:<span class="ruby-identifier">auth</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">roles</span><span class="ruby-operator">|</span>   <span class="ruby-comment"># &lt;- observe o splat aqui</span>
  <span class="ruby-identifier">condition</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">logged_in?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">roles</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">role</span><span class="ruby-operator">|</span> <span class="ruby-identifier">current_user</span>.<span class="ruby-identifier">in_role?</span> <span class="ruby-identifier">role</span> }
      <span class="ruby-identifier">redirect</span> <span class="ruby-string">&quot;/login/&quot;</span>, <span class="ruby-value">303</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/minha/conta/&quot;</span>, :<span class="ruby-identifier">auth</span> =<span class="ruby-operator">&gt;</span> [:<span class="ruby-identifier">usuario</span>, :<span class="ruby-identifier">administrador</span>] <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Detalhes da sua conta&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&quot;/apenas/administrador/&quot;</span>, :<span class="ruby-identifier">auth</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">administrador</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Apenas administradores são permitidos aqui!&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Retorno+de+valores">Retorno de valores<span><a href="#label-Retorno+de+valores">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>O valor de retorno do bloco de uma rota determina pelo menos o corpo da
resposta passado para o cliente HTTP, ou pelo menos o próximo middleware na
pilha <a href="Rack.html">Rack</a>. Frequentemente, isto é uma
<code>string</code>, tal como nos exemplos acima. Entretanto, outros
valores também são aceitos.</p>

<p>Você pode retornar uma resposta válida ou um objeto para o <a
href="Rack.html">Rack</a>, sendo eles de qualquer tipo de objeto que
queira. Além disso, é possível retornar um código de status HTTP.</p>
<ul><li>
<p>Um array com três elementros: <code>[status (Fixnum), cabecalho (Hash),
corpo da resposta (responde à #each)]</code></p>
</li><li>
<p>Um array com dois elementros: <code>[status (Fixnum), corpo da resposta
(responde à #each)]</code></p>
</li><li>
<p>Um objeto que responda à <code>#each</code> sem passar nada, mas, sim,
<code>strings</code> para um dado bloco</p>
</li><li>
<p>Um objeto <code>Fixnum</code> representando o código de status</p>
</li></ul>

<p>Dessa forma, podemos implementar facilmente um exemplo de streaming:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">Stream</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">each</span>
    <span class="ruby-value">100</span>.<span class="ruby-identifier">times</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-keyword">yield</span> <span class="ruby-node">&quot;#{i}\n&quot;</span> }
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-constant">Stream</span>.<span class="ruby-identifier">new</span> }
</pre>

<p>Você também pode usar o método auxiliar <code>stream</code> (descrito
abaixo) para incorporar a lógica de streaming na rota.</p>

<h2 id="label-Validadores+de+Rota+Personalizados">Validadores de Rota Personalizados<span><a href="#label-Validadores+de+Rota+Personalizados">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Como apresentado acima, a estrutura do <a href="Sinatra.html">Sinatra</a>
conta com suporte embutido para uso de padrões de String e expressões
regulares como validadores de rota. No entanto, ele não pára por aí. Você
pode facilmente definir os seus próprios validadores:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">AllButPattern</span>
  <span class="ruby-constant">Match</span> = <span class="ruby-constant">Struct</span>.<span class="ruby-identifier">new</span>(:<span class="ruby-identifier">captures</span>)

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">except</span>)
    <span class="ruby-ivar">@except</span>   = <span class="ruby-identifier">except</span>
    <span class="ruby-ivar">@captures</span> = <span class="ruby-constant">Match</span>.<span class="ruby-identifier">new</span>([])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">match</span>(<span class="ruby-identifier">str</span>)
    <span class="ruby-ivar">@captures</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@except</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">str</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_but</span>(<span class="ruby-identifier">pattern</span>)
  <span class="ruby-constant">AllButPattern</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>)
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-identifier">all_but</span>(<span class="ruby-string">&quot;/index&quot;</span>) <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note que o exemplo acima pode ser robusto e complicado em excesso. Pode
também ser implementado como:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">//</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;/index&quot;</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Ou, usando algo mais denso à frente:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-regexp">%r{^(?!/index$)}</span> <span class="ruby-keyword">do</span>
  <span class="ruby-comment"># ...</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Arquivos+est-C3-A1ticos">Arquivos estáticos<span><a href="#label-Arquivos+est-C3-A1ticos">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Arquivos estáticos são disponibilizados a partir do diretório
<code>./public</code>. Você pode especificar um local diferente pela opção
<code>:public_folder</code></p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">public_folder</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/estatico&#39;</span>
</pre>

<p>Note que o nome do diretório público não é incluido na URL. Um arquivo
<code>./public/css/style.css</code> é disponibilizado como
<code>http://exemplo.com/css/style.css</code>.</p>

<h2 id="label-Views+-2F+Templates">Views / Templates<span><a href="#label-Views+-2F+Templates">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Cada linguagem de template é exposta através de seu próprio método de
renderização. Estes metodos simplesmente retornam uma string:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Isto renderiza <code>views/index.rb</code></p>

<p>Ao invés do nome do template, você também pode passar direto o conteúdo do
template:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">code</span> = <span class="ruby-string">&quot;&lt;%= Time.now %&gt;&quot;</span>
  <span class="ruby-identifier">erb</span> <span class="ruby-identifier">code</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Templates também aceitam um segundo argumento, um hash de opções:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">post</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Isto irá renderizar a <code>views/index.erb</code> inclusa dentro da
<code>views/post.erb</code> (o padrão é a <code>views/layout.erb</code>, se
existir).</p>

<p>Qualquer opção não reconhecida pelo <a href="Sinatra.html">Sinatra</a> será
passada adiante para o engine de template:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">html5</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Você também pode definir opções padrões para um tipo de template:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">haml</span>, :<span class="ruby-identifier">format</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">html5</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Opções passadas para o método de renderização sobrescreve as opções
definitas através do método <code>set</code>.</p>

<p>Opções disponíveis:</p>
<dl>
  <dt>locals</dt>
  <dd>
    Lista de locais passado para o documento. Conveniente para *partials*
    Exemplo: <tt>erb "<%= foo %>", :locals => {:foo => "bar"}</tt>
  </dd>

  <dt>default_encoding</dt>
  <dd>
    String encoding para ser utilizada em caso de incerteza. o padrão é <tt>settings.default_encoding</tt>.
  </dd>

  <dt>views</dt>
  <dd>
    Diretório de onde os templates são carregados. O padrão é <tt>settings.views</tt>.
  </dd>

  <dt>layout</dt>
  <dd>
    Para definir quando utilizar ou não um
    layout (<tt>true</tt> ou <tt>false</tt>). E se for um
    Symbol, especifica qual template usar. Exemplo:
    <tt>erb :index, :layout => !request.xhr?</tt>
  </dd>

  <dt>content_type</dt>
  <dd>
    O *Content-Type* que o template produz. O padrão depente
    da linguagem de template utilizada.
  </dd>

  <dt>scope</dt>
  <dd>
    Escopo em que o template será renderizado. Padrão é a
    instancia da aplicação. Se você mudar isto as variáveis
    de instânciae metodos auxiliares não serão
    disponibilizados.
  </dd>

  <dt>layout_engine</dt>
  <dd>
    A engine de template utilizada para renderizar seu layout.
    Útil para linguagens que não suportam templates de outra
    forma. O padrão é a engine do template utilizado. Exemplo: 
    <tt>set :rdoc, :layout_engine => :erb</tt>
  </dd>

  <dt>layout_options</dt>
  <dd>
    Opções especiais utilizadas apenas para renderizar o
    layout. Exemplo:
    <tt>set :rdoc, :layout_options => { :views => 'views/layouts' }</tt>
  </dd>
</dl>
<p>É pressuposto que os templates estarão localizados direto sob o diretório
<code>./views</code>. Para usar um diretório diferente:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span>, <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">root</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/templates&#39;</span>
</pre>

<p>Uma coisa importante para se lembrar é que você sempre deve referenciar os
templates utilizando <em>symbols</em>, mesmo que eles estejam em um
subdiretório (neste caso use: <code>:&#39;subdir/template&#39;</code> or
<code>&#39;subdir/template&#39;.to_sym</code>). Você deve utilizar um
<em>symbol</em> porque senão o método de renderização irá renderizar
qualquer outra string que você passe diretamente para ele</p>

<h3 id="label-Literal+Templates">Literal Templates<span><a href="#label-Literal+Templates">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%div.title Olá Mundo&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Renderiza um template string.</p>

<h3 id="label-Linguagens+de+template+dispon-C3-ADveis">Linguagens de template disponíveis<span><a href="#label-Linguagens+de+template+dispon-C3-ADveis">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Algumas linguagens possuem multiplas implementações. Para especificar qual
implementação deverá ser utilizada (e para ser <em>thread-safe</em>), você
deve simplesmente requere-la primeiro:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rdiscount&#39;</span> <span class="ruby-comment"># ou require &#39;bluecloth&#39;</span>
<span class="ruby-identifier">get</span>(<span class="ruby-string">&#39;/&#39;</span>) { <span class="ruby-identifier">markdown</span> :<span class="ruby-identifier">index</span> }
</pre>

<h4 id="label-Haml+Templates">Haml Templates<span><a href="#label-Haml+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://haml.info/" title="haml">haml</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.haml</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>haml :index, :format => :html5</tt></td>
  </tr>
</table>
<h4 id="label-Erb+Templates">Erb Templates<span><a href="#label-Erb+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="http://www.kuwata-lab.com/erubis/" title="erubis">erubis</a>
      or erb (included in Ruby)
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivos</td>
    <td><tt>.erb</tt>, <tt>.rhtml</tt> or <tt>.erubis</tt> (Erubis only)</td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>erb :index</tt></td>
  </tr>
</table>
<h4 id="label-Builder+Templates">Builder Templates<span><a href="#label-Builder+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="https://github.com/jimweirich/builder" title="builder">builder</a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.builder</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>builder { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<p>It also takes a block for inline templates (see exemplo).</p>

<h4 id="label-Nokogiri+Templates">Nokogiri Templates<span><a href="#label-Nokogiri+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://nokogiri.org/" title="nokogiri">nokogiri</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.nokogiri</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>nokogiri { |xml| xml.em "hi" }</tt></td>
  </tr>
</table>
<p>It also takes a block for inline templates (see exemplo).</p>

<h4 id="label-Sass+Templates">Sass Templates<span><a href="#label-Sass+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.sass</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>sass :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>
<h4 id="label-SCSS+Templates">SCSS Templates<span><a href="#label-SCSS+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://sass-lang.com/" title="sass">sass</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.scss</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>scss :stylesheet, :style => :expanded</tt></td>
  </tr>
</table>
<h4 id="label-Less+Templates">Less Templates<span><a href="#label-Less+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://www.lesscss.org/" title="less">less</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.less</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>less :stylesheet</tt></td>
  </tr>
</table>
<h4 id="label-Liquid+Templates">Liquid Templates<span><a href="#label-Liquid+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://www.liquidmarkup.org/" title="liquid">liquid</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.liquid</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>liquid :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>Já que você não pode chamar o Ruby (exceto pelo método <code>yield</code>)
pelo template Liquid, você quase sempre precisará passar o
<code>locals</code> para ele.</p>

<h4 id="label-Markdown+Templates">Markdown Templates<span><a href="#label-Markdown+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td>
      Anyone of:
        <a href="https://github.com/rtomayko/rdiscount" title="RDiscount">RDiscount</a>,
        <a href="https://github.com/vmg/redcarpet" title="RedCarpet">RedCarpet</a>,
        <a href="http://deveiate.org/projects/BlueCloth" title="BlueCloth">BlueCloth</a>,
        <a href="http://kramdown.gettalong.org/" title="kramdown">kramdown</a>,
        <a href="https://github.com/bhollis/maruku" title="maruku">maruku</a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivos</td>
    <td><tt>.markdown</tt>, <tt>.mkd</tt> and <tt>.md</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>markdown :index, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Não é possível chamar métodos por este template, nem passar <em>locals</em>
para o mesmo. Portanto normalmente é utilizado junto a outra engine de
renderização:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">markdown</span>(:<span class="ruby-identifier">introducao</span>) }
</pre>

<p>Note que vcoê também pode chamar o método <code>markdown</code> dentro de
outros templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Olá</span> <span class="ruby-keyword">do</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">markdown</span>(:<span class="ruby-identifier">saudacoes</span>)
</pre>

<p>Já que você não pode chamar o Ruby pelo Markdown, você não pode utilizar um
layout escrito em Markdown. Contudo é possível utilizar outra engine de
renderização como template, deve-se passar a <code>:layout_engine</code>
como opção.</p>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://redcloth.org/" title="RedCloth">RedCloth</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.textile</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>textile :index, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Não é possível chamar métodos por este template, nem passar <em>locals</em>
para o mesmo. Portanto normalmente é utilizado junto a outra engine de
renderização:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">textile</span>(:<span class="ruby-identifier">introducao</span>) }
</pre>

<p>Note que vcoê também pode chamar o método <code>textile</code> dentro de
outros templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Olá</span> <span class="ruby-keyword">do</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">textile</span>(:<span class="ruby-identifier">saudacoes</span>)
</pre>

<p>Já que você não pode chamar o Ruby pelo Textile, você não pode utilizar um
layout escrito em Textile. Contudo é possível utilizar outra engine de
renderização como template, deve-se passar a <code>:layout_engine</code>
como opção.</p>

<h4 id="label-RDoc+Templates">RDoc Templates<span><a href="#label-RDoc+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://rdoc.sourceforge.net/" title="RDoc">RDoc</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.rdoc</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>rdoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Não é possível chamar métodos por este template, nem passar <em>locals</em>
para o mesmo. Portanto normalmente é utilizado junto a outra engine de
renderização:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">rdoc</span>(:<span class="ruby-identifier">introducao</span>) }
</pre>

<p>Note que vcoê também pode chamar o método <code>rdoc</code> dentro de
outros templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Olá</span> <span class="ruby-keyword">do</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">rdoc</span>(:<span class="ruby-identifier">saudacoes</span>)
</pre>

<p>Já que você não pode chamar o Ruby pelo RDoc, você não pode utilizar um
layout escrito em RDoc. Contudo é possível utilizar outra engine de
renderização como template, deve-se passar a <code>:layout_engine</code>
como opção.</p>

<h4 id="label-AsciiDoc+Templates">AsciiDoc Templates<span><a href="#label-AsciiDoc+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://asciidoctor.org/" title="Asciidoctor">Asciidoctor</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.asciidoc</tt>, <tt>.adoc</tt> and <tt>.ad</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>asciidoc :README, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Já que você não pode chamar o Ruby pelo template AsciiDoc, você quase
sempre precisará passar o <code>locals</code> para ele.</p>

<h4 id="label-Radius+Templates">Radius Templates<span><a href="#label-Radius+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/jlong/radius" title="Radius">Radius</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.radius</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>radius :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>Já que você não pode chamar o Ruby pelo template Radius, você quase sempre
precisará passar o <code>locals</code> para ele.</p>

<h4 id="label-Markaby+Templates">Markaby Templates<span><a href="#label-Markaby+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://markaby.github.com/" title="Markaby">Markaby</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.mab</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>markaby { h1 "Welcome!" }</tt></td>
  </tr>
</table>
<p>Este também recebe um bloco para templates (veja o exemplo).</p>

<h4 id="label-RABL+Templates">RABL Templates<span><a href="#label-RABL+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/nesquena/rabl" title="Rabl">Rabl</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.rabl</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>rabl :index</tt></td>
  </tr>
</table>
<h4 id="label-Slim+Templates">Slim Templates<span><a href="#label-Slim+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="http://slim-lang.com/" title="Slim Lang">Slim Lang</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.slim</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>slim :index</tt></td>
  </tr>
</table>
<h4 id="label-Creole+Templates">Creole Templates<span><a href="#label-Creole+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/minad/creole" title="Creole">Creole</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.creole</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>creole :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>Não é possível chamar métodos por este template, nem passar <em>locals</em>
para o mesmo. Portanto normalmente é utilizado junto a outra engine de
renderização:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">creole</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>Note que vcoê também pode chamar o método <code>creole</code> dentro de
outros templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Olá</span> <span class="ruby-keyword">do</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">creole</span>(:<span class="ruby-identifier">saudacoes</span>)
</pre>

<p>Já que você não pode chamar o Ruby pelo Creole, você não pode utilizar um
layout escrito em Creole. Contudo é possível utilizar outra engine de
renderização como template, deve-se passar a <code>:layout_engine</code>
como opção.</p>

<h4 id="label-MediaWiki+Templates">MediaWiki Templates<span><a href="#label-MediaWiki+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/nricciar/wikicloth" title="WikiCloth">WikiCloth</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.mediawiki</tt> and <tt>.mw</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>mediawiki :wiki, :layout_engine => :erb</tt></td>
  </tr>
</table>
<p>It is not possible to call methods from MediaWiki markup, nor to pass
locals to it. You therefore will usually use it in combination with another
rendering engine:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">overview</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">mediawiki</span>(:<span class="ruby-identifier">introduction</span>) }
</pre>

<p>Note that you may also call the <code>mediawiki</code> method from within
other templates:</p>

<pre class="ruby"><span class="ruby-operator">%</span><span class="ruby-value">1</span> <span class="ruby-constant">Hello</span> <span class="ruby-constant">From</span> <span class="ruby-constant">Haml!</span>
<span class="ruby-operator">%</span>= <span class="ruby-identifier">mediawiki</span>(:<span class="ruby-identifier">greetings</span>)
</pre>

<p>Já que você não pode chamar o Ruby pelo MediaWiki, você não pode utilizar
um layout escrito em MediaWiki. Contudo é possível utilizar outra engine de
renderização como template, deve-se passar a <code>:layout_engine</code>
como opção.</p>

<h4 id="label-CoffeeScript+Templates">CoffeeScript Templates<span><a href="#label-CoffeeScript+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="https://github.com/josh/ruby-coffee-script" title="Ruby CoffeeScript">
        CoffeeScript
      </a> and a
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        way to execute javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.coffee</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>coffee :index</tt></td>
  </tr>
</table>
<h4 id="label-Stylus+Templates">Stylus Templates<span><a href="#label-Stylus+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td>
      <a href="https://github.com/lucasmazza/ruby-stylus" title="Ruby Stylus">
        Stylus
      </a> and a
      <a href="https://github.com/sstephenson/execjs/blob/master/README.md#readme" title="ExecJS">
        way to execute javascript
      </a>
    </td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.styl</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>stylus :index</tt></td>
  </tr>
</table>
<p>Antes que vcoê possa utilizar o template Stylus primeiro você deve carregar
<code>stylus</code> e <code>stylus/tilt</code>:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stylus&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;stylus/tilt&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">stylus</span> :<span class="ruby-identifier">exemplo</span>
<span class="ruby-keyword">end</span>
</pre>

<h4 id="label-Yajl+Templates">Yajl Templates<span><a href="#label-Yajl+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/brianmario/yajl-ruby" title="yajl-ruby">yajl-ruby</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.yajl</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td>
      <tt>
        yajl :index,
             :locals => { :key => 'qux' },
             :callback => 'present',
             :variable => 'resource'
      </tt>
    </td>
  </tr>
</table>
<p>O código-fonte do template é executado como uma string Ruby e a variável
resultante em json é convertida utilizando <code>#to_json</code>:</p>

<pre class="ruby"><span class="ruby-identifier">json</span> = { :<span class="ruby-identifier">foo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;bar&#39;</span> }
<span class="ruby-identifier">json</span>[:<span class="ruby-identifier">baz</span>] = <span class="ruby-identifier">key</span>
</pre>

<p>O <code>:callback</code> e <code>:variable</code> são opções que podem ser
utilizadas para o objeto de renderização:</p>

<pre>var resource = {&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;qux&quot;};
present(resource);</pre>

<h4 id="label-WLang+Templates">WLang Templates<span><a href="#label-WLang+Templates">&para;</a> <a href="#top">&uarr;</a></span></h4>
<table>
  <tr>
    <td>Dependencia</td>
    <td><a href="https://github.com/blambeau/wlang/" title="WLang">WLang</a></td>
  </tr>
  <tr>
    <td>Extencao do Arquivo</td>
    <td><tt>.wlang</tt></td>
  </tr>
  <tr>
    <td>Exemplo</td>
    <td><tt>wlang :index, :locals => { :key => 'value' }</tt></td>
  </tr>
</table>
<p>Já que você não pode chamar o Ruby (exceto pelo método <code>yield</code>)
pelo template WLang, você quase sempre precisará passar o
<code>locals</code> para ele.</p>

<h2 id="label-Acessando+Vari-C3-A1veis+nos+Templates">Acessando Variáveis nos Templates<span><a href="#label-Acessando+Vari-C3-A1veis+nos+Templates">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Templates são avaliados dentro do mesmo contexto como manipuladores de
rota. Variáveis de instância setadas em rotas manipuladas são diretamente
acessadas por templates:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:id&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@foo</span> = <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>])
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%h1= @foo.nome&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Ou, especifique um hash explícito para variáveis locais:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:id&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">foo</span> = <span class="ruby-constant">Foo</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;id&#39;</span>])
  <span class="ruby-identifier">haml</span> <span class="ruby-string">&#39;%h1= foo.nome&#39;</span>, :<span class="ruby-identifier">locals</span> =<span class="ruby-operator">&gt;</span> { :<span class="ruby-identifier">foo</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">foo</span> }
<span class="ruby-keyword">end</span>
</pre>

<p>Isso é tipicamente utilizando quando renderizamos templates como partials
dentro de outros templates.</p>

<h3 id="label-Templates+com+yield+e+layouts+aninhados">Templates com <code>yield</code> e layouts aninhados<span><a href="#label-Templates+com+yield+e+layouts+aninhados">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>O layout geralmente é apenas um template que executa <code>yield</code>.
Tal template pode ser utilizado pela opção <code>:template</code> descrita
acima ou pode ser renderizado através de um bloco, como a seguir:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">post</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Este código é quase equivalente a <code>erb :index, :layout =&gt;
:post</code></p>

<p>Passando blocos para os métodos de renderização é útil para criar layouts
aninhados:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">main_layout</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">admin_layout</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">user</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Também pode ser feito com menos linhas de código:</p>

<pre class="ruby"><span class="ruby-identifier">erb</span> :<span class="ruby-identifier">admin_layout</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> :<span class="ruby-identifier">main_layout</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">erb</span> :<span class="ruby-identifier">user</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Atualmente os métodos listados aceitam blocos: <code>erb</code>,
<code>haml</code>, <code>liquid</code>, <code>slim</code>,
<code>wlang</code>. E também o método <code>render</code>.</p>

<h3 id="label-Templates+Inline">Templates Inline<span><a href="#label-Templates+Inline">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Templates podem ser definidos no final do arquivo fonte(.rb):</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>

__END__

<span class="ruby-identifier">@@</span> <span class="ruby-identifier">layout</span>
<span class="ruby-operator">%</span><span class="ruby-identifier">tml</span>
  = <span class="ruby-keyword">yield</span>

<span class="ruby-identifier">@@</span> <span class="ruby-identifier">index</span>
<span class="ruby-operator">%</span><span class="ruby-identifier">iv</span>.<span class="ruby-identifier">title</span> <span class="ruby-constant">Olá</span> <span class="ruby-constant">Mundo</span>.
</pre>

<p>NOTA: Templates inline definidos no arquivo fonte são automaticamente
carregados pelo sinatra. Digite `enable :inline_templates` se você tem
templates inline no outro arquivo fonte.</p>

<h3 id="label-Templates+nomeados">Templates nomeados<span><a href="#label-Templates+nomeados">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Templates também podem ser definidos utilizando o método top-level
<code>template</code>:</p>

<pre class="ruby"><span class="ruby-identifier">template</span> :<span class="ruby-identifier">layout</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;%html\n  =yield\n&quot;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">template</span> :<span class="ruby-identifier">index</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;%div.title Olá Mundo!&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Se existir um template com nome “layout”, ele será utilizado toda vez que
um template for renderizado. Você pode desabilitar layouts passando
<code>:layout =&gt; false</code>.</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">haml</span> :<span class="ruby-identifier">index</span>, :<span class="ruby-identifier">layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">request</span>.<span class="ruby-identifier">xhr?</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Associando+extens-C3-B5es+de+arquivos">Associando extensões de arquivos<span><a href="#label-Associando+extens-C3-B5es+de+arquivos">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Para associar uma extensão de arquivo com um engine de template use o
método <code>Tilt.register</code>. Por exemplo, se você quiser usar a
extensão <code>tt</code> para os templates Textile você pode fazer o
seguinte:</p>

<pre class="ruby"><span class="ruby-constant">Tilt</span>.<span class="ruby-identifier">register</span> :<span class="ruby-identifier">tt</span>, <span class="ruby-constant">Tilt</span>[:<span class="ruby-identifier">textile</span>]
</pre>

<h3 id="label-Adicionando+seu+Pr-C3-B3prio+Engine+de+Template">Adicionando seu Próprio Engine de Template<span><a href="#label-Adicionando+seu+Pr-C3-B3prio+Engine+de+Template">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Primeiro registre seu engine utilizando o Tilt, e então crie um método de
renderização:</p>

<pre class="ruby"><span class="ruby-constant">Tilt</span>.<span class="ruby-identifier">register</span> :<span class="ruby-identifier">myat</span>, <span class="ruby-constant">MyAwesomeTemplateEngine</span>

<span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">myat</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-identifier">render</span>(:<span class="ruby-identifier">myat</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">myat</span> :<span class="ruby-identifier">index</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Renderize <code>./views/index.myat</code>. Veja <a
href="https://github.com/rtomayko/tilt">github.com/rtomayko/tilt</a> para
saber mais sobre Tilt.</p>

<h3 id="label-Customizando+l-C3-B3gica+para+encontrar+templates">Customizando lógica para encontrar templates<span><a href="#label-Customizando+l-C3-B3gica+para+encontrar+templates">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Para implementar sua própria lógica para busca de templates você pode
escrever seu próprio método <code>#find_template</code></p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">views</span> [ <span class="ruby-string">&#39;./views/a&#39;</span>, <span class="ruby-string">&#39;./views/b&#39;</span> ]
<span class="ruby-keyword">end</span>

<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_template</span>(<span class="ruby-identifier">views</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-constant">Array</span>(<span class="ruby-identifier">views</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">super</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">engine</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Filtros">Filtros<span><a href="#label-Filtros">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Filtros Before são avaliados antes de cada requisição dentro do contexto da
requisição e podem modificar a requisição e a reposta. Variáveis de
instância setadas nos filtros são acessadas através de rotas e templates:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@nota</span> = <span class="ruby-string">&#39;Oi!&#39;</span>
  <span class="ruby-identifier">request</span>.<span class="ruby-identifier">path_info</span> = <span class="ruby-string">&#39;/foo/bar/baz&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-ivar">@nota</span> <span class="ruby-comment">#=&gt; &#39;Oi!&#39;</span>
  <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;splat&#39;</span>] <span class="ruby-comment">#=&gt; &#39;bar/baz&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Filtros After são avaliados após cada requisição dentro do contexto da
requisição e também podem modificar a requisição e a resposta. Variáveis de
instância e rotas definidas nos filtros before são acessadas através dos
filtros after:</p>

<pre class="ruby"><span class="ruby-identifier">after</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">puts</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">status</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Filtros opcionalmente têm um padrão, fazendo com que sejam avaliados
somente se o caminho do pedido coincidir com esse padrão:</p>

<pre class="ruby"><span class="ruby-identifier">before</span> <span class="ruby-string">&#39;/protected/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">authenticate!</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">after</span> <span class="ruby-string">&#39;/create/:slug&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">slug</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">last_slug</span>] = <span class="ruby-identifier">slug</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Helpers">Helpers<span><a href="#label-Helpers">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Use o método de alto nível <code>helpers</code> para definir métodos
auxiliares para utilizar em manipuladores de rotas e modelos:</p>

<pre class="ruby"><span class="ruby-identifier">helpers</span> <span class="ruby-keyword">do</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">nome</span>)
    <span class="ruby-node">&quot;#{nome}bar&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:nome&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">bar</span>(<span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;nome&#39;</span>])
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Utilizando+Sess-C3-B5es">Utilizando Sessões<span><a href="#label-Utilizando+Sess-C3-B5es">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Sessões são usadas para manter um estado durante uma requisição. Se ativa,
você terá disponível um hash de sessão para cada sessão de usuário:</p>

<pre class="ruby"><span class="ruby-identifier">enable</span> :<span class="ruby-identifier">sessions</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;value = &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>].<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:value&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;value&#39;</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>Note que <code>enable :sessions</code> utilizará um cookie para guardar
todos os dados da sessão. Isso nem sempre pode ser o que você quer (guardar
muitos dados irá aumentar o seu tráfego, por exemplo). Você pode utilizar
qualquer <a href="Rack.html">Rack</a> middleware de sessão: para fazer isso
<strong>não</strong> utilize o método <code>enable :sessions</code>, ao
invés disso utilize seu middleware de sessão como utilizaria qualquer
outro:</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">Pool</span>, :<span class="ruby-identifier">expire_after</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">2592000</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;value = &quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">session</span>[:<span class="ruby-identifier">value</span>].<span class="ruby-identifier">inspect</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/:value&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;value&#39;</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;value&#39;</span>]
<span class="ruby-keyword">end</span>
</pre>

<p>Para melhorar a segurança, os dados da sessão guardados no cookie é
assinado com uma chave secreta da sessão. Uma chave aleatória é gerada para
você pelo <a href="Sinatra.html">Sinatra</a>. Contudo, já que a chave
mudará cada vez que você inicia sua aplicação, você talvez queira defini-la
você mesmo para que todas as instâncias da aplicação compartilhe-a:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">session_secret</span>, <span class="ruby-string">&#39;super secret&#39;</span>
</pre>

<p>Se você quiser fazer outras configurações, você também pode guardar um hash
com as opções nas configurações da <code>session</code>:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, :<span class="ruby-identifier">domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;foo.com&#39;</span>
</pre>

<p>Para compartilhar sua sessão entre outros aplicativos em um subdomínio de
foo.com, utilize o prefixo <em>.</em>:</p>

<pre class="ruby"><span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, :<span class="ruby-identifier">domain</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;.foo.com&#39;</span>
</pre>

<h3 id="label-Halting">Halting<span><a href="#label-Halting">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Para parar imediatamente uma requisição com um filtro ou rota utilize:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span>
</pre>

<p>Você também pode especificar o status quando parar…</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">410</span>
</pre>

<p>Ou com corpo de texto…</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-string">&#39;isso será o corpo do texto&#39;</span>
</pre>

<p>Ou também…</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">401</span>, <span class="ruby-string">&#39;vamos embora!&#39;</span>
</pre>

<p>Com cabeçalhos…</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-value">402</span>, {<span class="ruby-string">&#39;Content-Type&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;text/plain&#39;</span>}, <span class="ruby-string">&#39;revanche&#39;</span>
</pre>

<p>É obviamente possivel combinar um template com o <code>halt</code>:</p>

<pre class="ruby"><span class="ruby-identifier">halt</span> <span class="ruby-identifier">erb</span>(:<span class="ruby-identifier">error</span>)
</pre>

<h3 id="label-Passing">Passing<span><a href="#label-Passing">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Uma rota pode processar aposta para a próxima rota correspondente usando
<code>pass</code>:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/adivinhar/:quem&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">pass</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">params</span>[<span class="ruby-string">&#39;quem&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;Frank&#39;</span>
  <span class="ruby-string">&#39;Você me pegou!&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/adivinhar/*&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Você falhou!&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>O bloqueio da rota é imediatamente encerrado e o controle continua com a
próxima rota de parâmetro. Se o parâmetro da rota não for encontrado, um
404 é retornado.</p>

<h3 id="label-Desencadeando+Outra+Rota">Desencadeando Outra Rota<span><a href="#label-Desencadeando+Outra+Rota">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>As vezes o <code>pass</code> não é o que você quer, ao invés dele talvez
você queira obter o resultado chamando outra rota. Utilize o método
<code>call</code> neste caso:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/foo&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span> = <span class="ruby-identifier">call</span> <span class="ruby-identifier">env</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-string">&quot;PATH_INFO&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;/bar&#39;</span>)
  [<span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span>:<span class="ruby-identifier">upcase</span>)]
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/bar&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;bar&quot;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Note que no exemplo acima você ganharia performance ao simplemente mover o
<code>&quot;bar&quot;</code> em um helper usado por ambos <code>/foo</code>
e <code>/bar</code>.</p>

<p>Se você quer que a requisição seja enviada para a mesma instancia da
aplicação ao invês de uma duplicada, use <code>call!</code> no lugar de
<code>call</code>.</p>

<p>Veja a especificação do <a href="Rack.html">Rack</a> se você quer aprender
mais sobre o <code>call</code>.</p>

<h2 id="label-Configura-C3-A7-C3-A3o">Configuração<span><a href="#label-Configura-C3-A7-C3-A3o">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Rodando uma vez, na inicialização, em qualquer ambiente:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Rodando somente quando o ambiente (<code>RACK_ENV</code> environment
variável) é setado para <code>:production</code>:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Rodando quando o ambiente é setado para <code>:production</code> ou
<code>:test</code>:</p>

<pre class="ruby"><span class="ruby-identifier">configure</span> :<span class="ruby-identifier">production</span>, :<span class="ruby-identifier">test</span> <span class="ruby-keyword">do</span>
  <span class="ruby-operator">...</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Tratamento+de+Erros">Tratamento de Erros<span><a href="#label-Tratamento+de+Erros">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Tratamento de erros rodam dentro do mesmo contexto como rotas e filtros
before, o que significa que você pega todos os presentes que tem para
oferecer, como <code>haml</code>, <code>erb</code>, <code>halt</code>, etc.</p>

<h3 id="label-N-C3-A3o+Encontrado">Não Encontrado<span><a href="#label-N-C3-A3o+Encontrado">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>Quando um <code>Sinatra::NotFound</code> exception é levantado, ou o código
de status da reposta é 404, o manipulador <code>not_found</code> é
invocado:</p>

<pre class="ruby"><span class="ruby-identifier">not_found</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Isto está longe de ser encontrado&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<h3 id="label-Erro">Erro<span><a href="#label-Erro">&para;</a> <a href="#top">&uarr;</a></span></h3>

<p>O manipulador <code>error</code> é invocado toda a vez que uma exceção é
lançada a partir de um bloco de rota ou um filtro. O objeto da exceção pode
ser obtido a partir da variável <a href="Rack.html">Rack</a>
<code>sinatra.error</code>:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Desculpe, houve um erro desagradável - &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>].<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Erros customizados:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-constant">MeuErroCustomizado</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Então que aconteceu foi...&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>].<span class="ruby-identifier">message</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Então, se isso acontecer:</p>

<pre class="ruby"><span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">MeuErroCustomizado</span>, <span class="ruby-string">&#39;alguma coisa ruim&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Você receberá isso:</p>

<pre>Então que aconteceu foi... alguma coisa ruim</pre>

<p>Alternativamente, você pode instalar manipulador de erro para um código de
status:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-value">403</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Accesso negado&#39;</span>
<span class="ruby-keyword">end</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/secreto&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-value">403</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Ou um range:</p>

<pre class="ruby"><span class="ruby-identifier">error</span> <span class="ruby-value">400</span><span class="ruby-operator">..</span><span class="ruby-value">510</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Boom&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>O <a href="Sinatra.html">Sinatra</a> instala os manipuladores especiais
<code>not_found</code> e <code>error</code> quando roda sobre o ambiente de
desenvolvimento.</p>

<h2 id="label-Mime+Types">Mime Types<span><a href="#label-Mime+Types">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Quando utilizamos <code>send_file</code> ou arquivos estáticos você pode
ter mime types <a href="Sinatra.html">Sinatra</a> não entendidos. Use
<code>mime_type</code> para registrar eles por extensão de arquivos:</p>

<pre class="ruby"><span class="ruby-identifier">mime_type</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;text/foo&#39;</span>
</pre>

<p>Você também pode utilizar isto com o helper <code>content_type</code>:</p>

<pre class="ruby"><span class="ruby-identifier">content_type</span> :<span class="ruby-identifier">foo</span>
</pre>

<h2 id="label-Rack+Middleware"><a href="Rack.html">Rack</a> Middleware<span><a href="#label-Rack+Middleware">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>O <a href="Sinatra.html">Sinatra</a> roda no <a
href="http://rack.github.io/">Rack</a>, uma interface padrão mínima para
frameworks web em Ruby. Um das capacidades mais interessantes do <a
href="Rack.html">Rack</a> para desenvolver aplicativos é suporte a
“middleware” – componentes que ficam entre o servidor e sua aplicação
monitorando e/ou manipulando o request/response do HTTP para prover vários
tipos de funcionalidades comuns.</p>

<p>O <a href="Sinatra.html">Sinatra</a> faz construtores pipelines do
middleware <a href="Rack.html">Rack</a> facilmente em um nível superior
utilizando o método <code>use</code>:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;meu_middleware_customizado&#39;</span>

<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Lint</span>
<span class="ruby-identifier">use</span> <span class="ruby-constant">MeuMiddlewareCustomizado</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/ola&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&#39;Olá mundo&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>A semântica de <code>use</code> é idêntica aquela definida para a DSL <a
href="http://rubydoc.info/github/rack/rack/master/Rack/Builder">Rack::Builder</a>
(mais frequentemente utilizada para arquivos rackup). Por exemplo, o método
<code>use</code> aceita múltiplos argumentos/variáveis bem como blocos:</p>

<pre class="ruby"><span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Auth</span><span class="ruby-operator">::</span><span class="ruby-constant">Basic</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">usuario</span>, <span class="ruby-identifier">senha</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">usuario</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;admin&#39;</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">senha</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;secreto&#39;</span>
<span class="ruby-keyword">end</span>
</pre>

<p>O <a href="Rack.html">Rack</a> é distribuido com uma variedade de
middleware padrões para logs, debugs, rotas de URL, autenticação, e
manipuladores de sessão. <a href="Sinatra.html">Sinatra</a> utilizada
muitos desses componentes automaticamente baseando sobre configuração,
então, tipicamente você não tem <code>use</code> explicitamente.</p>

<h2 id="label-Testando">Testando<span><a href="#label-Testando">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Testes no <a href="Sinatra.html">Sinatra</a> podem ser escritos utilizando
qualquer biblioteca ou framework de teste baseados no <a
href="Rack.html">Rack</a>. <a
href="http://gitrdoc.com/brynary/rack-test">Rack::Test</a> é recomendado:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;minha_aplicacao_sinatra&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rack/test&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MinhaAplicacaoTeste</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Minitest</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span>
  <span class="ruby-identifier">include</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Test</span><span class="ruby-operator">::</span><span class="ruby-constant">Methods</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">app</span>
    <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Application</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">meu_test_default</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Ola Mundo!&#39;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">teste_com_parametros</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/atender&#39;</span>, :<span class="ruby-identifier">name</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Frank&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&#39;Olá Frank!&#39;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">bodymeet</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">test_com_ambiente_rack</span>
    <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span>, {}, <span class="ruby-string">&#39;HTTP_USER_AGENT&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;Songbird&#39;</span>
    <span class="ruby-identifier">assert_equal</span> <span class="ruby-string">&quot;Você está utilizando o Songbird!&quot;</span>, <span class="ruby-identifier">last_response</span>.<span class="ruby-identifier">body</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>NOTA: Os módulos de classe embutidos <code>Sinatra::Test</code> e
<code>Sinatra::TestHarness</code> são depreciados na versão 0.9.2.</p>

<h2 id="label-Sinatra-3A-3ABase+-+Middleware-2C+Bibliotecas+e+aplicativos+modulares">Sinatra::Base - Middleware, Bibliotecas e aplicativos modulares<span><a href="#label-Sinatra-3A-3ABase+-+Middleware-2C+Bibliotecas+e+aplicativos+modulares">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Definir sua aplicação em um nível superior de trabalho funciona bem para
micro aplicativos, mas tem consideráveis incovenientes na construção de
componentes reutilizáveis como um middleware <a href="Rack.html">Rack</a>,
metal Rails, bibliotecas simples como um componente de servidor, ou mesmo
extensões <a href="Sinatra.html">Sinatra</a>. A DSL de nível superior polui
o espaço do objeto e assume um estilo de configuração de micro aplicativos
(exemplo: uma simples arquivo de aplicação, diretórios
<code>./public</code> e <code>./views</code>, logs, página de detalhes de
exceção, etc.). É onde o <code>Sinatra::Base</code> entra em jogo:</p>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra/base&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MinhaApp</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">sessions</span>, <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">set</span> :<span class="ruby-identifier">foo</span>, <span class="ruby-string">&#39;bar&#39;</span>

  <span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">do</span>
    <span class="ruby-string">&#39;Ola mundo!&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>A classe <code>MinhaApp</code> é um componente <a href="Rack.html">Rack</a>
independente que pode agir como um middleware <a href="Rack.html">Rack</a>,
uma aplicação <a href="Rack.html">Rack</a>, ou metal Rails. Você pode
utilizar ou executar esta classe com um arquivo rackup
<code>config.ru</code>; ou, controlar um componente de servidor fornecendo
como biblioteca:</p>

<pre class="ruby"><span class="ruby-constant">MinhaApp</span>.<span class="ruby-identifier">run!</span> :<span class="ruby-identifier">host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;localhost&#39;</span>, :<span class="ruby-identifier">port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">9090</span>
</pre>

<p>Os métodos disponíveis para subclasses <code>Sinatra::Base</code> são
exatamente como aqueles disponíveis via a DSL de nível superior. Aplicações
de nível mais alto podem ser convertidas para componentes
<code>Sinatra::Base</code> com duas modificações:</p>
<ul><li>
<p>Seu arquivo deve requerer <code>sinatra/base</code> ao invés de
<code>sinatra</code>; outra coisa, todos os métodos DSL do <a
href="Sinatra.html">Sinatra</a> são importados para o espaço principal.</p>
</li><li>
<p>Coloque as rotas da sua aplicação, manipuladores de erro, filtros e opções
na subclasse de um <code>Sinatra::Base</code>.</p>
</li></ul>

<p><code>Sinatra::Base</code> é um quadro branco. Muitas opções são
desabilitadas por padrão, incluindo o servidor embutido. Veja <a
href="http://sinatra.github.com/configuration.html">Opções e
Configurações</a> para detalhes de opções disponíveis e seus
comportamentos.</p>

<p>SIDEBAR: A DSL de alto nível do <a href="Sinatra.html">Sinatra</a> é
implementada utilizando um simples sistema de delegação. A classe
<code>Sinatra::Application</code> – uma subclasse especial da
<code>Sinatra::Base</code> – recebe todos os <code>:get</code>,
<code>:put</code>, <code>:post</code>, <code>:delete</code>,
<code>:before</code>, <code>:error</code>, <code>:not_found</code>,
<code>:configure</code>, e <code>:set messages</code> enviados para o alto
nível. Dê uma olhada no código você mesmo: aqui está o <a
href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/base.rb#L1128">Sinatra::Delegator
mixin</a> sendo <a
href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/main.rb#L28">incluido
dentro de um espaço principal</a></p>

<h2 id="label-Linha+de+Comando">Linha de Comando<span><a href="#label-Linha+de+Comando">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Aplicações <a href="Sinatra.html">Sinatra</a> podem ser executadas
diretamente:</p>

<pre>ruby minhaapp.rb [-h] [-x] [-e AMBIENTE] [-p PORTA] [-o HOST] [-s SERVIDOR]</pre>

<p>As opções são:</p>

<pre class="ruby"><span class="ruby-operator">-</span><span class="ruby-identifier">h</span> <span class="ruby-comment"># ajuda</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">p</span> <span class="ruby-comment"># define a porta (padrão é 4567)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">o</span> <span class="ruby-comment"># define o host (padrão é 0.0.0.0)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">e</span> <span class="ruby-comment"># define o ambiente (padrão é development)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">s</span> <span class="ruby-comment"># especifica o servidor/manipulador rack (padrão é thin)</span>
<span class="ruby-operator">-</span><span class="ruby-identifier">x</span> <span class="ruby-comment"># ativa o bloqueio (padrão é desligado)</span>
</pre>

<h2 id="label-A+-C3-BAltima+vers-C3-A3o">A última versão<span><a href="#label-A+-C3-BAltima+vers-C3-A3o">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>Se você gostaria de utilizar o código da última versão do <a
href="Sinatra.html">Sinatra</a>, crie um clone local e execute sua
aplicação com o diretório <code>sinatra/lib</code> no
<code>LOAD_PATH</code>:</p>

<pre>cd minhaapp
git clone git://github.com/sinatra/sinatra.git
ruby -I sinatra/lib minhaapp.rb</pre>

<p>Alternativamente, você pode adicionar o diretório do
<code>sinatra/lib</code> no <code>LOAD_PATH</code> do seu aplicativo:</p>

<pre class="ruby"><span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">unshift</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&#39;/sinatra/lib&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems&#39;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&#39;sinatra&#39;</span>

<span class="ruby-identifier">get</span> <span class="ruby-string">&#39;/sobre&#39;</span> <span class="ruby-keyword">do</span>
  <span class="ruby-string">&quot;Estou rodando a versão&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>
<span class="ruby-keyword">end</span>
</pre>

<p>Para atualizar o código do <a href="Sinatra.html">Sinatra</a> no futuro:</p>

<pre class="ruby"><span class="ruby-identifier">cd</span> <span class="ruby-identifier">meuprojeto</span><span class="ruby-operator">/</span><span class="ruby-identifier">sinatra</span>
<span class="ruby-identifier">git</span> <span class="ruby-identifier">pull</span>
</pre>

<h2 id="label-Mais">Mais<span><a href="#label-Mais">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ul><li>
<p><a href="http://www.sinatrarb.com/">Website do Projeto</a> - Documentação
adicional, novidades e links para outros recursos.</p>
</li><li>
<p><a href="http://www.sinatrarb.com/contributing">Contribuir</a> - Encontrar
um bug? Precisa de ajuda? Tem um patch?</p>
</li><li>
<p><a href="http://github.com/sinatra/sinatra/issues">Acompanhar Questões</a></p>
</li><li>
<p><a href="http://twitter.com/sinatra">Twitter</a></p>
</li><li>
<p><a href="http://groups.google.com/group/sinatrarb/topics">Lista de
Email</a></p>
</li><li>
<p><a href="https://github.com/sinatra/sinatra-book/">Sinatra Book</a> Livro
de Receitas</p>
</li><li>
<p>Documentação da API para a <a
href="http://rubydoc.info/gems/sinatra">última release</a></p>
</li><li>
<p><a href="irc://chat.freenode.net/#sinatra"> #sinatra</a> em <a
href="http://freenode.net">freenode.net</a></p>
</li><li>
<p><a href="http://travis-ci.org/sinatra/sinatra">Servidor de CI</a></p>
</li></ul>
</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

