<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Sinatra::Helpers::Stream::Base - Sinatra</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../../";
</script>

<script src="../../../js/jquery.js"></script>
<script src="../../../js/darkfish.js"></script>

<link href="../../../css/fonts.css" rel="stylesheet">
<link href="../../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../../table_of_contents.html#pages">Pages</a>
    <a href="../../../table_of_contents.html#classes">Classes</a>
    <a href="../../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">Rack::Utils</span>
  
  
  
    <li><a class="include" href="../../Helpers.html">Sinatra::Helpers</a>
  
  
  
    <li><a class="include" href="Templates.html">Sinatra::Helpers::Stream::Templates</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-add_filter">::add_filter</a>
    
    <li ><a href="#method-c-after">::after</a>
    
    <li ><a href="#method-c-agent">::agent</a>
    
    <li ><a href="#method-c-before">::before</a>
    
    <li ><a href="#method-c-build">::build</a>
    
    <li ><a href="#method-c-call">::call</a>
    
    <li ><a href="#method-c-caller_files">::caller_files</a>
    
    <li ><a href="#method-c-caller_locations">::caller_locations</a>
    
    <li ><a href="#method-c-cleaned_caller">::cleaned_caller</a>
    
    <li ><a href="#method-c-compile">::compile</a>
    
    <li ><a href="#method-c-compile-21">::compile!</a>
    
    <li ><a href="#method-c-condition">::condition</a>
    
    <li ><a href="#method-c-configure">::configure</a>
    
    <li ><a href="#method-c-define_singleton">::define_singleton</a>
    
    <li ><a href="#method-c-delete">::delete</a>
    
    <li ><a href="#method-c-detect_rack_handler">::detect_rack_handler</a>
    
    <li ><a href="#method-c-development-3F">::development?</a>
    
    <li ><a href="#method-c-disable">::disable</a>
    
    <li ><a href="#method-c-enable">::enable</a>
    
    <li ><a href="#method-c-encoded">::encoded</a>
    
    <li ><a href="#method-c-error">::error</a>
    
    <li ><a href="#method-c-escaped">::escaped</a>
    
    <li ><a href="#method-c-extensions">::extensions</a>
    
    <li ><a href="#method-c-force_encoding">::force_encoding</a>
    
    <li ><a href="#method-c-generate_method">::generate_method</a>
    
    <li ><a href="#method-c-get">::get</a>
    
    <li ><a href="#method-c-head">::head</a>
    
    <li ><a href="#method-c-helpers">::helpers</a>
    
    <li ><a href="#method-c-host_name">::host_name</a>
    
    <li class="calls-super" ><a href="#method-c-inherited">::inherited</a>
    
    <li ><a href="#method-c-inline_templates-3D">::inline_templates=</a>
    
    <li ><a href="#method-c-invoke_hook">::invoke_hook</a>
    
    <li ><a href="#method-c-layout">::layout</a>
    
    <li ><a href="#method-c-link">::link</a>
    
    <li ><a href="#method-c-middleware">::middleware</a>
    
    <li ><a href="#method-c-mime_type">::mime_type</a>
    
    <li ><a href="#method-c-mime_types">::mime_types</a>
    
    <li ><a href="#method-c-new">::new</a>
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-new-21">::new!</a>
    
    <li ><a href="#method-c-not_found">::not_found</a>
    
    <li ><a href="#method-c-options">::options</a>
    
    <li ><a href="#method-c-patch">::patch</a>
    
    <li ><a href="#method-c-post">::post</a>
    
    <li ><a href="#method-c-production-3F">::production?</a>
    
    <li ><a href="#method-c-prototype">::prototype</a>
    
    <li ><a href="#method-c-provides">::provides</a>
    
    <li ><a href="#method-c-public-3D">::public=</a>
    
    <li ><a href="#method-c-public_dir">::public_dir</a>
    
    <li ><a href="#method-c-public_dir-3D">::public_dir=</a>
    
    <li ><a href="#method-c-put">::put</a>
    
    <li ><a href="#method-c-quit-21">::quit!</a>
    
    <li ><a href="#method-c-register">::register</a>
    
    <li ><a href="#method-c-reset-21">::reset!</a>
    
    <li ><a href="#method-c-route">::route</a>
    
    <li ><a href="#method-c-run-21">::run!</a>
    
    <li ><a href="#method-c-running-3F">::running?</a>
    
    <li ><a href="#method-c-safe_ignore">::safe_ignore</a>
    
    <li ><a href="#method-c-set">::set</a>
    
    <li ><a href="#method-c-settings">::settings</a>
    
    <li ><a href="#method-c-setup_common_logger">::setup_common_logger</a>
    
    <li ><a href="#method-c-setup_custom_logger">::setup_custom_logger</a>
    
    <li ><a href="#method-c-setup_default_middleware">::setup_default_middleware</a>
    
    <li ><a href="#method-c-setup_logging">::setup_logging</a>
    
    <li ><a href="#method-c-setup_middleware">::setup_middleware</a>
    
    <li ><a href="#method-c-setup_null_logger">::setup_null_logger</a>
    
    <li ><a href="#method-c-setup_protection">::setup_protection</a>
    
    <li ><a href="#method-c-setup_sessions">::setup_sessions</a>
    
    <li ><a href="#method-c-setup_traps">::setup_traps</a>
    
    <li ><a href="#method-c-start-21">::start!</a>
    
    <li ><a href="#method-c-start_server">::start_server</a>
    
    <li ><a href="#method-c-stop-21">::stop!</a>
    
    <li ><a href="#method-c-synchronize">::synchronize</a>
    
    <li ><a href="#method-c-template">::template</a>
    
    <li ><a href="#method-c-test-3F">::test?</a>
    
    <li ><a href="#method-c-unlink">::unlink</a>
    
    <li ><a href="#method-c-use">::use</a>
    
    <li ><a href="#method-c-user_agent">::user_agent</a>
    
    <li class="calls-super" ><a href="#method-c-warn">::warn</a>
    
    <li ><a href="#method-i-call">#call</a>
    
    <li ><a href="#method-i-dispatch-21">#dispatch!</a>
    
    <li ><a href="#method-i-dump_errors-21">#dump_errors!</a>
    
    <li ><a href="#method-i-error_block-21">#error_block!</a>
    
    <li ><a href="#method-i-filter-21">#filter!</a>
    
    <li ><a href="#method-i-force_encoding">#force_encoding</a>
    
    <li ><a href="#method-i-forward">#forward</a>
    
    <li ><a href="#method-i-halt">#halt</a>
    
    <li ><a href="#method-i-handle_exception-21">#handle_exception!</a>
    
    <li ><a href="#method-i-indifferent_hash">#indifferent_hash</a>
    
    <li ><a href="#method-i-indifferent_params">#indifferent_params</a>
    
    <li ><a href="#method-i-invoke">#invoke</a>
    
    <li ><a href="#method-i-options">#options</a>
    
    <li ><a href="#method-i-pass">#pass</a>
    
    <li ><a href="#method-i-process_route">#process_route</a>
    
    <li ><a href="#method-i-route-21">#route!</a>
    
    <li ><a href="#method-i-route_eval">#route_eval</a>
    
    <li ><a href="#method-i-route_missing">#route_missing</a>
    
    <li ><a href="#method-i-settings">#settings</a>
    
    <li ><a href="#method-i-static-21">#static!</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Sinatra::Helpers::Stream::Base">
  <h1 id="class-Sinatra::Helpers::Stream::Base" class="class">
    class Sinatra::Helpers::Stream::Base
  </h1>

  <section class="description">
    
<p><a href="Base.html">Base</a> class for all <a
href="../../../Sinatra.html">Sinatra</a> applications and middleware.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="URI_INSTANCE">URI_INSTANCE
        
        <dd>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-c-errors" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">errors</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-c-filters" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">filters</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-c-routes" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">routes</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-c-templates" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">templates</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-app" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">app</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-env" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">env</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-params" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">params</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-request" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">request</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-response" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">response</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-template_cache" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">template_cache</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(app = nil) { |self| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              <a href="Templates.html#method-c-new">Sinatra::Helpers::Stream::Templates.new</a>
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 885</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">app</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">super</span>()
  <span class="ruby-ivar">@app</span> = <span class="ruby-identifier">app</span>
  <span class="ruby-ivar">@template_cache</span> = <span class="ruby-constant">Tilt</span><span class="ruby-operator">::</span><span class="ruby-constant">Cache</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-keyword">self</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Base.html#method-c-new-21">new!</a>
        </div>
        

        
      </div>

    
      <div id="method-c-settings" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">settings</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Access settings defined with <a href="Base.html#method-c-set">::set</a>.</p>
          
          

          
          <div class="method-source-code" id="settings-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 921</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">settings</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Class Methods</h3>
       </header>

    
      <div id="method-c-add_filter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_filter</span><span
            class="method-args">(type, path = nil, options = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>add a filter</p>
          
          

          
          <div class="method-source-code" id="add_filter-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1342</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_filter</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">path</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = <span class="ruby-regexp">//</span>, <span class="ruby-identifier">path</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:each_pair</span>)
  <span class="ruby-identifier">filters</span>[<span class="ruby-identifier">type</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">compile!</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">path</span> <span class="ruby-operator">||</span> <span class="ruby-regexp">//</span>, <span class="ruby-identifier">block</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-after" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">after</span><span
            class="method-args">(path = nil, options = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define an after filter; runs after all requests within the same context as
route handlers and may access/modify the request and response.</p>
          
          

          
          <div class="method-source-code" id="after-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1337</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">after</span>(<span class="ruby-identifier">path</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">add_filter</span>(<span class="ruby-value">:after</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-agent" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">agent</span><span
            class="method-args">(pattern)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Base.html#method-c-user_agent">user_agent</a>
        </div>
        
      </div>

    
      <div id="method-c-before" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">before</span><span
            class="method-args">(path = nil, options = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define a before filter; runs before all requests within the same context as
route handlers and may access/modify the request and response.</p>
          
          

          
          <div class="method-source-code" id="before-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1330</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">before</span>(<span class="ruby-identifier">path</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">add_filter</span>(<span class="ruby-value">:before</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-build" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build</span><span
            class="method-args">(app)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a <a href="../../../Rack/Builder.html">Rack::Builder</a> instance
with all the middleware set up and the given <code>app</code> as end point.</p>
          
          

          
          <div class="method-source-code" id="build-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1477</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build</span>(<span class="ruby-identifier">app</span>)
  <span class="ruby-identifier">builder</span> = <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Builder</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">setup_default_middleware</span> <span class="ruby-identifier">builder</span>
  <span class="ruby-identifier">setup_middleware</span> <span class="ruby-identifier">builder</span>
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">run</span> <span class="ruby-identifier">app</span>
  <span class="ruby-identifier">builder</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="call-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1485</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">synchronize</span> { <span class="ruby-identifier">prototype</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-caller_files" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">caller_files</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Like Kernel#caller but excluding certain magic entries and without line /
method information; the resulting array contains filenames only.</p>
          
          

          
          <div class="method-source-code" id="caller_files-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1491</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">caller_files</span>
  <span class="ruby-identifier">cleaned_caller</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">flatten</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-caller_locations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">caller_locations</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Like <a href="Base.html#method-c-caller_files">::caller_files</a>, but
containing Arrays rather than strings with the first element being the
file, and the second being the line.</p>
          
          

          
          <div class="method-source-code" id="caller_locations-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1497</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">caller_locations</span>
  <span class="ruby-identifier">cleaned_caller</span> <span class="ruby-value">2</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-cleaned_caller" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cleaned_caller</span><span
            class="method-args">(keep = 3)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Like Kernel#caller but excluding certain magic entries</p>
          
          

          
          <div class="method-source-code" id="cleaned_caller-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1805</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cleaned_caller</span>(<span class="ruby-identifier">keep</span> = <span class="ruby-value">3</span>)
  <span class="ruby-identifier">caller</span>(<span class="ruby-value">1</span>).
    <span class="ruby-identifier">map!</span>    { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/:(?=\d|in )/</span>, <span class="ruby-value">3</span>)[<span class="ruby-value">0</span>,<span class="ruby-identifier">keep</span>] }.
    <span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">file</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-constant">CALLERS_TO_IGNORE</span>.<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">pattern</span> } }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-compile" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">compile</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="compile-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1616</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">compile</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:to_str</span>
    <span class="ruby-identifier">keys</span> = []

    <span class="ruby-comment"># We append a / at the end if there was one.</span>
    <span class="ruby-comment"># Reason: Splitting does not split off an empty</span>
    <span class="ruby-comment"># string at the end if the split separator</span>
    <span class="ruby-comment"># is at the end.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">postfix</span> = <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\/\z/</span>

    <span class="ruby-comment"># Split the path into pieces in between forward slashes.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-identifier">segments</span> = <span class="ruby-identifier">path</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;/&#39;</span>).<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">segment</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">ignore</span> = []

      <span class="ruby-comment"># Special character handling.</span>
      <span class="ruby-comment">#</span>
      <span class="ruby-identifier">pattern</span> = <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">to_str</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/[^\?\%\\/\:\*\w]/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">ignore</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">escaped</span>(<span class="ruby-identifier">c</span>).<span class="ruby-identifier">join</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/[\.@]/</span>)
        <span class="ruby-identifier">patt</span> = <span class="ruby-identifier">encoded</span>(<span class="ruby-identifier">c</span>)
        <span class="ruby-identifier">patt</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/%[\da-fA-F]{2}/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">match</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>).<span class="ruby-identifier">map!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">char</span><span class="ruby-operator">|</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[A-Z]/</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;[#{char}#{char.tr(&#39;A-Z&#39;, &#39;a-z&#39;)}]&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">char</span>}.<span class="ruby-identifier">join</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">ignore</span> = <span class="ruby-identifier">ignore</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">join</span>

      <span class="ruby-comment"># Key handling.</span>
      <span class="ruby-comment">#</span>
      <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/((:\w+)|\*)/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">match</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">match</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;*&quot;</span>
          <span class="ruby-identifier">keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;splat&#39;</span>
          <span class="ruby-string">&quot;(.*?)&quot;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">keys</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">$2</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
          <span class="ruby-identifier">ignore_pattern</span> = <span class="ruby-identifier">safe_ignore</span>(<span class="ruby-identifier">ignore</span>)

          <span class="ruby-identifier">ignore_pattern</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># Special case handling.</span>
    <span class="ruby-comment">#</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">segment</span> = <span class="ruby-identifier">segments</span>.<span class="ruby-identifier">pop</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/\[\^\\./</span>)
        <span class="ruby-identifier">parts</span> = <span class="ruby-identifier">segment</span>.<span class="ruby-identifier">rpartition</span>(<span class="ruby-regexp">/\[\^\\./</span>)
        <span class="ruby-identifier">parts</span>[<span class="ruby-value">1</span>] = <span class="ruby-string">&#39;[^&#39;</span>
        <span class="ruby-identifier">segments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">parts</span>.<span class="ruby-identifier">join</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">segments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">segment</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
    [<span class="ruby-node">/\A#{segments.join(&#39;/&#39;)}#{postfix}\z/</span>, <span class="ruby-identifier">keys</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:keys</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:match</span>)
    [<span class="ruby-identifier">path</span>, <span class="ruby-identifier">path</span>.<span class="ruby-identifier">keys</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:names</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:match</span>)
    [<span class="ruby-identifier">path</span>, <span class="ruby-identifier">path</span>.<span class="ruby-identifier">names</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:match</span>
    [<span class="ruby-identifier">path</span>, []]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-identifier">path</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-compile-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">compile!</span><span
            class="method-args">(verb, path, block, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="compile-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1601</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">compile!</span>(<span class="ruby-identifier">verb</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">block</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">option</span>, <span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">option</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) }
  <span class="ruby-identifier">method_name</span>             = <span class="ruby-node">&quot;#{verb} #{path}&quot;</span>
  <span class="ruby-identifier">unbound_method</span>          = <span class="ruby-identifier">generate_method</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">keys</span>           = <span class="ruby-identifier">compile</span> <span class="ruby-identifier">path</span>
  <span class="ruby-identifier">conditions</span>, <span class="ruby-ivar">@conditions</span> = <span class="ruby-ivar">@conditions</span>, []

  <span class="ruby-identifier">wrapper</span>                 = <span class="ruby-identifier">block</span>.<span class="ruby-identifier">arity</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span>
    <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">unbound_method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">a</span>).<span class="ruby-identifier">call</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">p</span>) } <span class="ruby-operator">:</span>
    <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>,<span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">unbound_method</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-identifier">a</span>).<span class="ruby-identifier">call</span> }
  <span class="ruby-identifier">wrapper</span>.<span class="ruby-identifier">instance_variable_set</span>(<span class="ruby-value">:@route_name</span>, <span class="ruby-identifier">method_name</span>)

  [ <span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">keys</span>, <span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">wrapper</span> ]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-condition" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">condition</span><span
            class="method-args">(name = "</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add a route condition. The route is considered non-matching when the block
returns false.</p>
          
          

          
          <div class="method-source-code" id="condition-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1349</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">condition</span>(<span class="ruby-identifier">name</span> = <span class="ruby-node">&quot;#{caller.first[/`.*&#39;/]} condition&quot;</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-ivar">@conditions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">generate_method</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-configure" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">configure</span><span
            class="method-args">(*envs) { |self| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Set configuration options for <a href="../../../Sinatra.html">Sinatra</a>
and/or the app. Allows scoping of settings for certain environments.</p>
          
          

          
          <div class="method-source-code" id="configure-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1409</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">configure</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">envs</span>)
  <span class="ruby-keyword">yield</span> <span class="ruby-keyword">self</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">envs</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">envs</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">environment</span>.<span class="ruby-identifier">to_sym</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-define_singleton" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">define_singleton</span><span
            class="method-args">(name, content = Proc.new)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Dynamically defines a method on settings.</p>
          
          

          
          <div class="method-source-code" id="define_singleton-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1535</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">define_singleton</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">content</span> = <span class="ruby-constant">Proc</span>.<span class="ruby-identifier">new</span>)
  <span class="ruby-comment"># replace with call to singleton_class once we&#39;re 1.9 only</span>
  (<span class="ruby-keyword">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword">self</span>; <span class="ruby-keyword">self</span>; <span class="ruby-keyword">end</span>).<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">undef_method</span>(<span class="ruby-identifier">name</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">method_defined?</span> <span class="ruby-identifier">name</span>
    <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">content</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">class_eval</span>(<span class="ruby-node">&quot;def #{name}() #{content}; end&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">content</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-delete" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delete</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="delete-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1378</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delete</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)  <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;DELETE&#39;</span>,  <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-detect_rack_handler" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">detect_rack_handler</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="detect_rack_handler-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1773</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">detect_rack_handler</span>
  <span class="ruby-identifier">servers</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">server</span>)
  <span class="ruby-identifier">servers</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server_name</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Handler</span>.<span class="ruby-identifier">get</span>(<span class="ruby-identifier">server_name</span>.<span class="ruby-identifier">to_s</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span>, <span class="ruby-constant">NameError</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">fail</span> <span class="ruby-node">&quot;Server handler (#{servers.join(&#39;,&#39;)}) not found.&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-development-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">development?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="development-3F-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1403</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">development?</span>; <span class="ruby-identifier">environment</span> <span class="ruby-operator">==</span> <span class="ruby-value">:development</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-disable" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">disable</span><span
            class="method-args">(*opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Same as calling `set :option, false` for each of the given options.</p>
          
          

          
          <div class="method-source-code" id="disable-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">disable</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">opts</span>)
  <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">key</span>, <span class="ruby-keyword">false</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-enable" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">enable</span><span
            class="method-args">(*opts)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Same as calling `set :option, true` for each of the given options.</p>
          
          

          
          <div class="method-source-code" id="enable-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">enable</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">opts</span>)
  <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">key</span>, <span class="ruby-keyword">true</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-encoded" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">encoded</span><span
            class="method-args">(char)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="encoded-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1682</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">encoded</span>(<span class="ruby-identifier">char</span>)
  <span class="ruby-identifier">enc</span> = <span class="ruby-constant">URI_INSTANCE</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">char</span>)
  <span class="ruby-identifier">enc</span> = <span class="ruby-node">&quot;(?:#{escaped(char, enc).join(&#39;|&#39;)})&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">enc</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">char</span>
  <span class="ruby-identifier">enc</span> = <span class="ruby-node">&quot;(?:#{enc}|#{encoded(&#39;+&#39;)})&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot; &quot;</span>
  <span class="ruby-identifier">enc</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-error" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">error</span><span
            class="method-args">(*codes, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define a custom error handler. Optionally takes either an Exception class,
or an HTTP status code to specify which errors should be handled.</p>
          
          

          
          <div class="method-source-code" id="error-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1253</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">error</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">codes</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">args</span>  = <span class="ruby-identifier">compile!</span> <span class="ruby-string">&quot;ERROR&quot;</span>, <span class="ruby-regexp">//</span>, <span class="ruby-identifier">block</span>
  <span class="ruby-identifier">codes</span> = <span class="ruby-identifier">codes</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">c</span>) }.<span class="ruby-identifier">flatten</span>
  <span class="ruby-identifier">codes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Exception</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">codes</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">codes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> (<span class="ruby-ivar">@errors</span>[<span class="ruby-identifier">c</span>] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">args</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-escaped" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">escaped</span><span
            class="method-args">(char, enc = URI_INSTANCE.escape(char))</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="escaped-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1689</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">escaped</span>(<span class="ruby-identifier">char</span>, <span class="ruby-identifier">enc</span> = <span class="ruby-constant">URI_INSTANCE</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">char</span>))
  [<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">enc</span>), <span class="ruby-constant">URI_INSTANCE</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">char</span>, <span class="ruby-regexp">/./</span>)]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-extensions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extensions</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Extension modules registered on this class and all superclasses.</p>
          
          

          
          <div class="method-source-code" id="extensions-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1186</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">extensions</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:extensions</span>)
    (<span class="ruby-ivar">@extensions</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">extensions</span>).<span class="ruby-identifier">uniq</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@extensions</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-force_encoding" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">force_encoding</span><span
            class="method-args">(data, encoding = default_encoding)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="force_encoding-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1820</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">default_encoding</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">settings</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Tempfile</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:force_encoding</span>
    <span class="ruby-identifier">data</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">encoding</span>).<span class="ruby-identifier">encode!</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:each_value</span>
    <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each_value</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">encoding</span>) }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">data</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:each</span>
    <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">force_encoding</span>(<span class="ruby-identifier">v</span>, <span class="ruby-identifier">encoding</span>) }
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-generate_method" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">generate_method</span><span
            class="method-args">(method_name, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="generate_method-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1593</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">generate_method</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">method_name</span> = <span class="ruby-identifier">method_name</span>.<span class="ruby-identifier">to_sym</span>
  <span class="ruby-identifier">define_method</span>(<span class="ruby-identifier">method_name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">method</span> = <span class="ruby-identifier">instance_method</span> <span class="ruby-identifier">method_name</span>
  <span class="ruby-identifier">remove_method</span> <span class="ruby-identifier">method_name</span>
  <span class="ruby-identifier">method</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-get" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get</span><span
            class="method-args">(path, opts = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Defining a `GET` handler also automatically defines a `HEAD` handler.</p>
          
          

          
          <div class="method-source-code" id="get-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1368</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">conditions</span> = <span class="ruby-ivar">@conditions</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">route</span>(<span class="ruby-string">&#39;GET&#39;</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)

  <span class="ruby-ivar">@conditions</span> = <span class="ruby-identifier">conditions</span>
  <span class="ruby-identifier">route</span>(<span class="ruby-string">&#39;HEAD&#39;</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-head" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">head</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="head-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1379</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">head</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)    <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;HEAD&#39;</span>,    <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-helpers" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">helpers</span><span
            class="method-args">(*extensions, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Makes the methods defined in the block and in the Modules given in
`extensions` available to the handlers and templates</p>
          
          

          
          <div class="method-source-code" id="helpers-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1387</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">helpers</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">extensions</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">class_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)   <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-identifier">include</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">extensions</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">extensions</span>.<span class="ruby-identifier">any?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-host_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">host_name</span><span
            class="method-args">(pattern)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Condition for matching host name. Parameter might be String or Regexp.</p>
          
          

          
          <div class="method-source-code" id="host_name-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1544</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">host_name</span>(<span class="ruby-identifier">pattern</span>)
  <span class="ruby-identifier">condition</span> { <span class="ruby-identifier">pattern</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">host</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-inherited" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inherited</span><span
            class="method-args">(subclass)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="inherited-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1784</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inherited</span>(<span class="ruby-identifier">subclass</span>)
  <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">reset!</span>
  <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">set</span> <span class="ruby-value">:app_file</span>, <span class="ruby-identifier">caller_files</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">subclass</span>.<span class="ruby-identifier">app_file?</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-inline_templates-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">inline_templates=</span><span
            class="method-args">(file = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Load embedded templates from the file; uses the caller&#39;s __FILE__ when
no file is specified.</p>
          
          

          
          <div class="method-source-code" id="inline_templates-3D-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1279</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inline_templates=</span>(<span class="ruby-identifier">file</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">file</span> = (<span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">true</span>) <span class="ruby-operator">?</span> (<span class="ruby-identifier">caller_files</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">$0</span>)) <span class="ruby-operator">:</span> <span class="ruby-identifier">file</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">io</span> = <span class="ruby-operator">::</span><span class="ruby-constant">IO</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:binread</span>) <span class="ruby-operator">?</span> <span class="ruby-operator">::</span><span class="ruby-constant">IO</span>.<span class="ruby-identifier">binread</span>(<span class="ruby-identifier">file</span>) <span class="ruby-operator">:</span> <span class="ruby-operator">::</span><span class="ruby-constant">IO</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">file</span>)
    <span class="ruby-identifier">app</span>, <span class="ruby-identifier">data</span> = <span class="ruby-identifier">io</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&quot;\r\n&quot;</span>, <span class="ruby-string">&quot;\n&quot;</span>).<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/^__END__$/</span>, <span class="ruby-value">2</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
    <span class="ruby-identifier">app</span>, <span class="ruby-identifier">data</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">data</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">app</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">app</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/([^\n]*\n)?#[^\n]*coding: *(\S+)/m</span>
      <span class="ruby-identifier">encoding</span> = <span class="ruby-node">$2</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">encoding</span> = <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">default_encoding</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">app</span>.<span class="ruby-identifier">count</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
    <span class="ruby-identifier">template</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">force_encoding</span> <span class="ruby-identifier">data</span>, <span class="ruby-identifier">encoding</span>
    <span class="ruby-identifier">data</span>.<span class="ruby-identifier">each_line</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">lines</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^@@\s*(.*\S)\s*$/</span>
        <span class="ruby-identifier">template</span> = <span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&#39;&#39;</span>, <span class="ruby-identifier">encoding</span>)
        <span class="ruby-identifier">templates</span>[<span class="ruby-node">$1</span>.<span class="ruby-identifier">to_sym</span>] = [<span class="ruby-identifier">template</span>, <span class="ruby-identifier">file</span>, <span class="ruby-identifier">lines</span>]
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">template</span>
        <span class="ruby-identifier">template</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">line</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-invoke_hook" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invoke_hook</span><span
            class="method-args">(name, *args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="invoke_hook-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1589</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invoke_hook</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">extensions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">e</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">name</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-layout" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">layout</span><span
            class="method-args">(name = :layout, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define the layout template. The block must return the template source.</p>
          
          

          
          <div class="method-source-code" id="layout-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1273</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">layout</span>(<span class="ruby-identifier">name</span> = <span class="ruby-value">:layout</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">template</span> <span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-link" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">link</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="link-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1382</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">link</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)    <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;LINK&#39;</span>,    <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-middleware" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">middleware</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Middleware used in this class and all superclasses.</p>
          
          

          
          <div class="method-source-code" id="middleware-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1195</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">middleware</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:middleware</span>)
    <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">middleware</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@middleware</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@middleware</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-mime_type" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mime_type</span><span
            class="method-args">(type, value = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Lookup or register a mime type in Rack&#39;s mime registry.</p>
          
          

          
          <div class="method-source-code" id="mime_type-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1311</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mime_type</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">value</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">type</span>      <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;/&#39;</span>)
  <span class="ruby-identifier">type</span> = <span class="ruby-node">&quot;.#{type}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-value">?.</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Mime</span>.<span class="ruby-identifier">mime_type</span>(<span class="ruby-identifier">type</span>, <span class="ruby-keyword">nil</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">value</span>
  <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Mime</span><span class="ruby-operator">::</span><span class="ruby-constant">MIME_TYPES</span>[<span class="ruby-identifier">type</span>] = <span class="ruby-identifier">value</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-mime_types" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mime_types</span><span
            class="method-args">(type)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>provides all mime types matching type, including deprecated types:</p>

<pre class="ruby"><span class="ruby-identifier">mime_types</span> :<span class="ruby-identifier">html</span> <span class="ruby-comment"># =&gt; [&#39;text/html&#39;]</span>
<span class="ruby-identifier">mime_types</span> :<span class="ruby-identifier">js</span>   <span class="ruby-comment"># =&gt; [&#39;application/javascript&#39;, &#39;text/javascript&#39;]</span>
</pre>
          
          

          
          <div class="method-source-code" id="mime_types-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1322</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mime_types</span>(<span class="ruby-identifier">type</span>)
  <span class="ruby-identifier">type</span> = <span class="ruby-identifier">mime_type</span> <span class="ruby-identifier">type</span>
  <span class="ruby-identifier">type</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^application\/(xml|javascript)$/</span> <span class="ruby-operator">?</span> [<span class="ruby-identifier">type</span>, <span class="ruby-node">&quot;text/#$1&quot;</span>] <span class="ruby-operator">:</span> [<span class="ruby-identifier">type</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(*args, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create a new instance of the class fronted by its middleware pipeline. The
object is guaranteed to respond to <a
href="Base.html#method-i-call">call</a> but may not be an instance of the
class new was called on.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1470</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)
  <span class="ruby-identifier">instance</span> = <span class="ruby-identifier">new!</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)
  <span class="ruby-constant">Wrapper</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">build</span>(<span class="ruby-identifier">instance</span>).<span class="ruby-identifier">to_app</span>, <span class="ruby-identifier">instance</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new-21" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">new!</span><span
            class="method-args">(app = nil)</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Create a new instance without middleware in front of it.</p>
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Base.html#method-c-new">new</a>
        </div>
        
      </div>

    
      <div id="method-c-not_found" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">not_found</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sugar for `error(404) { … }`</p>
          
          

          
          <div class="method-source-code" id="not_found-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1261</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">not_found</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">error</span>(<span class="ruby-value">404</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">error</span>(<span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">NotFound</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">options</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="options-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1380</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">options</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>) <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;OPTIONS&#39;</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-patch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">patch</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="patch-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1381</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">patch</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)   <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;PATCH&#39;</span>,   <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-post" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">post</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="post-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1377</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">post</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)    <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;POST&#39;</span>,    <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-production-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">production?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="production-3F-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1404</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">production?</span>;  <span class="ruby-identifier">environment</span> <span class="ruby-operator">==</span> <span class="ruby-value">:production</span>  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-prototype" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">prototype</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The prototype instance used to process requests.</p>
          
          

          
          <div class="method-source-code" id="prototype-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1460</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prototype</span>
  <span class="ruby-ivar">@prototype</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-provides" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">provides</span><span
            class="method-args">(*types)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Condition for matching mimetypes. Accepts file extensions.</p>
          
          

          
          <div class="method-source-code" id="provides-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1563</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">provides</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">types</span>)
  <span class="ruby-identifier">types</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">mime_types</span>(<span class="ruby-identifier">t</span>) }
  <span class="ruby-identifier">types</span>.<span class="ruby-identifier">flatten!</span>
  <span class="ruby-identifier">condition</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> = <span class="ruby-identifier">response</span>[<span class="ruby-string">&#39;Content-Type&#39;</span>]
      <span class="ruby-identifier">types</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">type</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">types</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">type</span>[<span class="ruby-regexp">/^[^;]+/</span>]
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">type</span> = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">preferred_type</span>(<span class="ruby-identifier">types</span>)
      <span class="ruby-identifier">params</span> = (<span class="ruby-identifier">type</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:params</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">params</span> <span class="ruby-operator">:</span> {})
      <span class="ruby-identifier">content_type</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">params</span>)
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-public-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">public=</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="public-3D-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1353</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">public=</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;:public is no longer used to avoid overloading Module#public, use :public_folder or :public_dir instead&quot;</span>
  <span class="ruby-identifier">set</span>(<span class="ruby-value">:public_folder</span>, <span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-public_dir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">public_dir</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="public_dir-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1362</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">public_dir</span>
  <span class="ruby-identifier">public_folder</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-public_dir-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">public_dir=</span><span
            class="method-args">(value)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="public_dir-3D-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1358</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">public_dir=</span>(<span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">public_folder</span> = <span class="ruby-identifier">value</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-put" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">put</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="put-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1376</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">put</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)     <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;PUT&#39;</span>,     <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-quit-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quit!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Stop the self-hosted server if running.</p>
          
          

          
          <div class="method-source-code" id="quit-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1420</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quit!</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">running?</span>
  <span class="ruby-comment"># Use Thin&#39;s hard #stop! if available, otherwise just #stop.</span>
  <span class="ruby-identifier">running_server</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:stop!</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">running_server</span>.<span class="ruby-identifier">stop!</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">running_server</span>.<span class="ruby-identifier">stop</span>
  <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;== Sinatra has ended his set (crowd applauds)&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">handler_name</span> <span class="ruby-operator">=~</span><span class="ruby-regexp">/cgi/i</span>
  <span class="ruby-identifier">set</span> <span class="ruby-value">:running_server</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">set</span> <span class="ruby-value">:handler_name</span>, <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Base.html#method-c-stop-21">stop!</a>
        </div>
        

        
      </div>

    
      <div id="method-c-register" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">register</span><span
            class="method-args">(*extensions, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Register an extension. Alternatively take a block from which an extension
will be created and registered on the fly.</p>
          
          

          
          <div class="method-source-code" id="register-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1394</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">register</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">extensions</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">extensions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Module</span>.<span class="ruby-identifier">new</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-ivar">@extensions</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">extensions</span>
  <span class="ruby-identifier">extensions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">extension</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">extend</span> <span class="ruby-identifier">extension</span>
    <span class="ruby-identifier">extension</span>.<span class="ruby-identifier">registered</span>(<span class="ruby-keyword">self</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">extension</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:registered</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-reset-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reset!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Removes all routes, filters, middleware and extension hooks from the
current class (not routes/filters/… defined by its superclass).</p>
          
          

          
          <div class="method-source-code" id="reset-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1169</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reset!</span>
  <span class="ruby-ivar">@conditions</span>     = []
  <span class="ruby-ivar">@routes</span>         = {}
  <span class="ruby-ivar">@filters</span>        = {<span class="ruby-value">:before</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-value">:after</span> =<span class="ruby-operator">&gt;</span> []}
  <span class="ruby-ivar">@errors</span>         = {}
  <span class="ruby-ivar">@middleware</span>     = []
  <span class="ruby-ivar">@prototype</span>      = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@extensions</span>     = []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:templates</span>)
    <span class="ruby-ivar">@templates</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>,<span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">templates</span>[<span class="ruby-identifier">key</span>] }
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@templates</span> = {}
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-route" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">route</span><span
            class="method-args">(verb, path, options = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="route-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1579</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">route</span>(<span class="ruby-identifier">verb</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-comment"># Because of self.options.host</span>
  <span class="ruby-identifier">host_name</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-value">:host</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-value">:host</span>)
  <span class="ruby-identifier">enable</span> <span class="ruby-value">:empty_path_info</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">==</span> <span class="ruby-string">&quot;&quot;</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">empty_path_info</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">signature</span> = <span class="ruby-identifier">compile!</span>(<span class="ruby-identifier">verb</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">block</span>, <span class="ruby-identifier">options</span>)
  (<span class="ruby-ivar">@routes</span>[<span class="ruby-identifier">verb</span>] <span class="ruby-operator">||=</span> []) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">signature</span>
  <span class="ruby-identifier">invoke_hook</span>(<span class="ruby-value">:route_added</span>, <span class="ruby-identifier">verb</span>, <span class="ruby-identifier">path</span>, <span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">signature</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-run-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run!</span><span
            class="method-args">(options = {}, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run the <a href="../../../Sinatra.html">Sinatra</a> app as a self-hosted
server using Thin, Puma, Mongrel, or WEBrick (in that order). If given a
block, will call with the constructed handler once we have taken the stage.</p>
          
          

          
          <div class="method-source-code" id="run-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1434</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">run!</span>(<span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">running?</span>
  <span class="ruby-identifier">set</span> <span class="ruby-identifier">options</span>
  <span class="ruby-identifier">handler</span>         = <span class="ruby-identifier">detect_rack_handler</span>
  <span class="ruby-identifier">handler_name</span>    = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/.*::/</span>, <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-identifier">server_settings</span> = <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:server_settings</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">server_settings</span> <span class="ruby-operator">:</span> {}
  <span class="ruby-identifier">server_settings</span>.<span class="ruby-identifier">merge!</span>(<span class="ruby-value">:Port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">port</span>, <span class="ruby-value">:Host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bind</span>)

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">start_server</span>(<span class="ruby-identifier">handler</span>, <span class="ruby-identifier">server_settings</span>, <span class="ruby-identifier">handler_name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EADDRINUSE</span>
    <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;== Someone is already performing on port #{port}!&quot;</span>
    <span class="ruby-identifier">raise</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">quit!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Base.html#method-c-start-21">start!</a>
        </div>
        

        
      </div>

    
      <div id="method-c-running-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">running?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Check whether the self-hosted server is running or not.</p>
          
          

          
          <div class="method-source-code" id="running-3F-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1455</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">running?</span>
  <span class="ruby-identifier">running_server?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-safe_ignore" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">safe_ignore</span><span
            class="method-args">(ignore)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="safe_ignore-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1693</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">safe_ignore</span>(<span class="ruby-identifier">ignore</span>)
  <span class="ruby-identifier">unsafe_ignore</span> = []
  <span class="ruby-identifier">ignore</span> = <span class="ruby-identifier">ignore</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/%[\da-fA-F]{2}/</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hex</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">unsafe_ignore</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">hex</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>]
    <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">unsafe_patterns</span> = <span class="ruby-identifier">unsafe_ignore</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">unsafe</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">chars</span> = <span class="ruby-identifier">unsafe</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">//</span>).<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">char</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">char</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[A-Z]/</span>
        <span class="ruby-identifier">char</span> <span class="ruby-operator">&lt;&lt;=</span> <span class="ruby-identifier">char</span>.<span class="ruby-identifier">tr</span>(<span class="ruby-string">&#39;A-Z&#39;</span>, <span class="ruby-string">&#39;a-z&#39;</span>)
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">char</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-node">&quot;|(?:%[^#{chars[0]}].|%[#{chars[0]}][^#{chars[1]}])&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">unsafe_patterns</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-node">&quot;((?:[^#{ignore}/?#%]#{unsafe_patterns.join()})+)&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-node">&quot;([^#{ignore}/?#]+)&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-set" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set</span><span
            class="method-args">(option, value = (not_set = true), ignore_setter = false, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets an option to the given value.  If the value is a proc, the proc will
be called every time the option is accessed.</p>
          
          

          
          <div class="method-source-code" id="set-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">option</span>, <span class="ruby-identifier">value</span> = (<span class="ruby-identifier">not_set</span> = <span class="ruby-keyword">true</span>), <span class="ruby-identifier">ignore_setter</span> = <span class="ruby-keyword">false</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">not_set</span>
  <span class="ruby-identifier">value</span>, <span class="ruby-identifier">not_set</span> = <span class="ruby-identifier">block</span>, <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">not_set</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">option</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:each</span>)
    <span class="ruby-identifier">option</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set</span>(<span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span>) }
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">self</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">respond_to?</span>(<span class="ruby-node">&quot;#{option}=&quot;</span>) <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">ignore_setter</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">__send__</span>(<span class="ruby-node">&quot;#{option}=&quot;</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">setter</span> = <span class="ruby-identifier">proc</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set</span> <span class="ruby-identifier">option</span>, <span class="ruby-identifier">val</span>, <span class="ruby-keyword">true</span> }
  <span class="ruby-identifier">getter</span> = <span class="ruby-identifier">proc</span> { <span class="ruby-identifier">value</span> }

  <span class="ruby-keyword">case</span> <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Proc</span>
    <span class="ruby-identifier">getter</span> = <span class="ruby-identifier">value</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Symbol</span>, <span class="ruby-constant">Fixnum</span>, <span class="ruby-constant">FalseClass</span>, <span class="ruby-constant">TrueClass</span>, <span class="ruby-constant">NilClass</span>
    <span class="ruby-identifier">getter</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">inspect</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
    <span class="ruby-identifier">setter</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">val</span> = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">val</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">val</span>
      <span class="ruby-identifier">set</span> <span class="ruby-identifier">option</span>, <span class="ruby-identifier">val</span>, <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">define_singleton</span>(<span class="ruby-node">&quot;#{option}=&quot;</span>, <span class="ruby-identifier">setter</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">setter</span>
  <span class="ruby-identifier">define_singleton</span>(<span class="ruby-identifier">option</span>, <span class="ruby-identifier">getter</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">getter</span>
  <span class="ruby-identifier">define_singleton</span>(<span class="ruby-node">&quot;#{option}?&quot;</span>, <span class="ruby-node">&quot;!!#{option}&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">method_defined?</span> <span class="ruby-node">&quot;#{option}?&quot;</span>
  <span class="ruby-keyword">self</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_common_logger" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_common_logger</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_common_logger-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1743</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_common_logger</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Sinatra</span><span class="ruby-operator">::</span><span class="ruby-constant">CommonLogger</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_custom_logger" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_custom_logger</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_custom_logger-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1747</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_custom_logger</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">logging</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:to_int</span>
    <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Logger</span>, <span class="ruby-identifier">logging</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Logger</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_default_middleware" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_default_middleware</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_default_middleware-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1716</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_default_middleware</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">ExtendedRack</span>
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">ShowExceptions</span>       <span class="ruby-keyword">if</span> <span class="ruby-identifier">show_exceptions?</span>
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">MethodOverride</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">method_override?</span>
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Head</span>
  <span class="ruby-identifier">setup_logging</span>    <span class="ruby-identifier">builder</span>
  <span class="ruby-identifier">setup_sessions</span>   <span class="ruby-identifier">builder</span>
  <span class="ruby-identifier">setup_protection</span> <span class="ruby-identifier">builder</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_logging" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_logging</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_logging-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1730</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_logging</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">logging?</span>
    <span class="ruby-identifier">setup_common_logger</span>(<span class="ruby-identifier">builder</span>)
    <span class="ruby-identifier">setup_custom_logger</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">logging</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">setup_null_logger</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_middleware" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_middleware</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_middleware-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1726</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_middleware</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-identifier">middleware</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">a</span>,<span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span>(<span class="ruby-identifier">c</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">a</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_null_logger" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_null_logger</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_null_logger-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1739</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_null_logger</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">NullLogger</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_protection" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_protection</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_protection-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1755</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_protection</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">protection?</span>
  <span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">protection</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">protection</span>.<span class="ruby-identifier">dup</span> <span class="ruby-operator">:</span> {}
  <span class="ruby-identifier">protect_session</span>  = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">fetch</span>(<span class="ruby-value">:session</span>) { <span class="ruby-identifier">sessions?</span> }
  <span class="ruby-identifier">options</span>[<span class="ruby-value">:except</span>] = <span class="ruby-constant">Array</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:except</span>]
  <span class="ruby-identifier">options</span>[<span class="ruby-value">:except</span>] <span class="ruby-operator">+=</span> [<span class="ruby-value">:session_hijacking</span>, <span class="ruby-value">:remote_token</span>] <span class="ruby-keyword">unless</span> <span class="ruby-identifier">protect_session</span>
  <span class="ruby-identifier">options</span>[<span class="ruby-value">:reaction</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">:drop_session</span>
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Protection</span>, <span class="ruby-identifier">options</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_sessions" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_sessions</span><span
            class="method-args">(builder)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_sessions-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1765</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_sessions</span>(<span class="ruby-identifier">builder</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sessions?</span>
  <span class="ruby-identifier">options</span> = {}
  <span class="ruby-identifier">options</span>[<span class="ruby-value">:secret</span>] = <span class="ruby-identifier">session_secret</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">session_secret?</span>
  <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">sessions</span>.<span class="ruby-identifier">to_hash</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sessions</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:to_hash</span>
  <span class="ruby-identifier">builder</span>.<span class="ruby-identifier">use</span> <span class="ruby-constant">Rack</span><span class="ruby-operator">::</span><span class="ruby-constant">Session</span><span class="ruby-operator">::</span><span class="ruby-constant">Cookie</span>, <span class="ruby-identifier">options</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-setup_traps" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup_traps</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="setup_traps-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1519</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup_traps</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">traps?</span>
    <span class="ruby-identifier">at_exit</span> { <span class="ruby-identifier">quit!</span> }

    [<span class="ruby-value">:INT</span>, <span class="ruby-value">:TERM</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">signal</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">old_handler</span> = <span class="ruby-identifier">trap</span>(<span class="ruby-identifier">signal</span>) <span class="ruby-keyword">do</span>
        <span class="ruby-identifier">quit!</span>
        <span class="ruby-identifier">old_handler</span>.<span class="ruby-identifier">call</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">old_handler</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:call</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">set</span> <span class="ruby-value">:traps</span>, <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-start-21" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">start!</span><span
            class="method-args">(options = {}, &block)</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Base.html#method-c-run-21">run!</a>
        </div>
        
      </div>

    
      <div id="method-c-start_server" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start_server</span><span
            class="method-args">(handler, server_settings, handler_name) { |server| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Starts the server by running the <a href="../../../Rack.html">Rack</a>
Handler.</p>
          
          

          
          <div class="method-source-code" id="start_server-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1504</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start_server</span>(<span class="ruby-identifier">handler</span>, <span class="ruby-identifier">server_settings</span>, <span class="ruby-identifier">handler_name</span>)
  <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">run</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">server_settings</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">server</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-identifier">handler_name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/cgi/i</span>
      <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;== Sinatra (v#{Sinatra::VERSION}) has taken the stage on #{port} for #{environment} with backup from #{handler_name}&quot;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">setup_traps</span>
    <span class="ruby-identifier">set</span> <span class="ruby-value">:running_server</span>, <span class="ruby-identifier">server</span>
    <span class="ruby-identifier">set</span> <span class="ruby-value">:handler_name</span>,   <span class="ruby-identifier">handler_name</span>
    <span class="ruby-identifier">server</span>.<span class="ruby-identifier">threaded</span> = <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">threaded</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">server</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:threaded=</span>

    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">server</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-stop-21" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">stop!</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="Base.html#method-c-quit-21">quit!</a>
        </div>
        
      </div>

    
      <div id="method-c-synchronize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">synchronize</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="synchronize-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1791</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">synchronize</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">lock?</span>
    <span class="ruby-identifier">@@mutex</span>.<span class="ruby-identifier">synchronize</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-template" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">template</span><span
            class="method-args">(name, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Define a named template. The block must return the template source.</p>
          
          

          
          <div class="method-source-code" id="template-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1267</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">template</span>(<span class="ruby-identifier">name</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">line</span> = <span class="ruby-identifier">caller_locations</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-identifier">templates</span>[<span class="ruby-identifier">name</span>] = [<span class="ruby-identifier">block</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">line</span>.<span class="ruby-identifier">to_i</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-test-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">test?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="test-3F-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1405</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">test?</span>;        <span class="ruby-identifier">environment</span> <span class="ruby-operator">==</span> <span class="ruby-value">:test</span>        <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-unlink" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unlink</span><span
            class="method-args">(path, opts = {}, &bk)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="unlink-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1383</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unlink</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span>)  <span class="ruby-identifier">route</span> <span class="ruby-string">&#39;UNLINK&#39;</span>,  <span class="ruby-identifier">path</span>, <span class="ruby-identifier">opts</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">bk</span> <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-use" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">use</span><span
            class="method-args">(middleware, *args, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Use the specified <a href="../../../Rack.html">Rack</a> middleware</p>
          
          

          
          <div class="method-source-code" id="use-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">use</span>(<span class="ruby-identifier">middleware</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-ivar">@prototype</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@middleware</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">middleware</span>, <span class="ruby-identifier">args</span>, <span class="ruby-identifier">block</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-user_agent" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">user_agent</span><span
            class="method-args">(pattern)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Condition for matching user agent. Parameter should be Regexp. Will set <a
href=":agent">params</a>.</p>
          
          

          
          <div class="method-source-code" id="user_agent-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1550</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">user_agent</span>(<span class="ruby-identifier">pattern</span>)
  <span class="ruby-identifier">condition</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">user_agent</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">pattern</span>
      <span class="ruby-ivar">@params</span>[<span class="ruby-value">:agent</span>] = <span class="ruby-identifier">$~</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="Base.html#method-c-agent">agent</a>
        </div>
        

        
      </div>

    
      <div id="method-c-warn" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">warn</span><span
            class="method-args">(message)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>used for deprecation warnings</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="warn-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1800</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">warn</span>(<span class="ruby-identifier">message</span>)
  <span class="ruby-keyword">super</span> <span class="ruby-identifier">message</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;\n\tfrom #{cleaned_caller.first.join(&#39;:&#39;)}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">(env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="../../../Rack.html">Rack</a> call interface.</p>
          
          

          
          <div class="method-source-code" id="call-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 893</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">env</span>)
  <span class="ruby-identifier">dup</span>.<span class="ruby-identifier">call!</span>(<span class="ruby-identifier">env</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-forward" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">forward</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Forward the request to the downstream app – middleware only.</p>
          
          

          
          <div class="method-source-code" id="forward-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 951</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">forward</span>
  <span class="ruby-identifier">fail</span> <span class="ruby-string">&quot;downstream app not set&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:call</span>
  <span class="ruby-identifier">status</span>, <span class="ruby-identifier">headers</span>, <span class="ruby-identifier">body</span> = <span class="ruby-ivar">@app</span>.<span class="ruby-identifier">call</span> <span class="ruby-identifier">env</span>
  <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">status</span>
  <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">body</span> = <span class="ruby-identifier">body</span>
  <span class="ruby-ivar">@response</span>.<span class="ruby-identifier">headers</span>.<span class="ruby-identifier">merge!</span> <span class="ruby-identifier">headers</span>
  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-halt" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">halt</span><span
            class="method-args">(*response)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Exit the current block, halts any further processing of the request, and
returns the specified response.</p>
          
          

          
          <div class="method-source-code" id="halt-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 938</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">halt</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">response</span>)
  <span class="ruby-identifier">response</span> = <span class="ruby-identifier">response</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">response</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">throw</span> <span class="ruby-value">:halt</span>, <span class="ruby-identifier">response</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-options" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">options</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="options-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 930</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">options</span>
  <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Sinatra::Base#options is deprecated and will be removed, &quot;</span>          <span class="ruby-node">&quot;use #settings instead.&quot;</span>
  <span class="ruby-identifier">settings</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-pass" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">pass</span><span
            class="method-args">(&block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Pass control to the next matching route. If there are no more matching
routes, <a href="../../../Sinatra.html">Sinatra</a> will return a 404
response.</p>
          
          

          
          <div class="method-source-code" id="pass-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 946</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">pass</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-identifier">throw</span> <span class="ruby-value">:pass</span>, <span class="ruby-identifier">block</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-settings" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">settings</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Access settings defined with <a href="Base.html#method-c-set">::set</a>.</p>
          
          

          
          <div class="method-source-code" id="settings-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 926</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">settings</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">settings</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-dispatch-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dispatch!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Dispatch a request with error handling.</p>
          
          

          
          <div class="method-source-code" id="dispatch-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1080</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dispatch!</span>
  <span class="ruby-identifier">invoke</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">static!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">static?</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">request</span>.<span class="ruby-identifier">get?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">request</span>.<span class="ruby-identifier">head?</span>)
    <span class="ruby-identifier">filter!</span> <span class="ruby-value">:before</span>
    <span class="ruby-identifier">route!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">boom</span>
  <span class="ruby-identifier">invoke</span> { <span class="ruby-identifier">handle_exception!</span>(<span class="ruby-identifier">boom</span>) }
<span class="ruby-keyword">ensure</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">filter!</span> <span class="ruby-value">:after</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.static_file&#39;</span>]
  <span class="ruby-keyword">rescue</span> <span class="ruby-operator">::</span><span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">boom</span>
    <span class="ruby-identifier">invoke</span> { <span class="ruby-identifier">handle_exception!</span>(<span class="ruby-identifier">boom</span>) } <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-dump_errors-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dump_errors!</span><span
            class="method-args">(boom)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="dump_errors-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1142</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dump_errors!</span>(<span class="ruby-identifier">boom</span>)
  <span class="ruby-identifier">msg</span> = [<span class="ruby-node">&quot;#{Time.now.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)} - #{boom.class} - #{boom.message}:&quot;</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">boom</span>.<span class="ruby-identifier">backtrace</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n\t&quot;</span>)
  <span class="ruby-ivar">@env</span>[<span class="ruby-string">&#39;rack.errors&#39;</span>].<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">msg</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-error_block-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">error_block!</span><span
            class="method-args">(key, *block_params)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Find an custom error block for the key(s) specified.</p>
          
          

          
          <div class="method-source-code" id="error_block-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1127</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">error_block!</span>(<span class="ruby-identifier">key</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">block_params</span>)
  <span class="ruby-identifier">base</span> = <span class="ruby-identifier">settings</span>
  <span class="ruby-keyword">while</span> <span class="ruby-identifier">base</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:errors</span>)
    <span class="ruby-keyword">next</span> <span class="ruby-identifier">base</span> = <span class="ruby-identifier">base</span>.<span class="ruby-identifier">superclass</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">args_array</span> = <span class="ruby-identifier">base</span>.<span class="ruby-identifier">errors</span>[<span class="ruby-identifier">key</span>]
    <span class="ruby-identifier">args_array</span>.<span class="ruby-identifier">reverse_each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">first</span> = <span class="ruby-identifier">args</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">args_array</span>.<span class="ruby-identifier">first</span>
      <span class="ruby-identifier">args</span> <span class="ruby-operator">+=</span> [<span class="ruby-identifier">block_params</span>]
      <span class="ruby-identifier">resp</span> = <span class="ruby-identifier">process_route</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">resp</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">first</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:superclass</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">superclass</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Exception</span>
  <span class="ruby-identifier">error_block!</span>(<span class="ruby-identifier">key</span>.<span class="ruby-identifier">superclass</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">block_params</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filter-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter!</span><span
            class="method-args">(type, base = settings)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run filters defined on the class and all superclasses.</p>
          
          

          
          <div class="method-source-code" id="filter-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 963</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter!</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">base</span> = <span class="ruby-identifier">settings</span>)
  <span class="ruby-identifier">filter!</span> <span class="ruby-identifier">type</span>, <span class="ruby-identifier">base</span>.<span class="ruby-identifier">superclass</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">base</span>.<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:filters</span>)
  <span class="ruby-identifier">base</span>.<span class="ruby-identifier">filters</span>[<span class="ruby-identifier">type</span>].<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span> <span class="ruby-identifier">process_route</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-force_encoding" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">force_encoding</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Fixes encoding issues by</p>
<ul><li>
<p>defaulting to UTF-8</p>
</li><li>
<p>casting params to Encoding.default_external</p>
</li></ul>

<p>The latter might not be necessary if <a href="../../../Rack.html">Rack</a>
handles it one day. Keep an eye on Rack&#39;s LH #100.</p>
          
          

          
          <div class="method-source-code" id="force_encoding-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1818</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">force_encoding</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>) <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-handle_exception-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">handle_exception!</span><span
            class="method-args">(boom)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Error handling during requests.</p>
          
          

          
          <div class="method-source-code" id="handle_exception-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1097</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">handle_exception!</span>(<span class="ruby-identifier">boom</span>)
  <span class="ruby-ivar">@env</span>[<span class="ruby-string">&#39;sinatra.error&#39;</span>] = <span class="ruby-identifier">boom</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">boom</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:http_status</span>
    <span class="ruby-identifier">status</span>(<span class="ruby-identifier">boom</span>.<span class="ruby-identifier">http_status</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">use_code?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">boom</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:code</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">boom</span>.<span class="ruby-identifier">code</span>.<span class="ruby-identifier">between?</span> <span class="ruby-value">400</span>, <span class="ruby-value">599</span>
    <span class="ruby-identifier">status</span>(<span class="ruby-identifier">boom</span>.<span class="ruby-identifier">code</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">status</span>(<span class="ruby-value">500</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">status</span>(<span class="ruby-value">500</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">between?</span> <span class="ruby-value">400</span>, <span class="ruby-value">599</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">server_error?</span>
    <span class="ruby-identifier">dump_errors!</span> <span class="ruby-identifier">boom</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">dump_errors?</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-identifier">boom</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">show_exceptions?</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">show_exceptions</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:after_handler</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">not_found?</span>
    <span class="ruby-identifier">headers</span>[<span class="ruby-string">&#39;X-Cascade&#39;</span>] = <span class="ruby-string">&#39;pass&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">x_cascade?</span>
    <span class="ruby-identifier">body</span> <span class="ruby-string">&#39;&lt;h1&gt;Not Found&lt;/h1&gt;&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">error_block!</span>(<span class="ruby-identifier">boom</span>.<span class="ruby-identifier">class</span>, <span class="ruby-identifier">boom</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">error_block!</span>(<span class="ruby-identifier">status</span>, <span class="ruby-identifier">boom</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword">or</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">server_error?</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-identifier">boom</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">raise_errors?</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">show_exceptions?</span>
  <span class="ruby-identifier">error_block!</span> <span class="ruby-constant">Exception</span>, <span class="ruby-identifier">boom</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-indifferent_hash" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">indifferent_hash</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a Hash with indifferent access.</p>
          
          

          
          <div class="method-source-code" id="indifferent_hash-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1060</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">indifferent_hash</span>
  <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">hash</span>,<span class="ruby-identifier">key</span><span class="ruby-operator">|</span> <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">Symbol</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">key</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-indifferent_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">indifferent_params</span><span
            class="method-args">(object)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Enable string or symbol key access to the nested params hash.</p>
          
          

          
          <div class="method-source-code" id="indifferent_params-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1046</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">indifferent_params</span>(<span class="ruby-identifier">object</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">object</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Hash</span>
    <span class="ruby-identifier">new_hash</span> = <span class="ruby-identifier">indifferent_hash</span>
    <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span> <span class="ruby-identifier">new_hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">indifferent_params</span>(<span class="ruby-identifier">value</span>) }
    <span class="ruby-identifier">new_hash</span>
  <span class="ruby-keyword">when</span> <span class="ruby-constant">Array</span>
    <span class="ruby-identifier">object</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">indifferent_params</span>(<span class="ruby-identifier">item</span>) }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">object</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-invoke" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invoke</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run the block with &#39;throw :halt&#39; support and apply result to the
response.</p>
          
          

          
          <div class="method-source-code" id="invoke-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1065</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invoke</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">catch</span>(<span class="ruby-value">:halt</span>) { <span class="ruby-keyword">yield</span> }
  <span class="ruby-identifier">res</span> = [<span class="ruby-identifier">res</span>] <span class="ruby-keyword">if</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword">or</span> <span class="ruby-constant">String</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">res</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">res</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">Fixnum</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">first</span>
    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">res</span>.<span class="ruby-identifier">dup</span>
    <span class="ruby-identifier">status</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">shift</span>)
    <span class="ruby-identifier">body</span>(<span class="ruby-identifier">res</span>.<span class="ruby-identifier">pop</span>)
    <span class="ruby-identifier">headers</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">res</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:each</span>
    <span class="ruby-identifier">body</span> <span class="ruby-identifier">res</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">nil</span> <span class="ruby-comment"># avoid double setting the same response tuple twice</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_route" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_route</span><span
            class="method-args">(pattern, keys, conditions, block = nil, values = []) { |self, values| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>If the current request matches pattern and conditions, fill params with
keys and call the given block. Revert params afterwards.</p>

<p>Returns pass block.</p>
          
          

          
          <div class="method-source-code" id="process_route-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1001</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_route</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">keys</span>, <span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">block</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">values</span> = [])
  <span class="ruby-identifier">route</span> = <span class="ruby-ivar">@request</span>.<span class="ruby-identifier">path_info</span>
  <span class="ruby-identifier">route</span> = <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">route</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-keyword">and</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">empty_path_info?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">match</span> = <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">route</span>)
  <span class="ruby-identifier">values</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">match</span>.<span class="ruby-identifier">captures</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">force_encoding</span> <span class="ruby-constant">URI_INSTANCE</span>.<span class="ruby-identifier">unescape</span>(<span class="ruby-identifier">v</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">values</span>.<span class="ruby-identifier">any?</span>
    <span class="ruby-identifier">original</span>, <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">params</span>, <span class="ruby-identifier">params</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-string">&#39;splat&#39;</span> =<span class="ruby-operator">&gt;</span> [], <span class="ruby-string">&#39;captures&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">values</span>)
    <span class="ruby-identifier">keys</span>.<span class="ruby-identifier">zip</span>(<span class="ruby-identifier">values</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-ivar">@params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">?</span> <span class="ruby-ivar">@params</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">:</span> <span class="ruby-ivar">@params</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">catch</span>(<span class="ruby-value">:pass</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">conditions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> <span class="ruby-identifier">throw</span> <span class="ruby-value">:pass</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">bind</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">call</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span> }
    <span class="ruby-identifier">block</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">block</span>[<span class="ruby-keyword">self</span>, <span class="ruby-identifier">values</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword">yield</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">values</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-ivar">@params</span> = <span class="ruby-identifier">original</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">original</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-route-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">route!</span><span
            class="method-args">(base = settings, pass_block = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run routes defined on the class and all superclasses.</p>
          
          

          
          <div class="method-source-code" id="route-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 969</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">route!</span>(<span class="ruby-identifier">base</span> = <span class="ruby-identifier">settings</span>, <span class="ruby-identifier">pass_block</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">routes</span> = <span class="ruby-identifier">base</span>.<span class="ruby-identifier">routes</span>[<span class="ruby-ivar">@request</span>.<span class="ruby-identifier">request_method</span>]
    <span class="ruby-identifier">routes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">keys</span>, <span class="ruby-identifier">conditions</span>, <span class="ruby-identifier">block</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">returned_pass_block</span> = <span class="ruby-identifier">process_route</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">keys</span>, <span class="ruby-identifier">conditions</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.route&#39;</span>] = <span class="ruby-identifier">block</span>.<span class="ruby-identifier">instance_variable_get</span>(<span class="ruby-value">:@route_name</span>)
        <span class="ruby-identifier">route_eval</span> { <span class="ruby-identifier">block</span>[<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>] }
      <span class="ruby-keyword">end</span>

      <span class="ruby-comment"># don&#39;t wipe out pass_block in superclass</span>
      <span class="ruby-identifier">pass_block</span> = <span class="ruby-identifier">returned_pass_block</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">returned_pass_block</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Run routes defined in superclass.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">base</span>.<span class="ruby-identifier">superclass</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:routes</span>)
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">route!</span>(<span class="ruby-identifier">base</span>.<span class="ruby-identifier">superclass</span>, <span class="ruby-identifier">pass_block</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">route_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">pass_block</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">pass_block</span>
  <span class="ruby-identifier">route_missing</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-route_eval" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">route_eval</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Run a route block and throw :halt with the result.</p>
          
          

          
          <div class="method-source-code" id="route_eval-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 992</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">route_eval</span>
  <span class="ruby-identifier">throw</span> <span class="ruby-value">:halt</span>, <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-route_missing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">route_missing</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>No matching route was found or all routes passed. The default
implementation is to forward the request downstream when running as
middleware (@app is non-nil); when no downstream app is set, raise a <a
href="../../NotFound.html">NotFound</a> exception. Subclasses can override
this method to perform custom route miss logic.</p>
          
          

          
          <div class="method-source-code" id="route_missing-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1025</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">route_missing</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@app</span>
    <span class="ruby-identifier">forward</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotFound</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-static-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">static!</span><span
            class="method-args">(options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Attempt to serve static files from public directory. Throws :halt when a
matching file is found, returns nil otherwise.</p>
          
          

          
          <div class="method-source-code" id="static-21-source">
            <pre><span class="ruby-comment"># File lib/sinatra/base.rb, line 1035</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">static!</span>(<span class="ruby-identifier">options</span> = {})
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> (<span class="ruby-identifier">public_dir</span> = <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">public_folder</span>).<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-node">&quot;#{public_dir}#{unescape(request.path_info)}&quot;</span> )
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">path</span>)

  <span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;sinatra.static_file&#39;</span>] = <span class="ruby-identifier">path</span>
  <span class="ruby-identifier">cache_control</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">settings</span>.<span class="ruby-identifier">static_cache_control</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">settings</span>.<span class="ruby-identifier">static_cache_control?</span>
  <span class="ruby-identifier">send_file</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-value">:disposition</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">nil</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

