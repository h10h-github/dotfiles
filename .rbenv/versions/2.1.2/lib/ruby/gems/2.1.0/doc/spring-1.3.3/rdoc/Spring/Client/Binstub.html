<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Spring::Client::Binstub - spring-1.3.3 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script src="../../js/jquery.js"></script>
<script src="../../js/darkfish.js"></script>

<link href="../../css/fonts.css" rel="stylesheet">
<link href="../../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../../table_of_contents.html#pages">Pages</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Command
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-call">::call</a>
    
    <li ><a href="#method-c-description">::description</a>
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-c-rails_command">::rails_command</a>
    
    <li ><a href="#method-i-call">#call</a>
    
    <li ><a href="#method-i-find_commands">#find_commands</a>
    
    <li ><a href="#method-i-spring_binstub">#spring_binstub</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Spring::Client::Binstub">
  <h1 id="class-Spring::Client::Binstub" class="class">
    class Spring::Client::Binstub
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="LOADER">LOADER
        
        <dd><p>If loading the bin/spring file works, it&#39;ll run spring which will
eventually call Kernel.exit. This means that in the client process we will
never execute the lines after this block. But if the spring client is not
invoked for whatever reason, then the Kernel.exit won&#39;t happen, and so
we&#39;ll fall back to the lines after this block, which should cause the
“unsprung” version of the command to run.</p>
        
      
        <dt id="OLD_BINSTUB">OLD_BINSTUB
        
        <dd>
        
      
        <dt id="SHEBANG">SHEBANG
        
        <dd>
        
      
        <dt id="SPRING">SPRING
        
        <dd><p>The defined? check ensures these lines don&#39;t execute when we load the
binstub from the application process. Which means that in the application
process we&#39;ll execute the lines which come after the <a
href="Binstub.html#LOADER">LOADER</a> block, which is what we want.</p>

<p>Parsing the lockfile in this way is pretty nasty but reliable enough The
regex ensures that the match must be between a GEM line and an empty line,
so it won&#39;t go on to the next section.</p>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-bindir" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">bindir</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-items" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">items</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">(args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="call-source">
            <pre><span class="ruby-comment"># File lib/spring/client/binstub.rb, line 127</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;spring/commands&quot;</span>
  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-description" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">description</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="description-source">
            <pre><span class="ruby-comment"># File lib/spring/client/binstub.rb, line 119</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">description</span>
  <span class="ruby-string">&quot;Generate spring based binstubs. Use --all to generate a binstub for all known commands.&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/spring/client/binstub.rb, line 132</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">super</span>

  <span class="ruby-ivar">@bindir</span> = <span class="ruby-identifier">env</span>.<span class="ruby-identifier">root</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;bin&quot;</span>)
  <span class="ruby-ivar">@all</span>    = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@mode</span>   = <span class="ruby-value">:add</span>
  <span class="ruby-ivar">@items</span>  = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">drop</span>(<span class="ruby-value">1</span>)
                .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-identifier">find_commands</span> <span class="ruby-identifier">name</span> }
                .<span class="ruby-identifier">inject</span>(<span class="ruby-constant">Set</span>.<span class="ruby-identifier">new</span>, <span class="ruby-value">:|</span>)
                .<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">command</span><span class="ruby-operator">|</span> <span class="ruby-constant">Item</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">command</span>) }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-rails_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rails_command</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="rails_command-source">
            <pre><span class="ruby-comment"># File lib/spring/client/binstub.rb, line 123</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rails_command</span>
  <span class="ruby-ivar">@rails_command</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">CommandWrapper</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;rails&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-call" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">call</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="call-source">
            <pre><span class="ruby-comment"># File lib/spring/client/binstub.rb, line 166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">call</span>
  <span class="ruby-keyword">case</span> <span class="ruby-ivar">@mode</span>
  <span class="ruby-keyword">when</span> <span class="ruby-value">:add</span>
    <span class="ruby-identifier">bindir</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">bindir</span>.<span class="ruby-identifier">exist?</span>

    <span class="ruby-constant">File</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">spring_binstub</span>, <span class="ruby-constant">SPRING</span>)
    <span class="ruby-identifier">spring_binstub</span>.<span class="ruby-identifier">chmod</span> <span class="ruby-value">0755</span>

    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:add</span>)
  <span class="ruby-keyword">when</span> <span class="ruby-value">:remove</span>
    <span class="ruby-identifier">spring_binstub</span>.<span class="ruby-identifier">delete</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@all</span>
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:remove</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-find_commands" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">find_commands</span><span
            class="method-args">(name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="find_commands-source">
            <pre><span class="ruby-comment"># File lib/spring/client/binstub.rb, line 144</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_commands</span>(<span class="ruby-identifier">name</span>)
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">name</span>
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;--all&quot;</span>
    <span class="ruby-ivar">@all</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-identifier">commands</span> = <span class="ruby-constant">Spring</span>.<span class="ruby-identifier">commands</span>.<span class="ruby-identifier">dup</span>
    <span class="ruby-identifier">commands</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">_</span><span class="ruby-operator">|</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&quot;rails_&quot;</span>) }
    <span class="ruby-identifier">commands</span>.<span class="ruby-identifier">values</span> <span class="ruby-operator">+</span> [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">rails_command</span>]
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;--remove&quot;</span>
    <span class="ruby-ivar">@mode</span> = <span class="ruby-value">:remove</span>
    []
  <span class="ruby-keyword">when</span> <span class="ruby-string">&quot;rails&quot;</span>
    [<span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">rails_command</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">command</span> = <span class="ruby-constant">Spring</span>.<span class="ruby-identifier">commands</span>[<span class="ruby-identifier">name</span>]
      [<span class="ruby-identifier">command</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;The &#39;#{name}&#39; command is not known to spring.&quot;</span>
      <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-spring_binstub" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">spring_binstub</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="spring_binstub-source">
            <pre><span class="ruby-comment"># File lib/spring/client/binstub.rb, line 183</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">spring_binstub</span>
  <span class="ruby-identifier">bindir</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;spring&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.2.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

